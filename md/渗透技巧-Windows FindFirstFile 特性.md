> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/9vP43SHhrEJhMk7mVSuSGw)

  

文章首发于：

火线Zone社区（https://zone.huoxian.cn/）

  

**前言**

  

首先这个思路来自于书籍《代码审计-企业级 Web 代码安全架构》，看完之后感觉挺新奇的值得分享（也可能是因为我太菜了，之前不了解这种姿势），推荐大家去阅读原书。

  

**利用原理**

  

我们都知道，在我们进行文件包含的时候，上传的文件名很大几率都是经过处理的（MD5、时间戳等）。

  

那么这样，我们很可能会碰到马子上传成功了，但是由于服务器未返回文件名，不知道完整路径而无法利用。

  

这时我们就可以使用这个技巧，在知道文件所在目录，但不知道文件名的情况下来包含我们的马子。（也可根据常见的文件名处理逻辑去猜测爆破文件名。）

  

**利用条件**

  

利用的条件为：Windows，这是因为 Windows 在搜索文件时使用到了 FindFirstFile 这一个 winapi 函数，该函数到一个文件夹（包括子文件夹）去搜索指定文件。

  

**利用方法**

  

我们可以将文件名不可知部分之后的字符串使用 "<" 或 ">" 代替，但是需要注意：一个 "<" 或 ">" 只能代表一个字符。

如果我们上传的马子为 shell.php，那么请求 "s<" 或者 ”s>“ 都是访问不到文件的。需要使用 "s<<" 才能访问到，含义为继续往下搜索。

  

**演示**

  

这里只是作为姿势的演示，真实环境下需要结合场景进行变通。

如下图，我们可以看到一个存在文件包含漏洞的 test.php 以及我们所上传 shell.txt 后名称被处理的马子 

shell_2021123166666.txt

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cYsIMIqYHELFchJDwkkWiaOhBQZtXQibhaPU1lZZHp4PThEIB8cwSwSwA/640?wx_fmt=png)

  

在正常情况下，我们需要包含我们的马子需要这样操作：

test.php?file=shell_2021123166666.txt

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682c6jr3Pe438vQmYrrbibrQfWLXZiarYfWpx4uqIV7pkJ9gnh2slfjotPmg/640?wx_fmt=png)

  

那么我们在不知道马子的完整文件名时，就可以这样去访问。

test.php?file=shell<<

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682c8ib5qJOicoUFMicXZDNhbDlkFgCW5ibJ3SNe6EIyuwFTcY4aEAWuaJT0QA/640?wx_fmt=png)

  

**注意1：**

shell<<、shel<<、she<<、sh<<、s<< 都是可以访问到的。

**注意2：**

此特性只可在 Windows 中使用。

**注意3：**

经过测试发现，在使用 "<<" 去匹配时，模糊时会优先匹配值最小的文件名称，如下图：

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682c9oGCAbvvpibwCR7ib4LlVnSDL32xTbkxIBeuh032icqD6oKlu8rbLJmOQ/640?wx_fmt=png)

  

2020 < 2021 < 2022

在访问 test.php?file=shell_202<< 时，由于我们存在 2020、2021、2022 文件，0 < 1 < 2，所以会匹配到 2020 文件。

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cgibqLYyKPDGrtpFnW1jrfp7VSmqggLjQW9xrlqTKhYhQMNzynSP9Kzw/640?wx_fmt=png)

  

如果想要匹配到我们的马子，也就是 2021，则需要增加文件名的准确度，也就是匹配 test.php?file=shell_2021<<

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cicicZBRSRdVsMp9NxenMUqu1GKiaoWOd99FnlZT234w8o6icHiaXWRiaK2gg/640?wx_fmt=png)

  

补充：不要忘记 "<" 或 ">" 只能代表一个字符，因此在文件名长度不确定时，我们提供的半截文件名加"<" 或 ">" 的字符数之和不等于完整文件名字符数，会匹配失败。

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cQFtNWrVQzlIjkkg48V5aMUcDJebQHqiatJYickUQxSfeqzEKZ26QHbeA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cOp3JyQQibj27FfNzKHb62c7yfhGSUib1SR0QMVmPlibo6kWg8W8hQgE8A/640?wx_fmt=png)

  

**小结**

  

此特性并不是只有文件包含函数才可用，事实上还有很多函数也一样可利用这个特性，我们在进行代码审计的时候也可以注意一下，说不定就能挖出意想不到的漏洞（关于 PHP 的代码审计可了解我之前发的 https://zone.huoxian.cn/d/752-cms 文章:）。

  

函数可见下图，最后祝各位师傅们新年挖洞多多，￥多多。

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cB1MUicoicOwpduVfHwlULO5KKRbJCuz0JPWPTwdcmVV8xmF4jgCM4HKA/640?wx_fmt=png)

  

  

**【火线—白帽技术交流群】**

进群可以与技术大佬互相交流

进群有机会免费领取节假日礼品

进群可以免费观看技术分享直播

识别二维码回复【**交流群**】进群

![](https://mmbiz.qpic.cn/mmbiz_gif/27gyKJMBMtuVONoDeF9Ub9RJwcJZy2GqDInd6oJscwa4tGkibUqKibXefUnRPVkK7hc62XoYUCYZPtdSQEhR66eA/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaSbIbiaOU7llGXHgQPdKE9pFatLqbadicicDlEqzHphY8OzzVibyzkE1phBhNp9W39ib68m70Ke4msJx4g/640?wx_fmt=jpeg)

  

**【火线zone社区周激励】**

2022.1.10 ～ 2022.1.16公告

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaSbIbiaOU7llGXHgQPdKE9pFISfhCxw8TO0mOEPIsJyTNEC7w14DaukLiaVa8dmmNtLgrtry19kWq5Q/640?wx_fmt=png)

  

**【相关精选文章】**

[![](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaSbIbiaOU7llGXHgQPdKE9pFZr3tM4h6DX6ibcLDNEIxcl3HRzdAGky1rpuCMAvLageBHTdryJQetzQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247491223&idx=1&sn=bd7cc7f0bb2ab2c9ee78c8e9f0e55e35&chksm=eaaa96b7dddd1fa1efa2b5b962b32dfa86af1f5436d2896c26ff44057b0c7da0b47caa2b83fe&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaQoJ4CrlwX0DMxuggbg682cEDtyMQeAtYicILe0G4OJrkyN4iaACicsfKuhs9GhicCq20qHcJFkH4AJicw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247491333&idx=1&sn=802cd38b36a3060e0b4942d95901ef4a&chksm=eaaa9725dddd1e333e742a1f50df986a1acf1283ecbf09594584a2618162d2f3e464d8b64b3a&scene=21#wechat_redirect)

  

![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaSbIbiaOU7llGXHgQPdKE9pFibLkiaE2rHiaTwqdtKtiap8vYl2SD5hRpyOxGnCibHKvz77QOFYXWiaCxibqA/640?wx_fmt=png)

  

火线Zone是[火线安全平台]运营的封闭式实战安全攻防社区，研究讨论实战攻防技术，平台向顶尖的白帽子提供安全测试的云端基础设施，目前火线的高级白帽子数量已经近万人，欢迎具备分享和探索精神的白帽子加入火线Zone社区，共建一个有技术氛围的优质社区！

如需转载火线Zone公众号内的文章请联系火线小助手：hxanquan（微信）

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaSbIbiaOU7llGXHgQPdKE9pF42ibIPFic3eBEKaspqXnAmkwicbVzJF4YEq4DUjUaspFdfBLxyaDs0U3w/640?wx_fmt=jpeg)

 **微信号** 

huoxian_zone

  

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/YxSSnpu6MW0CIoKC0f9U1ALN0bHmzzVfdqHmAlujAniaYos5t6H3zUomx1QoILFNCMdeV5eknVH2AfsYvjfV6iag/640?wx_fmt=gif)

点击阅读原文，加入社区，共建一个有技术氛围的优质社区！