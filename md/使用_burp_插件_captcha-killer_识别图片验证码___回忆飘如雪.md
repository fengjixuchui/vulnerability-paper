<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [gv7.me](https://gv7.me/articles/2019/burp-captcha-killer-usage/)

> 0x01 开发背景说起对存在验证码的登录表单进行爆破，大部分人都会想到 PKav HTTP Fuzzer，这款工具在前些年确实给我们带来了不少便利。

[](#0x01-开发背景 "0x01 开发背景")0x01 开发背景
-----------------------------------

说起对存在验证码的登录表单进行爆破，大部分人都会想到`PKav HTTP Fuzzer`，这款工具在前些年确实给我们带来了不少便利。反观 burp 一直没有一个高度自定义通杀大部分图片验证码的识别方案，于是抽了点闲暇的时间开发了 [captcha-kille](https://github.com/c0ny1/captcha-killer)，希望 burp 也能用上各种好用的识别码技术。其设计理念是`只专注做好对各种验证码识别技术接口的调用！`说具体点就是 burp 通过同一个插件，就可以适配各种验证码识别接口，无需重复编写调用代码。今天不谈编码层面如何设计，感兴趣的可以去 github 看源码。此处只通过使用步骤来说明设计的细节。

[](#0x02-Step1-将获取验证码的数据包发送到插件 "0x02 Step1:将获取验证码的数据包发送到插件")0x02 Step1: 将获取验证码的数据包发送到插件
---------------------------------------------------------------------------------------

使用 burp 抓取获取验证码数据包，然后右键`captcha-killer` -> `send to captcha panel`发送数据包到插件的验证码请求面板。

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step1-1.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step1-1.png)将请求验证码数据包发送到插件

然后到切换到插件面板，点击获取即可拿到要识别的验证码图片内容。

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step1-2.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step1-2.png)请求获取验证码

**注意：获取验证码的 cookie 一定要和 intruder 发送的 cookie 相同！**

[](#0x03-Step2-配置识别接口的地址和请求包 "0x03 Step2:配置识别接口的地址和请求包")0x03 Step2: 配置识别接口的地址和请求包
---------------------------------------------------------------------------------

拿到验证码之后，就要设置接口来进行识别了。我们可以使用网上寻找免费的接口，用 burp 抓包，然后右键发送到插件的接口请求面板。

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step2-1.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step2-1.png)将接口调用请求发送到插件

然后我们把图片内容的位置用标签来代替。比如该例子使用的接口是 post 提交 image 参数，参数的值为图片二进制数据的 base64 编码后的 url 编码。那么`Request template`(请求模版) 面板应该填写如下：

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step2-2.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step2-2.png)接口请求模版设置

<table><thead><tr><th>ID</th><th>标签</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td><code>&lt;@IMG_RAW&gt;&lt;/@IMG_RAW&gt;</code></td><td>代表验证码图片原二进制内容</td></tr><tr><td>2</td><td><code>&lt;@URLENCODE&gt;&lt;/@URLENCODE&gt;</code></td><td>对标签内的内容进行 url 编码</td></tr><tr><td>3</td><td><code>&lt;@BASE64&gt;&lt;/@BASE64&gt;</code></td><td>对标签内的内容进行 base64 编码</td></tr></tbody></table>

最后点击 “识别” 即可获取到接口返回的数据包，同时在`request raw`可以看到调用接口最终发送的请求包。

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step2-3.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step2-3.png)模版被渲染为最终的请求

[](#0x03-Step3-设置用于匹配识别结果的规则 "0x03 Step3:设置用于匹配识别结果的规则")0x03 Step3: 设置用于匹配识别结果的规则
---------------------------------------------------------------------------------

通过上一步我们获取到了识别接口的返回结果，但是插件并不知道返回结果中，哪里是真正的识别结果。插件提供了 4 中方式进行匹配，可以根据具体情况选择合适的。

<table><thead><tr><th>ID</th><th>规则类型</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>Repose data</td><td>这种规则用于匹配接口返回包内容直接是识别结果</td></tr><tr><td>2</td><td>Regular expression</td><td>正则表达式, 适合比较复杂的匹配。比如接口返回包<code>{"coede":1,"result":"abcd"}</code>说明 abcd 是识别结果，我们可以编写规则为<code>result":"(.*?)"\}</code></td></tr><tr><td>3</td><td>Define the start and end positions</td><td>定义开始和结束位置, 使用上面的例子，可以编写规则<code>{"start":21,"end":25}</code></td></tr><tr><td>4</td><td>Defines the start and end strings</td><td>定义开始和结束字符，使用上面的例子，可以编写规则为<code>{"start":"result\":\","end":"\"\}"}</code></td></tr></tbody></table>

通过分析我们知道，接口返回的 json 数据中，字段`words`的值为识别结果。我们这里使用`Regular expression`(正则表达式) 来匹配，然后选择`yzep`右键`标记为识别结果`，系统会自动生成正则表达式规则`" (.*?)"\}\]`。

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step3-1.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step3-1.png)设置匹配方式和自动生成规则

注意：若右键标记自动生成的规则匹配不精确，可以人工进行微调。比如该例子中可以微调规则为`"words"\: "(.*?)"\}`将更加准确！

到达这步建议将配置好常用接口的 url，数据包已经匹配规则保存为模版，方便下次直接通过右键`模板库`中快速设置。同时插件也有默认的模版供大家使用与修改。

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step3-2.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step3-2.png)保存设置好的配置，方便下次快速配置

[](#0x04-Step4-在Intruder模块调用 "0x04 Step4:在Intruder模块调用")0x04 Step4: 在 Intruder 模块调用
-----------------------------------------------------------------------------------

配置好各项后，可以点击`锁定`对当前配置进行锁定，防止被修改导致爆破失败！接着安装以下步骤进行配置

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step4-1.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step4-1.png)设置 Intruder 的爆破模式和 payload 位置

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step4-2.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step4-2.png)验证码 payload 选择有插件来生成

[![](https://gv7.me/articles/2019/burp-captcha-killer-usage/step4-3.png)](https://gv7.me/articles/2019/burp-captcha-killer-usage/step4-3.png)进行爆破，可以通过对比识别结果看出识别率

[](#0x05-使用小案例 "0x05 使用小案例")0x05 使用小案例
--------------------------------------

后续将通过小案例来演示，如何通过 captcha-killer 让 burp 使用上各种技术识别验证码 (免费方案)，敬请期待！

*   《captcha-killer 调用 tesseract-ocr 识别验证码》[待发布]
*   《captcha-killer 调用完美识别验证码系统》[待发布]
*   《captcha-killer 调用百度 ocr 识别验证码》[待发布]
*   《capatch-killer + 机器学习识别验证码》[待发布]