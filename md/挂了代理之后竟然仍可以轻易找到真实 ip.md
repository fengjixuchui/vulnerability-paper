<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/pERWptf5o_XM_Todnn6f8Q)

免责声明

  

  

**本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。**

**只供对已授权的目标使用测试，对未授权目标的测试作者不承担责任，均由使用本人自行承担。**

![](https://mmbiz.qpic.cn/mmbiz_png/0x3kGZxwKTkyY7BrNkUwicjIkq3F2xlCIgGz7pBpnEMh3rvpbyH2DE2kIKVste0B2yP8TiavoOsuo9sMQKSj9uxQ/640?wx_fmt=png)

文章正文

  

  

通过 WEBRTC 结合 stun 服务器实现获取真实主机 IP

**测试：**  

真实 IP：  

![](https://mmbiz.qpic.cn/mmbiz_png/h8P1KUHOKuYj3ntuNEECUxlH9d1JyOAF4TJ10bJ0icyhhyALXnCOZJdkosdsQt4SUddicibiatuqlaHj6sicd39eZPQ/640?wx_fmt=png)

**挂代理之后的 ip**

![](https://mmbiz.qpic.cn/mmbiz_png/h8P1KUHOKuYj3ntuNEECUxlH9d1JyOAFpGNicM9pSTI1Dy2IBclFSZ1uVpY8mK4qgibcwMMEV88vfTxSCadoKktg/640?wx_fmt=png)

**保存以下代码到本地：**  

```
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  </head>
  <body>
  <h3>你的代理IP是：<div id=1></div></h3>
  
  <h3>你的真实IP是：<div id=2></div></h3>
    <script>
      
      // turn 配置
      const config = {
        iceServers: [{
           urls: "stun:stun.l.google.com:19302" // stun.voippro.com  stun.voipraider.com  这里使用谷歌，线上部署直接替换
        }]
      };
 
      // 构建
      let pc = new RTCPeerConnection(config);
      
      pc.onicecandidate = function(event) {
        if(event.candidate)
            handleCandidate(event.candidate.candidate);
      }
      
       function handleCandidate(candidate) { 
         if (candidate.indexOf("srflx") != -1) {
           console.log(candidate)
           var regex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/
           var ip_addr = regex.exec(candidate)[0];
           //alert("Your public network ip: "+ ip_addr)
           document.getElementById('2').innerHTML = ip_addr;
         }  
       }
       
      pc.createDataChannel("");
      
      pc.createOffer(function(result){
          pc.setLocalDescription(result);
      }, function(){});
</script>
    <script src='http://pv.sohu.com/cityjson?ie=utf-8'></script>
    <script>
    var ip=returnCitySN["cip"];
    //var city=returnCitySN["cname"];
    document.getElementById('1').innerHTML = ip;
</script>
  </body>
</html>
```

**在挂代理的条件下，访问，即可获得 代理后面的真实 IP：**  

**![](https://mmbiz.qpic.cn/mmbiz_png/h8P1KUHOKuYj3ntuNEECUxlH9d1JyOAFL8NFtOyzSN4ak7awuEiasyv42lGKdIMiawriatTZNnBCDNm1hLUqsm4Fw/640?wx_fmt=png)**

具体 WEBRTC、STUN 的原理，感兴趣的自行 google  

![](https://mmbiz.qpic.cn/mmbiz_png/0x3kGZxwKTkyY7BrNkUwicjIkq3F2xlCIgGz7pBpnEMh3rvpbyH2DE2kIKVste0B2yP8TiavoOsuo9sMQKSj9uxQ/640?wx_fmt=png)

技术交流

  

  

  

  

交流群

  

  

关注公众号回复 “**加群**”，添加 Z2OBot 小 K 自动拉你加入 **Z2O 安全攻防交流群**分享更多好东西。

![](https://mmbiz.qpic.cn/mmbiz_png/h8P1KUHOKuY9E2LvIlswNljP9IyicCzPZxkOfzs2Dtuex992CbtUiabzNmISZ4m55KFcNAs6DaibVTCzMiatIQ1m5Q/640?wx_fmt=png)

  

  

知识星球

  

  

**星球不定时更新最新漏洞复现，手把手教你，同时不定时更新 POC、内外网渗透测试骚操作。****涉及方向包括 Web 渗透、免杀绕过、内网攻防、代码审计、应急响应、云安全等**

![](https://mmbiz.qpic.cn/mmbiz_jpg/h8P1KUHOKubjVXO2QVicEtHJzDDzl0EuY7WCibgib7IWAkx4fpYSAibSRBkDQI0ian07gYbZSPO89P9nAX0cuCuQXQw/640?wx_fmt=jpeg)

  

  

关注我们

  

  

**关注福利：**

**回复 “****app****" 获取  app 渗透和 app 抓包教程**

**回复 “****渗透字典** **" 获取 针对一些字典重新划分处理，收集了几个密码管理字典生成器用来扩展更多字典的仓库。**

**回复 “****书籍** **" 获取 网络安全相关经典书籍电子版 pdf**

往期文章：

  

  

[**CVE-2022-30190 Follina Office RCE 分析【附自定义 word 模板 POC】**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247487751&idx=1&sn=b42b637157f9cf21cd62299346baf3f5&chksm=cea8fa47f9df735156337fa5b34b71ec11dbd6d8e96eb2684dc241c0a7ccfae0a4cec90d63a2&scene=21#wechat_redirect)  

[**邮箱附件钓鱼常用技法**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247487390&idx=1&sn=b99a7f0eb43e38222a9ff0fa3eb0ded4&chksm=cea8e4def9df6dc8d95a29f7b2daceb84e2e6bb2529596c519d10eaaf157a51d10ba1829235a&scene=21#wechat_redirect)

[**入侵痕迹清理**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247487424&idx=1&sn=5aa705aa06bca902f0ab27190b423d4e&chksm=cea8e480f9df6d96a827ee66e6b6ef7b8d04c1767a8bb6c73eb5ad18cdf9c383952d2163534c&scene=21#wechat_redirect)

[**一篇文章带你学会容器逃逸**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247486670&idx=1&sn=6822dd40dcc20121fce0c42188fcd49a&chksm=cea8e78ef9df6e987896bdbd6b7a96c48992782657680574d7015d72984e7ca67a25a0aeea5d&scene=21#wechat_redirect)

[**spring cloud function spel 表达式注入 RCE 复现**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247486607&idx=1&sn=659ee01cb0fe59d034080efc32a7348b&chksm=cea8e7cff9df6ed96a64bc0c6d2890c28a9df8f776062f53f67ceea0e88efb5bca3147f1c78b&scene=21#wechat_redirect)  
[**利用 burp 精准定位攻击者**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247486527&idx=1&sn=5891b6ef97724eec50464c72dd9c48e0&chksm=cea8e77ff9df6e69979bb2a3485852d5d3c8e11c77dd0eaba91367b203256fa587c33eff7fa8&scene=21#wechat_redirect)  
[**从此 Typora 代码块有了颜色**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247486501&idx=1&sn=73946992c1ddf5111dcf61b7afbc733f&chksm=cea8e765f9df6e73794e277e11f7d319ac4f18fbf7f7cc06f562428d2d653bf02dd11ba59340&scene=21#wechat_redirect)  
[**不会写免杀也能轻松过 defender 上线 CS**](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247486248&idx=1&sn=2a02490ec5574225715615f7b0baa28f&chksm=cea8e068f9df697e3e29aa0dd9417e4e2a7d12aa64bb403a4f014a85cd63384bd5d81a6201ab&scene=21#wechat_redirect)