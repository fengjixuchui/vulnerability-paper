<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/JZM0iLh084zaMitCGtCEQg)<table><tbody><tr><td width="557" valign="top" height="62"><p><strong>声明：</strong>该公众号分享的安全工具和项目均来源于网络，仅供安全研究与学习之用，如用于其他用途，由使用者承担全部法律及连带责任，与工具作者和本公众号无关。</p></td></tr></tbody></table>

**0x00 前言**

在 2021 年 12 月的某星期天的下午，成都飘着小雨，冷的瑟瑟发抖，在家里打开电脑开始学习，但是无意间发现之前渗透的非法网站又开起来了，但是只是一个宝塔页面，没有任何价值，于是在同 ip 下发现一个博彩网站，随之展开渗透  

  

**0x01 信息收集**

1. 以下由 tfxxx 来代替域名  

锁定网站：tfxxx.com

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80fYrgRMAL3TPfRVlHbM7azYibHz1PkRGkTRw4DaJ7wUXZfZtdO9qfgQQ/640?wx_fmt=png&wx_lazy=1&wx_co=1)

  

2. 查看服务器 ip 以及判断是否有 cdn

这个没有 cdn，很 nice  

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80ZiaGRANiagpanT9TvPwbbhAcxJq9cQqnMv7HK1zzrj5IyVfhBkMicibq8g/640?wx_fmt=png&wx_lazy=1&wx_co=1)

  

### 3. 目录扫描

总体来说，并没有得到什么有用的价值

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80icQ7KW08gTcNGyDHhAJSxtb4Plibficj6VMBYFT3PM29qwcNJLoxfzvAQ/640?wx_fmt=png&wx_lazy=1&wx_co=1)

  

### 4. 二级域名扫描

不错，得到了一个后台 admin.tfxxx.com，留着待会看

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80CMA3SEo6sfuAOP9Wx0DR0PabafNbpxyVZlVRTZjbxyk9ls282J7meg/640?wx_fmt=png&wx_lazy=1&wx_co=1)

  

5. 端口扫描

全端口扫描，这里就不截图了，扫的太慢了，基本上也没有啥利用的，远程端口更改了，扫出来的是 20119 端口

**0x02 漏洞探测**

1. 后台页面  

通过上面收集的信息来说，还是比较局限，先不管吧，有一个后台，就来尝试一下后台登录，看是否 ok

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80nT7rGBRKJp9IjX10icjhuiagURrzSvERxB5rPUITJAn1r9l3ReQX0e4g/640?wx_fmt=png&wx_lazy=1&wx_co=1)

2. 猜账户

随手一个 admin，进入到输入密码和安全码的页面，输入其他账号会提示用户名不正确，所以这里判断账号为：admin

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80Kb1TM6kOJDcRSSicqlBkdicyhSEIsBU4PCA0Nh01bU3P0OPNBKkSBfiaQ/640?wx_fmt=png&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80jtRIytic5pg0T1yibAXaaWKQKL8nIYvBE96EwVYEa2ia4ahxNefV2BABw/640?wx_fmt=png&wx_lazy=1&wx_co=1)

3. 爆破安全码

这里开始爆破安全码，因为进入到这个界面随便输入一个安全码它会提示安全码不正确，所以我在想如果把安全码输入正确了密码不对，它是不是只会提示密码错误？怀着这个问题用 burp 来爆破看看

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80S2yKwQBs86OyKRhuDMUR0L7xEFgmlmJ7icYHcWgRibz8u87GLGw7ZjKw/640?wx_fmt=png&wx_lazy=1&wx_co=1)

通过 URL 解码，然后在网站后台登录看看，既然这样提示了，那应该是验证了我的想法，所以这里判断安全码为：123456

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80TNhcgQag2n6gUke40klia7HffyaicyvSkZ3TRBtHG7FShyrNGBgouaRw/640?wx_fmt=png&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80jQAIcwbCMrC7MoWPdtyH8ibOia8kTQGAofdgD0ezumia3l0Shn2OEnvhw/640?wx_fmt=png&wx_lazy=1&wx_co=1)

4. 爆破密码

既然有了用户名和安全码，那就试着来爆破一下密码，最终最终！弱口令啊，YYDS！！密码：qwe123456

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80YDEbbsXKwawzjf08awGHad4QvlyJCWFpdkcLZaiaVGFG1kjMWY1LzLw/640?wx_fmt=png&wx_lazy=1&wx_co=1)

成功登录

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80lmfuJh9qtG7aCYeFPnyjFfk1fcYnIMuI5YxNnj1fAlIIyAqbLrRCRw/640?wx_fmt=png&wx_lazy=1&wx_co=1)

**0x03 漏洞利用**

1. 文件上传

来到后台开始寻找是否有上传的地方或者其他能 getshell 的地方，找到一个上传点，抓包，提示上传失败

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80Znkc9YkbwV6AEOoruGhKnWUfc69ff8gH7S9jJUvDRe65N0ZDw2xaSg/640?wx_fmt=png&wx_lazy=1&wx_co=1)

然后试着把 Content-Type：application/octet-stream 改成 Content-Type: image/jpg，万万没想到这么顺利，直接上传成功  

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh807XS4cGFj0rkMHia7aTPTc2yLByOE1d1YtHDfLXu3fBlMNsrSBYS3icCQ/640?wx_fmt=png&wx_lazy=1&wx_co=1)

2. 蚁剑连接

找到刚才的小马地址，成功连接

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80TBrqOvibnhdFbUl9x2JIHAxwXIjEXIObGj0En38ajvGoGazyFXTAN5Q/640?wx_fmt=png&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80CghLgLEOmphDQVxPrb0gEibgyFF9bJcznGuJxwI1azRK2VW4I7DiczyQ/640?wx_fmt=png&wx_lazy=1&wx_co=1)

**0x04 提权**

1. 尝试突破命令限制

其实这里已经是 system 权限了，但是蚁剑和菜刀都无法执行命令，尝试了各种办法突破都未果，还是我太菜了

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80aja0iaB8ic2hAOTJWhZyY7ia159YoIeGJkicET023HArcTm2ryCHWRgGTA/640?wx_fmt=png&wx_lazy=1&wx_co=1)

2. 使用 sys_eval 函数

这里使用 udf 提权的方式，将 sys_eval 引入进去，然后完成执行添加账户，再加入用户组，我不能执行 sys_exec 不知道为啥...

`select sys_eval('net user admin 123456 /add');`

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80pmMkPibaGgnByxibzTF3QEIsTVyKUC80eK47iaxiaOoCPX3UaGKic5bDY0w/640?wx_fmt=png&wx_lazy=1&wx_co=1)

成功登录桌面  

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80ZFeLicD7I3HwXwotpBzwbCQS9hMfJSZTZFjYb15Tjv4Z656iawDFLZww/640?wx_fmt=png&wx_lazy=1&wx_co=1)

3. 获取管理员密码

这里使用 wce 获取管理员明文密码，掌握到常用密码，可以进一步掌握这人的信息，大家都懂哈

`查看当前登录的用户及加密的密码``wce-universal.exe -l``查看当前用户登录的详细信息``wce-universal.exe -lv``查看明文信息``wce-universal -w`

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh805riavQVHibiaCBEGrpkiahicxXSic4iaMJem89ibicWt5dZzLtpknHra45PTiafg/640?wx_fmt=png&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOclhGSiaOBpzPMKdfsYomh80b0k4sM2GB6GrDRtOeZIbSUjLJzqicbroQhTEkAicM6KxgSibax4S0z3ww/640?wx_fmt=png&wx_lazy=1&wx_co=1)

`文章来源：G3et博客``原文地址：https://www.g3et.cn/2021/2021-12-27-13-38-59`

![](https://mmbiz.qpic.cn/mmbiz_png/3heAguJrdPwwb5AxgeyO4QBNh18Fn6zdHoLUI5icibB4ibJKHvDsZTm7oBibUMPBk2ccibiawFdUyRsxdwsHjdAVjYuw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/3heAguJrdPwFnSZ4ST9beGd5aICibCzeudnBgkU2jxkNicmkoJOqCRpRTuZ66zKQRXahaCXcwyxugx5paBygA1aw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/3heAguJrdPzLicKwibCOrj4LSdPHyjzIeCec4cT7TKYicpltRA9sjls9gnl2G8aQ2xxbEMDPklOXS9Qq1PiaWicxcjA/640?wx_fmt=png)