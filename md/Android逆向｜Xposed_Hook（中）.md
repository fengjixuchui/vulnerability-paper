<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/RAv6BLEsHpBXa4Q614y7AA)

本篇是《Android逆向入门教程》的第八章第1.3节，具体课程详情可点击下方图片查看：

[![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/Ov836aiagXu7icia9amB6lib8gRhTV7XELQTFdNVg15fXPGGUSUJjE9kSTIWZvpibdBZXDKQFaRqyfYvVibKtW10YhBA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247485929&idx=1&sn=1b74ef1fc771be6ff32fb56b6ab8f560&chksm=9b3701ddac4088cb2fd25fd7bc3356f7a9710460a804360a955f036b7398e6a3c47c18377541&scene=21#wechat_redirect)

每一章节详细内容及实验材料可通过加入底部免费的【Android逆向成长计划】星球获得！

  

声明：所有实验含部分虚构，纯属技术练习，未对真实环境造成任何影响。也请勿将相关技术用于非法操作，否则责任自负。

  

**0x01 Hook复杂参数**
-----------------

在我们Hook的时候经常会遇到一些复杂类型的参数，如map、二维数组、自定义类型和集合等参数，这个时候我们应该如何传入我们的参数列表的字节码？本小节将介绍几种方法来传入复杂参数的字节码。

在这里我们还是以上一次案例为例

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/Ov836aiagXu5ZzjkATz9utbPzVR8aSdWyxYLA5OznYIMDRApY5Gzn8p0Co5RI3Kl8uE5mv1Hbae8GyTXJSnm0CA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

我们这次要Hook的函数为complexParameterFunc(String,String,Map,ArrayList),其中的参数有复杂类型参数，那我们最常规的一种hook参数列表的方式为”类型.class”。代码如下：

```
`import de.robv.android.xposed.IXposedHookLoadPackage;``import de.robv.android.xposed.XC_MethodHook;``import de.robv.android.xposed.XposedBridge;``import de.robv.android.xposed.XposedHelpers;``import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;``import android.util.Log;``public class Hook implements IXposedHookLoadPackage {``public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {``if (lpparam.packageName.equals("com.feichen.xposeddemo")){``final Class clazz = XposedHelpers.findClass("com.feichen.xposeddemo.Demo",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz,``//Hook参数列表方式一：类型.class``"complexParameterFunc",``String.class,``String[][].class,``Map.class,``ArrayList.class,``new XC_MethodHook(){``public void beforeHookedMethod(MethodHookParam param){``Log.d("Lvmeng","Lvmeng===============before");``Log.d("before-获取参数", ""+param.args[0]);``}``public void afterHookedMethod(MethodHookParam param){``Log.d("Lvmeng","Lvmeng=============after");``Log.d("after-获取参数", ""+param.args[0]);``Log.d("Lvmeng", ""+param.getResult());``}``});``}``}``}`
```

然后运行效果如下：  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

通过日志输出可以发现我们已经成功hook到complexParameterFunc的参数。

**0x02 Hook自定义参数**
------------------

对于一些自定义类型的参数，很显然类型.class是不可取的，那么我们介绍另外一种方式，即该方法所在的全路径，还是以complexParameterFunc为例。

```
`import de.robv.android.xposed.IXposedHookLoadPackage;``import de.robv.android.xposed.XC_MethodHook;``import de.robv.android.xposed.XposedBridge;``import de.robv.android.xposed.XposedHelpers;``import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;``import android.util.Log;``public class Hook implements IXposedHookLoadPackage {``public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {``if (lpparam.packageName.equals("com.feichen.xposeddemo")){``final Class clazz = XposedHelpers.findClass("com.feichen.xposeddemo.Demo",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz,``//Hook参数列表方式二：该方法所在的全路径``"complexParameterFunc",``"java.lang.String",``"[[Ljava.lang.String;",``“java.util.Map",``“java.util.ArrayList”,``new XC_MethodHook(){``public void beforeHookedMethod(MethodHookParam param){``Log.d("Lvmeng","Lvmeng===============before");``Log.d("before-获取参数", ""+param.args[0]);``}``public void afterHookedMethod(MethodHookParam param){``Log.d("Lvmeng","Lvmeng=============after");``Log.d("after-获取参数", ""+param.args[0]);``Log.d("Lvmeng", ""+param.getResult());``}``});``}``}``}`
```

然后运行截图如下：  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

通过日志输出可以发现我们已经成功hook到complexParameterFunc的参数。

另外Hook参数列表即是获取列表的字节码，因此还有两种获取方式，均已获取字符串列表为例，一种是：

**XposedHelpers.findClass("java.lang.String",lpparam.classLoader),**

另一种为反射获取：

**Class.forName("java.lang.String"),**

其中反射函数forName有重载，一个是一个参数的，一个是三个参数的，其中三个参数的，可以指明classLoader，而我们一般可以选择三个参数的指明我们选取的类加载器。

  

  

团队公开知识库链接：

https://www.yuque.com/books/share/f7515884-c39f-4d2b-ab15-55921c8205b8?# 《WhITECat公开知识积累》密码：kstn

知识星球：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**往期经典**

  

[Android逆向入门成长计划【免费知识星球+微信交流群】](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247485929&idx=1&sn=1b74ef1fc771be6ff32fb56b6ab8f560&chksm=9b3701ddac4088cb2fd25fd7bc3356f7a9710460a804360a955f036b7398e6a3c47c18377541&scene=21#wechat_redirect)  

[《从入门到秃头之PWN蛇皮走位》](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484643&idx=1&sn=a8effd61504fc574ee7089f9ce8440af&chksm=9b370cd7ac4085c102e5f3ee1bd1fcb6f61fc56559edef3e4eb33d934c499c541d56c87ae7cd&scene=21#wechat_redirect)

[漏洞挖掘｜条件竞争在漏洞挖掘中的妙用](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484441&idx=1&sn=2f24cfe9e648118a4e537c0446e98119&chksm=9b370c2dac40853bf285a7e3fcbb8d83cba2aa34e82d81346af29d38c2855269dbc094aaab1e&scene=21#wechat_redirect)  

[漏洞笔记|记一次与XXE漏洞的爱恨纠缠](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247483808&idx=1&sn=e49283ccb0de1a3b7ac89e9cdb6d0e2f&chksm=9b370994ac4080829721246426d4dee351a4b7bdc2ac737f1f5fe1eb1a69eeb8a1dcaeb50b13&scene=21#wechat_redirect)  

[移动安全-APP渗透进阶之AppCan本地文件解密](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484404&idx=1&sn=184cb740fcdcdccc6f41f81c9abbc008&chksm=9b370bc0ac4082d6ef87004b1ce7e7c5e4d618a8e4696021d805e90a31c6a32b23c4139c5b50&scene=21#wechat_redirect)  

[内网渗透之从信息收集到横向独家姿势总结-linux篇](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484666&idx=1&sn=5b0cf18e99d5e7cb9ff2b4a105251557&chksm=9b370cceac4085d8792838dde9359371751fad09200df6fd7ccf98a3a0230b71dbcd73cc595b&scene=21#wechat_redirect)  

[HVV前奏｜最新版AWVS&Nessus破解及批量脚本分享](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484137&idx=2&sn=286c87de932713c7e0951e9633a9fda9&chksm=9b370addac4083cb868bed7429c420f7feb101abd69550cd8cc4645f31e18b29d5d7f93cb3f7&scene=21#wechat_redirect)  

[Android抓包总结-HTTPS单向认证&双向认证突破](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484224&idx=1&sn=c3af9883d69de8e7c57d9f9503e63685&chksm=9b370b74ac408262fa670b3917250d509f77bd5de87dd4fef463358a6e18f1dcad517280c9bd&scene=21#wechat_redirect)

[图形验证码绕过新姿势之深度学习与burp结合](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484598&idx=1&sn=997f5329edb5ad2850e8e129da32f175&chksm=9b370c82ac4085941fe53b84ec5fa61961cbb4ef406ae2013773d6144a28a665be9f7e80a283&scene=21#wechat_redirect)  

  

安

全

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**扫描二维码 ｜****关注我们**