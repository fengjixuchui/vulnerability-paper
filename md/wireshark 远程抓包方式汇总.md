<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/CGJk6dVI2a2NxfhgfCWjvQ)

通常在 linux 上使用 tcpdump 抓包，在远端 linux 抓取一部分数据包后，再回传到本地，然后使用 wireshark 进行分析。这种操作主要是抓取的数据包不是实时的，不能做实时数据分析，其次每次要穿文件也不太方便。所以对 wireshark 远程抓包做了一个非常详细介绍，总结了 windows、linux、mac 三种不同方式远程抓包方式。

**本地 windows 远程抓包 linux**
-------------------------

### **在 linux 上安装 rpcapd**

rpcapd 是一个为 Windows 版本的 Wireshark 协议分析器提供远程流量捕获的守护进程。它随 Windows 的 WinPcap 网络捕获库一起提供，但在 Linux 中的 libpcap 中不存在。安装需要 root 权限执行。

在 Ubuntu Linux 下安装：

```
apt-get build-dep libpcap -y
git clone https://github.com/rpcapd-linux/rpcapd-linux.git
cd rpcapd-linux/libpcap/
./configure && make
cd ../
make
```

Centos/Fedora/Redhat Linux 下安装：

glibc-static 中的 libcrypt.a 被破坏，需要删除 rpcapd-linux 目录 Makefile 中`-static`再编译。

```
yum install -y byacc glibc-static libgcrypt-devel
git clone https://github.com/rpcapd-linux/rpcapd-linux.git
cd rpcapd-linux/libpcap/
 ./configure && make
 cd ../
sed -i 's/-static//' Makefile
 make
```

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NzabZeAib6IHovcicYIaOca2jfEMzfiaSnzr5iaeac7JsyRq9RsP9fickyog/640?wx_fmt=png)  

不指定端口，默认监听 2002 端口。

### **wireshark GUI 配置远程接口**

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NLaoyaXdeBoSFRTXRolib1lxUTP8k6w8Q2Z8Z05xQtcOtg0O42uEgOuw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NOxTYeibsPQlwCBEqkDnsV3aYNlA2Dic0tbxjlsSosRiaKT2UD6nHt5ib4g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NYkEah0lCmZXq4CpmOXZMUgfAnByic0sFJIjf3KtzDSBpZzdSCYyRFcg/640?wx_fmt=png)

开始抓包即可。

**![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NlBEtib0ZiaBjPYPO36Zp3CBXW9vP3T56bPh0rdowbjQmleJrg0at3sgQ/640?wx_fmt=png)**

### **wireshark 命令行配置远程接口**

如果没有配置 wireshark 环境变量，就打开 wireshark 安装目录并执行下面命令。

```
wireshark -k -i rpcap://<capture_box_ip>:<rpcapd_port>/<interface_to_capture>
```

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NuV7YLFvc0vsppZ6eMS4ktCuc4htibNmiaJu7hEQ8KdZvnLnngyFgz0rQ/640?wx_fmt=png)

**本地 mac 远程抓包 linux**
---------------------

### **本地 mac 配置 sshdump**

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NzdGoVrSDvAFdPDd4ibM0EaKzicFVsA8lWNQvX5ciaEIt5kmNFWW05qeQg/640?wx_fmt=png)

windows 的 wireshark 默认没有该选项，需要本地安装 openssh 客户端。

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NwzMcM35SItor3gz3lvSlfUdpkr6oAT4zJEAND7KJSI8SmlFkg917gA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7Nia0TkhpQHpiaTb2IicO5IYFicpymSgkJHQeJdZfOYr4e8uP8ZKglGpJoAQ/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7N81dysAL9NFY7XFIJAycQzicHHzgKX0euuFibcoibCVJH0uw5wWWWNNTgw/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NEBI4A5tqQWdgDvPYrZ8X0BS4Zq4jHX2dO53voTYWatOyQMvPWCjtCw/640?wx_fmt=png)

远程抓包成功

同理 mac 上也可以使用上面本地 windows 的 rpcap 的方式进行抓包。

**本地 linux 远程抓包 linux**
-----------------------

### **本地 wireshark 设置管道**

在本地 linux 创建管道文件

```
mkfifo /tmp/sharkfile
```

远程 linux 安装 wireshark

```
yum install wireshark* -y
```

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7NP6mvfWuuCxFcxl5anzmybngNzMghibgdVDVUL1hxOJOBOaibTg7wbQIQ/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7Nn6C9Tcofy1MSAaNibNlSiaIJEqYoHgeXg6vKB3SZYUeUd3J2TjPDzabg/640?wx_fmt=png)

```
ssh user@remote-host "dumpcap -P -w - -f 'not tcp port 22'"> /tmp/sharkfile
```

![](https://mmbiz.qpic.cn/mmbiz_png/9JPpNb7icHgGw6s9XAFV2dPC7ZUEJWp7Nw0mcnibibLgkm4Vbicbib4u5qv20icOuvIfhpGRJjicdRgVAT5ZrIjSoDK4w/640?wx_fmt=png)

抓包成功

同理本地 linux 也可以使用 sshdump 和 rpcap 的方式进行抓包。

作者：zgao，来源：https://zgao.top/

****关注公众号后台回复数字 1126 获取 应急响应实战笔记，1127 - ctf 工具集合，1230 - 内网工具，3924 - 弱口令爆破工具。****