<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/aSVrKLa24lktTFLogAmXYQ)

基本概念和反射机制相关的类 1. Class2. Constructor3. Method4. Field 获取 Class 对象 1. Class.forName("全类名")2. 类名. class3. 对象. getClass() 使用 Class 对象 1. 获取成员变量 2. 获取构造方法 3. 获取成员方法 4. 获取类名参考链接

基本概念
----

在运行状态时，对于任意一个类，都能够**获取**到这个类的所有属性和方法；

对于任意一个对象，都能够**调用**它对应的类名和任意一个方法、属性 (包括私有的方法和属性)。

这种**动态获取的信息**以及**动态调用对象的方法**的功能就称为 java 语言的反射机制。

我们在很多 java 漏洞的 exp 中看到它的影子。

和反射机制相关的类
---------

一个类一般是抽象出了某一类事物的特征

### 1. Class

Class 类抽象出了 java 中**类的特征**并提供了一些方法

### 2. Constructor

Constructor 抽象出了 java 中**所有的构造函数的特征**以及提供一些方法

### 3. Method

java 中**所有的方法**都是 Method 类型

### 4. Field

类的字段为 Field 类型

获取 Class 对象
-----------

### 1. Class.forName("全类名")

将字节码文件加载进内存，返回 Class 对象；

多用于配置文件，将类名定义在配置文件中；读取文件，加载类。

### 2. 类名. class

通过类名的属性 class 获取；

多用于参数的传递。

### 3. 对象. getClass()

getclass() 方法在 Object 类中定义；

多用于对象的获取字节码的方式。

使用 Class 对象
-----------

### 1. 获取成员变量

*   Field[] getFields() 获取所有 public 修饰的成员变量
    
*   Field getField(String name) 获取指定名称 public 的成员变量
    
*   Field[] getDeclaredFields() 获取所有成员变量，不考虑修饰符
    
*   Field getDeclaredField(String name) 获取所有指定名称的成员变量，不考虑修饰符
    

**获取成员变量后可做操作**：

*   获取值：Object get(Object obj)
    
*   设置值：void set(Object obj, Object value)
    
*   忽略访问权限修饰符的安全检查：setAccessible(true)（暴力反射）
    

```
Field[] fields = personClass.getFields();
for (Field field : fields){
   // System.out.println(field);
}

Field a = personClass.getField("a");
//获取成员变量a的值，a初始值为null
Person p = new Person();
Object value1 = a.get(p);
System.out.println(value1);
//设置a的值
a.set(p, "aaa");

//获取私有成员变量d
Field d = personClass.getDeclaredField("d");
//忽略访问权限修饰符的安全检查
d.setAccessible(true);  //暴力反射
Object value2 = d.get(p);

```

### 2. 获取构造方法

*   Constructor<?>[ ] getConstructors() 获取所有 public 修饰的构造方法
    
*   Constructor<T> getConstructor(类 <?>... parameterTypes) 获取指定名称 public 的构造方法
    
*   Constructor<?>[ ] getDeclaredConstructors() 获取所有构造方法，不考虑修饰符
    
*   Constructo<T>r getDeclaredConstructor(类 <?>... parameterTypes) 获取所有指定名称的构造方法，不考虑修饰符
    

**获取构造方法后，可使用构造器创建对象**：

*   newInstance()
    

```
Constructor[]  constructor0 = personClass.getConstructors();
for (Constructor constructor : constructor0){
   // System.out.println(constructor);
}

// Constructor<T> getConstructor(类<?>... parameterTypes)
Constructor constructor1 = personClass.getConstructor(String.class, int.class);
System.out.println(constructor1);

// 用构造器创建对象，带参数
Object person1 = constructor1.newInstance("aaa",20);
System.out.println(person1);

// 获取空参构造方法
Constructor constructor2 = personClass.getConstructor();
System.out.println(constructor2);

// 用构造器创建对象，无参数
Object person2 = constructor2.newInstance();
System.out.println(person2);

// 如果使用空参构造方法创建对象，可以直接使用Class对象的newInstance()方法
Object person3 = personClass.newInstance();
System.out.println(person3);

```

### 3. 获取成员方法

*   Method[] getMethods() 获取所有 public 修饰的成员方法
    
*   Method getMethod(String name, 类 <?>... parameterTypes) 获取指定名称 public 的成员方法
    
*   Method[] getMethods() 获取所有成员方法，不考虑修饰符
    
*   Method getDeclaredMethod(String name, 类 <?>... parameterTypes) 获取所有指定名称的成员方法，不考虑修饰符
    

**获取成员方法后，可以执行该方法**：

*   Object invoke(Object obj, Object...args)
    

```
// 获取空参方法
Method eat_method1 = personClass.getMethod("eat");
Person p = new Person();
// 执行方法
eat_method1.invoke(p);

// 获取带参方法
Method eat_method2 = personClass.getMethod("eat", String.class);
// 执行方法
eat_method2.invoke(p, "Apple");

```

### 4. 获取类名

*   String getName()
    

参考链接
----

https://xz.aliyun.com/t/9921