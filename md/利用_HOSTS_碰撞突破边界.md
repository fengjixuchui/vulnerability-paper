<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/LPd74eAZNDS4Uw4ul6c8uQ)<table><tbody><tr><td width="557" valign="top" height="62"><section><strong>声明：</strong>该公众号大部分文章来自作者日常学习笔记，也有部分文章是经过作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系开白。</section><section>请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。</section></td></tr></tbody></table>

文章来源：先知社区（deep）

原文地址：https://xz.aliyun.com/t/9590

**0x00 引言**

在渗透测试中，搜集了很多 IP 资产，端口也开放了 WEB 服务，但打开总是 403 404 400 错误，扫目录也扫不到东西。这时候可以尝试利用 HOSTS 碰撞技术突破其边界对其内网系统进行攻击。

**0x01 HOSTS 碰撞**

什么是 HOSTS 碰撞，当直接访问 IP 回显 4xx 错误，直接指定 HOST 头为某个域名时访问该 IP 回显正常时，可判断可进行 HOSTS 碰撞。  

  
当一些域名只允许在内网访问时，可通过这种碰撞直接突破边界限制，访问到内网系统进行下一步渗透测试。

**0x02 配置不当**

如 Nginx、Apache 中，都可通过配置文件进行域名绑定，如 Nginx 的 default_server，Apache 的 httpd.conf 配置中的 ServerName。

直接访问 IP 是无法访问成功的，而访问其绑定的域名才可以访问成功。在访问域名的时候能够直接重定向服务器相关站点的目录下，即可成功访问。

**0x03 如何利用**

*   搜集指向目标内网 IP 的域名
    
*   搜集目标 IP 资产
    
*   进行碰撞
    

最主要的是搜集指向内网 IP 的域名，可以通过 OneForAll 等工具搜集一些子域名，挑选出指向内网 IP 的域名，如下图所示，把这些内网 IP 对应的域名进行搜集。

**项目地址：  
**

```
https://github.com/shmilylty/OneForAll
```

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOfZ7I3RlxLtdvBejVtOTdvLibcfXRSVSsAicaY6vND76InKMZc7UIQdsTVDUQsibrYB5clgCXDoCU9lQ/640?wx_fmt=png)

然后搜集目标资产的 IP，探测 Web 服务。

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOfZ7I3RlxLtdvBejVtOTdvLBJWOrKlaY1tsJ04aea99gqPkRcTLcOSw3noCPAUhToKicsBfu2Pp9oQ/640?wx_fmt=png)

将探测到开放 WEB 服务的 IP 资产搜集起来。

然后通过某佬写的 Hosts_scan，将搜集到的域名和 IP 分别放入 hosts.txt 和 ip.txt（也可以在 host 中添加一些内网办公系统常用的子域名）运行，通过对比数据包大小和标题即可得到匹配成功的 Host 头与对应 IP。

**项目地址：**

```
https://github.com/fofapro/Hosts_scan
```

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOfZ7I3RlxLtdvBejVtOTdvLDNiaGGeeiaXiblUwbQBvFG6VYBFic4foKjOZV7EteicycntnP8ajIsrHMbw/640?wx_fmt=png)

也可对某个 IP 的 Host 头的值进行 Fuzz

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOfZ7I3RlxLtdvBejVtOTdvLnA6Q0hfgHnG0icUxM6wkGQQovZzKFNiaUpQXOiau34xBuQ8DqB17Nb3IQ/640?wx_fmt=png)

然后在 Burp Proxy 中的 Options 选项中设置好 Host 头的 Replace 规则

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOfZ7I3RlxLtdvBejVtOTdvL3E8NCro1a7adXXxdbMcDEtPNaW1d5upqI4QOibxEiaOeDmljg3nCtOnw/640?wx_fmt=png)

配置好并启用后通过浏览器设置 Burp 代理访问该 IP 后即可访问设置的内网系统。

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOfZ7I3RlxLtdvBejVtOTdvLbtFd6ICTzXf1M793L8Zwlm78ehFdFb7UvIMnsoq0yRR5x5CuMvibohg/640?wx_fmt=png)

可对内网系统进一步进行渗透测试。

### **参考资料：**

```
nginx配置不当容易产生的安全问题
https://www.cnblogs.com/sevck/p/11498249.html
边界渗透中的小技巧
http://r3start.net/wp-content/uploads/2019/08/2019080916135087.pdf
利用火器DNS数据集进行hosts碰撞, 发现某厂商严重漏洞
https://articles.zsxq.com/id_s228po7lm8cz.html
nginx 的 default_server 定义及匹配规则
https://segmentfault.com/a/1190000015681272
```

**关 注 有 礼**

  

  

关注公众号回复 “9527” 可以领取一套 HTB 靶场文档和视频，“1208” 个人常用高效爆破字典，“0221”2020 年酒仙桥文章打包，“2191” 潇湘信安文章打包，“1212” 杀软对比源码 + 数据源，“0421”Windows 提权工具包。

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=png) 还在等什么？赶紧点击下方名片关注学习吧！![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=png)

 ![](http://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOdSMdwH23ehXbQrbUlOvt6YLhRjHMxGMsH55CSVdlMC0XEwtoAQI06hia8rd371BcDnQ8bfRmP4YqA/0?wx_fmt=png) ** 潇湘信安 ** 一个不会编程、挖 SRC、代码审计的安全爱好者，主要分享一些安全经验、渗透思路、奇淫技巧与知识总结。 142 篇原创内容  公众号

**推 荐 阅 读**

  

  

  

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOec0rlHvusMpuZ14HCT4dZn9ZdY1H6uNgSDcvJmovZibZVy4FV2kEib6nJ9SASN1b4Es56KdPsHWibKg/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247491360&idx=1&sn=e4c3d356b45d7fe821dc2b645f30a595&chksm=cfa6bb33f8d132259884026238db7b79f33da3f3fff2f90a87e4a447118a1be8c4e948031d8f&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOf1BEGicRSpVMRDuaANDvrLcIJDWu9lMmvjKulJ1TxiavKVzyum8jfLVjSYI21rq57uueQafg0LSTCA/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247486961&idx=1&sn=d02db4cfe2bdf3027415c76d17375f50&chksm=cfa6a9e2f8d120f4c9e4d8f1a7cd50a1121253cb28cc3222595e268bd869effcbb09658221ec&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOf8eyzKWPF5pVok5vsp74xolhlyLt6UPab7jQddW6ywSs7ibSeMAiae8TXWjHyej0rmzO5iaZCYicSgxg/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247486327&idx=1&sn=71fc57dc96c7e3b1806993ad0a12794a&chksm=cfa6af64f8d1267259efd56edab4ad3cd43331ec53d3e029311bae1da987b2319a3cb9c0970e&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOdAPjIVeN2ZahG9ibP0Y3wlfg6BO1WO7MZfo1JeW7zDWcLSTQ5Ek8zXAia5w1nMnogpbpXP6OxXXOicA/640?wx_fmt=png)