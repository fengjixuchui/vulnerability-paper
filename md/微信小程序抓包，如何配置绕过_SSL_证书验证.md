<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/G_2tapKOBrSU8bSgEayekw)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5HTFKgv5JiaxyU6p8NkAYBIIsAVf8XYGRaQQFksaVdTeZ8UMxmtJzF3ibljlo6ovPoBkc30dTQWe6kw/640?wx_fmt=png)

**前言：**我们日常在抓微信小程序或抓 https 加密数据包的时候，由于 Burp 的 ca 证书不被信任，所以抓不到包，或者抓不全数据包。针对这个问题网上已经有很多解决方案了，本文记录总结在 Windows 和 Mac 环境中，如何配置绕过 SSL 证书验证。

![](https://mmbiz.qpic.cn/mmbiz_gif/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwsngCJFfp9x4UFSDkBT62hZBFnYVcicrWxByGFpccEDT8BCKuibbVYuxw/640?wx_fmt=gif)

**0x01  Windows 环境配置抓包**

**1.1  步骤一，安装模拟器**  

Windows 环境中建议使用夜神模拟器。

```
下载地址：https://www.yeshen.com/
```

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwiaQeMaVgjOwGibqNPQeiaspC6uDDjwDuVJLl1afXFVtUJD5U7ZFC3Qib9Q/640?wx_fmt=png)

安卓版本选择 Android5，兼容性比较好：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwgMS5ibZcicm9DtyBhic9ViamUTlDFq7DemzINniaTOXpiaWcwPRMaJYEaWWw/640?wx_fmt=png)

**1.2  步骤二，安装 xposed 框架**

该框架可以在不影响功能的情况下运行很多功能强大的模块，这个地方有个小细节，之前我一直从网上找到这个框架拖拽到模拟器中安装，但是偶尔会出现不兼容的情况，这时候可以找到游戏中心，搜索下载 xposed，从游戏中心下载的就非常友好了。

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZw190Peewp9jngxdiaKciaumtjlgrTaxUqNeiaWichttgVlWuJKWCQhSaXqg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwfnxU3PK8YhyicSgfdgQFdbLS6wEQgQbgmMcI3SZKhVMlXFZ4iaVetHww/640?wx_fmt=png)

打开 xposed，点击安装更新 (version89)，给 root 权限，重启设备：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZw21vy8Y99fRYZyLp3Ab5qiaLt3JIrDxtHw5kckF1wHUthWtmBmz14v1w/640?wx_fmt=png)

重启后会在桌面看到 xposed 图标，那就是安装好啦。

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwtfJ6Lzcn6rTkVkUiafdXic0MjFx2ROCQ1VVnXFvhKKzMZvV0wZGl69UQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwEN9Tq3mDlX0WHgVLkHHribib0QhdSlOib62fVybHdvIzVXOakbibwUE8DQ/640?wx_fmt=png)

### **1.3  步骤三，安装 just trust me 插件**

该插件是用来禁用、绕过 ssl 证书检查的，功能上来说，just trust me 是将 apk 中所有用于校验 ssl 证书的 api 都进行 hook ，从而绕过证书检查。

```
下载地址：https://github.com/Fuzion24/JustTrustMe/releases/tag/v.2
参考链接：https://blog.csdn.net/weixin_44677409/article/details/106663127
```

将下载好的 just trust me 插件拖拽到夜神模拟器进行安装，成功后会在 xposed 框架中，模块里看到他，点击勾选一下启用：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwo2uibbUCNB3JjpgwhdVpvULZ9E85BkReU7LVDXyLiad2RQhj6kd0fjww/640?wx_fmt=png)

### **1.4  步骤四，安装证书**

打开 Burpsuite，设置 options ，新增自己 ip，自定一个端口：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwRo26QG7G7E6B1Kpj5xOd8WpvQEsxIy2eQn9LZBX76ShBZm47cn8g9A/640?wx_fmt=png)

打开夜神模拟器，点击 wifi、修改网络、高级选项，设置手动代理，ip 和端口对应刚才设置的 Burpsuite：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZww8l6lzJWh99AzrANfEDkuz3HGY09vE2cDCL0m9FVep0H3cHuYl38Mg/640?wx_fmt=png)

打开浏览器输入 http://burp，下载 ca 证书：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwgQsaSMjArvxgCu129Z5yEUglE6unVG9pdSdQIL7EfSNTOfPgvtxdqQ/640?wx_fmt=png)

从自带的文件管理器找到 download，将下载的 der 证书改成 cer 后缀：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwVCVgVqotyE79OKyVCkCfP5eQxwQRDooKnNMpovibJfW507LaYoMFsMA/640?wx_fmt=png)

打开设置、安全、SD 卡安装证书，找到刚才下载修改好的 cacert.cer 证书，点击安装：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwG8cEkE3UiaGicB9Abb18TxNlxkwA06lFFDRJLibicQrfOPW01Zc2y36V7g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwHg4ich0eRgesibXWXTibLTgszoZQ3bnDy0lMPf965xVnlKJPQ0hFUicZKw/640?wx_fmt=png)

### **1.5  步骤五，完成抓包**

打开 Burp，登录微信，登录的数据包就可以抓到啦：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZw0OOY5Qp5pFZuTgbc0Vg1uLuibI7fbHw9j8YwgBjroic6rHrKZemtaLwQ/640?wx_fmt=png)

尝试打开一下某咖啡微信小程序：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwW9OU7VDGzTTt7QwZtTUVktgUk5xEqP97upYLYzRkLW4VbWtsVDVnZA/640?wx_fmt=png)

愉快的抓 https 数据包：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZw8yvSZOJt0TqhyI2asibBJnA87u0N8xQmfXhTg9NIR4x7LKrgqxdbLfg/640?wx_fmt=png)

**0x02 Mac 环境配置抓包**
===================

Mac 下配置小程序抓包的环境就容易很多了，只需要配置证书就可以操作抓包啦。

### **2.1  步骤一，安装证书**

打开 Burpsuite 从代理、选项中导出 ca 证书：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwoCuRkQM6jajmiaYpkDT2nus1Bdo1fLLwcH9AgfFSC7Su2BbWsQhnZDw/640?wx_fmt=png)

选择第一个，导出 DER 格式的证书，保存成 der 格式的后缀：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwzFeefQyVpibksotyfSFGaeFQibGveZfyxhqCYV7aicuGNAnUaiaKEPnnVg/640?wx_fmt=png)

输入账号密码，导入证书到钥匙串访问：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwxlkMa6iaj7HbyVVm3jWKtZFlfm60TAduXktT9dAHsBLJYSBN8g5UGVg/640?wx_fmt=png)

将证书设置为始终信任：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwDPaamM0BcmPECBJLA8962zmCV9KL130EicEBaG9LnX5GB5IQFkfHlVg/640?wx_fmt=png)

打开设置、Wi-Fi、代理，将 http 和 https 代理都设置为本地地址加 burp 端口，默认 8080：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwzZziaNsXstdwQdpENB9p6E1HdiaichEQWAvHjGQwdYuNTteDbsjEQzWibw/640?wx_fmt=png)

### **2.2  完成抓包**

打开 burp，依旧打开某咖啡小程序，愉快的抓包 ing：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwFW8sXDTFMCJExm7DY2LZmLvjHbv8qkib1bZ5cqvicyN21XK3tC3rgjUA/640?wx_fmt=png)

愉快的抓 https 的数据包：

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5EsCxjFaSlCiccnMbicMiaCiaZwkQP85MtYMg9TkPI7hHx69aiaN9E25fIqEkmkBREVbTyBRH7oj31yrNA/640?wx_fmt=png)

-- _END_ --

公众号