<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/quIpapbkFNay0JtUK4wODQ)

  

  

  

**Introduction 介绍**

  

  

云账户需要经过正确的安全配置，才能满足云原生部署对动态基础设施不断变化的要求。在亚马逊云平台中，同时可能出现许多配置选项，让人应接不暇，仅Amazon EC2就有几十种关键性的安全配置。要确保服务得到正确的配置实属不易。不仅如此，亚马逊云平台还提供数量惊人的服务，每一种服务又都有各自的要求。为解决这一挑战，云安全态势管理（Cloud Security Posture Management）产品应运而生，助力团队有条不紊地向前推进。

  

但从安全影响的角度来看，亚马逊云平台的配置各有不同，服务的使用率也不尽相同，有些配置会与各种服务交互，其提供的配置可以推翻或影响其它配置。由此，您可能不太清楚如何确定优先级，或者从何下手。

  

下面罗列的是市场上最常见的亚马逊云平台服务中一些典型的大型云原生部署基础服务。

  

**我们根据潜在的安全影响挑选了一些错误的配置：**

  

  

  

  

  

• 特定服务的受欢迎程度

• 攻击面覆盖规模

• 对其他安全控制能力是否有“压制”影响

• 对其它亚马逊云平台服务或安全控制能力是否有潜在影响

(例如, 如果没有日志记录，则事件响应不可用)

  

了解风险系数最高的配置，可以帮助团队发现自有环境的潜在风险，并确定选择哪种亚马逊云平台服务。

  

  

  

  

**风险最高的10种AWS配置错误**

  

  

**Amazon EC2**

  

作为AWS的经典产品， EC2可以访问基于云的服务器，也是很多其它AWS服务的基础。因此，EC2的很多配置策略也适用于其它的AWS服务。所以，不仅EC2，在运行其它服务（如EKS）时，也一定要检查配置是否有细微差别。  

  

**01**

**限制访问：Open SSH**

  

  

  

  

除非是为了满足一些特殊的业务需求，否则最好不要向外部开放端口，有些路径因为承载着敏感数据，所以就需要更高水平的安全防护。由于SSH是用于命令层的管理接口，所以如果让SSH保持开放状态，可能会引发严重的配置错误，让黑客有可乘之机，掌控命令行接口。

  

因此，SSH端口一定不能保持开放状态，而关闭它可以消除高风险的攻击向量。

  

**Amazon IAM**

  

Amazon IAM服务不单独计费，它是所有亚马逊云平台账户中都包括的一种功能，用来管理这些服务的身份和访问。在各类不同的服务中，IAM策略都会互相影响，因此，在添加亚马逊云平台服务时要留意这些策略。

  

**02**

**限制访问：使用根账户而非IAM用户**

  

  

  

  

在AWS账户中，根用户可以访问整个账户中所有的亚马逊云平台服务和资源。利用好IAM的最佳实践是，只有设置第一个IAM用户时才使用根用户，之后在执行其它常规任务时则尽量使用IAM角色。举个例子：比如只有在查看税务文件等少量用例中，才会用到根访问。

  

而如果这一配置选项被滥用，或设置不正确，就可能导致根用户凭证被暴露的严重后果。我们甚至建议您不要给根账户创建访问凭证，因为登陆凭证暴露的风险是巨大的。保障根账户凭证的安全，并在大多数的任务中使用IAM角色，就能确保黑客无法访问账户中的亚马逊云平台的服务和资源。

  

**Amazon S3**

  

在AWS所提供的几个存储方案中，S3 buckets存储空间支持公开访问数据，并因其简便、开箱即用的优点受到欢迎。 S3 buckets与在EC2中运行的网络和应用配合使用时，能充分展现出它的易用优势。不过，这也意味着需要管理更多的配置才能防止公众在不经意间访问S3 buckets中的数据。

  

**03**

**限制访问：拦截对S3 Bucket的公众访问**

  

  

  

  

不论是不是亚马逊云平台的用户， S3 buckets经过配置后可以允许所有人在bucket中写入或删除目标。公共访问拦截（ Public Access Block）配置基本会否决ACL授予的所有公共访问权限或策略，作为一个集中控制的角色，该配置可拦截所有指向S3 buckets的公共访问。这一配置启用后不会改变，这要看目标是如何添加的或bucket是如何设置的。如果可以向S3 bucket添加一个关键的访问控制，那就应该添加公共访问拦截配置，因为它的保护范围广，有能力限制访问S3 bucket的其它潜在漏洞。

  

**RDS**

  

RDS是AWS较受欢迎的一款数据库，因其具有开箱即用的优点，以及自动化的配置、管理、维护和安全选项，所以得到广泛使用。

  

**04**

**限制访问：RDS公共访问**

  

  

  

  

有时，管理员为了排除故障，想将RDS设置为在公共端点可用。但对RDS的公共访问一旦处于开放状态，就可能引起不必要的暴露和风险。最好将公共访问选项设置为默认禁用，仅在确实需要的特殊情况下才启用，通常做法是，从VPC设置RDS访问。

  

可以通过CloudTrail来记录亚马逊云平台服务中的活动和事件日志，不要与 CloudWatch混淆，它展现的是亚马逊云平台服务的具体情况和性能指标。

  

**AWS CloudTrail**

  

可以通过CloudTrail来记录亚马逊云平台服务中的活动和事件日志，不要与 CloudWatch混淆，它展现的是亚马逊云平台服务的具体情况和性能指标。

  

**05**

**策略及Config/Logging ：启用跟踪**

  

  

  

  

AWS的账户默认启用CloudTrail功能，但数据每90天会被默认删除，而且不会自动捕捉所有类型的事件。关键性的额外安全事件有监控的功能，它们具体包括：登陆失败、IAM策略更改和根账户使用等。如果没能成功创建跟踪功能来记录具体资源、区域，以及应该受监控的事件（这是最重要的），那可能就会导致关键性安全数据的丢失。出现安全问题时，可能无法知道哪里出现了问题、或及时查看显著影响整体云安全的事件。这一要求适用于ECS、EKS和Fargate（见下）。

  

**包括云原生产品才有的配置：**

  

最常见的亚马逊云平台云原生服务的特别配置告诉我们，所有这些服务之间可以互相影响，而且给重要的服务进行正确配置是非常重要的。

  

**AWS Fargate**

  

利用无服务器产品，客户可以放手让AWS来处理容器的配置和管理，无需手动发布，也无需管理EC2实例。

  

**06**

**限制访问： 分配一个任务执行角色**

  

  

  

  

Fargate通过利用任务执行角色从私有注册中获取镜像，或向CloudWatch发布容器日志。这两项任务都非常关键。任务执行角色的目的在于将每一个基于IAM角色的任务所获得的许可都分离开来。这样，每个单独的任务就不会看到账户中其它的服务。如果任务执行角色是一个EC2角色，情况也是一样，但需要更改信任关系，也就是CNI（容器联网接口）可以制定一个IAM角色。

  

**07**

**策略和Config: 只读容器**

  

  

  

  

为了支持“不可变”的概念，在任务定义时配置必须定义一个”只读容器”，也就是将“只读根系统”的属性定义为“true“即可。

  

**08**

**策略和Config：任务定义的awsvpc网络节点**

  

  

  

  

根据建议配置VPC时，一定要在任务定义中将网络节点选为“awsvpc”。

  

**09**

**日志：VPC流日志**

  

  

  

  

VPC中的日志流支持对进出VPC的任务流量进行监控。这是一个非常重要的安全开启功能，此外还有其它的Cloudtrail日志选项可用。

  

**Amazon EKS**

  

在亚马逊云平台上运行Kubernetes可能会用到 Amazon EKS，它与IAM和VPC等AWS的其它服务配合使用，有助于所有配置保持一致。

  

**10**

**限制访问：禁止针对IMDS的pod访问**

  

  

  

  

因为继承了默认设置，由EC2实例的元数据服务 (IMDS)派发给节点IAM角色的凭证可能会推翻用户角色。我们建议禁止pod访问IMDS，从而让安全风险和整体容器许可的复杂度都降至最低，这样才能落实最小特权原则。

  

  

  

  

**自动修复的重要性**

  

  

如果云基础设施是动态的，并可能扩展到多个服务和环境，那么云账户配置的监控和修复能力则必须也具备同样水平。自动修复是应对云账户配置错误的一个理想解决方案。这类配置错误会带来极大的风险。

  

以下是Aqua CSPM自动修复的一个例子，在EC2中修复Open SSH。

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

在制定了策略之后，如果在EC2服务中发现了Open SSH，就会发出一个通知，告知问题已经解决，通知报告中包含自动修复的详细内容。  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

详细报告显示，在收到Open SSH 端口通知（17:05:54）后仅2秒钟就执行了自动修复（17:05:56）。  

  

如果使用手动流程更改配置，则需要完成12个具体步骤。

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

  

  

**总结**

  

  

上述的云账户配置既有可能增强安全性，又可能会损害安全性。理想的解决方案就是凡事谨慎，并设置自动修复功能。

  

每一种云部署都各有特点，还有很多配置不当的服务和设置我们在文中没有提及。如果您想知道在云服务账户中这些配置是否有问题，最好的办法是全方位扫描，而且要特别留意本文所列举的10种高风险配置。

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

  

  

  

**关于Aqua Security**

  

**Aqua Security总部位于以色列特拉维夫，为客户的创新以及加速数字化转型保驾护航。Aqua平台在整个应用生命周期管理中提供预防、检测和响应自动化服务，以确保供应链、云基础架构平台和运行时工作负载的安全运行。**

  

**Aqua的客户遍布全球，涉及金融服务、软件、媒体、制造和零售领域，能够在广泛的云提供商和现代技术堆栈中实施，其中包括容器、无服务器功能和云虚拟机。**

  

  

  

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

点击“阅读原文”，了解Aqua Enterprise更多信息！

↓↓↓