<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/A-3my_vazn1hQs7b422fHA)

**前言**
------

Kubernetes 可以把用户提交的容器放到 Kubernetes 管理的集群的某一台节点上去。Kubernetes 的调度器是执行这项能力的组件，它会观察正在被调度的这个容器的大小、规格。跟调度一个有关的容忍度 (Toleration) 与污点(Taint)。今天要写的是 k8s 环境当中的一种横向移动手法，对该手法进行实验分析前提条件是 node 持有有效凭证调度 pod

**正文**
------

容忍度 tolerations 是定义在 Pod 对象上的键值型属性数据，用于配置其可容忍的节点污点，而且调度器仅能将 Pod 对象调度至其能够容忍该节点污点的节点之上。

节点亲和性 是 Pod 的一种属性，它使 Pod 被吸引到一类特定的节点 （这可能出于一种偏好，也可能是硬性要求）。污点（Taint）则相反——它使节点能够排斥一类特定的 Pod。容忍度（Toleration）是应用于 Pod 上的，允许（但并不要求）Pod 调度到带有与之匹配的污点的节点上。

搭建 k8s 环境和相关概念在之前写过。

> k8s
> 
> 达达，公众号：Th0r 安全[云原生安全入门 - K8s 概念与安装](http://mp.weixin.qq.com/s?__biz=Mzg3ODY3MzcwMQ==&mid=2247487991&idx=2&sn=6e0c45482d5d665a986a75658baf0656&chksm=cf117bbdf866f2ab8f4c5d5a9e5c813b5083485c482d9e439d4df754c9049a10471871cf728b#rd)

这里稍微提一下 pod 和 node 的概念

Pod 是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。

Kubernetes 通过将容器放入在节点（Node）上运行的 Pod 中来执行你的工作负载。

之前也有一篇文章写过:

> k8s
> 
> 达达，公众号：Th0r 安全[云原生安全入门 - Pod 及其相关](http://mp.weixin.qq.com/s?__biz=Mzg3ODY3MzcwMQ==&mid=2247488010&idx=1&sn=4f877c5adcb267af04638a85ef4ea968&chksm=cf117840f866f1564757bbc33b6b39479472e56a73ffd4f022557b59d63652ec86fbbbcbce62#rd)

污点横移拿权限是 K8s 中一个比较特殊的手法，利用的是容忍度的特性，不过在实际中，可能需要操作多次 pod 才能成功。

之前写的一篇 k8s 部分攻击面

> k8s
> 
> 达达，公众号：Th0r 安全[云原生安全入门之 k8s 部分攻击面](http://mp.weixin.qq.com/s?__biz=Mzg3ODY3MzcwMQ==&mid=2247488280&idx=1&sn=a7d8ff8144e40693a987001fea74e2c8&chksm=cf117952f866f0445176e368f9a63d10d81320e32634d90d30b9834d597c392542c79f86b4f3#rd)

这里是三台虚拟机，一台 master, 两台 node.  

进入 node 节点，在普通 node 在操作  

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqHj6faYNH46KadFm8NmwicT4YibDUO34O8Mn72e0PhBJwZNw5iciaN9oYmQ/640?wx_fmt=png)

这里查看 master 节点的容忍度  

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqcKnwveBibXSyNf7K4tFNfoI5CUUvX41Q454cyick2LY2r36vUPhKzDicw/640?wx_fmt=png)

针对容忍编写相应的 pod, 挂载到根目录到 / master 下  

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqxr2K7CFNWr4SxRrMPicPrIic0EVdia9r2S2EiciadgjRdPjiaftewGPBfxjw/640?wx_fmt=png)

创建成功  

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqDV2bsWRFMUiauutVAicNiaWQsvlthS1beDdGw1P3mib59I6h6caTh2sygw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqQX6XSgDNvloCSKlz2qJdVHGvpegrokeG895324jpxYDnEJWQznQ8oA/640?wx_fmt=png)

查看 pod 归属, 归属 master 成功  

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqhdoAusI8kWyrFapljcDw8O15rjhfhNdBXOFY8F0jFicpynMGPXEpJgw/640?wx_fmt=png)

进入执行 bash

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqHxbrYwFm4mskN05Svt1e5ykS3FILicHEUC9CjPz73AT7gP15K38owRA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/GIRBFLSfaJJLFg6wxeLo3uRMVnRfszQqMvwQ2CJicmy3PfiaX641VJadOdJownTU1PvFgaA4aaqTI6GbIBk7L6Nw/640?wx_fmt=png)