<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [l0ki.top](https://l0ki.top/archives/340/) #post-content{ font-size: 14px; }

域前置基本思想原理[](javascript:;)
=========================

*   博主： [L0ki](https://l0ki.top/author/1/)
*   发布时间：2021 年 04 月 02 日
*   187次浏览
*   [暂无评论](#comments)
*   1335字数
*   分类： [渗透测试](https://l0ki.top/category/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/)

1.  [首页](https://l0ki.top/)
2.  正文  

0x01 前言
=======

就在昨天——愚人节，开普勒安全团队发生了一件这样的事，具体看[知乎](https://www.zhihu.com/question/452446051)

由此，引出了一个名词——域前置/域前端。

0x02 什么是域前置？
============

我们来看百度百科是如何解释的

> **域前置**（英语：Domain fronting），又译为域名幌子，是一种隐藏连接真实端点来规避互联网审查的技术。在[应用层](https://baike.baidu.com/item/应用层/16412033)上运作时，域前置使用户能通过[HTTPS](https://baike.baidu.com/item/HTTPS/285356)连接到被屏蔽的服务，而表面上像在与另一个完全不同的站点通信。

简言之，Domain Fronting基于HTTPS通用规避技术，也被称为域前端网络攻击技术。

这是一种审查规避技术，主要用于隐蔽通信中会被禁止的远程端点，如用来隐藏Metasploit，Cobalt Strike等团队控制服务器流量，以此来一定程度绕过检查器或防火墙检测的技术，如Amazon ,Google，Akamai 等大型厂商会提供一些域前端技术服务。

0x03 域前置的技术原理是什么？
=================

需要明白域前置技术的使用场景和特点：  
域前置发生在应用层，主要使用了HTTPS协议进行通信。  
易于部署和使用，不需要任何特殊的网络媒介。

需要明白检测器可见的明文层（通信外层）是：  
DNS请求和TLS SNI

需要明白检测器不可见的加密层（通信内层）是：  
HTTP层，HTTP Host Header的域名会在HTTPS加密之下

> Host头对于检查器是不可见的，但是对于接收HTTPS请求的前端服务器是可见的

那么由此就延伸出第一个问题：如何绕过检测？  
使用域前置技术，让检测器误认为是一个其他的合法地址，即在不同的通信层使用不同的域名，我们在检测器可见的明文层（明文的DNS请求和TLS SNI服务器名称指示）使用一个无害的域名(allowed.domain)进行初始化连接；我们在检测器不可见的加密层（HTTP层）在Host头中使用另一个恶意域名(evil.domain)，其中evil.domain是我们真实但隐蔽的域名，这个域名由于在HTTPS加密之下，所以对检测器而言是不可见的。

最终的执行流程是这样的：明文的DNS请求和TLS服务器名称指示（SNI）中使用无害的域名(allowed.domain)来初始化连接，而实际要连接的被禁止的域名仅在创建加密的HTTPS连接后发出，在Host头中携带了另一个C2恶意域名(evil.domain)。

那么由此就延伸出第二个问题：为什么这样做就可以绕过检测？  
对于检测器而言，它很难在通信流量中判断一个域名是否使用了域前置技术，留给它的选项只能是放行和完全禁止，而事实上在通信中大部分是不会使用域前置技术，如果完全禁止，那么很有可能造成误伤，误伤则可能会带来严重的附带损害。

所以，域前置技术的核心基础设施是cdn。

最后修改：2021 年 04 月 16 日 10 : 39 AM

© 允许规范转载  赞赏 如果觉得我的文章对你有用，请随意赞赏 ×Close

#### 赞赏作者

**扫一扫支付**

![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=)![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=)  支付宝支付  微信支付 

*   [下一篇](https://l0ki.top/archives/328/)
*   [上一篇](https://l0ki.top/archives/344/)

textarea#comment{ background-image: url('https://s2.ax1x.com/2019/07/20/ZzaGcV.png'); background-color: #ffffff; transition: all 0.25s ease-in-out 0s; } textarea#comment:focus { background-position-y: 105px; transition: all 0.25s ease-in-out 0s; }

#### 发表评论 [取消回复](https://l0ki.top/archives/340/#respond-post-340)

 评论 *  表情 OwO

*   OωO
*   |´・ω・)ノ
*   ヾ(≧∇≦*)ゝ
*   (☆ω☆)
*   （╯‵□′）╯︵┴─┴
*   ￣﹃￣
*   (/ω＼)
*   ∠( ᐛ 」∠)＿
*   (๑•̀ㅁ•́ฅ)
*   →_→
*   ୧(๑•̀⌄•́๑)૭
*   ٩(ˊᗜˋ*)و
*   (ノ°ο°)ノ
*   (´இ皿இ｀)
*   ⌇●﹏●⌇
*   (ฅ´ω`ฅ)
*   (╯°A°)╯︵○○○
*   φ(￣∇￣o)
*   ヾ(´･ ･｀｡)ノ"
*   ( ง ᵒ̌皿ᵒ̌)ง⁼³₌₃
*   (ó﹏ò｡)
*   Σ(っ °Д °;)っ
*   ( ,,´･ω･)ﾉ"(´っω･｀｡)
*   ╮(╯▽╰)╭
*   o(*////▽////*)q
*   ＞﹏＜
*   ( ๑´•ω•) "(ㆆᴗㆆ)
*   (｡•ˇ‸ˇ•｡)

*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   

*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   
*   

*   颜文字
*   阿鲁
*   推特

名称 * ![](https://secure.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=65&r=G&d=)  邮箱 *   地址    发表评论 提交中...    

*   [热门文章](#widget-tabs-4-hots)
*   [最新评论](#widget-tabs-4-comments)
*   [随机文章](#widget-tabs-4-random)

##### 热门文章

*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/3.jpg)](https://l0ki.top/archives/268/)
    
    #### [日推小知识点](https://l0ki.top/archives/268/ "日推小知识点")
    
    浏览次数: 1826
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/2.jpg)](https://l0ki.top/archives/40/)
    
    #### [L0kiTown v1.0](https://l0ki.top/archives/40/ "L0kiTown  v1.0")
    
    浏览次数: 1607
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/10.jpg)](https://l0ki.top/archives/282/)
    
    #### [[内网渗透姿势总结] s2-016(CVE-2013-2251)](https://l0ki.top/archives/282/ "[内网渗透姿势总结] s2-016(CVE-2013-2251)")
    
    浏览次数: 1228
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/5.jpg)](https://l0ki.top/archives/281/)
    
    #### [[内网渗透姿势总结] oracle数据库服务器RCE](https://l0ki.top/archives/281/ "[内网渗透姿势总结] oracle数据库服务器RCE")
    
    浏览次数: 1186
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/4.jpg)](https://l0ki.top/archives/265/)
    
    #### [实战中遇到的Dubbo反序列化漏洞](https://l0ki.top/archives/265/ "实战中遇到的Dubbo反序列化漏洞")
    
    浏览次数: 1109

##### 最新评论

*    [![](https://secure.gravatar.com/avatar/f93083f9156b2c4af3b721721b62c8c1?s=65&r=G&d=)](https://l0ki.top/about.html#comment-123) [  ](https://l0ki.top/about.html#comment-123) [ 玉明 ](https://l0ki.top/about.html#comment-123 "玉明") 牛逼，是大佬orz 
*    [![](https://secure.gravatar.com/avatar/f93083f9156b2c4af3b721721b62c8c1?s=65&r=G&d=)](https://l0ki.top/archives/314/#comment-122) [  ](https://l0ki.top/archives/314/#comment-122) [ 玉明 ](https://l0ki.top/archives/314/#comment-122 "玉明") 好东西啊 
*    [![](https://q.qlogo.cn/g?b=qq&nk=1335968147&s=100)](https://l0ki.top/archives/265/#comment-110) [  ](https://l0ki.top/archives/265/#comment-110) [ 原神姬 ](https://l0ki.top/archives/265/#comment-110 "原神姬") 写的很好！ 
*    [![](https://q.qlogo.cn/g?b=qq&nk=1405388021&s=100)](https://l0ki.top/archives/40/#comment-106) [  ](https://l0ki.top/archives/40/#comment-106) [ 咖灰猫 ](https://l0ki.top/archives/40/#comment-106 "咖灰猫") L0ki加油ヾ(◍°∇°◍)ﾉﾞ 
*    [![](https://q.qlogo.cn/g?b=qq&nk=2338550311&s=100)](https://l0ki.top/about.html#comment-104) [  ](https://l0ki.top/about.html#comment-104) [ joki ](https://l0ki.top/about.html#comment-104 "joki") 学长好棒，在csdn上见到你了，能给一下联系方式吗，我是201... 

##### 随机文章

*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/3.jpg)](https://l0ki.top/archives/355/)
    
    #### [区块链货币安全](https://l0ki.top/archives/355/ "区块链货币安全")
    
    浏览次数: 500
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/2.jpg)](https://l0ki.top/archives/271/)
    
    #### [文件上传漏洞](https://l0ki.top/archives/271/ "文件上传漏洞")
    
    浏览次数: 402
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/10.jpg)](https://l0ki.top/archives/316/)
    
    #### [CSRF](https://l0ki.top/archives/316/ "CSRF")
    
    浏览次数: 364
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/5.jpg)](https://l0ki.top/archives/353/)
    
    #### [区块链游戏安全](https://l0ki.top/archives/353/ " 区块链游戏安全")
    
    浏览次数: 527
*   [![](https://l0ki.top/usr/themes/handsome/assets/img/sj2/4.jpg)](https://l0ki.top/archives/40/)
    
    #### [L0kiTown v1.0](https://l0ki.top/archives/40/ "L0kiTown  v1.0")
    
    浏览次数: 1607

##### 博客信息

*   81文章数目
*   18评论数目
*   1年345天运行天数
*   45,394访客总数
*   75.14 万全站字数
*   6 个月前最后活动

##### 标签云

[请求](https://l0ki.top/tag/%E8%AF%B7%E6%B1%82/) [服务器](https://l0ki.top/tag/%E6%9C%8D%E5%8A%A1%E5%99%A8/) [攻击](https://l0ki.top/tag/%E6%94%BB%E5%87%BB/) [执行](https://l0ki.top/tag/%E6%89%A7%E8%A1%8C/) [控制](https://l0ki.top/tag/%E6%8E%A7%E5%88%B6/) [用户](https://l0ki.top/tag/%E7%94%A8%E6%88%B7/) [域名](https://l0ki.top/tag/%E5%9F%9F%E5%90%8D/) [前置](https://l0ki.top/tag/%E5%89%8D%E7%BD%AE/) [检测](https://l0ki.top/tag/%E6%A3%80%E6%B5%8B/) [域](https://l0ki.top/tag/%E5%9F%9F/) [通信](https://l0ki.top/tag/%E9%80%9A%E4%BF%A1/)

##### 文章目录

 0x01 前言 0x02 什么是域前置？ 0x03 域前置的技术原理是什么？

文章目录

域前置基本思想原理
=========

[L0ki](#) • 2021 年 04 月 02 日

0x01 前言
=======

就在昨天——愚人节，开普勒安全团队发生了一件这样的事，具体看[知乎](https://www.zhihu.com/question/452446051)

由此，引出了一个名词——域前置/域前端。

0x02 什么是域前置？
============

我们来看百度百科是如何解释的

> **域前置**（英语：Domain fronting），又译为域名幌子，是一种隐藏连接真实端点来规避互联网审查的技术。在[应用层](https://baike.baidu.com/item/应用层/16412033)上运作时，域前置使用户能通过[HTTPS](https://baike.baidu.com/item/HTTPS/285356)连接到被屏蔽的服务，而表面上像在与另一个完全不同的站点通信。

简言之，Domain Fronting基于HTTPS通用规避技术，也被称为域前端网络攻击技术。

这是一种审查规避技术，主要用于隐蔽通信中会被禁止的远程端点，如用来隐藏Metasploit，Cobalt Strike等团队控制服务器流量，以此来一定程度绕过检查器或防火墙检测的技术，如Amazon ,Google，Akamai 等大型厂商会提供一些域前端技术服务。

0x03 域前置的技术原理是什么？
=================

需要明白域前置技术的使用场景和特点：  
域前置发生在应用层，主要使用了HTTPS协议进行通信。  
易于部署和使用，不需要任何特殊的网络媒介。

需要明白检测器可见的明文层（通信外层）是：  
DNS请求和TLS SNI

需要明白检测器不可见的加密层（通信内层）是：  
HTTP层，HTTP Host Header的域名会在HTTPS加密之下

> Host头对于检查器是不可见的，但是对于接收HTTPS请求的前端服务器是可见的

那么由此就延伸出第一个问题：如何绕过检测？  
使用域前置技术，让检测器误认为是一个其他的合法地址，即在不同的通信层使用不同的域名，我们在检测器可见的明文层（明文的DNS请求和TLS SNI服务器名称指示）使用一个无害的域名(allowed.domain)进行初始化连接；我们在检测器不可见的加密层（HTTP层）在Host头中使用另一个恶意域名(evil.domain)，其中evil.domain是我们真实但隐蔽的域名，这个域名由于在HTTPS加密之下，所以对检测器而言是不可见的。

最终的执行流程是这样的：明文的DNS请求和TLS服务器名称指示（SNI）中使用无害的域名(allowed.domain)来初始化连接，而实际要连接的被禁止的域名仅在创建加密的HTTPS连接后发出，在Host头中携带了另一个C2恶意域名(evil.domain)。

那么由此就延伸出第二个问题：为什么这样做就可以绕过检测？  
对于检测器而言，它很难在通信流量中判断一个域名是否使用了域前置技术，留给它的选项只能是放行和完全禁止，而事实上在通信中大部分是不会使用域前置技术，如果完全禁止，那么很有可能造成误伤，误伤则可能会带来严重的附带损害。

所以，域前置技术的核心基础设施是cdn。