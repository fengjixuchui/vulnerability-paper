<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/3FaGJY0y_wazYKRNfNrUJA)

少壮不努力，老大消特征

浅水一个 cs4.5 的加密流量消除

公开是不可能公开的，这辈子都不可能公开的

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmhBpxgbYPnpenktAJRPCcKmyvuPnCzygP1QiaiabG9DVtOjF9ab06QsOsqQNmtt5cUnlZoha4zvzKRg/640?wx_fmt=png)

CS4.5 特征消除

··································  

1、修改启动端口 65535（反正实战肯定不是 65535）

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiavibYXlnAF38CziaUHZ0DCpSVGiau3jb2Ug63qlu431xTDn9Ca3QLCEv29ogx03qwTVz77Lhex8z23w/640?wx_fmt=png)

2、修改自带 ssl 证书  

这里先生成新的证书文件  

要记住名字（ssl.store）和自己设置的 key

一会还要用

这里伪造微软升级签名

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiavibYXlnAF38CziaUHZ0DCpScQ3pGZozHlBibbmibH05aBx7ibNLeRRwN56SIfpTY5hRj4OtMibQH4kd0w/640?wx_fmt=png)

然后应该就可以看见新生成的 ssl 证书

迁移到 PKCS12 标准格式

```
keytool -importkeystore -srckeystore /Users/chenhuan/Desktop/cs/./ssl.store -destkeystore /Users/chenhuan/Desktop/cs/./ssl.store -deststoretype pkcs12
```

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiavibYXlnAF38CziaUHZ0DCpSiagiaj3YNXF6r6hF5jRoINhwU6k3HScFZFrqUicicMPZ3XaSt9HzQicLnibg/640?wx_fmt=png)

然后咱们自定义 C2 profile 文件

这里 cs 官方给出了自定义文件的一些需求可以作为参考

https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/malleable-c2_main.htm?cshid=1062#_Toc65482835

```
set sample_name "MicrosoftUpdate";
set sleeptime "5000"; # use a ~30s delay between callbacks
set jitter "10"; # throw in a 10% jitter
set useragent "Mozilla/5.0 (Windows NT 6.1; rv:24.0) Gecko/20100101
Firefox/24.0";
#设置证书，这里伪造微软升级
https-certificate {
set CN "US";
set O "MicrosoftUpdate";
set C "en";
set L "US";
set OU "MicrosoftUpdate";
set ST "US";
set validity "365";
}
#设置cliet内容和方式
code-signer{
set keystore "yourname.store";
set password "yourpass";
set alias "ssl";
}
http-post {
set uri " your uri "
client {
省略.........
id {
netbios;
省略.........
}
output {
base64;
prepend " ";
print;
}
省略.........
```

注意修改 sample_name,ssl keystore 和 password 的值

这里因为 dnsmax 方法的弃用转 dns-bendon.dnsmax 方法的失败就删除了 dnsmax 的选项, 不使用 dns 来回传 hostname

然后使用 c2lint 验证 profile

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiavibYXlnAF38CziaUHZ0DCpSPWsDC4LrwX45FXprSPErezFuZoicibQ7sYzhAZE6iaia3XlnicEvwp1OhSg/640?wx_fmt=png)

这样就 ok 了

然后开 teamserver

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiavibYXlnAF38CziaUHZ0DCpSFibufBfk2nxOeBmksPLHCRSvIrGeE0EjOnbM09OjYAeUtFGoZJGGvrw/640?wx_fmt=png)

正常登录搞个马子看看流量

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiaPfVRiciaKsVSnaF2X5yAicLvlZHGEA7PpVYc3VIrb1bzxXqxCYWatvEr39ic0leuwajQFnjV53LOLJg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiaPfVRiciaKsVSnaF2X5yAicLvJPlCyIYHPsOagmWSejosVNtRuJFFgibm0NZAjibCz8v37c9VhcDUNYug/640?wx_fmt=png)

效果不错  

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiaPfVRiciaKsVSnaF2X5yAicLvCxVeXT6yrHibLnPMQ15uQc1lTU625uf3seiaelVgCEATOzlCN2evCAdQ/640?wx_fmt=png)

<table><tbody><tr><td width="268" valign="top"><p><img class="" src="https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiaPfVRiciaKsVSnaF2X5yAicLvana4gOuuf1YZBPa9Mt8vzqRgotTQleLVGnd4BjiajrCBhTLFiciaZJ2icQ/640?wx_fmt=png"></p><br></td><td width="268" valign="top"><p><img class="" src="https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmiaPfVRiciaKsVSnaF2X5yAicLvhLJHumevgdGChy2PPLyFaAFF9ZIctqSt9GfGSTvxlHOD9ibbD4hZib2Q/640?wx_fmt=png"></p><br></td></tr></tbody></table>

后续 nmap 等工具的消除也会做

还在考虑要不要把 cs re 掉改一下生成马子的特征

今天就先水到这里（划掉）

文章来源：冰棱安全团队

“如侵权请私聊公众号删文”

我知道你**在看**哟