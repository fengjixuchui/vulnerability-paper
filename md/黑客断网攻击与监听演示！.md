> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/AohfRXyCriFlpXbFkZsFyA)

> 作者：csdn-Tr0e  
> 
> 原文链接：http://aaqv.net/240da

**前言**

**借助 ARP 欺骗让你回到 “村里还没接网线” 的年代、**

**同时还能让你的 PC 主机或者手****机的部分隐私处于 “裸奔” 状态……**

严正声明：本文仅限于技术讨论与分享，严禁用于非法途径。

**本文目的**

演示如何借助 Kali Linux 系统内置的 nmap、arpspoof、driftnet、ettercap 等渗透测试工具对局域网内 (同 WIFI 下) 同一网段的 PC 主机、手机进行 ARP 欺骗 和 流量监听，实现对目标主机 / 手机的 断网攻击、图片窃取、密码监听 等攻击目的。

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tO6GAb5mBq4oJAFnncBB62g80ZibVVeZgkDlpOPibXzibUed47vfE3W7kg/640?wx_fmt=png)

环境说明

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tHwj9Qvn1NelvnhUvrBtxs4dHs8SGhce8aTLEgLBklVp7UDMv0pwEyQ/640?wx_fmt=png)

Kali 虚拟机使用桥接模式，Win 10 物理机和 华为荣耀 20、魅族 A5 实体手机连接同一个 WIFI，使得四者处于同一局域网同一网段之下，可互相 (Ping) 连通。

**应用场景**

*   宿舍室友半夜打游戏、看视频太吵了，忍无可忍的你 “优雅” 地使用 ARP 欺骗切断他的 WIFI，然后舒服地睡觉，留他一脸蒙圈……；
    
*   宿友半夜盯着手机疯狂偷笑，不知道在看啥 “妙不可言” 的东西，你可以通过使用 arpspoof+driftnet 将他手机正在浏览的图片保存到 Kali 主机内，好东西得分享……；
    
*   室友跟你吹嘘他高数考了 100 分，然而每天比他努力却只考了 60 分的你表示不服，通过使用 arpspoof+ettercap 监听他登陆教务管理系统时输入的账号密码，发现这货只考了 10 分……
    

以上应用场景均假设与 “被害人” 处于同一 WIFI(校园网)环境之中。再次强调下本文所述方法具有攻击性，各位同胞切不可以身试法…… 后果自负

**断网攻击**

在演示如何对局域网内部的主机进行断网攻击之前，我们先来了解下攻击原理——ARP 欺骗。

**ARP 欺骗**

**1、ARP 协议****（如果理论都懂了，可以直接往下滑看 “攻击演示”)**

ARP(Address Resolution Protocol) 即地址解析协议，是根据 IP 地址获取物理地址的一个 TCP/IP 协议。

主机发送信息时将包含目标 IP 地址的 ARP 请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址；

收到返回消息后将该 IP 地址和物理地址存入本机 ARP 缓存中并保留一定时间，下次请求时直接查询 ARP 缓存以节约资源。

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tvP8XYUlXQ6jrqhdYwjMyHudPGQ4yb5mibTibfNbYGibyOb0yS9NVEdp4A/640?wx_fmt=png)

**2、ARP 欺骗**

地址解析协议是建立在网络中各个主机互相信任的基础上的，局域网络上的主机可以自主发送 ARP 应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机 ARP 缓存；

由此攻击者就可以向某一主机发送伪 ARP 应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个 ARP 欺骗。

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04taIexZnKEjObQZMKNibZuZsp9Q4ARrWaAfKWzQmoP4T0JKYW7wgriaQcQ/640?wx_fmt=png)

由于 ARP 缓存表不是实时更新的，如果在网络中产生大量的 ARP 通信量，攻击者只要持续不断的发出伪造的 ARP 响应包就能更改目标主机 ARP 缓存中的 IP-MAC 条目，造成网络中断或中间人攻击。

下面的演示实验将使用网关型欺骗的 ARP 欺骗攻击，通过欺骗受害 PC 主机 / 手机，将局域网的网关地址设置为 Kali 主机的 IP 地址， 使目标主机认为攻击者的网卡是网关，从而将数据包都发给攻击者的网卡，如果攻击者直接将数据包丢弃（不开启转发），即是断网攻击。

如果攻击者的网卡再开启转发，将数据包传到真正网关，则可实现受害主机不断网。

**攻击演示**

1、将 Kali 虚拟机配置为桥接模式，查看其 IP 地址和网关地址：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tjvbVb9j5tvObCicuyCUaEgQzrV9ao0yZbQVEIGXgGLUsr1heml0VsiaA/640?wx_fmt=png)

2、使用 Nmap 扫描局域网中存活的主机的信息

（也可以使用 Kali 内置的 Nmap 图形化界面软件 Zenmap 扫描，结果是一样的）：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tcr8KMRLDdoCia72VAcQKcjMA51zxiaSlWRkTsMh0YHpFiaWGCNicFjay8g/640?wx_fmt=png)

3、在 Win 10 主机使用 Zenamp 做下全面扫描，发现华为手机还是无法扫描到 IP 地址，但 IPhone 和 魅族手机可以扫描到：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tSvxwkHiaAsh7CgEbrj5Hliaia77oAcElh475iaDrbmhiaGelicpQYaLVic2Sw/640?wx_fmt=png)

4、在 Kali 终端执行 arpspoof 命令：arpspoof -i en0 -t 192.168.0.106(目标 IP) 192.168.0.1(网关 IP)

开始进行 ARP 断网攻击，攻击目标为 Win 10 物理主机：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04t5t9UWoVb40RmicKc7mhcOLyj4DtAUtemevYchOPJJLhv3euAzpKBlsA/640?wx_fmt=png)  

5、此时 Win 10 主机已经无法正常连接互联网，访问百度后如下：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tpSdHMT7XiahWRpfKibOEI2Bb3Vcmb2hRoJp9ETSoP3dRFW6iaT9u7vuHw/640?wx_fmt=png)

6、在 Kali 的终端中按下键盘 Ctrl+Z 组合键中断欺骗，物理机就可以恢复正常访问互联网了：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tILR9IqZAYnvIKnWZ0ib9UFvWCY5HpIuiaOXK1uJHWBCJ7E1nia3nibIjzA/640?wx_fmt=png)

7、对华为荣耀 20 手机做了同样的断网攻击测试，结果没法完全断网……

但是会极大地限制网速，刷网页、视频会十分卡顿。

然而对 魅族 A5 手机进行测试，则可以正常实现断网：

![](https://mmbiz.qpic.cn/mmbiz_jpg/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tt5yKiaOqiaqoTSicqI8ibqdrpPl2ibshDwSUBtjOthicSf8pVOHr4covMnQg/640?wx_fmt=jpeg)

华为手机在 Nmap 中扫描不出其 IP 地址、ARP 欺骗也没法实现彻底的断网，具体原因待研究…… 在这里暂时先默默送给它一句 Six Six Six 吧……

**图片窃取**

你以为 Kali 能做的仅仅是让局域网中主机断网这么简单？

单纯截断受害者的数据流量可没多大意思，我们何不自己充当中间人将其数据流量转发出去，然后监听、获取受害者的数据流量呢（疯狂暗示）……

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tMdKToDzMSkrs8JhB019su1PcEjrTz24f4wU7lDPByILKT7r39Ej8Gw/640?wx_fmt=png)

端口转发

在对受害者实施以上 ARP 欺骗实现断网攻击后，如果攻击者将自己的网卡开启流量转发，将截获的数据包传到真正网关，则可让受害主机不断网，同时可以监听到受害者主机的数据流量的内容。

1、编辑 Kali Linux 虚拟机 / etc/sysctl.conf 配置文件，将 net.ipv4.ip_forward 配置项取消掉 “#” 注释符号，并将其值由 0 改为 1 即可开启端口转发：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tNUlEJpC2LVlOdPloxKdz3PD10epribSkeLNWicFOZT7xO9TmC9BzNJ2g/640?wx_fmt=png)

2、接着在 Kali 终端重新执行 arpspoof 命令（注意网关 IP 和主机 IP 顺序此时需要对换一下）：arpspoof -i en0 -t 192.168.0.1(网关 IP) 192.168.0.106(目标 IP)

重新对 Win 10 主机发动 ARP 欺骗攻击，此时其仍能正常联网，端口转发成功：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tlcSttOpkibupO2uIG3zIU3g19npsSpEpT5U5T3gSqCTheic4zHu8ddHw/640?wx_fmt=png)

**攻击演示**

driftnet 是一款简单而使用的图片捕获工具，可以很方便的在网络数据包中抓取图片，其使用语法：driftnet [options] [filter code]。

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tL4KnvzGrWjwtWthVh4ZgicoQFtjQHfrGHbO8FPy6t1v7b79gcTiarsXA/640?wx_fmt=png)

1、此次图片窃取的演示使用 IP 地址为 192.168.0.105 的华为荣耀 20 手机 (前面断网不成功，本菜表示不服)，首先开启 ARP 欺骗：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tjk5WLrb0SqU03ic9XAESib8plNptnYPzic1Vdcjia1wL7k0voOHQR9w23A/640?wx_fmt=png)

2、打开另外一个终端并执行 driftnet -i eth0 -a -d /root/hhh 命令，该命令会自动将手机浏览的图片保存到 Kali 虚拟机的 / root/hhh 路径下：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tSKZxsO5u5NjegBRQiciax1MyhedboTzZrWjA8lvgc6ia7y1ZdSrtHJJCg/640?wx_fmt=png)

3、上图已成功获取到手机上正在访问的图片信息，而此时手机打开的是 “央视新闻” 微信公众号的新闻链接，图中保存了文章评论者的头像，如下图所示：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04t7amrEWfMeiagZXKSVlXx7rWTITjAxnkv3KiarfZgib8ByOoR04T4cI8og/640?wx_fmt=png)

4、此处还对 IPhone 手机、Win 10 物理主机均进行了测试，均可成功监听并保存受害主机的图片：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tibDQ0dem7MA6Bmh3uVcKn6XcGVWdmBBfkyvE1yHzqdqhRxLMnhjlGNg/640?wx_fmt=png)

至此，图片监听窃取的攻击演示结束…… 骚年，看到这里，你还敢连着 WIFI 肆无忌惮地看 “不可描述” 的东西么？

**密码监听**

手机浏览的图片被监听窃取，想一想还是可以忍的（身正不怕影子斜）……

但是如果连上网使用的账号密码也被监听了，兄 die 你还能稳得住么？

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tG3gyGwZtd5BD7oicOvOPwUUzCvibQ8RZOibDtKLZh6qBEbzlrYt8hgN6Q/640?wx_fmt=png)

**ettercap**

前面介绍了，ettercap 是一款网络抓包工具，利用 ARP 协议的缺陷进行中间人攻击，可嗅探局域网数据流量。

ettercap 的参数及常用操作：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tEvBTEbk69KzmykpRWLPPhGJfsibr9HTyZAa4l6TPpNT2zBqWzZuO5Lw/640?wx_fmt=png)

其他命令和使用，我们可以直接在 Kali 终端输入 ettercap -h 打印：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tWvLd8LU9ibGpOKpiaciaSD9CO51ib3RysZXBEXibferEEtVqDgIYnsaQk0Q/640?wx_fmt=png)

**攻击演示**

1、同样先在 Kali 终端执行 arpspoof 命令开启 ARP 欺骗攻击，攻击目标为 Win 10 物理主机：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tsQhRbnhm0cFUSGuAicNlJDeiaibib4pKkkNzboXYodG3x01CQpibXuoniaeQ/640?wx_fmt=png)

2、然后在物理机上打开一个登陆页面

微信搜索公众号：Linux 技术迷，回复：linux 领取资料 。

3、打开另一个 Kali 终端，开始利用 ettercap 来抓取账号密码，在终端输入命令 ettercap -Tq -i eth0（这条命令表示监控 eth0 网卡的流量）即可，监听状态如下图：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tG2A9qsCe5vDdTV6CRjxKCYcGlazHiaQHibUL9Ju940YjaX8g8RibaOrFA/640?wx_fmt=png)

4、此时在物理机输入正确的账号和密码后，即可在虚拟机终端输出打印其账号密码等登录信息：

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tU4M7jmjzMUvQpbADjJuiaArgchvYYaxrk3BUVrl6CDnAVctZ6oTibDJw/640?wx_fmt=png)

5、至此，密码监听的攻击演示结束。

**总结**

从上面的攻击演示可以看出，当你与攻击者处于同一局域网 (同一 WIFI) 下面，攻击者可以借助 ARP 欺骗让你回到 “村里还没接网线” 的年代，同时还能让你的 PC 主机或者手机的部分隐私处于 “裸奔” 状态……

![](https://mmbiz.qpic.cn/mmbiz_png/83e7tQTo0wOkrmAmia6y2rRLKEQGPB04tb4PWMRsMWOPg7oTw9xiaa4RyLgefMiaqPZPHRD7XW3OVe8vAkYvnibQyw/640?wx_fmt=png)

**防止 ARP 攻击**是比较困难的，修改协议也是不大可能，但是有一些工作是可以提高本地网络的安全性和可提高电脑的安全系数

**比如:**  

*   定期删除 ARP 缓存表；
    
*   绑定静态的 ARP 表；
    
*   安装 ARP 防火墙；
    
*   拒绝连接安全性未知的 WIFI 等。
    

我们可以在主机中使用以下命令查看本地的 ARP 缓存：

我们可以在浏览器输入 http://192.168.0.1 进入网关管理页面（路由器后台管理地址）

网络参数一栏有 “IP 与 MAC 绑定” 一栏，把网关的 mac 地址与网关地址绑定就好了：只要确定了对应关系，当攻击者发布 ARP 响应包时，就不会更新相应的 IP-MAC 缓存表。