> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/WoQngG3YHH5i1lhvVYZrAQ)

![](https://mmbiz.qpic.cn/mmbiz_gif/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCic21Q1EHkQtPXNic8x3IdiaEH19B1XwxqiarulnEGboJOBDthGA9MTd3ctg/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicBt8eN6v6V7sttbFcyF8PIkXXXOhtMfjiaRQwH9Y0aiakjBGwURPXc9Tw/640?wx_fmt=png)

前言：最近从一名技术潜移默化的成为了文档工程师，心情复杂的去当初我奔着来的工控实验室。

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKzq4TFicia2yUjianoH80KtrWElvrR0XQbqBDCHC68DicU6TwYLR54jEJE3rqy2icwicrV85dICfKrJsOQ/640?wx_fmt=png) **01**

 **灵感一现**

从网线的走向，到交换机路由，到上位机，到 HMI，到 PLC。一根根网线在我脑海里串起，突然灵光一闪回忆起正常部署 PLC 的时候身份验证环节好像很脆弱，建立连接时没有严格的身份认证，只需要有订货号（类似于产品序列号）就可以了。

那么我在内网中选择一台 PC 机当作上位机，安装博图组态软件（针对西门子 Siemens-PLC 进行管控的应用程序）是不是就可以对 PLC 进行操作了？如果可行的话，可能会导致 PLC 停止工作。

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicJH8IIG9NP0NEt9z5lakQhKRFsCdX7STMfwia3e3Rez4zg5mh68jeCrg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKzq4TFicia2yUjianoH80KtrWElvrR0XQbqBDCHC68DicU6TwYLR54jEJE3rqy2icwicrV85dICfKrJsOQ/640?wx_fmt=png) **02**

**思路构想**

首先使用博途（组态软件）正常连接 PLC，需要新建项目→添加新设备→重点是订货号要匹配上。

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicRlXicJJs9RCWiaW6fNIrjtHfmmlOHZNibbm0V4N5T1NOJoicEcumErxCxA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicULJIfWFiaHiae6VFTtgaJUw9hHDNiamIg5s5oUYKWEicGkSvf0iaQM5TyhQ/640?wx_fmt=png)  

重点就在这个订货号上，当时在想有没有可能通过其他方式获取到订货号？这个订货号感觉就是产品的序列号，有了它就能与 PLC 建立会话？

思路如下：

1. 悄摸摸去现场设备上看；（可能性很小）

2. 机房门口蹲守垃圾堆，捡包装盒；（需要碰运气，而且有些脏）

3. 使用工具探测；（可行）

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKzq4TFicia2yUjianoH80KtrWElvrR0XQbqBDCHC68DicU6TwYLR54jEJE3rqy2icwicrV85dICfKrJsOQ/640?wx_fmt=png) **03**

**Goby 探测信息实现管控**

经过 Google 了半天，发现还真有这样的工具，首先发现的是 Python 写的，叫 ISF。但是需要安装第三方库，折腾了好一会才搞好。然后我发现 Goby 也有识别工控设备的这个功能…… 而且在报文细节上做的更棒，还有端口扫描功能，Web 页面浏览功能等。

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCic8VZtRPlt3C3ULm9vqYuEOnPyKwS2MVhOeaGPfN3zeKibhFohEO6C1Cw/640?wx_fmt=png)

有了订货号可以跟 PLC 交互后，理论上说是不是就可以任命一台同网段内主机做上位机了？经过测试还真行… 完全新建一个项目后，利用 Goby 探测出的资产信息进行添加 PLC，可以成功管控！（吃惊）  

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicFJ0Xc5lVbZW5GiazSRfbp2MxNrlkYUSkW1XDNWMAT8Qj6sCNMEhEhDQ/640?wx_fmt=png)

测试一下 stop 命令…

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicIZL6jcvjjgGX1zvmZZ1EZZnXgcZGUUymchzlualaQibAIldxJQf4Tlg/640?wx_fmt=png)

成功停掉了！告警灯疯狂闪烁！

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCic8qaRsGYhWcCSTrH5VGiaPf8DBaokX420NPhpus9HicWicME7GtGrzTdJQ/640?wx_fmt=png)

事实证明事先的想法是可行的，如果打进内网了运气好可以直接拿到 PLC，如果运气不好也能通过渗透同网段机器，任命上位机的方式拿掉 PLC，起码多了一条思路。

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKzq4TFicia2yUjianoH80KtrWElvrR0XQbqBDCHC68DicU6TwYLR54jEJE3rqy2icwicrV85dICfKrJsOQ/640?wx_fmt=png) **04**

**亮眼的工控实验室**

最后附一张工控实验室照片，上面好多设备被同事拆走带北京研究了。

**![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKjicGO9Hy5M6DLTaLia1iabCicX2T8swibBDKuxuwTNMRib2riam4ANOMzIIfC3y0F35oCW7Xia4WIdxh6aQ/640?wx_fmt=png)**

  

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKzq4TFicia2yUjianoH80KtrWfiaAtUngV8rgLh0bIibv9SumD1Y9ZmphGxK9lKiakkOWDp2gRsLjZInPg/640?wx_fmt=png)

**更多 Goby 使用技巧分享****：**

[• Corp0ra1 | Goby 食用指南之红蓝对抗](http://mp.weixin.qq.com/s?__biz=MzI4MzcwNTAzOQ==&mid=2247483874&idx=1&sn=b7278846b8d2720b463e4c859e09a682&chksm=eb87ea42dcf063547b40a785e7aa9b8efcf47e043c90a0dfb029122101b34f6b6b33ff4fcba6&scene=21#wechat_redirect)  

[• evil | 如何利用 Goby 进行外围打点](http://mp.weixin.qq.com/s?__biz=MzI4MzcwNTAzOQ==&mid=2247484044&idx=1&sn=c1bef67c6c4d52590d4c59750a1d5432&chksm=eb87e92cdcf0603a179de6adfc194e90a364cf5425b2494db95397d74a9348a2721b6a936bce&scene=21#wechat_redirect)  

[• mojie | 自定义漏洞之 PoC 对接插件](http://mp.weixin.qq.com/s?__biz=MzI4MzcwNTAzOQ==&mid=2247484086&idx=1&sn=74cf77890854ee6e498606d9ab903b1a&chksm=eb87e916dcf06000eaa745b0f738adc2e7cdd29d7cc29551202c87fc478934406594fd47e83a&scene=21#wechat_redirect)

[• mojie | 自定义漏洞之 EXP](http://mp.weixin.qq.com/s?__biz=MzI4MzcwNTAzOQ==&mid=2247484147&idx=1&sn=e333b79f64d06c8150d368fdc6076745&chksm=eb87e953dcf0604529e2a1fab0593040361957676966fd4b5df4bb0c9b54538fd471332e9733&scene=21#wechat_redirect)

[• mojie | 如何在 Goby 发布新版前拥有 S2-061EXP](http://mp.weixin.qq.com/s?__biz=MzI4MzcwNTAzOQ==&mid=2247484640&idx=1&sn=90c70a84c4a2b88b8e3a9e69c8589b5d&chksm=eb87ef40dcf0665666df15c0a47a139da13d721639d2a53f1fff4fd5d36962b5db803cdd6983&scene=21#wechat_redirect)

如果表哥 / 表姐也想把自己上交给社区（分享自己的使用技巧）![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjKEYyZh6YMicl2K5TDD26xJiaXMwReBoEFfWYSRkOGBMzrZ3VpbKu1DtFLprCibCrsuX3QlGJLMG79jg/640?wx_fmt=png)，欢迎提交文章到我们公众号，超级内测版等着你们~~~

![](https://mmbiz.qpic.cn/mmbiz_png/GGOWG0fficjIaeEP9ZkuBRxk7BicMlGFoEZnkVh7ib8GaBYw8lrh8SqACnTUZXlXclC9ZRfOFuvB3gTWHOPvH8icyg/640?wx_fmt=png)