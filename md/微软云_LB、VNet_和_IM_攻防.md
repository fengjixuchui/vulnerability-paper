<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/drk4iYgupynTKGvefSmRFw)

文章首发于：

火线Zone社区（https://zone.huoxian.cn/）

  

**0x01 LB**

  

Azure 负载均衡器在开放式系统互连 (OSI) 模型的第 4 层上运行，它是客户端的单一联系点。

  

负载均衡器将抵达负载均衡器前端的入站流分配到后端池实例，这些流取决于配置的负载均衡规则和运行状况探测，后端池实例可以是 Azure 虚拟机，或虚拟机规模集中的实例。

  

**01**

**影响**

  

创建负载均衡器资源

  

```
`az network lb create --resource-group Test --name MyLB --sku Standard --public-ip-address Myip --frontend-ip-name myfront --backend-pool-name myback``创建公共负载均衡器，命名为MyLB，前端池命名为myfront，后端池子命名为myback，与上一步创建的公共ip地址Myip关联`
```

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaTBgBz7xSOV436m9iaBRO1TqrDmBor8BPPla9DePCjgia2hicnK4jibvUBcEaUmDbcNx0dNcwJ2MtCNicw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

创建运行状况检测

  

```
`az network lb probe create --resource-group Test --lb-name MyLB --name MyPROBE --protocol tcp --port 80``命名为MyPROBE，协议为tcp，监视端口为80`
```

  

创建负载均衡器规则

  

```
`az network lb rule create --resource-group Test --lb-name MyLB --name myHTTPRule --protocol tcp --frontend-port 80 --backend-port 80 --frontend-ip-name myfront --backend-pool-name myback --disable-outbound-snat true --idle-timeout 15 --enable-tcp-reset true``命名为myHTTPRule，对前端池myfront中的端口80进行监听，使用端口80将负载均衡的网络流量发送到后端池myback，协议为tcp，空闲超时15分钟，启用tcp重置`
```

  

将虚拟机添加到负载均衡器后端池

  

```
`array=(myNicVM1 myNicVM2)` `for vmnic in "${array[@]}"` `do` `az network nic ip-config address-pool add \` `--address-pool myBackendPool \` `--ip-config-name ipconfig1 \` `--nic-name $vmnic \` `--resource-group CreatePubLBQS-rg \` `--lb-name myLoadBalancer` `done`
```

  

**0x02 VNet**

  

Azure 虚拟网络 (VNet) 是 Azure 中专用网络的基本构建块，VNet 允许许多类型的 Azure 资源（例如 Azure 虚拟机 (VM)）以安全方式彼此通信、与 Internet 通信，以及与本地网络通信。

  

**01**

**信息收集**

  

在VPC的地址空间处可以看到虚拟网络的地址空间，对于后续了解网络结构有一定的帮助。

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

通过防火墙配置可以查看规则、公共IP配置信息，还可以通过防火墙管理器进行安全配置修改

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**02**

**影响**

  

攻击者能够创建资源组、虚拟网络、公共 IP 或者修改安全组、防火墙策略等，从而达到自己的目的。

  

创建资源组

  

```
`az group create --name Test --location eastus``创建名为Test位置为eastus的资源组`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

创建虚拟网络

  

```
`az network vnet create --resource-group Test --location eastus --name Mynet --address-prefixes 10.1.0.0/16 --subnet-name mytest --subnet-prefixes 10.1.0.0/24``创建名为Mynet，地址前缀为10.1.0.0/16，子网名为Mytest，地址前缀为10.1.0.0/24，在Test资源组中`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

创建公共IP地址

  

```
`az network public-ip create --resource-group Test --name Myip --sku Standard``在资源组Test创建名为Myip的标准区域冗余公共ip地址`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**0x03 IM**

  

IM 即访问控制管理，在这里可以对用户的权限进行分配管理。

  

**01**

**信息收集**

  

在 IM 中可以看到目标对当前账号的角色分配情况，通过这些信息，可以判断出当前目标的高价值用户、运维人员的情况。

  

**02**

**权限维持**

  

在 IM 中实现权限维持一般有两种方法，一个是在 IM 中创建一个拥有高权限的用户；一个是直接创建一个访问密钥，同样可以实现权限维持。

  

参考：

  

https://docs.microsoft.com/zh-cn/azure/load-balancer/quickstart-load-balancer-standard-public-cli?tabs=option-1-create-load-balancer-standard

https://docs.microsoft.com/zh-cn/azure/virtual-network/virtual-networks-overview

  

  

**【火线Zone云安全社区群】**

进群可以与技术大佬互相交流

进群有机会免费领取节假日礼品

进群可以免费观看技术分享直播

识别二维码回复**【社区群】**进群

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**【火线Zone社区周激励】**

2022.5.9～ 2022.5.15公告

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**【相关精选文章】**

  

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247494895&idx=1&sn=7b90840f867a4984647156157e0308aa&chksm=eaa964cfdddeedd9d68f23c01e8ef2e746c2d941bfa4955182d9745d80bc777f9c452562f5e5&scene=21#wechat_redirect)

  

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247494880&idx=1&sn=852e311372f460d4f20f73204b1a9da4&chksm=eaa964c0dddeedd682fb1e9b6e2514352a62eba724a3d6922c139a66294d1b7e15b87531892b&scene=21#wechat_redirect)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

火线Zone是[火线安全平台]运营的云安全社区，内容涵盖云计算、云安全、漏洞分析、攻防等热门主题，研究讨论云安全相关技术，助力所有云上用户实现全面的安全防护。欢迎具备分享和探索精神的云上用户加入火线Zone社区，共建一个云安全优质社区！

如需转载火线Zone公众号内的文章请联系火线小助手：hxanquan（微信）  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

//  火线Zone //

微信号 : huoxian_zone

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

点击阅读原文，加入社区，共建一个有技术氛围的优质社区！