<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DiYQ3nWSC29RdNca2i9tqQ)

![](https://mmbiz.qpic.cn/mmbiz_png/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNF8EZlMibYRS8SZWzqeiadVJYwNUTPAiafWgVtBaV7vVjqicXoHyrwLY3rHg/640?wx_fmt=png)

作者 |  tom0099  

编 | Yanni

本文介绍了一种从攻防两个维度研究分析网络安全对抗技术的方法。该方法基于 Sysmon 日志、ATT&CK 标签日志、操作系统日志的分析实践，通过几种典型攻防对抗技术示例，着重介绍和分析攻击在主机层面特征，为蓝队人员 “看得见”“看得清” 网络威胁，提供了一种简单易学的技术修炼方法。也借此抛砖引玉，希望在安全规则优化或威胁狩猎的专家能有更多此方面技术分享。

 | **1、“左右互搏术”** |

这里的 “左右互搏术”，喻意为安全人员一边模拟红队或入侵者或企业内恶意人员的攻击，一边作为防守方从网络、主机等多层面检测和分析攻击，有助于安全人员理解掌握相关攻击技术原理、技术特征及其产生的日志、告警等信息。若将相关经验应用到企业生产环境，那么为企业优化网络安全告警解析规则、快速分析溯源攻击、威胁狩猎、针对性增强防护检测措施等方面，将是大有裨益的。

 | **2、资源准备** |

测试验证主要资源及软硬件配置信息如下。  

笔记本电脑：CPU 4 核 1.8GHz、内存 16GB、SSD 硬盘 1T，虚拟化软件 VMware Workstation Pro 15。  

SEIM（安全信息和事件管理系统）：Elastic ELK Docker 虚拟机推荐分配 12GB 内存  

日志采集软件：Sysmon+modular sysmonconfig.xml 配置文件，日志传送软件 winlogbeat 和 filebeat。  

攻击机：互联网云主机 + CobaltStrike（以下简称 CS）+ 云函数及 API 网关，虚拟机 Windows10+CS + 红队工具，虚拟机 Kali 或 Ubuntu+Impacket 等工具。

靶机：Windows2016、Windows11、Windows10、CentOS 8、Ubuntu20.04 等虚拟机。

 | **3、基于 Sysmon 的 “左右互搏术”** |

Sysmon 是微软安全人员开发的一种 Windows 系统服务和设备驱动程序，一旦安装在系统上，就会在系统重启后保持驻留状态，以监视系统活动并将其记录到 Windows 事件日志。它能提供有关进程创建、网络连接和文件创建时间更改等详细信息。通过使用 Windows 事件查看器或 SIEM 代理收集它生成的事件并进行安全分析，可了解入侵者和恶意软件如何在网络系统上运行，从而识别恶意或异常活动。目前，Sysmon 也有支持 Linux 版本，但其检测功能还比较弱，支持的操作系统类型较少。  

**以下介绍三方面场景，主要介绍在主机侧对有关攻击的检测发现。**篇幅有限，未对有关攻击与检测技术原理，防护措施等深入展开说明。

**3.1 EventlD 1 进程创建**

Sysmon EventID 1 是为有关新创建进程提供扩展信息，能提供有关进程执行上下文的完整命令行。

攻击者入侵系统往往会创建进程与 C2 等远控服务器建立通信连接，因此一般可通过 Sysmon EventID 1 进程创建事件来发现入侵行为。

### 3.1.1 红队攻击

红队在内网横向移动过程中，可能会使用 Impacket 套件等工具。现在模拟红队执行 psexec.py 横向移动一台 Windows 主机，执行效果如下图所示。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFIj8L5ZsgwuwzgTzPffEickkicEG3yw5mkia3grq7IiccS5JOCro0hI5tHw/640?wx_fmt=jpeg)  

使用 psexec.py 时，靶机出现病毒告警，改用 smbexec.py 则不会被防病毒软件（这里指 Defender）查杀，且能与靶机保持正常通信，执行效果见下图。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFmaibCyobpdZRrCwAVoicavuOM9b0JydyibUM8yG7mrib1coibEeLKNyjRmg/640?wx_fmt=jpeg)

### 3.1.2 蓝队防守

蓝队可以从有关攻击工具的源代码（如有）或恶意样本、网络通信数据包、主机日志等方面来进行安全分析。

#### 1）代码层面分析

通过查看 psexec.py 代码，可以深入了解其工作原理。下图代码展示了 psexec.py 首先会使用 SMB 协议进行会话协商，通过可写共享上传随机文件名的 exe 文件，随后打开 SVCManager 并创建服务，之后启动服务与远控端建立通信连接。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNF138qAx8f2LmjFPhiaIxko5GxCS4xbEPwDialdia1qgMJBCHIzFXqPlIyw/640?wx_fmt=jpeg)

#### 2）网络层面分析

通过 wireshark 获取网络数据包，验证了 psexec.py 开始使用了 SMB 协议进行会话协商，通过深入分析网络数据包，观察其是否有明显特征。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFy1O76AzOZ3ibKhiaKqTyB2x8MBxSPN3UtHoVC4icbkF1RPDlugxSmGDCQ/640?wx_fmt=jpeg)

#### 3）主机层面行为分析

通过 Elastic ELK 平台集中分析主机层面攻击行为，搜索 eventID 为 1 的事件，下图显示了红队执行 psexec.py 攻击及 whoami 命令后，在靶机上产生了 2 个进程。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFA2hj3P3YAAicRCfWTyiaJyMqbEibQwic7yTk9omIcngDtJ4tNFT646xA9Q/640?wx_fmt=jpeg)  

但由于 psexec.py 执行有很多明显的特征，已被大多数防病毒软件查杀，以下是 Windows defender 查杀告警。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFAA26zQKct7HxlvibGgNAUzxHAWHwCUibjjqlqp89ySCrib7DIIUQBQFiag/640?wx_fmt=jpeg)

smbexec.py 之所以没有被防病毒软件查杀，原因是其利用一个批处理文件和一个临时文件来执行和转发消息，达到免杀效果，如下图所示。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFKECmcdcicQJibBLQXfpyc5j75D3j5M0q1DlU4YSIQlpNARJ0icGcR4Yfw/640?wx_fmt=jpeg)

通过查看 smbexec.py 源代码，也可以验证此技术特征。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNF7VEiaBB0giaQHHIFpldchbsicEVjUOAvklTWbqh7oTN42MIhibRLlVSd3g/640?wx_fmt=jpeg)

#### 4）主机操作系统日志分析

蓝队也可以通过查看 Windows 操作系统安全日志，ID 编号为 4624，发现用户异常登录，如下图所示。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFtibNQfKGRZWnU8PuzeTQHB5Y3iaAADbS0mZcNeWFt6N9DPicGJ08TYKRQ/640?wx_fmt=jpeg)

**3.2 EventID 3&22**

Sysmon EventID 3 和 22 是网络外连事件。EventID 3 是记录系统 TCP/UDP 网络连接。每个连接都通过 ProcessId 和 ProcessGuid 字段链接到一个进程。该事件还包含源和目标主机 IP 地址、端口号和 IPv6 状态。EventID 22 是 DNS 查询，无论 DNS 查询结果成功还是失败、缓存与否，进程执行 DNS 查询时都会生成此事件。  

搜索 EventID 3，查看测试 CS 木马在靶机上的进程名称、网络外连 IP 和端口等信息，如下图所示。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFV1QO7n1onVCPJsgXK5CWlRMlE40jF6GcOUKVpBJ6PGyd77dYy3SD4Q/640?wx_fmt=jpeg)  

搜索 EventID 22，显示 CS 木马外联 C2 时，通过 DNS 解析了 C2 使用的云函数 API 网关的域名。因此，蓝队可将 EventID 3 和 22 检测到的外连 IP 和域名，与威胁情报库匹配来发现一些攻击行为。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFsBo2v2ubgTvTTSHmb6GWM5ckXy68tj12168IlcQRtjsbsYNuKzX2mQ/640?wx_fmt=jpeg)

下图是一个典型的 CS 木马执行后外连 C2 后产生的 Sysmon 告警日志柱状图。可以观测到木马执行后，先会产生大量多种 EventID 日志，再到后来远控通信产生的大量网络连接数据包（下图绿色部分），蓝队可以将其作为一种典型攻击行为进行跟踪。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNF5L0RmoonOhCktW4FZ3BfibGVQ7GHHWHI3PyFeYkqH3Wjg2UtTJY8Xyg/640?wx_fmt=jpeg)

对于初步识别出的可疑进程，可依托 Elastic ELK 进程关联分析功能，让蓝队很容易理解攻击行为，并高效地开展攻击溯源或威胁狩猎。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFm1geVPFT71tFmoT7ibpMhB5BDDlY2T7un3EPQKHfsq71fialeSrNIRvg/640?wx_fmt=jpeg)

**3.3 EventID 17&18**

Sysmon EventID 17 在创建命名管道时生成，而恶意软件通常使用命名管道进行进程间通信。EventID 18 则是在客户和服务端之间建立命名管道连接时形成事件记录。  
以下两图分别展示了 CS 木马在靶机上产生的命名管道创建和连接日志。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFXgclU8YtQzQFkgJbqnnLp33pe4Y0eIiaAfVn9j32XCEeSImlxAcibPEg/640?wx_fmt=jpeg)  
![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNF5iaLewzPtPUvxDn3ouicgTjBvjSFGmja3JO5F2UicCDEuzAAwOTOMLzKw/640?wx_fmt=jpeg)

CS 有很多用于后渗透的攻击模块，其加载通常借助调用 Windows DLL 方式来实现。这些攻击模块会通过命名管道的形式与 Beacon 通信，默认管道名称有 \ MSSE-、\postex_、\postex ssh*、\status_、\msagent_。这为蓝队分析判断攻击者使用哪种武器，有一定参考意义。  

通过对 Sysmon 每一个 EventID 事件分析，蓝队将会发现很多有安全价值的信息，对不同 EventID 进行关联，将会在入侵检测方面有较大的发挥空间。例如，通过监控单个或所有主机 Sysmon EventID 的走势图，也是可以发现攻击异常。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNF1zR9hjcYuTB91S4mJ8KPLia6a4K65c3LiavGeEOJ0Fx9dQHtEYQy3Asg/640?wx_fmt=jpeg)

 | **4、基于 ATT&CK 的 “左右互搏术”** |

借助 ATT&CK 模型，可以让蓝队更容易理解分析攻击者所使用的技战术和工具，甚至能分析判断出其属于哪个团伙，也便于安全人员间交流。

本项测试基于 Sysmon 产生的带有 ATT&CK 标签的日志。通过 ATT&CK 技战术分析日志，非常有助于蓝队攻击溯源和威胁狩猎。遗憾的是，目前少有 EDR、HIDS 厂家将带有 ATT&CK 标签的日志接口开放，不利于蓝队使用该模型来开发关联检测规则。

**4.1ATT&CK T1003**

在网络攻击中，凭证导出是最常见的攻击行为之一。目前，ATT&CK 模型中操作系统凭证导出有以下 8 种子技术：

T1003.001: LSASS Memory  
T1003.002: Security Account Manager  
T1003.003: NTDS  
T1003.004: LSA Secrets  
T1003.005: Cached Domain Credentials  
T1003.006: DCSync  
T1003.007: Proc Filesystem  
T1003.008: /etc/passwd and /etc/shadow  
这里测试 T1003.001:LSASS Memory 和 T1003.006:DCSync。

### 4.1.1 红队攻击

红队有时会将 LSASS 进程内存转储后，通过 mimikatz 离线导出账号密码及哈希。值得注意的是，安装了 KB2871997 补丁或者系统版本大于 Windows server 2012 的，系统内存已不再保存明文密码，且只有 Administrator(SID 500) 默认账号可被用于 PTH 哈希传递攻击。

假设红队导出上述的某个账号密码属于域管理员组或具有 DCsync 权限，则可使用 secretsdump.py 来导出域控 AD 目录所有账号及密码哈希。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFPiaNibePdXRFYxHEIrfuQPvOviaKuKJD4hibicLUFsZ0v5NwNpaicQLOPOZw/640?wx_fmt=jpeg)

而在大型域环境，一般会使用 BloodHound（下图）等工具来查找具有 DCSync 权限的账户。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFMpv1jXicTw7yfNtj50SVIBd40BIljtVq9tOA46frNu0Q8eG2hyxtjWg/640?wx_fmt=jpeg)

### 4.1.2 蓝队防守

针对红队第一种攻击技术，蓝队通过搜索 T1003.001 或 Credential Dumping 关键词，如下图所示，会发现红队访问 lsass.exe 进程的行为。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFNf24eagcibooHVJy9GqiaIbj5s6rjBSlSg9tscslfdPdEc4G0PBiccWug/640?wx_fmt=jpeg)  

结合 Sysmon EventID 11 或直接查找 lsass.dmp 文件, 或通过 ELK 自定义搜索结果来快速检索。如下图所示，检测到 lsass 内存转储行为。值得注意的是，测试发现 mimikatz shell 里执行的命令，Sysmon 并没有相关日志记录。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFjoJ2olZ7e70NsyicRmKoq8bcqADH12Werb4bYJherlnhLnYzA7x4ApQ/640?wx_fmt=jpeg)  

在红队进行第二种技术攻击时，即使用 secretsdump.py 导出域控 AD 目录所有账号和哈希时，Sysmon 并没有产生有关日志，而 Windows 安全日志里则产生了大量 4622 事件（A security package has been loaded by the Local Security Authority）。蓝队可以通过 ELK 预置规则或修改预置规则进行关联告警。需要提醒的是每一条安全检测规则均应经过实际测试验证有效。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFOt3EBfTKkzSNauVoVibOljVo7b4QnZOyjGrMWTiaKktujWRLnp0wEJjg/640?wx_fmt=jpeg)

根据红队使用 DCsync 攻击技术及 Windows 安全日志，蓝队可创建两条规则：规则一是检测使用 hacker 账户进行 NTLM V2 认证登录：winlog.event_data.LmPackageName:  

“NTLM V2”（还可以增加更多字段以提高检测的准确度）；规则二是将 DCsync 攻击产生的日志中有关字段（any where event.action==” 目录服务访问” and event.code==”4662”and winlog.event_data.AccessMask:”0x100” 等）进行关联并设置阈值，经测试产生了相关告警。如果两条规则产生的告警同时出现，更充分说明正在发生 PTH 和 DCsync 攻击，如下图所示。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFAXnSdsLWfc66sGAHeIBRBzkFOCjIjEFd38MrxGgCDtiaGKNtVW1FCcw/640?wx_fmt=jpeg)

**4.2 ATT&CK 1136.001**

红队在攻击 Linux 系统后，有可能会创建账号。Sysmon for Linux 可以检测此类攻击行为，修改 Sysmon 配置文件，添加如下图所示检测规则，可检测 Linux 账号创建行为。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFB1zPXWORo6KJYLaFSIBbC8ngpca1eicjiadBVcpbEwq3W65vM1icO2uNw/640?wx_fmt=jpeg)

在 ELK 中查询创建账号时，Sysmon 有生成 “T1136.001：Local Account”ATT&CK 标签的日志。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFXL48ibETib3PcRDMZObtLlSowGqh9gJsOSZRecuiaeLUiaxCXoJZTRXf8Q/640?wx_fmt=jpeg)

同 Sysmon EventID 走势图一样，蓝队也可以通过监控单个或所有主机 “TechniqueID” 走势图来发现攻击行为或其他异常。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFwrKicxMjTTRF35EhbDpKWdGy3FoCGF9fcuZ53icFtnpumqHGQQ8STTWw/640?wx_fmt=jpeg)

 | **5、基于操作系统日志的 “左右互搏术”** |

Windows 操作系统中有 Powershell、Defender、USB 和 WIFI 使用等相关日志，因此，蓝队应能从这些日志中发现一些入侵攻击或恶意行为。

**5.1 PTH 哈希传递攻击场景**

红队在内网横向移动过程中，往往会利用已掌握的个别系统账号密码，使用 CME 等工具对内网服务器实施 SSH、SMB 等协议密码喷洒攻击或 PTH 哈希传递攻击。

### 5.1.1 红队攻击

模拟红队使用 crackmapexec 套件工具，利用已获得账号及其哈希值，进行哈希传递攻击。下图显示发现有两个系统存在相同的账号密码。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFVBoJTtvke9WxQyh78EgPTeVia0fvibM8qNfNqUtMmNHUFmr1tAMepicdg/640?wx_fmt=jpeg)

### **5.1.2 蓝队防守**

#### 1）网络层面分析

通过分析网络数据包，未发现明显攻击特征。蓝队可在实际生产环境中验证是否能产生密码喷洒告警。

#### 2）主机层面行为分析

使用场景 4.1.2 中的 PTH 哈希传递攻击检测规则 “NTLMV2 访问”，发现了 CME 工具发起的 PTH 哈希传递攻击。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFBEIHwPDBjI8XenntxZEtT5n1u9AAppCu2YTc0uWuywn7DqtAaAm0mw/640?wx_fmt=jpeg)

**5.2 SID history 权限维持**

SID history 是攻击者用到的比较隐蔽的一种权限维持方法。蓝队应当经常检查域控是否有账号存在 500 SID history 权限，可通过 powershell 命令排查（Get-ADUser -Filter “SIDHistory -like ‘’” -Properties SIDHistory| ` Where { $_.SIDHistory -Like “-500” }）。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFtZhhuENmUvHYZS9T9NaiamxXxFXvUjibGyne5o4KoYcHcdJoMXoibzErg/640?wx_fmt=jpeg)  

Window 安全日志 ID 4765 事件为 SID History 添加到用户时生成。如果没有查找到 4765 事件，则可查找 ID 4738 事件，并查看有关用户的 SID history 变更情况。下图显示，为 hacker 账号添加了 500 SID history。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFTVWiavdChWYfYxrvHSyIrswMIxNuIvuACZuQxBEbiaeiaacHSVZYeGTPg/640?wx_fmt=jpeg)

**5.3 防泄密场景**

如果企业有封闭网络环境，禁止服务器接入 USB 存储设备，防止敏感数据被窃取。那么作为一种审计措施，将检索 “event.code:207 and 驱动器” 形成如下搜索结果，从而检测相关服务器是否发生了失泄密事件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFibjhAnyosNmxnajyNTvuwPKibvN9yhTfpiajGAMtDAEbpaibzygXIqGs3A/640?wx_fmt=jpeg)

**5.4 WiFi 非法外联场景**

如果企业有封闭网络环境，禁止非法网络外连。作为一种审计措施，将检索 “event.code:8001 and 无线” 形成如下搜索结果，从而检测是否发生了非法网络外连行为。这种违规行为在封闭网络环境下时有发生，值得特别关注。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFHQSBa9iaCEzFvHlT65rQ10sVptj9QuiaA4tkCga9xOSmTicYMicWAVHicRA/640?wx_fmt=jpeg)

**5.5 病毒告警场景**

如果企业使用 Windows Defender 防病毒软件，那么可以将 Defender 日志集中收集分析。检索 “event.code:1116” 和“event.code:1117”形成如下搜索结果，从而快速发现恶意文件和攻击行为。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrNQQpe1lx9icbCP4m1rnWNFf3lwJ6sLZot4tfen8icVExv1cuic9ib181fic99icLBzSYibmIHiaxPPkj2TQ/640?wx_fmt=jpeg)

 | **6、总结** |

通过以上攻防对抗技术测试，将 Sysmon EventID 日志、带有 ATT&CK 标签日志和操作系统等日志，通过 SEIM、SOC 等安全系统进行关联分析，能有效提升企业网络威胁检测能力。

当然使用 Sysmon 也有其局限性，通过卸载 Sysmon 或关闭 Sysmon 进程或 hook ETW，达到绕过 Sysmon 检测，或者将 winlogbeat、filebeat 这类传送日志的进程关闭，从而使 SEIM 无法收到相关日志及检测发现攻击行为。

另外，还有一些攻击者热衷于使用 LOLBAS 攻击（Living Off The Land Binaries, Scripts and Libraries）。这类程序一般具有微软或第三方认证机构的数字签名，所以不会被防病毒软件查杀，因此，往往被攻击者用于下载恶意程序、执行恶意代码、绕过 UAC 等内网渗透活动。蓝队可针对此类攻击方式，梳理这些程序或命令执行时最常使用的技术参数，将其纳入自定义检测告警规则，从而发现 LOLBAS 类攻击。

网络攻防对抗就像猫鼠游戏，蓝队需要持续跟踪了解掌握常见攻击技术，根据自身业务安全场景需要，通过持续优化安全系统告警规则，结合网络安全有效性验证及红蓝对抗实战化检验，及时检测发现深层次网络攻击行为和异常。

以下为测试过程中参考或应用到的部分资源链接信息。  
1)[https://attack.mitre.org/versions/v12/](https://attack.mitre.org/versions/v12/)  
2)[https://github.com/deviantony/docker-elk](https://github.com/deviantony/docker-elk)  
3)[https://github.com/elastic/detection-rules](https://github.com/elastic/detection-rules)  
4)[https://github.com/SigmaHQ/sigma/tree/master/rules](https://github.com/SigmaHQ/sigma/tree/master/rules)  
5)[https://car.mitre.org/analytics/by\_technique](https://car.mitre.org/analytics/by%5C_technique)  
6)[https://github.com/12306Bro/Threathunting-book](https://github.com/12306Bro/Threathunting-book)  
7)[https://lolbas-project.github.io/](https://lolbas-project.github.io/)

**精彩推荐**

* * *

[![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyonyNTH4PAdhFjcQicHmuPRy5uhwQMFotGgHetdT7lMmZAG6L38x1FGf7xDWKDaVg0uB2Gib73qjMQA/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=Mzg2MTAwNzg1Ng==&mid=2247490008&idx=1&sn=be4a7fe149f0e103af67529dcb51d641&chksm=ce1ce347f96b6a510a8d815654ca2f458b3d91eabb3532bfb847521448ea4a47bd1ffc8c242c&scene=21#wechat_redirect)[![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrM3dWIiaeKadRkeib9YDFZcWO20loHuBzYuJwNib7PbQ3JFXhRzPZUhHLtiaPI3tcVvTLThth5LOz2aQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=Mzg2MTAwNzg1Ng==&mid=2247489845&idx=1&sn=6e8667278a5c215d369016657ae885af&chksm=ce1ce3aaf96b6abc62f788766e47e2ca68de864f023cb66feb2215973751a0d70afa21286a13&scene=21#wechat_redirect)[![](https://mmbiz.qpic.cn/mmbiz_jpg/oQ6bDiaGhdyrM3dWIiaeKadRkeib9YDFZcW4he4Qw95djRia3gBxOTo0O6He3C9aCU2mpC16Ofg9Olj2kHhZOJcAFQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=Mzg2MTAwNzg1Ng==&mid=2247489815&idx=1&sn=bced4dd929bf77dc7f42752ea0e7730f&chksm=ce1ce388f96b6a9ef2fd48d8ecdb3d6442986e4f3dcacc2eda088718812a669787a58579c297&scene=21#wechat_redirect)![](https://mmbiz.qpic.cn/mmbiz_gif/oQ6bDiaGhdyqPFicE2ofjMiaicFVmMg7A7ZsULovp5oJvPQul8uiaFyg2w09MDa2jTmd7JAeBYdwPJpelBTjGAR7xXQ/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)