<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/AniPaGHYbLTZ5LRC5Z4xdg)

![](https://mmbiz.qpic.cn/mmbiz_png/My1Gumia3SKLeW5YKmZRUj1DicOJWicDUhqMc122V9S8icg9o3WlJxW962Q63Qp26ickjDaDMCCvFZgCc5Gvt1DibBLA/640?wx_fmt=png)

APP 安全威胁

![](https://mmbiz.qpic.cn/mmbiz_png/N5gGFPMEm3B6B4eKDcfNt5VFLvBOq8S7oicKicuouHJxltjKNXAiaZs9SYym7mgmx7gkBnKyD2eibkaRJYwoBHwKDw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/hMjlYNLvPyRpUl2m3A1sdiawdLBktzcYbRjdeeXvJtOWbehuJxMOEUK9zxqK8c0PkoxZAVxv4B7PicGMo6sC3OcQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_png/xicQVVic8TfFvDuZ1oRzgNicaicaRIsA1tE7Csu27FgSnBGgnbZNKdMLVbIwayvdMTA1Is6V3kp0SK7EDGjznOibzeQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUkEDbzFzW1jlUsaHFFxMiaR5OR0SBwIKWRZLwPVRfT6nf5u8on44g9iaA/640?wx_fmt=png)

在 App 项目中都会碰到三座 App 安全大山。**App 客户端安全、数据传输安全、App 服务端安全**。下面以分析检测的思路进行对 App 安全威胁的这三座大山进行一些剖析梳理总结。

![](https://mmbiz.qpic.cn/mmbiz_png/My1Gumia3SKLeW5YKmZRUj1DicOJWicDUhqMc122V9S8icg9o3WlJxW962Q63Qp26ickjDaDMCCvFZgCc5Gvt1DibBLA/640?wx_fmt=png)

工具介绍

![](https://mmbiz.qpic.cn/mmbiz_png/N5gGFPMEm3B6B4eKDcfNt5VFLvBOq8S7oicKicuouHJxltjKNXAiaZs9SYym7mgmx7gkBnKyD2eibkaRJYwoBHwKDw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/hMjlYNLvPyRpUl2m3A1sdiawdLBktzcYbRjdeeXvJtOWbehuJxMOEUK9zxqK8c0PkoxZAVxv4B7PicGMo6sC3OcQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_png/xicQVVic8TfFvDuZ1oRzgNicaicaRIsA1tE7Csu27FgSnBGgnbZNKdMLVbIwayvdMTA1Is6V3kp0SK7EDGjznOibzeQ/640?wx_fmt=png)

**静态分析工具** : Apktool、dex2jar、jadx-gui、JEB、Androidkiller、GDA。

**动态分析工具** : DDMS、gdb、IDA、Drozer。

**抓包分析工具** : Fiddler、Wireshark、charles。

**挂钩框架** : frida、xposed。

**其他工具** : JDK、AndroidSDK、AndroidResEdit、uiautomatorviewer、010 editor、jarsigner。

![](https://mmbiz.qpic.cn/mmbiz_png/My1Gumia3SKLeW5YKmZRUj1DicOJWicDUhqMc122V9S8icg9o3WlJxW962Q63Qp26ickjDaDMCCvFZgCc5Gvt1DibBLA/640?wx_fmt=png)

App 客户端安全测试

![](https://mmbiz.qpic.cn/mmbiz_png/N5gGFPMEm3B6B4eKDcfNt5VFLvBOq8S7oicKicuouHJxltjKNXAiaZs9SYym7mgmx7gkBnKyD2eibkaRJYwoBHwKDw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/hMjlYNLvPyRpUl2m3A1sdiawdLBktzcYbRjdeeXvJtOWbehuJxMOEUK9zxqK8c0PkoxZAVxv4B7PicGMo6sC3OcQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_png/xicQVVic8TfFvDuZ1oRzgNicaicaRIsA1tE7Csu27FgSnBGgnbZNKdMLVbIwayvdMTA1Is6V3kp0SK7EDGjznOibzeQ/640?wx_fmt=png)

  

  

  

运行环境检测

    1. 反编译 App 代码，查看 App 中是否存在检测 root 的关键代码。

    2. 运行 App 程序，观察确认是否能够正常运行并有对应提示用户信息。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUohsA0qXnPawTk78Vx3ZSC9QEKOFr3gNCJCLic6RcA0hrpzIapicnlz8g/640?wx_fmt=png)

通过上图静态分析 App 的 java 实现代码，可以很清晰的看到代码中有实现对 root 检测，通过检测可以改 root 的关键 App 包和检测 root 后的特有关键路径方式进行判断环境信息。

  

  

  

反编译检测

1. 可以利用 apktool、de2jar、jadx-gui 工具，进行反编译查看分析代码。

2. 直接利用可视化工具 AndroidKiller、GDA、JEB 工具进行反编译分析代码。

下面以 apktool 反编译方式进行对反编译 dex 分析。

（对于 App 中 so 文件，可以直接用 IDA 工具进行静态反编译分析 arm 汇编代码）

App 实际上是一个 zip 压缩包格式，可以直接将后缀修改成 zip 后缀，进行解压就可以获取到 App 的包数据。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUW7zzIiazMHWJnRBzheIBaOTDRD5IUl6CnX5vLibeJhdGWz101OwiadjYg/640?wx_fmt=png)

**通过利用 dex2jar 命令行将 dex 文件转换为 jar（java 代码）文件。**

命令格式: dex2jar.bat  要转换的 dex 文件路径

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUjdFL4kYdLgcA8RxJkA5UTlLqoavGLZGZHVezALf3tEAIALKj6pxFLA/640?wx_fmt=png)

通过 jadx-gui 工具，进行查看分析 jar 文件的 java 代码。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUcMdMyCIjE9DhHm23Eic9TEjuRsLsROFZaVlZkRxnLkQ7130hRqiafYGQ/640?wx_fmt=png)

经过这个 App 反编译 dex 流程分析: 上图的 App 虽然可以通过反编译工具进行反编译，但是该 App 采用了 360 加固保护，dex 文件里面的数据都是 360 加固的数据，真正的 dex 数据都被隐藏和抽取了。所以该 App 的反编译这项是相对安全的。

  

  

  

客户端完整性检测

在 App 中的每个文件都会做一次算法记录，并保存在 MANIFEST.MF 文件中，我们就可以通过基**于 MANIFEST.MF 文件的安全机制对 App 包进行完整性校验检测。**完整性校验可以在启动 App 时候触发，如果 App 被二次打包修改了，那么 MANIFEST.MF 文件中的校验信息是不一样的。

1. 通过利用 AndroidKiller 工具对 App 进行反编译，修改，二次打包并签名。

2. 通过 apktool 进行反编译、修改、打包，再通过 SignApk 工具进行对 App 重新签名。

下面以 androidkiller 工具进行 App 替换图片的完整性检测分析。

将 App 直接拖入 androidkiller 工具里面，在工具的工程管理界面下 res 是 App 所有资源图片所存放的位置。只要右击 res 文件夹进行打开文件路径，就可以跳转到 App 反编译后的资源文件夹。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcU52UcRC85SY3icPSdyX7XIR4RIUhiaDQbvr8rcEPagqgYM2eNmBORu90g/640?wx_fmt=png)

可以通过提取其他 App 的资源图片进行替换，替换完图片后将 App 重新编译并签名。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUsbXjmduk6x5ZuWrjI4s0gnbTuShrxib96zoZPJtZAY72NPPmaxYXGyg/640?wx_fmt=png)

通过分析: 如果 App 没有完整性校验的功能，那么 App 就可以通过反编译修改，二次打包签名并能正常运行。如果 App 有完整性校验功能，那么 App 二次打包后，是不能正常运行的。

安全 App 的做法是：在每次启动 App 的时候，进行对自身 App 完整性校验，并且在验证 App 逻辑中，不要单纯的只使用 MANIFEST.MF 文件中的数据为验证条件，最好同时验证是否有不属于 App 的文件，这个过程可以和服务端进行结合完成。

  

  

  

组件安全检测

**Android 四大组件简介**

Activity：呈现可供用户交互的界面，是最常见的组件；

Service：长时间执行后台作业，常见于监控类应用；

Content Provider：在多个 APP 间共享数据，比如通讯录；

Broadcast Receiver：注册特定事件，并在其发生时被激活。

**Android 的四大基本组件，都需要注册才能使用。**每个 Activity、service、Content Provider 都需要在 AndroidManifest 文件中进行配置。AndroidManifest 文件中未进行声明的 activity、service 以及 Content Provider 将不为系统所见，因此这些组件就不可用。而 broadcast  receiver 广播接收者的注册分静态注册（在 AndroidManifest 文件中进行配置）和通过代码动态创建并以调用 Context.registerReceiver() 的方式注册至系统。需要注意的是在 AndroidManifest 文件中进行配置的广播接收者会随系统的启动而一直处于活跃状态，只要接收到感兴趣的广播就会触发 (即使程序未运行)。

**对于 android 的组件安全性的问题，主要在于关注组件是否被外部 App 应用给调用。**

1. 通过分析 App 中的 AndroidManifest.xml 文件，判断组件属性是否设置为导出状态。设置导出状态外部的 App 就可以直接调用。

2. 通过利用 drozer 工具进行分析验证组件是否存在安全性问题。

下面以 AndroidManifest.xml 文件的 android:exported 属性进行判断组件安全性。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUDtQXGn6DkxbjHqq2jGU9zica5A6vJGLELof17olG1QIhC6je1vy7X3g/640?wx_fmt=png)

从上图中可以看到 activity 组件 android:exported 设置为 true，并且有 intent-filter 属性，这个 activity 表示就可以直接被外部 App 应用调用。

检测分析得出结论：android 的组件如果设置为导出状态，那么组件就有被直接调用或被劫持的风险。建议如果组件非必要导出情况下，将组件设置为不导出状态，如果组件必须提供给外部应用进行调用的话，建议对组件进行权限控制。

  

  

  

调试信息检测

检测 App 应用程序（保护服务端应用）调试信息是否关闭，调试信息中是否写入敏感信息。

通过运行 App 程序，**查看 logcat 等调试日志信息方式**，分析是否有泄漏重要的 URL 地址、提示信息、调试信息等敏感关键字以及程序逻辑的关键流程信息。

通过利用 DDMS 工具进行查看 App 运行过程中是否有调试日志信息。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUiboBq34DDLeMJgIYxuIomUGK8eajhp6updSu4yRr8pxh9CWLicbp6saw/640?wx_fmt=png)

通过 DDMS 中 LogCat 窗口，进行右击打开过滤窗口，可以选择针对只显示指定进程或 Pid 的数据，这样就可以进行精准查看分析 App 中是否有敏感日志信息输出。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUZnbiajVzQbicOcUuCqibrJxJqMBSiakSUdDBslAC55RLusJl4PWjJ2uk9Q/640?wx_fmt=png)

  

  

  

键盘输入安全性检测

在 App 应用中，默认情况下使用系统自带的软键盘，在 App 安装后，如果直接使用系统自带键盘，会有被记录、劫持的风险。我们可以通过在 App 应用输入信息的时候，观察是否会弹出自定义的软键盘。**安全的做法通过实现自定义的软键盘并且键盘码会进行变动。**

以下对键盘应用进行做定义分析

1、APP 输入调用安卓系统键盘

一般认为高风险，可能被劫持利用。

2、APP 调用应用中自带键盘输入

一般认为中风险，可能被其他 APP 以触摸点绝对定位方式劫持。

3、APP 调用应用中自带键盘并随机打乱键盘顺序 （这种设置一般银行 APP 比较多 有 打乱数字和键盘按键的 还有在这个界面下禁止截图的）

一般认为低风险，就算被劫持，利用可能性也很低。

  

  

  

本地数据安全检测

App 本地数据安全性问题需要关注的问题分别为: App 所在目录的文件权限、SQLite 数据库文件的安全性、敏感数据明文直接存储 Sdcard。

对于 App 所在目录的文件权限问题，通过验证 App 所在目录的文件权限是否进行设置，如果是非 root 用户是否可以进行读写执行 App 目录下的文件。**安全的情况下 App 所在的目录，其他用户必须无法进行读写操作。**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUKA3eV0nB86OLNsJHzuzkQcw2rIHIzxm1l93UGQBxOR1Rrhibw7hwkVg/640?wx_fmt=png)

对于 SQLite 数据库文件问题，SQLite 是一个轻型的数据库文件，它是很多 App 都是使用的一种数据存储方式，其中微信就是利用 SQLite 文件方式进行存储数据。可以通过 SQLiteSpy 和其他第三方工具，进行打开查看 SQLite 文件的数据。**主要需要关注下 db 文件是否直接存储敏感信息，是否对 db 文件有做加密处理。**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUU4Zufrcz7RvUxoeaXTRE8ZSBDNABwHTKotbUGELkyAgqhbRAthaA1g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcU4ByvbpxuaZ2X6x4icrXyiaqk7qRBu4gDA6iafp2HrleMHCjAREdBxH8lg/640?wx_fmt=png)

对于敏感数据是否存储在 Sdcard 上，可以通过运行 App 应用，然后进行查看是否有在 “sdcard/Android/data / 包名 /” 目录下，释放一些敏感文件或敏感的数据。

**安全做法是对于释放在 sdcard 目录上的数据和文件都应该做加密处理。**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcULNZwFQBjibjUyGDRMBIhrVnQviaSw2yE9a0eE7IGLahWnfOZS5eb5GDA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/My1Gumia3SKLeW5YKmZRUj1DicOJWicDUhqMc122V9S8icg9o3WlJxW962Q63Qp26ickjDaDMCCvFZgCc5Gvt1DibBLA/640?wx_fmt=png)

数据传输安全

![](https://mmbiz.qpic.cn/mmbiz_png/N5gGFPMEm3B6B4eKDcfNt5VFLvBOq8S7oicKicuouHJxltjKNXAiaZs9SYym7mgmx7gkBnKyD2eibkaRJYwoBHwKDw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/hMjlYNLvPyRpUl2m3A1sdiawdLBktzcYbRjdeeXvJtOWbehuJxMOEUK9zxqK8c0PkoxZAVxv4B7PicGMo6sC3OcQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_png/xicQVVic8TfFvDuZ1oRzgNicaicaRIsA1tE7Csu27FgSnBGgnbZNKdMLVbIwayvdMTA1Is6V3kp0SK7EDGjznOibzeQ/640?wx_fmt=png)

App 中的通信数据传输主要可以借助第三方抓包工具，采取代理方式进行对 HTTP、HTTPS 数据包抓取和分析。验证 App 的通讯方式是否采用 HTTPS 加密信道，通过抓取 App 数据包确认是否进行加密以及是否进行证书校验。**安全的做法是通过代理抓 App 数据是抓取不到，或者检测有用户抓取 App 数据时候进行强制退出**。

下面以 **charles 工具**设置代理方式进行抓包。

电脑主机上设置要代理端口。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcU5br2s4qh7RiczcY3XZ01LlLCLTaicaEv7Q9PwBfNpbhUX4xFcWGibd3Nw/640?wx_fmt=png)

手机环境下设置电脑主机的 IP 地址和 charles 电脑端设置的相同端口。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUaKP7OAb32Hdbb8bLJAiauQmudkkEeJygGeo6zc62pyyAy8PXujeYRiag/640?wx_fmt=png)

这样就可以进行对手机环境下的 App 应用进行数据抓包分析了（具体包分析过程，具体需求具体分析）。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6wSWe1NlFibCVYFzvoNOgcUC936KzlYLeneON1ypNtUqFacNGASVATeiarzIlNENNwFxSdW7iaTtkAw/640?wx_fmt=png)

  

  

  

App 服务器安全

App 服务端安全需要关注的是**服务端 API 安全、业务逻辑安全、中间件安全、服务器应用安全**。主要可以通过渗透测试的方式对 App 的服务器进行安全检测，通过模拟恶意攻击方式进行对服务器攻击。从而提高 App 服务器的安全性。

![](https://mmbiz.qpic.cn/mmbiz_png/AP7uYGaic65eecXicbzickFEbg36XW3HLu8Eia6SlqAnewYKsTLBOCRc1UiaAQKCZg30AZu4tFv4sYOY08GnpjRiau8g/640?wx_fmt=png)

E N D

![](https://mmbiz.qpic.cn/mmbiz_png/IYjOKYiazV1iaUatQzJKmFn3FhlZt2aMNibdXAeLbiclsALJO7riaWgZYNXm1GlfZbsIp9Cvd3ic9JXW4X6MZmHIYibYA/640?wx_fmt=png)

                ▲往期相关文章▼

 [你需要了解的 APP 安全](http://mp.weixin.qq.com/s?__biz=MzUxODkyODE0Mg==&mid=2247485442&idx=1&sn=f231b431428c6c1e04e222297c858da3&chksm=f9802a63cef7a37516f4a4c83d290542cf14de5911ffa27ac628847415ee553adcba1caddfda&scene=21#wechat_redirect)  

 [APP 隐私合规](http://mp.weixin.qq.com/s?__biz=MzUxODkyODE0Mg==&mid=2247486296&idx=1&sn=4172fc587c598d68df6c9588c18cc848&chksm=f9802939cef7a02f1ca8377b19160c1032c75bcef811af00e84f554269aba45d19628dee6181&scene=21#wechat_redirect)  

 [APP 安全合规](http://mp.weixin.qq.com/s?__biz=MzUxODkyODE0Mg==&mid=2247485420&idx=1&sn=20f1069713342043488db05568afec9e&chksm=f980258dcef7ac9b2e142ef68076b89878da5026834854a5baf517cdecd3be961947137c5c47&scene=21#wechat_redirect)  

公众号

最后  

-----

**由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。**

**无害实验室 sec 拥有对此文章的修改和解释权如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经作者允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的**

![](https://mmbiz.qpic.cn/mmbiz_png/D1XGIISrRhKQksamIGXRxFbSQuNUWamJYEUwU8KjhNprqa8STuc02vIUak808dBS7Fiao4hg6FS876bicD3uJPgQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/hib5mZ2t0cdTmGAgkySPqAr20oBpFicUtQaleTGbgBdnvlIjH1SRficZ0YseibXwjTN5qd6npxn5QvTVN35MV9v86w/640?wx_fmt=png)

点个赞和

![](https://mmbiz.qpic.cn/mmbiz_png/t3ZJ9oCd1YcJavCa7NoYkIDPhAtHQg5pOlFhHYic59ia9ic2gQGkZFHurrA63iaQeCbCHjial8ZW4XEd1HhOLZj3btQ/640?wx_fmt=png)

在看

你最好看