<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/bc2HEU8USbaeiaJK261XXw)

防范 DDoS 攻击最主要的手段是加钱上高防，同时隐藏网站真实 IP。本文详细介绍几种网站隐藏真实 ip 的方法和优缺点，让你能真正做一个永不暴露真实 IP 的网站。

做一个永不暴露真实 IP 的网站
----------------

**返回目录**

既然不想暴露网站的真实 IP，那么真实服务器前面至少套一层代理。一般来说，位于最前线的反向代理主要有如下几种：

*   **CDN**：内容分发网络，就近为用户提供服务，加速访问；
    
*   **高防 IP**：高防 IP 一般位于大带宽的骨干网节点上，用于清洗 DDoS 流量；
    
*   **SLB**：负载均衡器，用在大流量、繁忙的网站上，常见的 SLB 有 LVS、F5 等。
    

这三种反向代理主要作用不一样，配置好的情况下都能隐藏服务器真实 IP。对于普通的网站，使用 CDN 或者高防就足够，业务量大的情况下才会用到 SLB。

下面介绍使用了反向代理的情况下，隐藏网站真实 IP 的操作。

### **防火墙**

使用防火墙是最简单的做法，即：将反向代理的回源 IP 加入白名单，屏蔽其他 IP 的任何请求。

例如使用 CloudFlare 的免费 CDN 服务，其回源 IP 可从 https://www.cloudflare.com/zh-cn/ips/ 获取，然后将其加入白名单，同时屏蔽其他 IP：

```
# 将cf ip地址放在 cf_ips.txt# 首先将cf的ip加入白名单while read -r linedo
  firewall-cmd --zone=trusted --add-source=$linedone < cf_ips.txt# 然后移除其他ip对http和https服务的访问firewall-cmd --remove-service=http
firewall-cmd --remove-service=https

```

经过上述设置，Cloudflare 的 IP 能正常访问，其他 IP 完全无法访问真实 ip 的网站服务器，很好的隐藏了真实 IP。

该方法设置简单，适用于服务器托管单站点的情形。当服务器上托管多个网站，并且某些站点需要直接暴露外网时，这种做法缺乏灵活性，无法实现。

> 也可以通过 Nginx 的 allow/deny 指令达到相同效果

### **IPv6**

对于防火墙和网络不熟悉的网友，可以考虑使用 IPv6 来隐藏网站的真实 IP。具体操作为：

1. 找一台有 IPv6 地址的服务器，只有 IPv6 的 NAT VPS 更好。目前 IPv6 地址正在普及中，许多商家都免费提供 IPv6 地址，例如 一些 VPS 商家整理 中的 阿里云、Vultr、Linode、CloudCone，有的还提供不止一个 IPv6 地址；

2. 设置网站只监听 IPv6 端口。以 Nginx 为例，网站配置文件形如：

```
server {
    listen [::]:80;
    server_name 主机名; # 请改成自己的主机名

    return 301 https://主机名$request_uri;}server {
    listen      [::]:443 ssl http2;
    server_name  主机名;
    ssl_certificate 证书路径;
    ssl_certificate_key ssl密钥路径;
    # 其他设置}

```

3. 找一家支持只有 IPv6 的 CDN，例如 Cloudflare，设置 IPv6 解析：

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSEM3XSnU9ZJLoAoicuuFqPjm2B4Zibx7kymicH0GE8DAEQqia9F2SW7JF7uD11ujzsBIovljuqvmfB8jw/640?wx_fmt=jpeg&random=0.6413998947468502&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)CloudFlare 设置 ipv6 解析

经过上面三步设置，基本上可确保不会泄漏真实 IP，原因如下：

1. 绝大多数情况下，人们都会理所当然的找 IPv4，不会想到你的网站根本不存在 IPv4 网络上；

2. 相对于 IPv4，IPv6 的地址段实在太庞大。即使有 zmap 这种几小时扫描完全球 ipv4 段的神器，或者 Shodan 搜索引擎，也很难从海量地址中寻找单个地址。

如果不放心，可以同样加上防火墙，就万无一失了：

```
# 首先将cf的ip加入白名单while read -r linedo
  firewall-cmd --zone=trusted --add-source=$linedone < cf_ips.txt# 然后屏蔽其他地址对ipv6的访问权限firewall-cmd --add-rich-rule="rule family='ipv6' source address='::0/0' drop"

```

该方法同样设置简单，以奇招胜出，单台服务器能托管多个网站，并且其他网站可直接暴露不受影响。

### **CNAME**

另一种常见隐藏真实 IP 方式是使用 CNAME，同样无需设置防火墙。其操作如下：

1. CDN 回源时使用 CNAME 方式回源到另一个主机名上。例如 tlanyan.pp.ua 回源的 www.abcdexfd.com。需要注意的是，前端域名和源站域名最好不是同一个，防止通过爆破二级域名泄漏真实 IP；

2. 在源站服务器上设置默认站点，防止通过 host 方式爆破。由于默认站点只是为了防止 SNI 方式泄漏真实 IP，因此使用自签证书即可：

```
# 生成密钥openssl genrsa -out example.key 2048# 生成证书，期间需要填一些信息openssl req -new -x509 -days 3650 -key example.key -out example.pem

```

接着以 Nginx 为例，设置默认站点：

```
server {
  listen 80 default_server;
  server_name example.com;
  return 301 https://example.com$request_uri;}server {
  listen 443 ssl http2;
  server_name example.com default_server;
  ssl_certificate example.pem;
  ssl_certificate_key example.key;}

```

然后重启 Nginx 即可。

该方法无需设置防火墙，设置较为简单，但是需要额外一个域名。

注意事项
----

以上操作只能让他人在明面上无法直接访问真实服务器，但请仔细阅读 隐藏网站的真实 ip：https://itlanyan.com/hide-site-real-ip/ 中的建议，防止有发送邮件、WordPress pingback 等隐式暴露 IP 的行为。

遇到 DDoS 怎么办?
------------

如果域名之前从未用过，一出道就用上面提到的方法，基本上可以保证不会泄漏网站的真实 IP。

但是不泄漏真实 IP 不代表不会被 DDoS 或者 CC 攻击，遇到 DDoS 怎么办？解决办法主要有：

1. 加钱上高防保平安；

2. DNS 解析域名到 127.0.0.1 保平安；

3. 关机保平安。

请根据实际情况和业务需求采取相应措施。

```
作者：tlanyan
原文地址：https://itlanyan.com/do-hide-site-real-ip/

```

如有侵权，请联系删除

![](https://mmbiz.qpic.cn/mmbiz_png/QO6oDpE0HEmt8Ss52ibJFcYB7ZHBRVbIpxr9XXibHdW6Eib11FYq0FDZFNMUgDMcqTyfs6iaX8OtFdlL6ypEVHCLrw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

好文推荐

![](https://mmbiz.qpic.cn/mmbiz_png/QO6oDpE0HEmt8Ss52ibJFcYB7ZHBRVbIpzdIMlC9plAr8AiaQRUUvBFXZM2scib9zTnRyp0XZQxSUYAWWS0avKrCA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

[红队打点评估工具推荐](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247508839&idx=1&sn=abc801070b0e44475887ddbf7273c2e7&chksm=c3087017f47ff901ecb212aadc22c5cbfc6407da79b43a6f48a355cc3fd8c5af79c113db5fd1&scene=21#wechat_redirect)

[干货 | 红队项目日常渗透笔记](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247509256&idx=1&sn=76aad07a0f12d44427ce898a6ab2769e&chksm=c3087678f47fff6e2b750f41514d933390a8f97efef8ed18af7d8fb557500009381cd434ec26&scene=21#wechat_redirect)  

[实战 | 后台 getshell + 提权一把梭](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247508609&idx=1&sn=f3fcd8bf0e75d43e3f26f4eec448671f&chksm=c30871f1f47ff8e74551b09f092f8673890607257f2d39c0efa314d1888a867dc718cc20b7b3&scene=21#wechat_redirect)

[一款漏洞查找器（挖漏洞的有力工具）](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247507539&idx=2&sn=317a2c6cab28a61d50b22c07853c9938&chksm=c3080d23f47f8435b31476b13df045abaf358fae484d8fbe1e4dbd2618f682d18ea44d35dccb&scene=21#wechat_redirect)

[神兵利器 | 附下载 · 红队信息搜集扫描打点利器](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247508747&idx=1&sn=f131b1b522ee23c710a8d169c097ee4f&chksm=c308707bf47ff96dc28c760dcd62d03734ddabb684361bd96d2f258edb0d50e77cdb63a3600a&scene=21#wechat_redirect)

[神兵利器 | 分享 直接上手就用的内存马（附下载）](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247506855&idx=1&sn=563506565571f1784ad1cb24008bcc06&chksm=c30808d7f47f81c11b8c5f13ce3a0cc14053a77333a251cd6b2d6ba40dc9296074ae3ffd055e&scene=21#wechat_redirect)

[推荐一款自动向 hackerone 发送漏洞报告的扫描器](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501261&idx=1&sn=0ac4d45935842842f32c7936f552ee21&chksm=c30816bdf47f9fab5900c9bfd6cea7b1d99cd32b65baec8006c244f9041b25d080b2f23fd2c1&scene=21#wechat_redirect)

**关注我，学习网络安全不迷路**