<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [bbs.pediy.com](https://bbs.pediy.com/thread-272618.htm)

前言
==

我是逆向练习生，羽墨

 

目前最为流行的md文件编辑器，当属Typora，免费，简洁，让人爱不释手  
接上篇 [Typora破解之逆向分析](https://bbs.pediy.com/thread-272538.htm) ， 实现二进制层面的内存破解（证明内存破解的可行性，了却心愿）

 

经过几天断断续续的研究，我去逆向了Node API ，逆向了V8引擎，逆向了Electron框架，走入了无数的深坑。。。终于完美实现了内存破解。

 

本着有始有终的原则，我成功完成了破解程序的编写，并更新到本文，同时也要在这里说一下我执着于内存破解的心路历程 。在笔者的上篇帖子中，版主 @Editor 曾给出评价

 

![](upload/attach/202205/930159_XKJK6H3PMGHFCU7.png)

 

离成功还差一步，就是**差一步**这三个字，仿佛把我钉在了耻辱柱上，让我夜夜辗转反侧，难以忘怀。但同时也要感谢版主，正是这三个字，激发了我沉寂已久的热血。。。同时也希望版主可以再来点评下这篇文章

 

在各路大神破解Typora的文章中，我看到的都是千篇一律的破解办法，所有我也本着论证我在上篇文章中提出的破解思路，而实现了我所希望的目标。

 

**本文中会给出两种办法，一种是基于病毒木马技术，一种是基于PE注入技术（适合新手复现）**

 

**注：文章重在讲述逆向过程中的思路与方法 不然发文章除了炫耀毫无意义**

* * *

愚公移山 ：内存patch
=============

前期分析
----

1.根据上篇文章分析结果，继续进行深入分析，终于在我努力下，成功找到了关键函数，这个函数调用是napi_create_string_utf8，它会把ascii形式的JS代码当作参数传递，rbp - 50 的位置为这个字符对象的指针，里面存储的数据，经过我观察如下(只说重点的)

 

0x0偏移为JS代码的缓冲区，0x10偏移为JS代码的大小，0x18偏移为JS代码的关键验证点，必须比0x10位置的数据大1，但是据我观察他正常的时候不是这样的，可是在引擎中还是框架中（记不清了，只知道是海一样的汇编代码）会这样进行判断，好家伙太坑了，我差点晕倒

 

顺便提一下逆向引擎过程中发现的东西，V8引擎读取JS代码后，经过一些函数，之后申请一个缓冲区，代码流程跳到缓冲区执行，所以说引擎类似于一个动态的编译器，最后也是在内存中执行二进制代码

 

**具体的逆向引擎与框架的过程就不说了。。。**

 

![](upload/attach/202205/930159_TE4BSAZY2EQCVSR.png)

 

2.根据上篇总结的思路，笔者准备采用病毒木马常用的技术 ， 进程替换（傀儡进程）来实现hook关键函数，达到破解的目的

 

为什么使用这个技术，主要是因为，main.node是动态加载的模块，我必须在它加载之前进行hook，不然它加载起来会直接进入JS代码执行的步骤，所以需要这个技术

 

那么关键函数怎么hook，hook什么位置呢，上篇中有提到，这是一个导入函数，导入了electron的导出函数，所以目标就明确了，我们可以通过遍历导出表，来找到这个函数的RVA，之后获得目标进程BaseAddr，加上RVA，就可以定位到这个函数了

 

那么还有一个问题，既然main.node使用的是导入函数，熟悉PE格式的同学可能就会知道了，加载导入表是通过GetProcAddress来加载的，那么是不是只需要修改electron框架的导出表的导出地址就可以了？对，就是这样，当然，直接hook函数也是可以的，但是毕竟要修改人家的原始函数，我感觉多多少少有点不靠谱。。。

 

3.要实现这个技术，要点是在CreateProcess上， 查看微软文档可知， 创建进程时， 以**CREATE_SUSPENDED**标志创建，即可在进程创建后，把主线程挂起，挂起以后，程序会处在PE映射完毕，进入Startup入口处的状态

 

![](upload/attach/202205/930159_UMBS5QR3B5GBFU8.png)

 

4.挂起以后，需要定位导出函数在导出函数地址表中的RVA

 

5.进程肯定是会开随机基址的，所以我们不能使用固定的地址

 

6.定位导出函数地址以后，通过代码注入技术，把hook代码写入到 electron中，**hook代码应为shellcode形式**

 

7.修改导出函数的导出函数地址表的地址，指向注入的代码，在代码中根据我们的逆向分析结果，判断是否为关键调用

 

8.如果判断为JS代码，则向内存中写入Patch，如不是，则调用原函数

 

9.还有很多细节，在下面解释，大体方向搞清楚了，可以开工了，VS2019 启动！！！

Patch程序的编写
----------

好的，说起来简单做起来难  
因为我们使用的是x64版本的Typora，所以也需要编写同样x64的程序来实现破解，这64位程序就有很多坑等着你

### 创建傀儡进程

这部分比较简单，一行代码搞定

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">123456</td><td class="code"><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">创建进程并挂起</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(!CreateProcess(NULL, cmdline, NULL, NULL, FALSE, CREATE_SUSPENDED, NULL, NULL, &amp;si, &amp;pi))</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">printf(</code><code class="python string">"CreateProcess failed (%d)\n"</code><code class="python plain">, GetLastError());</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python value">0</code><code class="python plain">;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code></td></tr></tbody></table>

接下来按照前面的分析，应该准备好导出表相关的数据了

### 64位程序的导出表遍历

虽然我曾写过遍历的函数，我想大家肯定也有不少人写过这种东西，但是32位的不能直接拿来用

 

这里给出的实现代码，简单说一下坑的地方

 

**第一个坑** 遍历目标进程 与 遍历文件做选择，我最后选择了遍历文件

 

遍历目标进程映射后的PE格式是比较简单，但是我得写多少ReadProcessMem。。。。

 

那遍历文件也有坑啊，我全踩完了，首先读文件，读进来必定是64位地址，所以相关地方全换成64位值

 

**第二个坑** 遍历到的数据是FOA ，还得把FOA转RVA ， RVA转FOA ，xxx转VA ，一顿乱七八糟的转换（好吧，还不如多写点ReadProcessMem）

 

**第三个坑** 遍历时一般用到循环，循环通过下标遍历就OK ，但PE格式很多数据都为32位值，程序又用到了64位的地址，且64位指针步进都为8 ，然后开始调开始改吧。。。

 

通过修改，调试，最后得到了需要的数据 ：

 

目标函数的导出地址表的内容 RVA

 

目标函数的导出地址表的地址 FOA转RVA

 

目标函数的真实地址 是个FOA转RVA 之后再转VA

 

代码注释写起来比代码都复杂，就没写了，理清了关键内容就可以自己写出来

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162</td><td class="code"><code class="python plain">DWORD GetExportApiAddr(char</code><code class="python keyword">*</code> <code class="python plain">szPath, char</code><code class="python keyword">*</code> <code class="python plain">szApiName, DWORD64</code><code class="python keyword">*</code> <code class="python plain">ExportTableAddrRva)</code><code class="python plain">{</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">映射文件到内存&nbsp; 找出需要的数据</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">HANDLE hFile </code><code class="python keyword">=</code> <code class="python plain">CreateFile(szPath, GENERIC_READ, </code><code class="python value">0</code><code class="python plain">, NULL, OPEN_EXISTING, </code><code class="python value">0</code><code class="python plain">, NULL);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">HANDLE hMap </code><code class="python keyword">=</code> <code class="python plain">CreateFileMapping(hFile, NULL, PAGE_READONLY, </code><code class="python value">0</code><code class="python plain">, </code><code class="python value">0</code><code class="python plain">, NULL);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD64 lpBuff </code><code class="python keyword">=</code> <code class="python plain">MapViewOfFile(hMap, FILE_MAP_READ, </code><code class="python value">0</code><code class="python plain">, </code><code class="python value">0</code><code class="python plain">, NULL);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">PIMAGE_DOS_HEADER&nbsp; pDosHeader </code><code class="python keyword">=</code> <code class="python plain">(PIMAGE_DOS_HEADER)lpBuff;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">PIMAGE_NT_HEADERS&nbsp; pNtHeader </code><code class="python keyword">=</code> <code class="python plain">(PIMAGE_NT_HEADERS)((DWORD64)lpBuff </code><code class="python keyword">+</code> <code class="python plain">pDosHeader</code><code class="python keyword">-</code><code class="python plain">&gt;e_lfanew);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">PIMAGE_EXPORT_DIRECTORY&nbsp; pExportTable </code><code class="python keyword">=</code> <code class="python plain">lpBuff </code><code class="python keyword">+</code> <code class="python plain">RVA_TO_FOA(lpBuff, pNtHeader</code><code class="python keyword">-</code><code class="python plain">&gt;OptionalHeader.DataDirectory[</code><code class="python value">0</code><code class="python plain">].VirtualAddress);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">所有地址转为FOA</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD64</code><code class="python keyword">*</code> <code class="python plain">pAddressOfFunctions </code><code class="python keyword">=</code> <code class="python plain">(DWORD64</code><code class="python keyword">*</code><code class="python plain">)RVA_TO_FOA(lpBuff, pExportTable</code><code class="python keyword">-</code><code class="python plain">&gt;AddressOfFunctions);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pAddressOfFunctions </code><code class="python keyword">=</code> <code class="python plain">lpBuff </code><code class="python keyword">+</code> <code class="python plain">(DWORD64)pAddressOfFunctions;</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD64</code><code class="python keyword">*</code> <code class="python plain">pAddressOfNames </code><code class="python keyword">=</code> <code class="python plain">(DWORD64</code><code class="python keyword">*</code><code class="python plain">)RVA_TO_FOA(lpBuff, pExportTable</code><code class="python keyword">-</code><code class="python plain">&gt;AddressOfNames);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pAddressOfNames </code><code class="python keyword">=</code> <code class="python plain">lpBuff </code><code class="python keyword">+</code> <code class="python plain">(DWORD64)pAddressOfNames;</code>&nbsp;&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD64</code><code class="python keyword">*</code> <code class="python plain">pAddressOfNameOrdinals </code><code class="python keyword">=</code> <code class="python plain">(DWORD64</code><code class="python keyword">*</code><code class="python plain">)RVA_TO_FOA(lpBuff, pExportTable</code><code class="python keyword">-</code><code class="python plain">&gt;AddressOfNameOrdinals);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pAddressOfNameOrdinals </code><code class="python keyword">=</code> <code class="python plain">lpBuff </code><code class="python keyword">+</code> <code class="python plain">(DWORD64)pAddressOfNameOrdinals;</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD&nbsp;&nbsp;&nbsp;&nbsp; dwNumberOfNames </code><code class="python keyword">=</code> <code class="python plain">pExportTable</code><code class="python keyword">-</code><code class="python plain">&gt;NumberOfNames;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">判断导出方式（序号 </code><code class="python keyword">or</code> <code class="python plain">名称）</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">((DWORD)szApiName &gt;&gt; </code><code class="python value">16</code> <code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">0</code><code class="python plain">)</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD Index </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)szApiName </code><code class="python keyword">-</code> <code class="python plain">pExportTable</code><code class="python keyword">-</code><code class="python plain">&gt;Base;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(Index &gt;</code><code class="python keyword">=</code> <code class="python plain">pExportTable</code><code class="python keyword">-</code><code class="python plain">&gt;NumberOfFunctions) </code><code class="python keyword">return</code> <code class="python plain">NULL;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">(DWORD64)(lpBuff </code><code class="python keyword">+</code> <code class="python plain">pAddressOfFunctions[Index]);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pNameAddress;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD64&nbsp;&nbsp; FuncRva;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pNameAddress </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)(lpBuff </code><code class="python keyword">+</code> <code class="python plain">RVA_TO_FOA(lpBuff, (DWORD)</code><code class="python keyword">*</code><code class="python plain">pAddressOfNames));</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">for</code> <code class="python plain">(size_t i </code><code class="python keyword">=</code> <code class="python value">0</code><code class="python plain">; i &lt; dwNumberOfNames; i</code><code class="python keyword">+</code><code class="python keyword">+</code><code class="python plain">)</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(strcmp(szApiName, (char</code><code class="python keyword">*</code><code class="python plain">)pNameAddress) </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">0</code><code class="python plain">)</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">FuncRva </code><code class="python keyword">=</code> <code class="python plain">(WORD)</code><code class="python keyword">*</code><code class="python plain">pAddressOfNameOrdinals;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pAddressOfFunctions </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)pAddressOfFunctions </code><code class="python keyword">+</code> <code class="python plain">FuncRva </code><code class="python keyword">*</code> <code class="python value">4</code><code class="python plain">;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">FuncRva </code><code class="python keyword">=</code> <code class="python plain">(DWORD)(</code><code class="python keyword">*</code><code class="python plain">pAddressOfFunctions);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">*</code><code class="python plain">ExportTableAddrRva </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)pAddressOfFunctions </code><code class="python keyword">-</code> <code class="python plain">lpBuff;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">*</code><code class="python plain">ExportTableAddrRva </code><code class="python keyword">=</code> <code class="python plain">FOA_TO_RVA(lpBuff, </code><code class="python keyword">*</code><code class="python plain">ExportTableAddrRva);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">UnmapViewOfFile(lpBuff);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">CloseHandle(hFile);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">FuncRva;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pAddressOfNameOrdinals </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)pAddressOfNameOrdinals </code><code class="python keyword">+</code> <code class="python value">2</code><code class="python plain">;</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pAddressOfNames </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)pAddressOfNames </code><code class="python keyword">+</code> <code class="python value">4</code><code class="python plain">;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pNameAddress </code><code class="python keyword">=</code> <code class="python plain">(DWORD64)(lpBuff </code><code class="python keyword">+</code> <code class="python plain">RVA_TO_FOA(lpBuff, (DWORD)</code><code class="python keyword">*</code><code class="python plain">pAddressOfNames));</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">UnmapViewOfFile(lpBuff);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">CloseHandle(hFile);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python plain">NULL;</code><code class="python plain">}</code></td></tr></tbody></table>

### 获取目标进程的基址

这个也是个巨坑啊，首先我选择使用遍历模块的函数，但都失败，最后经过研究得知，当你创建挂起进程的时候，由于程序没有运行，所以系统不会更新此程序在三环的快照信息（遍历的几个函数都是使用快照获取）

 

所以我这里给出两个办法

 

第一个， 使用Nt半公开函数 NtQueryInformationProcess ，这个函数也通常用来做反调试

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">123456789101112131415161718192021222324252627282930</td><td class="code"><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">第二个参数是ProcessBasicInformation的话，则第三个参数必须为一个指针指向结构PROCESS_BASIC_INFORMATION</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">可以获取PEB ， 通过PEB获取基址</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">loadlibrary&nbsp; getprocaddress 获取函数地址</code><code class="python plain">__kernel_entry NTSTATUS NtQueryInformationProcess(</code><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">[</code><code class="python keyword">in</code><code class="python plain">]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HANDLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ProcessHandle,</code><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">[</code><code class="python keyword">in</code><code class="python plain">]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PROCESSINFOCLASS ProcessInformationClass,</code><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">[out]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PVOID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ProcessInformation,</code><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">[</code><code class="python keyword">in</code><code class="python plain">]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ULONG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ProcessInformationLength,</code><code class="python spaces">&nbsp;&nbsp;</code><code class="python plain">[out, optional] PULONG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ReturnLength</code><code class="python plain">);</code>&nbsp;<code class="python plain">typedef enum _PROCESSINFOCLASS {</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessBasicInformation </code><code class="python keyword">=</code> <code class="python value">0</code><code class="python plain">,</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessDebugPort </code><code class="python keyword">=</code> <code class="python value">7</code><code class="python plain">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">调式端口</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessWow64Information </code><code class="python keyword">=</code> <code class="python value">26</code><code class="python plain">,</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessImageFileName </code><code class="python keyword">=</code> <code class="python value">27</code><code class="python plain">,</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessBreakOnTermination </code><code class="python keyword">=</code> <code class="python value">29</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessDebugObjectHandle </code><code class="python keyword">=</code> <code class="python value">30</code><code class="python plain">, </code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">获取调试对象句柄，句柄为空表示未调试</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ProcessDebugFlags </code><code class="python keyword">=</code> <code class="python value">31</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">检测调试标志位为</code><code class="python value">0</code><code class="python plain">表示处于调试状态</code><code class="python plain">} PROCESSINFOCLASS;</code>&nbsp;<code class="python plain">typedef struct</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD ExitStatus;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">/</code><code class="python keyword">/</code> <code class="python plain">接收进程终止状态</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD PebBaseAddress;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">/</code><code class="python keyword">/</code> <code class="python plain">接收进程环境块地址&nbsp;&nbsp; PEB</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD AffinityMask;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">/</code><code class="python keyword">/</code> <code class="python plain">接收进程关联掩码</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">DWORD BasePriority;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">/</code><code class="python keyword">/</code> <code class="python plain">接收进程的优先级类</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ULONG UniqueProcessId;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python keyword">/</code><code class="python keyword">/</code> <code class="python plain">接收进程</code><code class="python functions">ID</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">ULONG InheritedFromUniqueProcessId; </code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">接收父进程</code><code class="python functions">ID</code><code class="python plain">} PROCESS_BASIC_INFORMATION;</code></td></tr></tbody></table>

第二个办法

 

获取线程环境，根据病毒分析经验，在创建进程挂起时，进程的ebx会指向PEB ，在64位程序中 rdx会指向PEB，而64位PEB结构中，PEB+0x10的偏移为进程基址，好的，这样就得到了Base

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">123456789101112</td><td class="code"><code class="python keyword">if</code> <code class="python plain">(!GetThreadContext(pi.hThread, &amp;context))</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">printf(</code><code class="python string">"GetThreadContext failed (%d)\n"</code><code class="python plain">, GetLastError());</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python value">0</code><code class="python plain">;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">获取进程基址</code><code class="python keyword">if</code> <code class="python plain">(!ReadProcessMemory(pi.hProcess, (LPVOID)(context.Rdx </code><code class="python keyword">+</code> <code class="python value">0x10</code><code class="python plain">), &amp;BaseAddr, sizeof(BaseAddr), &amp;retByte))</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">printf(</code><code class="python string">"ReadProcessMemory failed (%d)\n"</code><code class="python plain">, GetLastError());</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python value">0</code><code class="python plain">;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code></td></tr></tbody></table>

### 申请内存与hook

这里也有坑

 

根据前面的分析流程，现在应该hook导出函数地址表了，需要得到shellcode的地址，地址需要去对方进程申请

 

而导出表函数地址表中存放的函数的RVA ，且只有4字节，所以不得不考虑一个问题，如果申请到的地址是64位地址，大于FFFFFFFF则我们没法填入导出函数地址表（所以如果你有导出函数则进程不能大于4个G？微软这PE格式是不是该升级了）

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">1234567</td><td class="code"><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">申请内存 （地址不能与主模块间隔超过FFFFFFFF ）&nbsp;&nbsp;&nbsp; </code><code class="python plain">shellcodeAddr </code><code class="python keyword">=</code> <code class="python plain">VirtualAllocEx(pi.hProcess, BaseAddr </code><code class="python keyword">+</code> <code class="python value">0x10000000</code><code class="python plain">, </code><code class="python value">0x2000</code><code class="python plain">, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(shellcodeAddr </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python plain">NULL)</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">{</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">printf(</code><code class="python string">"VirtualAllocEx failed (%d)\n"</code><code class="python plain">, GetLastError());</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">return</code> <code class="python value">0</code><code class="python plain">;</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">}</code></td></tr></tbody></table>

这里我选择在基址附近申请一个内存，不超过4G即可，那么接下来该考虑hook的问题了

 

hook需要得到对方进程的VA ，前面说过了

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">123456</td><td class="code"><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">获得hook函数的VA&nbsp; </code><code class="python plain">ExportFuncVA </code><code class="python keyword">=</code> <code class="python plain">BaseAddr </code><code class="python keyword">+</code> <code class="python plain">ExportFuncRVA;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">获得导出表的VA&nbsp; </code><code class="python plain">ExportTableVA </code><code class="python keyword">=</code> <code class="python plain">BaseAddr </code><code class="python keyword">+</code> <code class="python plain">ExportTableVA;</code><code class="python keyword">/</code><code class="python keyword">/</code><code class="python plain">hook导出函数&nbsp; shellcode VA 转为 RVA&nbsp; 修改内存属性后写入</code><code class="python plain">shellcodeRva </code><code class="python keyword">=</code> <code class="python plain">shellcodeAddr </code><code class="python keyword">-</code> <code class="python plain">BaseAddr;</code></td></tr></tbody></table>

最后要注意修改时，要调整内存保护属性

### Shellcode的编写

这个是难点，为了写出精致的shellcode，我甚至还得用汇编实现算法  
另一个难点主要是Shellcode的编写需要依赖于逆向分析的结果，Shellcode以及注释在下边给出

 

这里64位程序不支持内联汇编，那么怎么写呢，两个办法 ，联合编译 与 使用机器码 ， 这里我选择64位的联合编译 ， 怎么实现联合编译呢 ，第一种办法如下， 第二种办法 写好汇编使用ml64汇编编译器生成obj文件，在C程序编译中链接此文件

 

新建一个asm后缀的文件，修改它的属性 ， 从生成中排除 否 ，自定义生成工具

 

![](upload/attach/202205/930159_S69WKGJKZKVDF2R.png)

 

![](upload/attach/202205/930159_79JA4F7T63ATT4N.png)

 

按照图中的配置即可

 

![](upload/attach/202205/930159_3C8Q9BWW7YA8XDD.png)

 

最后需要在C文件中，extern 汇编函数，即可愉快的使用联合编译

 

这里给出shellcode的汇编代码 **注意不能使用绝对地址**

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103</td><td class="code"><code class="python plain">.code</code><code class="python plain">MyHook proc</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code> <code class="python plain">r8,</code><code class="python value">1ED39h</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz Exit3</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code> <code class="python plain">r14,</code><code class="python value">1ED39h</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz Exit3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ; r8 </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">1ED39h</code> <code class="python plain">&amp;&amp; r14 </code><code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">1ED39h</code>&nbsp; <code class="python plain">确定目标 如不是直接跳走</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">; 保存环境 太长删了</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov byte ptr [rbp</code><code class="python keyword">-</code><code class="python value">40h</code><code class="python plain">],</code><code class="python value">40h</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">;进入正确流程后&nbsp; 先修改对象属性</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov byte ptr [rbp</code><code class="python keyword">-</code><code class="python value">38h</code><code class="python plain">],</code><code class="python value">41h</code>&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jmp Signature&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;重定位获得特征码地址</code><code class="python plain">RelocationCode:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov r10,rdx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;r10 保存目标代码地址</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov rcx,rdx</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">pop rdx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;strstr的参数</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">cld</code>&nbsp;<code class="python plain">Strstr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;strstr功能 找到特征码的位置</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">byte ptr [rdx], </code><code class="python value">0</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp; r9, rcx</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz&nbsp;&nbsp;&nbsp;&nbsp; lable1</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp; rax, rcx</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit3</code><code class="python plain">lable1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">byte ptr [rcx], </code><code class="python value">0</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lable5</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp; r8, rcx</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sub&nbsp;&nbsp;&nbsp;&nbsp; r8, rdx</code><code class="python plain">lable2:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp; rax, rdx</code><code class="python plain">lable3:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">movzx&nbsp;&nbsp; ecx, byte ptr [rax]</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">test&nbsp;&nbsp;&nbsp; cl, cl</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lable6</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">[r8</code><code class="python keyword">+</code><code class="python plain">rax], cl</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz&nbsp;&nbsp;&nbsp;&nbsp; lable4</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">inc&nbsp;&nbsp;&nbsp;&nbsp; rax</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">byte ptr [r8</code><code class="python keyword">+</code><code class="python plain">rax], </code><code class="python value">0</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz&nbsp;&nbsp;&nbsp;&nbsp; lable3</code><code class="python plain">lable4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">byte ptr [rax], </code><code class="python value">0</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lable6</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">inc&nbsp;&nbsp;&nbsp;&nbsp; r9</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">inc&nbsp;&nbsp;&nbsp;&nbsp; r8</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">byte ptr [r9], </code><code class="python value">0</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz&nbsp;&nbsp;&nbsp;&nbsp; lable2</code><code class="python plain">lable5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">xor&nbsp;&nbsp;&nbsp;&nbsp; eax, eax</code><code class="python plain">lable6:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp; rax, r9</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">cmp</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">rax,</code><code class="python value">0</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;没找到特征码就退出 当然不太可能</code><code class="python plain">CalcSize:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rsi,rax</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">lea&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rsi,[rsi </code><code class="python keyword">+</code> <code class="python value">1Ah</code><code class="python plain">]</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r15,rsi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;r15保存写入地址</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r11,rsi</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sub&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r11,r10</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r12,</code><code class="python value">1ED39h</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">sub&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r12,r11</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rax,r12</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">cqo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;符号扩展到rdx </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r13,</code><code class="python value">08h</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">div&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r13d</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rcx,rax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;循环移动次数，每次</code><code class="python value">8</code><code class="python plain">字节 给patch </code><code class="python value">7</code><code class="python plain">个字节的空间</code><code class="python plain">MoveCode:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">lodsq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;读</code><code class="python value">8</code><code class="python plain">个字节到rax&nbsp; rsi </code><code class="python keyword">+</code> <code class="python value">8</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">lea r14,[rsi </code><code class="python keyword">-</code> <code class="python value">1</code><code class="python plain">]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;得到第一次写的位置</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov rdx,rax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;保存第一次要写的数据</code><code class="python functions">Next</code><code class="python plain">:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">lodsq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;得到下</code><code class="python value">8</code><code class="python plain">字节的数据到rax&nbsp; rsi</code><code class="python keyword">+</code><code class="python value">8</code>&nbsp; <code class="python plain">就这样保持读正常</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov qword ptr [r14],rdx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;第一次写入数据&nbsp; 此时下一次要写的数据在rax 下一次要写的位置应该为 r14</code><code class="python keyword">+</code><code class="python value">8</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">add r14,</code><code class="python value">8</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">;r14 </code><code class="python keyword">+</code> <code class="python value">8</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov rdx,rax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;第二次要写的数据保存到rdx&nbsp; 就这样保持写正常</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">dec ecx</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jnz </code><code class="python functions">Next</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">;循环直到ecx为</code><code class="python value">0</code>&nbsp;&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov word ptr [r14],ax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;最后数据不足</code><code class="python value">8</code><code class="python plain">个 则把读到的数据直接写入即可</code><code class="python plain">WritePatch:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov&nbsp;&nbsp;&nbsp; dword ptr [r15],</code><code class="python value">72743D73h</code>&nbsp;&nbsp;&nbsp; <code class="python plain">;这里是patch数据</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov word ptr [r15</code><code class="python keyword">+</code><code class="python value">4</code><code class="python plain">],</code><code class="python value">6575h</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov byte ptr [r15</code><code class="python keyword">+</code><code class="python value">6</code><code class="python plain">],</code><code class="python value">3Bh</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jmp UnHook</code><code class="python plain">Exit:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">;恢复环境 太长删了</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov r8,qword ptr [rbp</code><code class="python keyword">-</code><code class="python value">40h</code><code class="python plain">]</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jmp Exit3</code><code class="python plain">Exit2:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">dq </code><code class="python value">1234567812345678h</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">;这里需要原函数地址 </code><code class="python plain">Exit3:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jmp qword ptr [Exit2]</code><code class="python plain">Signature:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">call RelocationCode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">db </code><code class="python value">63h</code><code class="python plain">,</code><code class="python value">6fh</code><code class="python plain">,</code><code class="python value">6eh</code><code class="python plain">,</code><code class="python value">73h</code><code class="python plain">,</code><code class="python value">74h</code><code class="python plain">,</code><code class="python value">20h</code><code class="python plain">,</code><code class="python value">51h</code><code class="python plain">,</code><code class="python value">3dh</code>&nbsp;&nbsp;&nbsp;<code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">dq </code><code class="python value">0h</code><code class="python plain">UnHook:</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov rax,</code><code class="python value">1234567812345678h</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">;这里需要导出表地址，恢复hook位置</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov ebx,</code><code class="python value">12345678h</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="python plain">;这里需要原导出函数RVA</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">mov dword ptr [rax],ebx</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">jmp Exit</code><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">dq </code><code class="python value">0</code><code class="python plain">MyHook endp</code><code class="python plain">end</code></td></tr></tbody></table>

### 调试与完善

好吧，经过一段时间的代码编写，我们的破解程序已经出炉了，调试的话，有兴趣的网友可以自行编写调试，Shellcode 中有两个简单实现的算法，strstr 与 挪动数据

 

然后我还为程序添加了图标与 隐藏控制台，算是比较不错的一个程序了，并且我写的代码具有一定的通用性，应该可以实现全版本通吃，但是我没有测试，可能还有一些细节需要完善，例如特征码的查找与关键调用的判断

 

我测试了最新的 1.25版本，没有问题，下面给出适合新手的PE注入实现

信手拈来 ：PE注入
==========

### 前期分析

众所周知，PE中的text段就是代码段，我们可以在text段中找到一个空闲的位置，来把shellcode放在其中

 

那么需要解决几个问题

 

1.空闲位置的RVA填入导出函数地址表

 

2.shellcode代码的十六进制形式

 

3.空闲位置需要有足够的位置存放shellcode

 

4.随机基址，如果PE注入，那么在跳回原函数的时候，需要它的位置是固定的（当然，如果有足够的大小，可以让Shellcode自定位）

### 开始行动

1.根据分析的4点，首先解决第4点，关闭PE的随机基址属性位 ， 010editor打开 typora.exe （把文件属性的只读去掉）

 

![](upload/attach/202205/930159_5FVV6XZTNRRTMXE.png)

 

010editor有PE格式解析脚本，找到选项头中的属性，把这一项改为0即可

 

2.找到空闲的text段位置，这里我找到了71B4A50的位置，大小刚好够存放我的shellcode

 

![](upload/attach/202205/930159_DDNRUSBSW4WH8G7.png)

 

3.注入代码的位置的FOA转RVA

 

可以使用PE工具来计算，也可以自己编写程序计算 ，我使用看雪资源下载中的PE编辑器，可以直接下载，这里得到了RVA ，71B5650

 

![](upload/attach/202205/930159_VMRMVKAP7QASTEC.png)

 

4.在导出函数地址中修改为这个RVA

 

我在上面的程序中已经找到了这个位置，FOA为0x8602fc5 ，来到文件中的这个位置，写入shellcode 的RVA，小端序写入 071B5650

 

![](upload/attach/202205/930159_48DDRB85V7WEXA2.png)

 

5.然后需要修改一下shellcode，并转换为机器码

 

把原函数地址写入shellcode，通过计算得出 1426FB7A0 为原函数地址（原函数RVA转VA）

 

调试查看一下，RVA修改成功，并且来到该地址，接下来把shellcode的十六进制复制到PE文件中即可

 

![](upload/attach/202205/930159_F4J8XEBWXQSVZAT.png)

 

把Shellcode机器码从调试器中拷贝出来，放到自己破解的010editor中（新版有反汇编功能）

 

![](upload/attach/202205/930159_5CVKFJP3MJGFVCV.png)

 

有一说一 ，还挺好用的，然后把原函数地址 填写到跳转的位置 , 这是我修改后的shellcode

<table border="0" cellpadding="0" cellspacing="0" class="syntaxhighlighter  python"><tbody><tr><td class="gutter">1234567891011121314151617181920</td><td class="code"><code class="python value">49</code> <code class="python value">81</code> <code class="python plain">F8 </code><code class="python value">39</code> <code class="python plain">ED </code><code class="python value">01</code> <code class="python value">00</code> <code class="python value">0F</code> <code class="python value">85</code> <code class="python value">05</code> <code class="python value">01</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">49</code> <code class="python value">81</code> <code class="python plain">FE</code><code class="python value">39</code> <code class="python plain">ED </code><code class="python value">01</code> <code class="python value">00</code> <code class="python value">0F</code> <code class="python value">85</code> <code class="python plain">F8 </code><code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">50</code> <code class="python value">53</code> <code class="python value">51</code> <code class="python value">52</code> <code class="python value">55</code> <code class="python value">54</code><code class="python value">56</code> <code class="python value">57</code> <code class="python value">41</code> <code class="python value">50</code> <code class="python value">41</code> <code class="python value">51</code> <code class="python value">41</code> <code class="python value">52</code> <code class="python value">41</code> <code class="python value">53</code> <code class="python value">41</code> <code class="python value">54</code> <code class="python value">41</code> <code class="python value">55</code> <code class="python value">41</code> <code class="python value">56</code><code class="python value">41</code> <code class="python value">57</code> <code class="python plain">C6 </code><code class="python value">45</code> <code class="python plain">C0 </code><code class="python value">40</code> <code class="python plain">C6 </code><code class="python value">45</code> <code class="python plain">C8 </code><code class="python value">41</code> <code class="python plain">E9 D9 </code><code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">4C</code><code class="python value">8B</code> <code class="python plain">D2 </code><code class="python value">48</code> <code class="python value">8B</code> <code class="python plain">CA </code><code class="python value">5A</code> <code class="python plain">FC </code><code class="python value">80</code> <code class="python value">3A</code> <code class="python value">00</code> <code class="python value">4C</code> <code class="python value">8B</code> <code class="python plain">C9 </code><code class="python value">75</code> <code class="python value">08</code> <code class="python value">48</code><code class="python value">8B</code> <code class="python plain">C1 E9 BB </code><code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">80</code> <code class="python value">39</code> <code class="python value">00</code> <code class="python value">74</code> <code class="python value">31</code> <code class="python value">4C</code> <code class="python value">8B</code> <code class="python plain">C1 </code><code class="python value">4C</code><code class="python value">2B</code> <code class="python plain">C2 </code><code class="python value">48</code> <code class="python value">8B</code> <code class="python plain">C2 </code><code class="python value">0F</code> <code class="python plain">B6 </code><code class="python value">08</code> <code class="python value">84</code> <code class="python plain">C9 </code><code class="python value">74</code> <code class="python value">23</code> <code class="python value">41</code> <code class="python value">38</code> <code class="python value">0C</code> <code class="python value">00</code><code class="python value">75</code> <code class="python value">0A</code> <code class="python value">48</code> <code class="python plain">FF C0 </code><code class="python value">41</code> <code class="python value">80</code> <code class="python value">3C</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">75</code> <code class="python plain">E9 </code><code class="python value">80</code> <code class="python value">38</code> <code class="python value">00</code> <code class="python value">74</code><code class="python value">0E</code> <code class="python value">49</code> <code class="python plain">FF C1 </code><code class="python value">49</code> <code class="python plain">FF C0 </code><code class="python value">41</code> <code class="python value">80</code> <code class="python value">39</code> <code class="python value">00</code> <code class="python value">75</code> <code class="python plain">D5 </code><code class="python value">33</code> <code class="python plain">C0 </code><code class="python value">49</code><code class="python value">8B</code> <code class="python plain">C1 </code><code class="python value">48</code> <code class="python value">83</code> <code class="python plain">F8 </code><code class="python value">00</code> <code class="python value">74</code> <code class="python value">7A</code> <code class="python value">48</code> <code class="python value">8B</code> <code class="python plain">F0 </code><code class="python value">48</code> <code class="python value">8D</code> <code class="python value">76</code> <code class="python value">1A</code> <code class="python value">4C</code><code class="python value">8B</code> <code class="python plain">FE </code><code class="python value">4C</code> <code class="python value">8B</code> <code class="python plain">DE </code><code class="python value">4D</code> <code class="python value">2B</code> <code class="python plain">DA </code><code class="python value">49</code> <code class="python plain">C7 C4 </code><code class="python value">39</code> <code class="python plain">ED </code><code class="python value">01</code> <code class="python value">00</code> <code class="python value">4D</code><code class="python value">2B</code> <code class="python plain">E3 </code><code class="python value">49</code> <code class="python value">8B</code> <code class="python plain">C4 </code><code class="python value">48</code> <code class="python value">99</code> <code class="python value">49</code> <code class="python plain">C7 C5 </code><code class="python value">08</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">41</code> <code class="python plain">F7</code><code class="python plain">F5 </code><code class="python value">48</code> <code class="python value">8B</code> <code class="python plain">C8 </code><code class="python value">48</code> <code class="python plain">AD </code><code class="python value">4C</code> <code class="python value">8D</code> <code class="python value">76</code> <code class="python plain">FF </code><code class="python value">48</code> <code class="python value">8B</code> <code class="python plain">D0 </code><code class="python value">48</code> <code class="python plain">AD </code><code class="python value">49</code><code class="python value">89</code> <code class="python value">16</code> <code class="python value">49</code> <code class="python value">83</code> <code class="python plain">C6 </code><code class="python value">08</code> <code class="python value">48</code> <code class="python value">8B</code> <code class="python plain">D0 FF C9 </code><code class="python value">75</code> <code class="python plain">F0 </code><code class="python value">66</code> <code class="python value">41</code> <code class="python value">89</code><code class="python value">06</code> <code class="python value">41</code> <code class="python plain">C7 </code><code class="python value">07</code> <code class="python value">73</code> <code class="python value">3D</code> <code class="python value">74</code> <code class="python value">72</code> <code class="python value">66</code> <code class="python value">41</code> <code class="python plain">C7 </code><code class="python value">47</code> <code class="python value">04</code> <code class="python value">75</code> <code class="python value">65</code> <code class="python value">41</code><code class="python plain">C6 </code><code class="python value">47</code> <code class="python value">06</code> <code class="python value">3B</code> <code class="python value">41</code> <code class="python value">5F</code> <code class="python value">41</code> <code class="python value">5E</code> <code class="python value">41</code> <code class="python value">5D</code> <code class="python value">41</code> <code class="python value">5C</code> <code class="python value">41</code> <code class="python value">5B</code> <code class="python value">41</code> <code class="python value">5A</code><code class="python value">41</code> <code class="python value">59</code> <code class="python value">41</code> <code class="python value">58</code> <code class="python value">5F</code> <code class="python value">5E</code> <code class="python value">5C</code> <code class="python value">5D</code> <code class="python value">5A</code> <code class="python value">59</code> <code class="python value">5B</code> <code class="python value">58</code> <code class="python value">4C</code> <code class="python value">8B</code> <code class="python value">45</code> <code class="python plain">C0</code><code class="python plain">EB </code><code class="python value">00</code> <code class="python plain">FF </code><code class="python value">25</code> <code class="python value">15</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python plain">E8 </code><code class="python value">22</code> <code class="python plain">FF FF FF </code><code class="python value">63</code> <code class="python value">6F</code> <code class="python value">6E</code><code class="python value">73</code> <code class="python value">74</code> <code class="python value">20</code> <code class="python value">51</code> <code class="python value">3D</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python plain">A0 B7 </code><code class="python value">6F</code><code class="python value">42</code> <code class="python value">01</code> <code class="python value">00</code> <code class="python value">00</code> <code class="python value">00</code></td></tr></tbody></table>

![](upload/attach/202205/930159_VPHKUFAAVHUGZX2.png)

 

好的，保存即可

使用方法
====

1.内存破解程序为 Crack_Typora.exe ，把它放在Typora的目录，双击打开即可

 

2.PE注入破解程序为Typora_Patch.exe ，把它放在Typora的目录，双击打开即可

 

**注：你还可以把它两发送到桌面快捷方式 更为方便快捷**

 

![](upload/attach/202205/930159_XEGDTP54KPXRRZ2.png)

完结撒花
====

![](upload/attach/202205/930159_5AKBSR2MDA4YDTC.png)

结语
==

每个人都有很多想法，但是真正去用行动实现的却只有少数人，而我，就是那少数人。

 

**注：经过大哥的提醒，防止我的程序被恶意传播，所以已经取消了附件下载链接，望谅解**

  

[【公告】 [2022大礼包]《看雪论坛精华22期》发布！收录近1000余篇精华优秀文章!](https://bbs.pediy.com/thread-271749.htm)

最后于 12小时前 被yumoqaq编辑 ，原因： [#调试逆向](forum-4-1-1.htm) [#系统底层](forum-4-1-2.htm) [#软件保护](forum-4-1-3.htm) [#病毒木马](forum-4-1-6.htm) [#问题讨论](forum-4-1-197.htm)