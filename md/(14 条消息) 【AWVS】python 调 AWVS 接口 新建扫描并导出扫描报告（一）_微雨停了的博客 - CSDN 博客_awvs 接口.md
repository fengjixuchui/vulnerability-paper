<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.csdn.net](https://blog.csdn.net/qq_45859826/article/details/123944724)

### 文章目录

*   [前言](#_6)
*   [一、先上完整 python 代码](#python_24)
*   [二、AWVS 介绍](#AWVS_164)
*   [三、准备工作](#_167)
*   *   [1. 获取 API-KEY](#1_APIKEY_168)
    *   [2.Header 设置](#2Header__176)
    *   *   [1. 接口介绍](#1_177)
        *   [2.python 代码](#2python_182)
    *   [3. 屏蔽警告](#3_190)
*   [四、接口验证](#_197)
*   *   [1. 查看 Targets 扫描队列](#1Targets_198)
    *   *   [1. 接口介绍](#1_199)
        *   [2.python 代码](#2python_204)
        *   [3. 返回结果](#3_210)
        *   [4. 参数说明](#4_252)
    *   [2. 添加任务到 Targets 扫描队列，并返回 target_id](#2Targetstarget_id_277)
    *   *   [1. 接口介绍](#1_278)
        *   [2.python 代码](#2python_283)
        *   [3. 返回结果](#3_296)
    *   [3. 添加 targets 队列中的任务到 scans](#3targetsscans_301)
    *   *   [1. 接口介绍](#1_302)
        *   [2.data 介绍](#2data_307)
        *   [3.python 代码](#3python_321)
        *   [4. 发送参数说明](#4_336)
    *   [4. 获取 scan_id](#4scan_id_357)
    *   *   [1. 接口介绍](#1_358)
        *   [2. 代码](#2_363)
        *   [3. 返回结果](#3_370)
        *   [4. 返回参数说明](#4_412)
    *   [5. 导出报告 - 生成 gennerate](#5gennerate_432)
    *   *   [1. 接口介绍](#1_433)
        *   [2.data 介绍](#2data_438)
        *   [3.python 代码](#3python_449)
        *   [4. 返回结果](#4_463)
        *   [5. 发送参数说明](#5_492)
        *   [6. 返回参数说明](#6_518)
    *   [6. 导出报告 - html/pdf](#6htmlpdf_531)
    *   *   [1. 接口介绍](#1_532)
        *   [2.python 代码](#2python_537)
*   [总结](#_552)

前言
==

**本文详细介绍了利用 python 调用 AWVS 14.x 中提供的四个内置接口，验证的流程为：**

> 1. 将目标 URL 添加到 targets 队列，扫描准备；  
> 2. 将 targets 队列中任务添加到 scans 队列，进行扫描；  
> 3. 将 scans 队列中的任务通过 generate 添加到 reports 队列，生成扫描报告；  
> 4. 从 reports 队列中导出扫描报告。

**验证的三个接口为：**

> /api/v1/targets  
> /api/v1/scans  
> /api/v1/reports

本人的 B 站讲解视频：[https://www.bilibili.com/video/BV1NY4y1B7p2/](https://www.bilibili.com/video/BV1NY4y1B7p2/)  
第二期实现批量扫描：[https://blog.csdn.net/qq_45859826/article/details/124082529](https://blog.csdn.net/qq_45859826/article/details/124082529)

一、先上完整 python 代码
================

```
import json
import time
from datetime import datetime

import requests

from requests.packages.urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

tarurl = "https://localhost:3443"
apikey = "1986ad8c0a5b3df4d7028d5f3c06e936c1fc7e549ff144a089c34a12b23d572fa"
headers = {"X-Auth": apikey, "Content-type": "application/json;charset=utf8"}


# 查看所有目标结果
def targets():
    api_url = tarurl + '/api/v1/targets'
    r = requests.get(url=api_url, headers=headers, verify=False)
    print(r.json())


# 添加targets目标，获取target_id
def post_targets(url):
    api_url = tarurl + '/api/v1/targets'
    data = {
        "address": url,
        "description": "wyt_target",
        "criticality": "10"
    }
    data_json = json.dumps(data)
    r = requests.post(url=api_url, headers=headers, data=data_json, verify=False)
    target_id = r.json().get("target_id")
    print('target_id:', target_id)
    return target_id


# 添加scans
def scans(url):
    api_url = tarurl + '/api/v1/scans'
    data = {
        "target_id": url,
        "profile_id": "11111111-1111-1111-1111-111111111112",
        "schedule":
            {"disable": False,
             "start_date": None,
             "time_sensitive": False
             }
    }
    data_json = json.dumps(data)
    r = requests.post(url=api_url, headers=headers, data=data_json, verify=False)
    # target_id = r.json().get("target_id")
    # print(r.json)


# 获取scan_id，通过start_date可知，最新生成的为第一个
def scan_id():
    api_url = tarurl + '/api/v1/scans'
    # print(api_url)
    r = requests.get(url=api_url, headers=headers, verify=False)
    scan_id = r.json().get("scans")[0].get("scan_id")
    print('scan_id:', scan_id)
    return scan_id


# 添加generate，并获取generate_id
def generate(url):
    api_url = tarurl + '/api/v1/reports'
    data = {
        "template_id": "11111111-1111-1111-1111-111111111115",
        "source": {
            "list_type": "scans",
            "id_list": [url]
        }
    }
    data_json = json.dumps(data)
    r = requests.post(url=api_url, headers=headers, data=data_json, verify=False)
    # print(r.json)


# 生成扫描报告,每次新生成的都在第一个
def html():
    api_url = tarurl + '/api/v1/reports'
    # print(api_url)
    r = requests.get(url=api_url, headers=headers, verify=False)
    html = r.json().get("reports")[0].get("download")[0]

    url_html = tarurl + html
    print('报告地址：', url_html)
    r_html = requests.get(url=url_html, headers=headers, verify=False)

    time_now = datetime.now().strftime('%Y-%m-%d %H%M%S')
    with open("report-" + time_now + ".html", "wb") as code:
        code.write(r_html.content)
        code.close()


def pdf():
    api_url = tarurl + '/api/v1/reports'
    # print(api_url)
    r = requests.get(url=api_url, headers=headers, verify=False)
    pdf = r.json().get("reports")[0].get("download")[1]

    url_pdf = tarurl + pdf
    print('报告地址：', url_pdf)
    r_html = requests.get(url=url_pdf, headers=headers, verify=False)

    time_now = datetime.now().strftime('%Y-%m-%d %H%M%S')
    with open("report-" + time_now + ".pdf", "wb") as code:
        code.write(r_html.content)
        code.close()


if __name__ == '__main__':
    # targets()
    # 添加到targets队列
    target_id = post_targets("http://8.8.8.8/")
    time.sleep(5)

    # 添加到scans队列
    scans(target_id)
    time.sleep(5)

    # 获取scan_id,并生成generate
    scan_id = scan_id()
    generate(scan_id)
    time.sleep(5)

    # 生成扫描报告
    # pdf()
    html()
```

**返回结果：**  
![](https://img-blog.csdnimg.cn/60f32f4f50414d99b1d9b6115d9000ff.png)  
![](https://img-blog.csdnimg.cn/1a6c133d5290470280a21b0a480e2854.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5b6u6Zuo5YGc5LqG,size_20,color_FFFFFF,t_70,g_se,x_16)

二、[AWVS](https://so.csdn.net/so/search?q=AWVS&spm=1001.2101.3001.7020) 介绍
=========================================================================

[Acunetix](https://so.csdn.net/so/search?q=Acunetix&spm=1001.2101.3001.7020) 是一个专业好用的漏洞扫描工具，提供一些内置 API 接口，可供调用。因毕业设计，对其中一些接口进行了测试，以下为测试文档。

三、准备工作
======

1. 获取 API-KEY
-------------

![](https://img-blog.csdnimg.cn/08770b4fa2be4c18b5ed17da0371b22e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5b6u6Zuo5YGc5LqG,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)  
「Administrator」-「Profile」-「API Key」-「Copy」

```
API-KEY：1986ad8c0a5b3df4d7028d5f3c06e936c1fc7e549ff144a089c34a12b23d572fa
```

2.Header 设置
-----------

### 1. 接口介绍

```
X-Auth:API-KEY
Content-type:application/json;charset=utf8
```

### 2.python 代码

```
apikey = "1986ad8c0a5b3df4d7028d5f3c06e936c1fc7e549ff144a089c34a12b23d572fa"
headers = {"X-Auth": apikey, "Content-type": "application/json;charset=utf8"}

tarurl = "https://localhost:3443"
```

3. 屏蔽警告
-------

```
from requests.packages.urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
```

四、接口验证
======

1. 查看 Targets 扫描队列
------------------

### 1. 接口介绍

```
Method: GET 
URL: /api/v1/targets
```

### 2.python 代码

```
api_url = tarurl + '/api/v1/targets'
r = requests.get(url=api_url, headers=headers, verify=False)
print(r.json())   #返回结果为json格式
```

### 3. 返回结果

```
{
  'targets': [
  {
	 'address': 'http://192.168.137.129/',
	 'continuous_mode': False, 
 	 'criticality': 10, 
 	 'default_scanning_profile_id': None,
	 'deleted_at': None,
	 'description': 'http://192.168.137.129/', 
	 'fqdn': '192.168.137.129', 
	 'fqdn_hash': '4d9a6f1d9e94cce236acd2d397fdc5ce', 
	 'fqdn_status': 'new', 
	 'fqdn_tm_hash': 'f3c47dc4029759660937dd3f55c685c2', 
	 'issue_tracker_id': None, 'last_scan_date': '2022-03-28T18:07:52.178043+08:00',
	 'last_scan_id': 'b7eab683-8708-4cfc-9d3a-2e3c989fbae5',
 	 'last_scan_session_id': 'b3b15334-44ed-4dd7-8363-b874c7ec0947', 
     'last_scan_session_status': 'completed', 
 	 'manual_intervention': None, 
	 'severity_counts': {
	 	'high': 0, 
	 	'info': 0,
	 	'low': 0,
 		'medium': 0
	 }, 
	 'target_id': '73e0d89a-6323-446a-a00c-691a884b286b', 
	 'threat': 0, 
	 'type': None, 
	 'verification': None
  },
  
  'pagination': 
  {
 	 'count': 11, 
	 'cursor_hash': '8f629dd49f910b9202eb0da5d51fdb6e', 
	 'cursors': [None], 
	 'sort': None
  }
}
```

### 4. 参数说明

<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>targets</td><td>目标详细信息</td></tr><tr><td>pagination</td><td>分页信息</td></tr></tbody></table>

targets:

<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>address</td><td>扫描目标网址</td></tr><tr><td>continuous_mode</td><td>是否连续模式</td></tr><tr><td>criticality</td><td>危险程度</td></tr><tr><td>description</td><td>描述</td></tr><tr><td>last_scan_date</td><td>最近扫描的日期</td></tr><tr><td>last_scan_id</td><td>最近扫描的 id</td></tr><tr><td>last_scan_session_id</td><td>最近扫描的 session id</td></tr><tr><td>last_scan_session_status</td><td>最近的扫描状态</td></tr><tr><td>manual_intervention</td><td>手动干预</td></tr><tr><td>severity_counts</td><td>漏洞等级个数分布</td></tr><tr><td>target_id</td><td>目标 id</td></tr><tr><td>threat</td><td>威胁等级</td></tr><tr><td>type</td><td>类型</td></tr><tr><td>verification</td><td>验证</td></tr></tbody></table>

2. 添加任务到 Targets 扫描队列，并返回 target_id
-----------------------------------

### 1. 接口介绍

```
Method: POST 
URL: /api/v1/targets
```

### 2.python 代码

```
api_url = tarurl + '/api/v1/targets'
data = {
   "address": url,
   "description": "wyt_target",
   "criticality": "10"
 }
data_json = json.dumps(data)
r = requests.post(url=api_url, headers=headers, data=data_json, verify=False)
target_id = r.json().get("target_id")
print(target_id)
```

### 3. 返回结果

```
87527c66-665b-4920-bde7-c56e5297f8b0
```

3. 添加 targets 队列中的任务到 scans
---------------------------

### 1. 接口介绍

```
Method: POST
URL: /api/v1/scans
```

### 2.data 介绍

```
data = 
{
    "target_id": "ec78d77d-6e26-4994-8d46-7fa8deae11b9",
    "profile_id": "11111111-1111-1111-1111-111111111112",
    "schedule":
      {
          "disable": False,
          "start_date": None,
          "time_sensitive": False
      }
}
```

### 3.python 代码

```
api_url = tarurl + '/api/v1/scans'
data = {
        "target_id": url,
        "profile_id": "11111111-1111-1111-1111-111111111112",
        "schedule": {
            "disable": False,
            "start_date": None,
            "time_sensitive": False
        }
  }
data_json = json.dumps(data)
r = requests.post(url=api_url, headers=headers, data=data_json, verify=False)
```

### 4. 发送参数说明

<table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>profile_id</td><td>string</td><td>扫描类型</td></tr><tr><td>ui_session_i</td><td>string</td><td>可不传</td></tr><tr><td>incremental</td><td>bool</td><td>增加的</td></tr><tr><td>schedule</td><td>json</td><td>扫描时间设置 (默认即时)</td></tr><tr><td>report_template_id</td><td>string</td><td>扫描报告类型 (可不传)</td></tr><tr><td>target_id</td><td>string</td><td>目标 id</td></tr></tbody></table>

profile_id：

<table><thead><tr><th>类型</th><th>值</th><th>意义</th></tr></thead><tbody><tr><td>Full Scan</td><td>11111111-1111-1111-1111-111111111111</td><td>完全扫描</td></tr><tr><td>High Risk Vulnerabilities</td><td>11111111-1111-1111-1111-111111111112</td><td>高风险漏洞</td></tr><tr><td>Cross-site Scripting Vulnerabilities</td><td>11111111-1111-1111-1111-111111111116</td><td>XSS 漏洞</td></tr><tr><td>SQL Injection Vulnerabilities</td><td>11111111-1111-1111-1111-111111111113</td><td>SQL 注入漏洞</td></tr><tr><td>Weak Passwords</td><td>11111111-1111-1111-1111-111111111115</td><td>弱口令检测</td></tr><tr><td>Crawl Only</td><td>11111111-1111-1111-1111-111111111117</td><td>Crawl Only</td></tr><tr><td>Malware Scan</td><td>11111111-1111-1111-1111-111111111120</td><td>恶意软件扫描</td></tr></tbody></table>

4. 获取 scan_id
-------------

### 1. 接口介绍

```
Method: GET 
URL: /api/v1/scans
```

### 2. 代码

```
api_url = tarurl + '/api/v1/scans'
r = requests.get(url=api_url, headers=headers, verify=False)
print(r.json().get("scans")[0])
scan_id = r.json().get("scans")[0].get("scan_id")
```

### 3. 返回结果

```
{
	'criticality': 10, 
	'current_session': {
		'event_level': 2, 
		'progress': 100, 
		'scan_session_id': '7be91fbd-f904-4c6f-a33c-909cddb7a9c8',
		'severity_counts': {
			'high': 0, 
			'info': 0,
			'low': 0, 
			'medium': 0
			}, 
		'start_date': '2022-04-03T19:05:05.089001+08:00', 
		'status': 'completed', 
		'threat': 0
		}, 
	'incremental': False, 
	'max_scan_time': 0, 
	'next_run': None, 
	'profile_id': '11111111-1111-1111-1111-111111111112', 
	'profile_name': 'High Risk', 
	'report_template_id': None, 
	'scan_id': '5b9222cc-a21b-4b11-b1a5-6d6d5856d74a', 
	'schedule': {
		'disable': False, 
		'history_limit': None, 
		'recurrence': None, 
		'start_date': None, 
		'time_sensitive': False, 
		'triggerable': False
		}, 
	'target': {
		'address': 'http://6.6.6.6/', 
		'criticality': 10, 
		'description': 'wyt_target', 
		'type': 'default'
		}, 
	'target_id': '0944cef3-411e-4d4c-8647-4655f0b1e52b'
}
```

### 4. 返回参数说明

<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>criticality</td><td>危险程度</td></tr><tr><td>current_session</td><td>当前会话</td></tr><tr><td>start_date</td><td>开始扫描时间</td></tr><tr><td>status</td><td>扫描状态</td></tr><tr><td>threat</td><td>威胁性</td></tr><tr><td>incremental</td><td>额外的？</td></tr><tr><td>manual_intervention</td><td>人工干预</td></tr><tr><td>max_scan_time</td><td>最大扫描时间</td></tr><tr><td>next_run</td><td>下一轮</td></tr><tr><td>profile_id</td><td>扫描类型</td></tr><tr><td>profile_name</td><td>扫描类型名称</td></tr><tr><td>report_template_id</td><td>扫描报告模板 id</td></tr><tr><td>scan_id</td><td>扫描 id</td></tr><tr><td>schedule</td><td>时间表</td></tr><tr><td>target</td><td>目标相关的信息</td></tr><tr><td>target_id</td><td>目标 id</td></tr></tbody></table>

5. 导出报告 - 生成 gennerate
----------------------

### 1. 接口介绍

```
Method: POST 
URL: /api/v1/reports
```

### 2.data 介绍

```
data = {
        "template_id": "11111111-1111-1111-1111-111111111115",
        "source": {
            "list_type": "scans",
            "id_list": ["87527c66-665b-4920-bde7-c56e5297f8b0"]
        }
}
```

### 3.python 代码

```
api_url = tarurl + '/api/v1/reports'
data = {
        "template_id": "11111111-1111-1111-1111-111111111115",
        "source": {
            "list_type": "scans",
            "id_list": [url]
        }
 }
data_json = json.dumps(data)
r = requests.post(url=api_url, headers=headers,data=data_json, verify=False)
print(r.json)
```

### 4. 返回结果

```
{
	'pagination': {
		'count': 5, 
		'cursor_hash': '8f629dd49f910b9202eb0da5d51fdb6e', 
		'cursors': [None], 
		'sort': None}, 
		'reports': [
		{
			'download':	[
				'/api/v1/reports/download/4df097a941830e36be6665ab908e40a27c2d0528d503a70ce9b77f72592bc73e05bc9f8d624994d71482b153-bd3b-4c36-8d21-0886c07f4739.html', 
				'/api/v1/reports/download/1c3fa9b4f76396cedcda1e857e5bfe0053fcd9653bf55d1344a5e99bd1b53366fa10c36a624994d71482b153-bd3b-4c36-8d21-0886c07f4739.pdf'
			], 
			'generation_date': '2022-04-03T19:33:46.118619+08:00', 
			'report_id': '1482b153-bd3b-4c36-8d21-0886c07f4739', 
			'source': {
				'list_type': 'scans', 
				'description': 'http://6.6.6.6/;wyt_target', 
				'id_list': ['5b9222cc-a21b-4b11-b1a5-6d6d5856d74a']
			}, 
			'status': 'completed', 
			'template_id': '11111111-1111-1111-1111-111111111115',
		    'template_name': 'Affected Items', 
			'template_type': 0
			}
		]
}
```

### 5. 发送参数说明

<table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>template_id</td><td>String</td><td>扫描报名模板类型</td></tr><tr><td>list_type</td><td>String</td><td>值为: scans</td></tr><tr><td>id_list</td><td>String</td><td>值为: scan_id</td></tr></tbody></table>

template_id:

<table><thead><tr><th>类型</th><th>值</th></tr></thead><tbody><tr><td>Affected Items</td><td>11111111-1111-1111-1111-111111111115</td></tr><tr><td>CWE 2011</td><td>11111111-1111-1111-1111-111111111116</td></tr><tr><td>Developer</td><td>11111111-1111-1111-1111-111111111111</td></tr><tr><td>Executive Summary</td><td>11111111-1111-1111-1111-111111111113</td></tr><tr><td>HIPAA</td><td>11111111-1111-1111-1111-111111111114</td></tr><tr><td>ISO 27001</td><td>11111111-1111-1111-1111-111111111117</td></tr><tr><td>NIST SP800 53</td><td>11111111-1111-1111-1111-111111111118</td></tr><tr><td>OWASP Top 10 2013</td><td>11111111-1111-1111-1111-111111111119</td></tr><tr><td>PCI DSS 3.2</td><td>11111111-1111-1111-1111-111111111120</td></tr><tr><td>Quick</td><td>11111111-1111-1111-1111-111111111112</td></tr><tr><td>Sarbanes Oxley</td><td>11111111-1111-1111-1111-111111111121</td></tr><tr><td>Scan Comparison</td><td>11111111-1111-1111-1111-111111111124</td></tr><tr><td>STIG DISA</td><td>11111111-1111-1111-1111-111111111122</td></tr><tr><td>WASC Threat Classification</td><td>11111111-1111-1111-1111-111111111123</td></tr></tbody></table>

### 6. 返回参数说明

<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>generation_date</td><td>生成时间</td></tr><tr><td>template_type</td><td>模板类型</td></tr><tr><td>report_id</td><td>报告 id</td></tr><tr><td>template_name</td><td>模板名字</td></tr><tr><td>status</td><td>状态</td></tr><tr><td>template_id</td><td>模板 id</td></tr><tr><td>download</td><td>下载链接 [html, pdf]</td></tr><tr><td>source</td><td>来源</td></tr><tr><td>description</td><td>备注</td></tr></tbody></table>

6. 导出报告 - html/pdf
------------------

### 1. 接口介绍

```
Method: GET
URL: /api/v1/reports
```

### 2.python 代码

```
api_url = tarurl + '/api/v1/reports'
r = requests.get(url=api_url, headers=headers, verify=False)
html = r.json().get("reports")[0].get("download")[0]
# pdf = r.json().get("reports")[0].get("download")[1]

url_html = tarurl + html
r_html = requests.get(url=url_html, headers=headers, verify=False)
with open("report.html", "wb") as code:
     code.write(r_html.content)
     code.close()
```

总结
==

这篇文章缘起于我的本科毕业设计” 漏洞分析系统设计 “，首先感谢各位师傅的优秀博文分享，给了迷茫中的我许多灵感：

> 国光师傅的 AWVS API 文档：[https://www.sqlsec.com/2020/04/awvsapi.html#toc-heading-32](https://www.sqlsec.com/2020/04/awvsapi.html#toc-heading-32)  
> h4rdy 师傅的 AWVS API 文档：[https://github.com/h4rdy/Acunetix11-API-Documentation](https://github.com/h4rdy/Acunetix11-API-Documentation)  
> Recar 师傅的 AWVS 测试文件： [https://blog.csdn.net/qq_28295425/article/details/81051954](https://blog.csdn.net/qq_28295425/article/details/81051954)

2022 年对于我是非常不一般的一年，前三个月的经历对我打击是巨大的。去年我的许多选择在今年看来都没有很好的结局，考研失败，身体一团糟，不知道未来在哪里，陷入无穷尽的自我怀疑旋涡…… 经历了一段时期的冷静期，重新回到 CSDN，也是想重回初心。其实不论未来如何，最大的希望还是：做一个健康快乐的女孩子。  
希望疫情能早日消失，我们的生活回归正轨；希望自己接下来的手术顺利进行，拥有一个健康的身体。有条件的话之后也要多发博文，和各位师傅一起进步。

2022 年 4 月 3 日于家中