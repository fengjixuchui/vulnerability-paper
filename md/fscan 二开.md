<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/_udAjrEPBesL0kfYRH3c3A)

简介
--

这里我们从 github 上下 git 最新的 fscan 项目并用 ide 打开

### common 目录

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyD6nyakXfYrNtdILa8g3MdQRg3nUBhjjXSAxianxYapMGuvcr17Y9j1Q/640?wx_fmt=png)

config.go 配置文件可以用来修改字典和默认扫描端口

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyyrbibHJfiary2dluAiayDnxKBn52F3Xia38n56frrqiaRBBtCRp3vD0oOIA/640?wx_fmt=png)

flag.go 用于命令行的选择比如 - h -p 等

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyLKCK0wJza8Djz5MYJLFr4fWKvNichwvkvvcXiclEibXicOZzRMoqjSoQwg/640?wx_fmt=png)

log.go 日志处理

Parse.go 对选择进行处理

ParseIP.go 对输入 ip 进行处理

ParsePort.go 对输入端口进行处理

proxy.go 代理

### Plugins 目录：

这个目录是按我的理解来说可以里面为扫描时的功能插件

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyR6U051rOgsO6rpwbmB4mZicdQyaChn5OKvAkr8sLkGfhHVEgmwXCicsA/640?wx_fmt=png)

像 这些 ms17010 mysql mmsql 等

列如 fscan 的 mysql 扫描写法

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSywCW401U9ibZaDjibpe1WQBJ0xvzSaFIRPlxx2CHpCAfV5Vpiafsu1f7IQ/640?wx_fmt=png)

两个 for 循环 调用 mysql 链接就实现了 mysql 扫描

他是如何调用这个函数的了？

我们直接对 Mysqlscan 进行查询

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyOYMpQG9D0P0vQhydVyLACGb5p9n4Y4eKe8qZPKm0Idt4ubGW8yvdxQ/640?wx_fmt=png)

发现在 base.go 文件中他调用了 mysqlscan 函数

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyLZQ24bic2fXqQMwdesIeuVbwexsl5mIT0R9wJW7qXU7FrgXFoZ7c5RA/640?wx_fmt=png)

他是如何对这些进行扫描处理的

同样的对 PluginList 进行查询

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyxdUt0NL6BJGStbrRyGkRGT2Gb81qxKEmY4X8wY8glRoWgenHR3icKcQ/640?wx_fmt=png)

继续跟下去

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyUlShryp4uy0TdDckWfrZTNhPL94W6wLpLSVcGnHpfDFypqm9YAjYpw/640?wx_fmt=png)

跟到这里我们可以看到他的处理逻辑

```
  if common.Scantype == "all" || common.Scantype == "main" {
        switch {
        case info.Ports == "135":
          AddScan(info.Ports, info, &ch, &wg) //findnet
          if common.IsWmi {
            AddScan("1000005", info, &ch, &wg) //wmiexec
          }
        case info.Ports == "445":
          AddScan(ms17010, info, &ch, &wg) //ms17010
          //AddScan(info.Ports, info, ch, &wg)  //smb
          //AddScan("1000002", info, ch, &wg) //smbghost
        case info.Ports == "9000":
          AddScan(web, info, &ch, &wg)        //http
          AddScan(info.Ports, info, &ch, &wg) //fcgiscan
        case IsContain(severports, info.Ports):
          AddScan(info.Ports, info, &ch, &wg) //plugins scan
        default:
          AddScan(web, info, &ch, &wg) //webtitle
        }
      } else {
        scantype := strconv.Itoa(common.PORTList[common.Scantype])
        AddScan(scantype, info, &ch, &wg)
      }

```

逻辑处理都出来了 感觉这个没必要说了 大家都应该能看懂这些代码

### Webscan 目录

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyyL1Xrl2wTqqALRaOTOBKU91BRXuGYbiaG4RicNembSDeOz46oaRibkfJw/640?wx_fmt=png)

rules.go 这里时对指纹的处理  如果你想增加指纹可以从这里入手  不过不太推荐增加太多

lib 目录

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSy5fibLk4kTl7mZ8BJiaXH4m4ySDfSF8mYzzXZWibDJ6uOiaWr7AEJDdPaoA/640?wx_fmt=png)

这里是一些固定的东西 没必要改

pocs 目录

就是你放 poc 的地方

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyh0GkaibnnZroUwKErcrQHShUr1mnRYx1AGdUzey9QPR8ibsIRZ7C2MwA/640?wx_fmt=png)

poc 编写方法你可以参考 xray 的来写，这里可以推荐一下 xray 规则实验室

```
https://poc.xray.cool/

```

二开  

-----

这里搞个简单的  搞个 zookeeper 未授权扫描

我们直接在 Plugins 创建一个 zookeeper.go 文件

参考下 zooker 的 go 链接 demo，这里就不说了，我们直接贴代码

```
package Plugins
import (
  "fmt"
  "github.com/samuel/go-zookeeper/zk"
  "github.com/shadow1ng/fscan/common"
  "time"
)
func ZookeeperConn(info *common.HostInfo) {
  x := fmt.Sprintf("%s:%v", info.Host, info.Ports)
  s := []string{x}
  _, _, err := zk.Connect(s, time.Second*5)
  //defer conn.Close()
  if err != nil {
    fmt.Println(err)
  } else {
    common.LogSuccess(fmt.Sprintf("unauthorized zookeeper %s", fmt.Sprintf("%v:%v", info.Host, info.Ports)))
    //fmt.Println("zookeeper 连接成功！")
  }
}

```

接着在 Plugins/base.go 把函数添加进去

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyvqmdSrsxpXhlhxwEibsZasr7rKv2CFibAvs8S9JHCI8JgcFjG6cnmmtQ/640?wx_fmt=png)

这个样子还不够，如果我们要进行单独扫描的话 还需要在 common 目录下对他进行处理

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyzRqLgZnliceyNRbOfW0tMuoq0H8XN0q0hpCIkPOJ3F90TiaP6vI6J98A/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyeOy5icNObQUkI4hOXicaBzTLibLTUyGBawqQ9iashic4TenSwy43rvYzKmA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSy3euS9nCep8ibB5vib1wfhvCkHNmDPRiclQaFzVeqHD5AkO3VVaQqQTQTw/640?wx_fmt=png)

这里就把单独扫描整好了

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyyr8Hgj1ZU3xRZ7jJ2RNNq2P6QqCC41bTUicRTK7bLiaxEuRCaQob8ZCA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2dH4ibBaats1LEr4Sw7FIVSyoU8lGeX8MdWRHTphdguVCTgichOYib31zRWOwouicOMAAcVWygxH1q2nQ/640?wx_fmt=png)

到这里一个简单的 zookeeper 未授权扫描功能就写好了

后面其实还可以加一堆东西 比如什么数据一键利用，向日葵扫描，一键写入 shiro 内存马等等都可以自定义加

免杀的话，其实可以本地编译, 去除 github.com/shadow1ng, 之后再对编译进行混淆就可以免杀了

这里不推荐工具了，推荐之后 过段时间就免杀不了