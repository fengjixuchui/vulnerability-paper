<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/eDexuhi3B2vs3gEPPJBJzA)

公众号

![](https://mmbiz.qpic.cn/mmbiz_png/HpA1SPmFiaXnH0icIic57eR9QytbPrsHiapgSzTxN8oh4ibvYCVK7ETUkaZIRlbfNom9X0QGt93I0RFaaAKA0Sibab3Q/640?wx_fmt=png)

背景

![](https://mmbiz.qpic.cn/mmbiz_png/mtXBpHBrIJmMvSfMA2IDGnclSl50gYw6Njhvznic1ZW25vGceuDAakscJgPLT6WQmfvzSibQZ3ib5gnGYQYTlclFg/640?wx_fmt=png)

在无意间发现某 QQ 群里，在推广售卖一个月 70 元的和平精英游戏的 APP 作弊软件。从 APP 作弊软件的页面功能展示上可以看到，该 APP 作弊软件有很经典的全图透视，人物上色，无后座力，子弹穿墙，方框绘制，附近人数等功能。**下面就从抓包、脱壳、功能代码解析方面，解析该 APP 的一些关键功能，如注册功能、辅助作弊功能。**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYNAere24T6rrLqOSVs6M0RvuATPRsiaxOouk2yYUnmtuWJynBtd4R2Cw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/HpA1SPmFiaXnH0icIic57eR9QytbPrsHiapgSzTxN8oh4ibvYCVK7ETUkaZIRlbfNom9X0QGt93I0RFaaAKA0Sibab3Q/640?wx_fmt=png)

APP 抓包

![](https://mmbiz.qpic.cn/mmbiz_png/mtXBpHBrIJmMvSfMA2IDGnclSl50gYw6Njhvznic1ZW25vGceuDAakscJgPLT6WQmfvzSibQZ3ib5gnGYQYTlclFg/640?wx_fmt=png)

下面主要以 **charles 抓包工具和逍遥模拟器为介质**，进行对 APP 网络包数据和行为分析。通过 APP 抓包数据，**可以确定该 APP 数据包都是没做任何加密保护或防抓包保护。所以对于该 APP 包分析还是相对简单的**。下面就简单说明下抓包设置还有几个关键的数据包。

**charles 抓包配置方法**

1. 在 charles 抓包工具设置要进行抓包用的端口号。

2. 模拟器或者真机上设置好主机的 ip 地址和 charle 工具一致的端口号。

主要就是保证 charles 和模拟器或真机上连接在同一网络同一端口即可。

**APP 软件更新的包信息**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYr9p7hWKcJbCCxC4T8Ex3F2G1Dic5XQPMpxqYLe0boXZu8HCqibhq1BLg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xY9ccjGuxRfFOta6Gt1AQmUDSvNqmiaiaMUg9GiczxiawhY3XribOc9626w2A/640?wx_fmt=png)

通过 charles 工具拦截到，上面的网络通信数据包信息，可以清晰的看到该 APP 的服务器是放在北京的阿里云，通过校验服务端的 gx.txt 文件，进行判断是否需要进行对 APP 版本包的更新。

**防封引擎 APP 下载**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYvibyQYHedFSXTocMQCibKConMfsawXxqg0JjqjfxicHn1tjxsF0W1oOaA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYJuKfH5MvPib8CC1OXqHZ5QRl35GIiatITmLKZvlomfw3DqcCjsznMfxQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYpibhVC5HEnm7YRD1mgXR3fbEwcP8R8vic1CQP7f6B0yL0oFSmHq0UibLw/640?wx_fmt=png)

通过上面的网络通信包数据分析，该 APP 还会从北京阿里云服务器或蓝奏云网盘上（https://pan.lanzouw.com/ipyI0xp25yj?p），进行下载配套的防封引擎插件 APP，这样通过两 APP 进行配合使用，以达到相对游戏作弊行为。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYTMA6ibTEW6badJNRYQNjCds1InwnCROrT1bUHd3sTKicSSHFjOpMPw5A/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYO4zvDhHheNYuSZ2ia2wVQqO6anoiaNmWicnriaKAtWD7Nw0ayCWia21sicyw/640?wx_fmt=png)

通过抓包分析可以看到该 APP，它在售卖和发放注册卡功能，它是放在第三方平台 https://www.mayifk.cn/details/9411BD8C 上进行做收款并发放注册卡的。

基于对 APP 的所有网络通信包分析，可以得出一个结果，该 APP 作弊软件作者，**主要的网络通信行为有北京阿里云服务器、蓝奏云网盘、第三方平台的付款和注册卡做通信和验证。基于服务器信息和付款信息，可以很快速的追踪到该作者的相关信息。**

![](https://mmbiz.qpic.cn/mmbiz_png/HpA1SPmFiaXnH0icIic57eR9QytbPrsHiapgSzTxN8oh4ibvYCVK7ETUkaZIRlbfNom9X0QGt93I0RFaaAKA0Sibab3Q/640?wx_fmt=png)

APP 脱壳

![](https://mmbiz.qpic.cn/mmbiz_png/mtXBpHBrIJmMvSfMA2IDGnclSl50gYw6Njhvznic1ZW25vGceuDAakscJgPLT6WQmfvzSibQZ3ib5gnGYQYTlclFg/640?wx_fmt=png)

通过用 jadx 工具 (还有 jeb、androidkiller 等工具) 查看 APP 解压后的 dex 文件，通过工具展示的信息，可以看到该 dex 文件的入口类 Application 类已经被处理过了，也就是该 APP 用了第三方加固软件，进行加固保护过的。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYQfdh104dxm8uX8PRH2gSibIibUiaicxW9GM3T6vTk4PzYdTlt0uMtwjIBQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYkoTKSIMCgxSnLNDTia3diafghW1wGIMibsNEORHwnAGGJwIcMyXdvibFDQ/640?wx_fmt=png)

**识别 APP 是否加固的小方法**

1、将 app 解压出来查看 assets 目录下，是否有对应的 so 文件，这个目录下的 so 文件名称是可以作为识别是什么加固厂商的方法。

2、将 app 拖到反编译工具，如 jadx 工具上，通过工具可以看出 Application 的入口类是否被替换，还有是否存在加固厂商的特征。

**我们知道在 APP 的 Application 类中的 attachBaseContext 和 onCreate 这两个函数是最先获取执行权进行代码执行的。这也是为什么很多加固工具的主要逻辑都是通过替换 APP 入口 Application，并自实现这两个函数从而达到加固的效果。通过上面的分析该 APP 采用的 360 加固进行最 App 做加固。那么要分析该 dex 文件的信息就需要进行做脱壳的操作。**

**APP 要成功脱壳两个最为关键的要素**

1、内存中 dex 的起始地址和大小，只有拿到这两个要素，才能够成功 dump 下内存中的 dex。

2、脱壳时机，只有正确的脱壳时机，才能够 dump 下明文状态的 dex。否则，时机不对，及时是正确的起始地址和大小，dump 下来的也可能只是密文。

**APP 脱壳的原理**

对于完整的 dex 文件，采用暴力搜索方式搜索 dex035 关键特征，对于抹掉头文件信息的 dex 如抹掉 dex035 这个的 magic bytes 信息，这个时候就需要通过匹配一些特征来进行搜索。

下面**通过 frida 框架和 frida_dexdump 脚本 (通过暴力搜索 dex035) 对该 360 壳进行脱壳操作**，可以很顺利的脱掉该 APP 的 360 加固保护，最终解密出多个 dex 文件。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYr3icrmzLDy4D93z71hpGpHtDm8W5w8Fibc7nqhFGFGWE3CNPxxFMIHlQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYcIYpQEqiarq6z88k7sw2Y8HrSZYFp0nldFzbveyykk3fQJspPBGPLFw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/HpA1SPmFiaXnH0icIic57eR9QytbPrsHiapgSzTxN8oh4ibvYCVK7ETUkaZIRlbfNom9X0QGt93I0RFaaAKA0Sibab3Q/640?wx_fmt=png)

APP 功能解析

![](https://mmbiz.qpic.cn/mmbiz_png/mtXBpHBrIJmMvSfMA2IDGnclSl50gYw6Njhvznic1ZW25vGceuDAakscJgPLT6WQmfvzSibQZ3ib5gnGYQYTlclFg/640?wx_fmt=png)

通过对 APP 脱壳后，就可以解析 dex 的代码功能了，通过下面的 dex 文件信息可以看出，**APP 是通过基于 E4A 开发的也就是易语言安卓的中文版编程的**。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYKGFpv4vqt5h0E2Fk7gbMOJbudkjsMBFOakyAQBiaoRZBRQkFGDW0oxA/640?wx_fmt=png)

因为在测试随便输入一个注册码的时候，发现该 APP 没有网络通信行为，所以她是一个本机校验的过程。通过下面的代码我们得出，**该 APP 是否注册是通过校验本地是否有 vip.txt 文件，只要本地有 vip.txt 文件，那么就会通过本地的注册验证，实现到真正的注册功能。**

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYygxrvu5OINnZFPHCybQWF6SRdmHicCH79gKjLwubAT6iaxTM9J6eJI8w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYl9SxN1NzvgK7C8aDfzkeYtiakIoAnE2PukhdsVcsZ4yeBKm9McWZp1w/640?wx_fmt=png)

通过下面截图可以看出，只要通过向 QQ 或者微信分析也可以获取注册码，这个可以通过假分享就可以实现次数的统计，只要点击对应分享然后切换回来就可以做实现计数的统计了。最后获取到注册码。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xY7YlhiaBy0l1wg4PwvMic8qYvUBqwQAX0uCK3jBflRbesGkbo6SRHST6A/640?wx_fmt=png)

通过下面的代码，可以看到本地记录分享次数的文件是 zscs.txt 文件，**那么只要将文件中的数据直接改为 20，那么也就可以获取到一个注册码**。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYgXicaUIvlJp8W9r5rRqrClq0aRia1D9ia7E9B15xQVuV2768tibWKRjtCQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYTlZM6xXdb4k9icnOlHhqKReWMpUPURD5JL8QJNtnNqEEB2QNrQ2CxPA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xY9EQXcRkiaPBENa1pZLTsHlrEU5gOwxkYicPhZLwm7D2CQfomQhUyhR3w/640?wx_fmt=png)

该 APP 外挂的防封引擎，它是通过将作弊功能的代码注入到游戏客户端上，而实现游戏作弊的功能和效果。

要实现游戏作弊功能，从业务层面上就是修改游戏角色属性或者关键函数参数、返回值信息。从底层引擎实现上来说就是通过基于修改底层渲染部分实现作弊功能，如调整子弹的速度，这样当子弹和碰撞体进行碰撞的时候，就会发生穿墙的效果。

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYk9f5ibbbqqvX3icLj8HNP2SxFibnU8wp2F15pYnReKwSQMPeFQEGpms6w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYwP0xH3kUqX0dO2Ztu1zSkjxibxl3Zx6iaG3IaXClECR2wPa6PzcZg5Lw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/jVCRndy8Lr6B52G3ibPDK36gg6XaxJ0xYQ4AFhDkPD3ggpt6f3oBySE2yvt9WuTdno4WtmsSgIAvVibWlXFlpc6g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/HpA1SPmFiaXnH0icIic57eR9QytbPrsHiapgSzTxN8oh4ibvYCVK7ETUkaZIRlbfNom9X0QGt93I0RFaaAKA0Sibab3Q/640?wx_fmt=png)

总结

![](https://mmbiz.qpic.cn/mmbiz_png/mtXBpHBrIJmMvSfMA2IDGnclSl50gYw6Njhvznic1ZW25vGceuDAakscJgPLT6WQmfvzSibQZ3ib5gnGYQYTlclFg/640?wx_fmt=png)

该 APP 通过易安卓进行编程开发游戏的作弊软件，并通过对 APP 进行加固保护保护代码。而注册卡方面相对比较弱，通过校验本地是否存在指定文件，这种很容易被绕过。游戏作弊功能上，通过修改游戏客户端数据而达到作弊功能，这种针对游戏客户端修改都是不安全的，因为这个游戏已接入了 ACE 反外挂检测功能，所以游戏中通过作弊软件进行作弊会有封号的风险。

![](https://mmbiz.qpic.cn/mmbiz_png/mLFdZp3ahsb0aOw3cnJr8icgCQt9tNp1BEz3YdSia5vMRAaERIOWkCwdV75LFqpricBXJntaRFKaALqrXsjYdic3zg/640?wx_fmt=png)

**【推荐阅读】**

**[一起来逆向分析吃鸡外挂](http://mp.weixin.qq.com/s?__biz=MzUxODkyODE0Mg==&mid=2247486587&idx=1&sn=e40fa94b3fb8b3dabf788527deef79e4&chksm=f9802e1acef7a70ce808b2aa31ae4a573c7dc85e6e2954c0be59686478c224e3c938157bd380&scene=21#wechat_redirect)  
**

**[我是这样对灰产 外挂 下手的](http://mp.weixin.qq.com/s?__biz=MzUxODkyODE0Mg==&mid=2247483856&idx=1&sn=c2729337e539b68de39d8fd761c32dcf&chksm=f98023b1cef7aaa7dcdb435470ff347fe0acb6096c89b11d824797fe080df9c712b159fc3f95&scene=21#wechat_redirect)  
**

**[分析免费游戏辅助的盈利方式](http://mp.weixin.qq.com/s?__biz=MzUxODkyODE0Mg==&mid=2247488699&idx=1&sn=074de601078ff5dd97622244551bc9c7&chksm=f98036dacef7bfcc6e64e46ff4409c0dd4795bd0cf1e99a0701eed65673ec8a22c2b363a3a06&scene=21#wechat_redirect)  
**

![](https://mmbiz.qpic.cn/mmbiz_png/EHgXwoLL1Ugfuzkc9zbLSEjXzCFxbWqXYcxa4mrP4taKQuzezpyOolUwIibXrl8xWk8F1sicNkrniaQ1Bs83HY6kw/640?wx_fmt=png)

点个赞 在看你最好看