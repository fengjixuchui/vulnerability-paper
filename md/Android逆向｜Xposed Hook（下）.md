> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/8qTl1IO1vCR47KITIqi2WA)

本篇是《Android逆向入门教程》的第八章第1.4节，具体课程详情可点击下方图片查看：

[![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/Ov836aiagXu7icia9amB6lib8gRhTV7XELQTFdNVg15fXPGGUSUJjE9kSTIWZvpibdBZXDKQFaRqyfYvVibKtW10YhBA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247485929&idx=1&sn=1b74ef1fc771be6ff32fb56b6ab8f560&chksm=9b3701ddac4088cb2fd25fd7bc3356f7a9710460a804360a955f036b7398e6a3c47c18377541&scene=21#wechat_redirect)

每一章节详细内容及实验材料可通过加入底部免费的【Android逆向成长计划】星球获得！

  

声明：所有实验含部分虚构，纯属技术练习，未对真实环境造成任何影响。也请勿将相关技术用于非法操作，否则责任自负。

  

**0x01 Hook替换函数与函数置空**
----------------------

在我们Hook的时候，常用的回调函数是XC_MethodHook()，用来获取或者修改我们Hook的参数列表。除了这个回调函数外，还有一个XC_MethodReplacement()函数，用来替换要Hook的函数或者将Hook的函数置空。实现代码如下：

```
`package com.xposed;``import android.util.Log;``import de.robv.android.xposed.IXposedHookLoadPackage;``import de.robv.android.xposed.XC_MethodReplacement;``import de.robv.android.xposed.XposedHelpers;``import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;``public class Hook implements IXposedHookLoadPackage {``public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {``if (lpparam.packageName.equals("com.feichen.xposeddemo")){``final Class<?> clazz = XposedHelpers.findClass("com.feichen.xposeddemo.Demo",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz,``"test",``new XC_MethodReplacement(){``@Override``protected Object replaceHookedMethod(MethodHookParam param)``throws Throwable {``Log.d("====================", "replaceHook");``return null;``}``});``}``}``}`
```

日志输出效果图如下：  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

可以发现test()函数已经被我们成功的替换掉，同理当我们什么也不写只返回Null就相当于将Hook的函数置空。

  

**0x02 Hook内部类与匿名类**
--------------------

在Hook的时候，我们经常也会遇到一些内部类以及匿名内部类，我们还是以之前的案例为例进行说明。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

然后编写我们的Hook代码如下：

```
`package com.xposed;``import android.util.Log;``import de.robv.android.xposed.IXposedHookLoadPackage;``import de.robv.android.xposed.XC_MethodReplacement;``import de.robv.android.xposed.XposedHelpers;``import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;``public class Hook implements IXposedHookLoadPackage {``public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {``if (lpparam.packageName.equals("com.feichen.xposeddemo")){``final Class<?> clazz = XposedHelpers.findClass("com.feichen.xposeddemo.Demo$InnerClass",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz,``"innerFunc",``String.class,``new XC_MethodReplacement(){``@Override``protected Object replaceHookedMethod(MethodHookParam param)``throws Throwable {``Log.d("====================", "我是被替换的内部类");``return null;``}``});``final Class<?> clazz1 = XposedHelpers.findClass("com.feichen.xposeddemo.Demo$1",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz1,``"eatFunc",``String.class,``new XC_MethodReplacement(){``@Override``protected Object replaceHookedMethod(MethodHookParam param)``throws Throwable {``Log.d("====================", "我是被替换的匿名内部类");``return null;``}``});``}``}``}`
```

Hook日志如下：  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

我们通过编写的Hook代码可以发现，Hook内部类的字节码为：类路径$类名

Hook匿名内部类的字节码为：类路径$1  类路径$2  类路径$3

  

**0x03 Xposed主动调用**
-------------------

在Hook的时候，我们有时候也是需要对app内部的函数进行主动调用，其中主动调用的函数为XposedHelpers.callMethod(),他的第一个参数为类的实例即clazz.newInstance()，第二个参数是方法名，第三个参数是参数列表，对于没有参数的函数可省略。那我还是以上个案例为例，找到其中的一个未被调用的函数refl（）

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

然后编写Hook代码如下：

```
`package com.xposed;``import android.util.Log;``import de.robv.android.xposed.IXposedHookLoadPackage;``import de.robv.android.xposed.XC_MethodReplacement;``import de.robv.android.xposed.XposedHelpers;``import de.robv.android.xposed.callbacks.XC_LoadPackage.LoadPackageParam;``public class Hook implements IXposedHookLoadPackage {``public void handleLoadPackage(final LoadPackageParam lpparam) throws Throwable {``if (lpparam.packageName.equals("com.feichen.xposeddemo")){``final Class<?> clazz = XposedHelpers.findClass("com.feichen.xposeddemo.Demo$InnerClass",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz,``"innerFunc",``String.class,``new XC_MethodReplacement(){``@Override``protected Object replaceHookedMethod(MethodHookParam param)``throws Throwable {``Log.d("====================", "我是被替换的内部类");``return null;``}``});``final Class<?> clazz1 = XposedHelpers.findClass("com.feichen.xposeddemo.Demo$1",lpparam.classLoader);``XposedHelpers.findAndHookMethod(clazz1,``"eatFunc",``String.class,``new XC_MethodReplacement(){``@Override``protected Object replaceHookedMethod(MethodHookParam param)``throws Throwable {``Log.d("====================", "我是被替换的匿名内部类");``return null;``}``});``//主动调用``final Class<?> clazz2 = XposedHelpers.findClass("com.feichen.xposeddemo.Demo",lpparam.classLoader);``XposedHelpers.callMethod(clazz2.newInstance(),"refl");``}``}``}`
```

运行日志如下：  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

发现已经成功主动调用到该函数。

  

  

团队公开知识库链接：  

https://www.yuque.com/books/share/f7515884-c39f-4d2b-ab15-55921c8205b8?# 《WhITECat公开知识积累》密码：kstn

知识星球：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**往期经典**

  

[Android逆向入门成长计划【免费知识星球+微信交流群】](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247485929&idx=1&sn=1b74ef1fc771be6ff32fb56b6ab8f560&chksm=9b3701ddac4088cb2fd25fd7bc3356f7a9710460a804360a955f036b7398e6a3c47c18377541&scene=21#wechat_redirect)  

[《从入门到秃头之PWN蛇皮走位》](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484643&idx=1&sn=a8effd61504fc574ee7089f9ce8440af&chksm=9b370cd7ac4085c102e5f3ee1bd1fcb6f61fc56559edef3e4eb33d934c499c541d56c87ae7cd&scene=21#wechat_redirect)

[漏洞挖掘｜条件竞争在漏洞挖掘中的妙用](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484441&idx=1&sn=2f24cfe9e648118a4e537c0446e98119&chksm=9b370c2dac40853bf285a7e3fcbb8d83cba2aa34e82d81346af29d38c2855269dbc094aaab1e&scene=21#wechat_redirect)  

[漏洞笔记|记一次与XXE漏洞的爱恨纠缠](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247483808&idx=1&sn=e49283ccb0de1a3b7ac89e9cdb6d0e2f&chksm=9b370994ac4080829721246426d4dee351a4b7bdc2ac737f1f5fe1eb1a69eeb8a1dcaeb50b13&scene=21#wechat_redirect)  

[移动安全-APP渗透进阶之AppCan本地文件解密](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484404&idx=1&sn=184cb740fcdcdccc6f41f81c9abbc008&chksm=9b370bc0ac4082d6ef87004b1ce7e7c5e4d618a8e4696021d805e90a31c6a32b23c4139c5b50&scene=21#wechat_redirect)  

[内网渗透之从信息收集到横向独家姿势总结-linux篇](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484666&idx=1&sn=5b0cf18e99d5e7cb9ff2b4a105251557&chksm=9b370cceac4085d8792838dde9359371751fad09200df6fd7ccf98a3a0230b71dbcd73cc595b&scene=21#wechat_redirect)  

[HVV前奏｜最新版AWVS&Nessus破解及批量脚本分享](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484137&idx=2&sn=286c87de932713c7e0951e9633a9fda9&chksm=9b370addac4083cb868bed7429c420f7feb101abd69550cd8cc4645f31e18b29d5d7f93cb3f7&scene=21#wechat_redirect)  

[Android抓包总结-HTTPS单向认证&双向认证突破](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484224&idx=1&sn=c3af9883d69de8e7c57d9f9503e63685&chksm=9b370b74ac408262fa670b3917250d509f77bd5de87dd4fef463358a6e18f1dcad517280c9bd&scene=21#wechat_redirect)

[图形验证码绕过新姿势之深度学习与burp结合](http://mp.weixin.qq.com/s?__biz=MzAwMzc2MDQ3NQ==&mid=2247484598&idx=1&sn=997f5329edb5ad2850e8e129da32f175&chksm=9b370c82ac4085941fe53b84ec5fa61961cbb4ef406ae2013773d6144a28a665be9f7e80a283&scene=21#wechat_redirect)  

  

安

全

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**扫描二维码 ｜****关注我们**