<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/L6WWJIHMaoz7Ot8IoDlg-A)

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYaz05uLwzia42Rz4MMYDbu6u1qIExIO16jYMzCbJ43u84BUbAUOgFoDA/640?wx_fmt=png)

**前言**  

无论是渗透内网还是外网，信息收集都非常重要，只有探测出目标系统 (操作系统 / Web 程序)、安装程序 / APP 等才有资格去找相应的 EXP 或漏洞工具对目标进行尝试利用，你连目标 IP 都不知道，靠运气一通乱扫描？所有漏洞都扫？人家用的是 MAC 或 LINUX，看到开放 445，你用 MS17010 去打？要搞清楚 MS 是微软的缩写 MS17010 只针对 Windows，LNX 也有 SMB 漏洞但不是这个编号。所以想方设法探测目标机器或收集相关信息非常重要也是第一步该做的事，只有知道存活 IP 才能使用其它工具扫描，或者知道系统信息又可使用更精确的工具去扫是否存在对应漏洞，对于思科设备更是如此，特别是溢出类的 EXP，不知道目标具体版本，可能打过去路由器就崩了，所以探测本很重要，当然有一些型号无法探测，连做了 10 几 20 年的 “某蛋” 等搜索引擎也无法识别，也可采用另一种方法，拿现有 EXP 全打了再说，崩了，顶多就是目标不能上网一会而已嘛，现实中谁上网不经常卡一下，你卡的时候有怀疑过是公司路由器被打了吗？连专门从事安全技术的都不会因为几秒或几分钟的网卡而去查，连 WEB 漏洞这种轻易利用和被发现的都得花点时间排查，如果是溢出类的，特别还是失败的，别人更不好查，一般容易被查都是在马这种有链接。也可以反向思路，假如你是管理员，你负责管理一堆机器，每天上班都是这工作，你去反查，是先查看现成日志，有链接有明显特征的流量，还是去看一条压根不成功，无法确认是用洞打的还是路由自己崩的信息，再说得直接点，TM 有几个管理员懂溢出，有个崩溃日志，他懂个毛，手头里大量明显外连的 IP，他都没有排查完，你还没进去呢，他还花大量时间学溢出，或请人来看一条崩溃日志？你有没想过不只你一个人在打，他管理的机器中也不只一台出现崩溃，所以有时候不要把对方想得太神过头了，没那么夸张，他真的牛到这种地步，你压根就不需要拿 Nday 去尝试了，你都敢拿 Nday 去打，就说明你心里认为他就是个 SB，压根都不打补丁或者不懂，如果非要说他懂，换作你是管理员，一个公开漏洞你懂，你会不补上吗？或者 WAF 规则不加上吗？不要怂，就是干。探测版本的目的是为了更快利用，减少未知版本，需要黑盒测试太多 Nday 所浪费的时间，根据我这几年在项目中遇到的 Cisco 版本，做了几种方法探测工具。因为不同版本开放端口不同、协议不同、就算同协议同端口返回信息也不懂，所以当你学会一种方法，压根就不可能探测全的，刚好探测到，只以说是运气。加上防火墙限制原因，可能只允许某个协议访问，你只会一种，又是不允许通过的，你识别个蛋啊。  

**小结：能识别版本，节省时间，调对应版本漏洞，实在不行直接打，怕个毛**  

**0x001 Snmp 协议**

Snmp 协议，这是一个非常老的协议，有些思科会开启该协议，我们直接通过 UDP 的 161 或 162 端口，就能探测到信息，这个前提是开启 SNMP，并不是说你会了这种方法，所有思科都能探，别高兴得太早了，类似工具在 Ladon 没写之前就已存在 10 几年，只是 Ladon 支持批量探测，同时还支持其它协议探测思科，此模块在 2020 年加入 Ladon，因为在不少大公司都通过 SNMP 监控设备，所以在这种条件下，SNMP 探测不到思科，也能探测到别的机器。  

**详细原理如下 (2 年前的文章)**  

渗透技巧 - Ladon 利用 SNMP 协议探测存活主机 / 操作系统版本原理与实现
===========================================

https://blog.csdn.net/k8gege/article/details/113443768

**SNMP 协议**  
简单网络管理协议 (SNMP) 是专门设计用于在 IP 网络管理网络节点(服务器、工作站、路由器、交换机及 HUBS 等) 的一种标准协议, 它是一种应用层协议。  
基于 SNMP, 进行网络设备监控, 如: 交换机、防火墙、服务器, CPU 等其系统内部信息, 基本都可以监控到。

  
**穿墙探测**  
**赚快钱的方法都写在刑法里，穿墙的协议都写在防火墙里**。Windows 系统默认允许协议 (或者说安装对应角色功能后默认通行的协议)，利用 **SNMP 协议**可探测机器名、操作系统版本、系统位数、多网卡信息 (IP \ 掩码 \ 网关)、进程 (进程名 / PID)、命令行参数、磁盘信息、C 段存活主机 MAC、当前打开目录、窗口标题等越多目标信息

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYSMA6LlTJ7xHM8HxzxngpopKjV4tjmbhxcLU6ediaeYtw50OzTvebACA/640?wx_fmt=png)

Ladon 默认先通过 Ping 探测存活，然后才加载模块对应协议。由于目标禁 ping，实际上是存活的，所以我们使用 noping 参数来探测 Snmp 协议思科存活机器信息，命令 Ladon noping 目标 IP  SnmpScan  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYtkGIglGREhS2U3VYvH6DeXvJZia7ZYLYtOCodwDBcHu7DR5OZyNdCJw/640?wx_fmt=png)

**0x002  Ladon 子模块 CiscoScan** 

Ladon 插件 Cisco 思科设备扫描 (IP、设备型号、主机名、Boot、硬件版本)，基于 http 协议能探测到固件版本，这也是部分版本，如果是其它版本，使用该模块探测不到也正常。
==============================================================================================

https://www.shuzhiduo.com/A/xl56eOk7Jr/（原博客被封这是别人转载的）

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYKaDZV0hMrm1RYldG48R4TZyMmIawnVMQUicEFbBgwybCsf1zRQCz9gQ/640?wx_fmt=png)

**0x003  Ladon 子模块 WhatCMS 指纹识别  
**

该插件基于 HTTP 协议 WEB 特征以及 SSL 证书识别，支持识别国内外常见上百种 CMS、设备、防火墙、CDN 等，也可智能识别一些未知 CMS，最新版 9.2.1 新增以下思科型号识别，包括但不只限于以下版本。有些思科版本依旧无法识别，连做了 10 几 20 年的蚤蛋等搜索引擎也无法识别。

107 Cisco AnyConnect VPN  
108 Cisco-CcspCwmpTcpCR/1.0  
109 Cisco Linksys Smart Wi-Fi  
110 Cisco RV016  
111 Cisco RV180W  
112 Cisco RV180  
113 Cisco RV120  
114 Cisco RV120W  
115 Cisco CVR328W

最新版 批量识别 Cisco 设备 实战效果  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYBZWa6bztJVMNm8ogAVfUM9rFDYttYXC1puefxUTxcdU8p8t247MhBg/640?wx_fmt=png)

**0x004 Ladon 子模块 SSLinfo  
**

**探测原理**  

通过访问 SSL 端口获取 SSL 信息，默认端口为 443，探测过程是一个正常 ssl 的请求服务器，服务器返回证书的过程，因此是不会被 WAF、防火墙、EDR、XDR 等产品拦截或报警。证书里可能会包含设备版本、组织机构、域名、机器名、路由器、CDN 等等信息，当然也相当于变相探测存活主机的方法。

参考文章 [Ladon9.1.7 利用 SSL 证书探测信息](http://mp.weixin.qq.com/s?__biz=Mzg3MTY4NjUyOQ==&mid=2247484266&idx=1&sn=830515cf7edd7d6faf94b9e6c00aa029&chksm=cefb8b84f98c02924396475d94e4410a49c7b7374eef2e96f63bd7a834d2db313befa701beb9&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYcSChdjeO5QjRiaptSz0hyQicViclKhLllgwq3Sy4W6aCbYoam15EsteGQ/640?wx_fmt=png)

对一些旧版思科设备，可直接在证书 OU 字段查看版本如 RV180

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW5JI6G3hbmGywlcDFaqxpO5xjAr59aiaEiaXH2MvhWUn2sqZIBg6YKnyM24M79AyBOcKHKcViasvbY5w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**0x005  Ladon 子模块 OsScan**

该模块只能探测到 Cisco 设备，无法探测型号, 但探测不到版本号，就算不敢使用漏洞打，也不代表不能尝试弱口令啊，因为原理不同，上面未必能探测到 Cisco 设备，实战当然是信息收集得越全越好，除非你运气好，前面模块扫到的直接打到权限了，不然可能你又少了一些可以尝试密码的机器。  
  

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHY6xMJS5GeWm4rNhbxTicTggsMicG1xOmhXhxmgL9geUQHODB1autpwe2A/640?wx_fmt=png)

**0x006  Ladon 子模块 SshScan**

使用该模块可通过 ssh 回显信息识别 Cisco，在目录下放字典文件时，也可以检测弱口令，特别是大型内网，几百台 Cisco，扫到几十台默认密码正常

![](https://mmbiz.qpic.cn/mmbiz_png/ESAML7BuCW7vlya5I77U5txdqwzygaHYCYCibzlVtVEyib8kQPQH10o55NicXc5MqkEmxicWtcasPoYZGPm24k8PAQ/640?wx_fmt=png)

**一些 EXP**

https://github.com/k8gege/ciscoexploit