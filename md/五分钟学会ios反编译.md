<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/qbNNMLkFo3Pqpgr4GbVvWw)

![图片](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxvMzibXUdvEsJgsmtFMRdGdIozdib3BWMEJ7X9FB2yjr1dYc54LU1LJKbIMKicSNknD2LMSpDdjre6w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

破军安全实验室

  

    忆享科技旗下高端的网络安全攻防服务团队.安服内容包括渗透测试、代码审计、应急响应、漏洞研究、威胁情报、安全运维、攻防演练等

  

本文约1700字，阅读约需5分钟。

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/bflrrmuxJYe3obbWEuGLrtO7AuTSaibIyiaC2iaEib3t7AN2kU52FZQYlPM8BWHfMoa4oNd6nPKqPLxJPV5S9Bz2pQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

0x00 前言

  

  

最近对ios反编译很感兴趣，就在业余时间里自己在上网找了各种资料学习，于是有了下面的文章，希望对大家学习有所帮助  

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/bflrrmuxJYe3obbWEuGLrtO7AuTSaibIyiaC2iaEib3t7AN2kU52FZQYlPM8BWHfMoa4oNd6nPKqPLxJPV5S9Bz2pQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

0x01 查看程序是否加壳

  

  

Mac 下通过Appstore安装的程序都存放在/Applications

  

这里以某app为例

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxdRGCnwBzs6AoarPKdWKP5bnq1T4e7thzRp1xBnV1RXDCibPWnG1SjDHNSoKMu0HKETd1mHYDI85g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxdRGCnwBzs6AoarPKdWKP59K7c4p0u4nJibpAUBU3E63s4y0icYc7XeJuUkicuibFJ4s0ry74BjHgc7A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  
  

找到可执行文件

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxdRGCnwBzs6AoarPKdWKP5s9SRsK1Vr9iawDGkjEXsM4niaNxvstnFEDrGF9ia26TRDz82Jxhs2AHUA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  
  

使用mac自带的otool命令

```
otool -l Panda |grep crypt
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

Cryptid 等于1 表示加密过的，需要解密后才能使用class-dump反编译

  

Cryptid 等于0 则可以直接使用class-dump反编译

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

0x02 脱壳

  

```
https://github.com/AloneMonkey/frida-ios-dump
```

苹果手机通过数据线连接Mac，期间数据线不能断，使用爱思助手越狱后，在爱思助手打开ssh通道

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

   

下载frida ，注意手机端的和Mac端的必须版本一致，不然会有一堆解决不了的bug

```
https://github.com/frida/frida/releases?page=9
```

  

如下，这里建议就选择我的这个版本，我试了很多版本，不是Mac端安装了没法使用frida，就是手机端的ios版本太低，导致dpkg装不上对应的deb包。然后需要更新dpkg等一系列问题

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

通过Scp命令的方式，将下载的deb包发送给手机

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

然后ssh到手机

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

使用dpkg -i xxx.deb命令，即可在手机上安装上frida

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

安装好了之后会自动运行frida-server

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

Mac安装pip3依赖  

注意将requirements.txt的frida-tools删掉，我们手动装对应版本

pip3 install frida-tools==8.1.3

  

```
pip3 install -r requirements.txt
```

   

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

使用frida-ls-devices命令查看电脑连接的iOS设备信息

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

使用frida-ps -Ua命令，能有回显，证明github项目的frida-ios-dump可以使用

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

   

手机端运行对应的软件，这里我拿的TikTok举例子

手机端运行TikTok程序，然后Mac端就可以通过frida-ps -Ua查看到对应的程序

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

这样便将TikTok的壳给脱了

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

0x03获取ipa文件源码

  

  

这里拿某个ipa举例子

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  
  

重命名为rar，解压，得到payload文件夹  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  
  

进入Payload文件夹，该文件夹下的文件就是所有资源文件  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  
  

重命名该文件，去掉隐藏的后缀.app即可

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

打开该文件里面就是我们需要的东西了

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

FTPhoneXXX为我们需要反编译的文件，可以获得头文件

两个db是sqlite文件，可以打开

  

在该目录搜索文件敏感内容

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  
  

比较需要关注的就是Info.plist这个文件，里面的配置比较多  

Api和key也比较多

  

将FTPhoneXXX放到class-dump项目里

```
https://github.com/nygard/class-dump/
```

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

使用命令：

```
./class-dump -H FTPhoneXXX.app -o XXX_pojie
```

将反编译后的文件输出到目录XXX_pojie里

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  
  

如果出现这样的错误，说明项目是Swift-OC混编的。而class-dump没法用于swift语言的App，此时只能使用IDA静态查看了。  

对于Swift-OC混编的App，需要选择针对swift定制版的class-dump

项目地址：

```
https://github.com/AloneMonkey/MonkeyDev
```

  

将FTPhoneXXX复制到/MonkeyDev/bin

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

执行命令：

```
./class-dump -H FTPhoneXXX.app -o XXX_pojie
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

反编译完成

  

 声明

    由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，破军安全实验室及文章作者不为此承担任何责任。

    破军安全实验室拥有对此文章的修改和解释权。如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经破军安全实验室允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

破军安全实验室

# 长按二维码 关注我们 #