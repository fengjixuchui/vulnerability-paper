<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/rgiQgkvt_vXTzOJmjhk5Vw)

********点击关注公众号，知识干货****及时送达********_************👇************_

_****Part.1 ActiveMQ 简介****_

Apache 的一款 JAVA 开源消息中间件，支持 Java 消息服务、集群、SpringFrameword 等。属于消息队列组件。（消息队列组件：分布式系统中的重要组件，主要解决应用耦合、异步消息、流量削峰等）

_**Part.2 漏洞描述**_

该漏洞出现在 fileserver 应用中, 漏洞原理:ActiveMQ 中的 fileserver 服务允许用户通过 HTTP PUT 方法上传文件到指定目录。Fileserver 支持写入文件 (不解析 jsp), 但是支持移动文件 (Move) 我们可以将 jsp 的文件 PUT 到 Fileserver 下, 然后再通过 Move 指令移动到可执行目录下访问。

_**Part.3 利用方法**_

1、写入 webshell

2、写入 cron 或 ssh key 等文件

3、写入 jar 或 jetty.xml 等库和配置文件

写入 webshell 的好处是，门槛低更方便，但前面也说了 fileserver 不解析 jsp，admin 和 api 两个应用都需要登录才能访问，所以有点鸡肋；写入 cron 或 ssh key，好处是直接反弹拿 shell，也比较方便，缺点是需要 root 权限；写入 jar，稍微麻烦点（需要 jar 的后门），写入 xml 配置文件，这个方法比较靠谱，但有个鸡肋点是：我们需要知道 activemq 的绝对路径。

_**Part.4 实战过程**_

通过信息收集，找到一个使用 ActiveMQ 中间件的网站

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9VIIwPPfMKWGibOlgPBCncrAInhOWc6tgoeHdmQibUibxFcR1xUKtjdHHNA/640?wx_fmt=png)

存在弱口令，账号密码都是 admin

根据前面所讲的，先爆出路径

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9V0AKO3rwE8hOaOs0Enicwob58f2ciaH8Uv39L0tVa9bm1XPicxZF1kyvSQ/640?wx_fmt=png)

然后 PUT 一个 JSP 一句话上去

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9VmFjy5v98ESwmj7jRZX1WjTgypjVdTTIdyWoaRYwYJsL0DNejYP58Jw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9VsRGJzfcedJ16kcbgSnygqiaibl9MdD9aDdcYn2WRhVxyPpLD1hUSnUiaQ/640?wx_fmt=png)

然后将 put 得 txt 一句话 move 成 jsp 格式 上传到 api 目录下

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9VlmVNz8Ebn24icAyppa8P1hA6OIvJnZDwXiczsw94asav9TEyOTvzsscQ/640?wx_fmt=png)

访问 WEBSHELL 并执行命令，可成功执行

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9VkibBlXjwrrclFhgIzFSkaRTbic5cYiaxWh6diaOvMsiaEnGFyqd8wOic6xQA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9VyEIfF1pLibYPZ345Nq9Q91Kr4vmAdvQuHjqdiaicrzOCpuqT8FZz5sv1w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7DjZohx9gzyqdJol3Kb8V0Xq4KuOGG9V4NMbibNJ7k2QCBcfltOIew7m7tAuwfudKacaYa9d5Du4bChWPhgA0tA/640?wx_fmt=png)

_**Part.6 小结**_

平时在挖 SRC 的时候，一定要熟练掌握各种基础漏洞，多多尝试，会有意想不到的成果。  

- End -

点击下方名片，关注我们

觉得内容不错，就点下 “**赞**” 和 “**在看**”

如果不想错过新的内容推送，可以设为**星标**![](https://mmbiz.qpic.cn/mmbiz_png/Yv6ic9zgr5hTYyCkc91euAiaGULJSbiaHricFHs2dd2sib20WTJKwHYD90Jia9HCKxnmJUwnkicGU7rVP3EYCVh3dMnng/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)哦