> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/1akn2rOob7N51_eQjAPwvw)

**0x01 前言**  

Tomcat 的历史漏洞还是有这么多的，其中最常用的就是部署 war 包 getshell 了，但难免会遇到部署失败的情况，粗鲁地猜测可能有两个原因：

1. 直接木马转 war 包部署被拦截，而普通文本转 war 包部署可正常访问，可能是安全防护设备在作妖，那就只能试试常规绕过；

2. 目标网站是低版本 Tomcat，攻防演练期间遇到很多低版本 Tomcat 网站，常规部署木马 war 包有时候会失效，最后通过部署 axis2，然后在 axis2 中上传木马 war 包，则成功 getshell。

本文呢，主要就是针对 axis2 进行 getshell，详细操作如下。

**0x02 环境搭建**

```
本次实验的环境
Tomcat 6.0.36
Jdk1.8.0_202

```

### **部署** **T****omcat** **6.0.36**

没有找到现成的环境，自己搭建了一套。

官网下载 Tomcat 6.0.36  

```
https://archive.apache.org/dist/tomcat/tomcat-6/v6.0.36/bin/

```

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9mCCC1sIPxS2MXmY9YX72l1tV8OnFicgBTsp5xhahbTj3tibbSciceg4Mw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9fR56L3bmD6HnBDOyrlwuH3pUjJtaB1SfvWvDy0dqhibFuggdb0pBznw/640?wx_fmt=png)

### **修改 tomcat 的用户设置**

修改 tomcat-users.xml 文件，不修改则无法访问 manager：  

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9nk9kqkeMEf4HMiaOXx2icOT3kTxLAATD9QaC4oibSwGFMjHdf4rlsePnA/640?wx_fmt=png)

添加内容如下：  

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9CdUFVVA9WCyZmiaKRv1rPnMkFt8iaR5xRwylaibaTvgKViahJRU7s9W0wA/640?wx_fmt=png)

### **环境启动**

首先进入 Tomcat 目录的 bin 目录，先添加权限

```
chmod +x ./*.sh

```

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9gaWp8FeW0sLKibGwhF7fE2wOdqdiaLYBlW8ny0PCbBYWmY0D4rWffticg/640?wx_fmt=png)

启动 Tomcat：  

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW99bibZibHStKDuaoVqN3eOBRBla0zXCwmzgMPIuFia92lkulHP3WJ8wwSA/640?wx_fmt=png)

获取地址：

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9ja0EWoZXO15LetxHsuZB2IhiaxRcGUwHfsVBD4AmSgJ2zibnXvxGM6Fg/640?wx_fmt=png)

访问 http://192.168.57.130:8080/manager/html  

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9nTXmOyJyoqdRxhndaRsxiajVBfX9iciblAkehcr0TkEI9GticS5YEjx33Q/640?wx_fmt=png)

**0x03 利用 axis2 进行 getshell**

### **部署 axis2**

```
下载地址：http://archive.apache.org/dist/axis/axis2/java/core/1.6.2/

```

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9kmFHqNZjY71jib7R5rQjm1hclzOpmrs2iaiatufzA1N3ZpVxhervJqibMw/640?wx_fmt=png)

直接在 Tomcat 页面进行上传部署：

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9iakWAYZy5OiaibVvCbxS4o5foxH9sFG7UwcYbawXySyWicib9DSboejcdew/640?wx_fmt=png)

部署成功

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9VzmMXsF6hUjsAQXm8ibhL6ocU19ZatqgyzMc6sGx04patxtiaQ8RiaFrQ/640?wx_fmt=png)

### **利用 axis2 部署木马**

首先登录 axis2 管理端：  

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW96M50EUacicWRQsX1l8SxB95PAdFrq5ubjmsXicfNxoSCvVDvEPia5D0Ww/640?wx_fmt=png)

账号密码来自 axis2.war 里面的 WEB-INF/conf.axis2.xml

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9IiaQdqicA7j5VU5AcoTeoJtJkr7tcCkShHUShZH3u5HkS2Yb2npLT9TA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9Bu5bfVW2my0ib46ibr5fI2Pv6abwaU4iakiaIVdqFDjm3mJwR9ntAYum7A/640?wx_fmt=png)

登录进去之后选择 Upload Service 部署 Axis2Shell

```
https://github.com/Svti/Axis2Shell

```

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9oCicy8FiasuxgcgtfPtAvI84y02uyXgs8O42Ifl7yLmARvmhYcSzNtNw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9twPsdKTaKzet96TBibBlomm0JBDsOqhuLibK1j8Kfia5khicV6mkMHt3KQ/640?wx_fmt=png)

部署成功后就可以进行命令执行

访问 http://192.168.57.130:8080/axis2/services/config/exec?cmd=whoami

可以看到命令执行成功

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9SFeYpCibRcONN6uumejdyXz5w3HOrib4ZZ6gOGoj8v6xUQ6kUMuJNMuA/640?wx_fmt=png)

获取当前项目所在路径（后面上冰蝎马需要用到）

```
http://192.168.57.130:8080/axis2/services/config/getClassPath

```

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9fwR6uz9IDRicIWZSKCIia0GUja7HYnIRicrI5Eqnaht2DKSicazlV2l4icQ/640?wx_fmt=png)

### **如何写入冰蝎马**

将 config.aar 里面的 resource 下的 one.txt 的内容改为冰蝎马的内容：

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9hjTok2lnPL1oQnq8XjS9ic97p2cYkUo7OllczyrRk5KiaaHh6FuTh2gQ/640?wx_fmt=png)

然后使用 Axis2Shell 将 one.txt 部署到指定文件夹下，path 可以通过 / services/config/getClassPath 获取

我这里直接将其部署到 tomcat 的 ROOT 目录下

利用如下命令将 config.aar 中的 one.txt 写到指定的 jsp 文件里

http://192.168.57.130:8080/axis2/services/config/upload?path=/home/kali/Desktop/test/apache-tomcat-6.0.36/webapps/ROOT/shell.jsp

上传成功

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW97VQVibakPqk1SUTtNSNfuYmHmb2ObBU5ucsCFrl7m8QnicdIReVCqDUA/640?wx_fmt=png)

成功冰蝎连接：

![](https://mmbiz.qpic.cn/mmbiz_png/5icW96HKeciaq0GiaTyZwF90XuD7gUZOCW9KyX1CDXwzQjCAadSAo4otwwko4ImVojBBnnOSt3PDrZKkcV7WJjwFw/640?wx_fmt=png)

END

往期回顾

  

[](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484445&idx=1&sn=78da18444b38922f842c57f0046e64c8&chksm=c07b405ff70cc9497576d4b86ae2264f4280d3f13610028ae26a4ecf245ef45375c4de61f981&scene=21#wechat_redirect)[漏洞分析 |【原创】Apusic 应用服务器未授权目录遍历漏洞分析 (附利用方法)](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485332&idx=1&sn=3df57185e16d407353fa86c3115ac552&chksm=c07b43d6f70ccac0913e6744d62692c846cbefc9519a7d72582513f39a25e4e753de6d6af56c&scene=21#wechat_redirect)

[漏洞分析 |【原创】Nacos 历史 + 最新漏洞详细分析 (附利用方法)](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485330&idx=1&sn=cdd36a0fb30ea1eaacb87b255a170490&chksm=c07b43d0f70ccac62ed995018b17f06e70cdbe1ea351c82f3906179d4dc3f657ef512598543a&scene=21#wechat_redirect)  

[技术分享 | JS 断点调试教学](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484445&idx=1&sn=78da18444b38922f842c57f0046e64c8&chksm=c07b405ff70cc9497576d4b86ae2264f4280d3f13610028ae26a4ecf245ef45375c4de61f981&scene=21#wechat_redirect)

[技术分享 | 搜索框之 % 的妙用](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485114&idx=1&sn=7ea2f21ec5c61cd5af8f4f2a272b11f9&chksm=c07b42f8f70ccbeebf1a599203bc5b87e8216acb39f94ab11ead9ab54184791510d1c6d1e245&scene=21#wechat_redirect)

[实战 | 对某授权学校的常规渗透](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247483787&idx=1&sn=d8d511ab73c62fecbca898f4c41e546c&chksm=c07b45c9f70cccdfdae606543a576984c7cf43ebaf8422df8e3fd586655b882e29fe60a8bccd&scene=21#wechat_redirect)

[实战 | 一次另类的 mssql 渗透之路](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485090&idx=1&sn=aaee13ec3f68afd30b64c60fb74de8b8&chksm=c07b42e0f70ccbf68c4931c370e336637a7a6e13a9a42cefd97d07409384586d0b234c813a88&scene=21#wechat_redirect)

[实战 | 一次没有逗号的 MSSQL 注入](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485185&idx=1&sn=895ee6b7610b6f32be7086b527666cc1&chksm=c07b4343f70cca55a24236018deda9cfad47cc9ad950b79c488d4fc3d2460e341fd24a8f7157&scene=21#wechat_redirect)

[技术分享 | ChatGPT 渗透教学（一）](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484977&idx=1&sn=994176944e557202f1171a352446be2c&chksm=c07b4273f70ccb65dae772bb96c9942c59c6f021f995acf2591b763fa9d563dbea4014986039&scene=21#wechat_redirect)

[实战 | host 碰撞之边界突破 getshell](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247483859&idx=1&sn=905977c98c278ce23058b4b2c2cec951&chksm=c07b4591f70ccc8786c41af1b2bed0f777aaa57fe7407b4d9615eebbbb3c86579e2f987b5fc8&scene=21#wechat_redirect)

[技术分享 | web 站点登录框的常规突破](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484696&idx=1&sn=ef36957bd0e4b00cf5e341a7a74d06a3&chksm=c07b415af70cc84c5e30113fd4e7edf350401725856ef37345c955bf73f2f4e62dd74c71cc8c&scene=21#wechat_redirect)

[权限提升 | DirtyPipe - 脏管道内核提权](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485165&idx=1&sn=81c53eac841e98823bf577dca8abcf8a&chksm=c07b42aff70ccbb965d66235a8c489488ce947f3eff2f8463f9a93bf6cdec326ec963b9cc57d&scene=21#wechat_redirect)

[免杀 | 初学者的 mimikatz 免杀制作教程](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484585&idx=1&sn=7551abe6ec57ec41615b6f3d5bdbbed3&chksm=c07b40ebf70cc9fd79a0f0c23c682d5c4f9fd9dae638584ff75fd61d9867b4b212101cd14c73&scene=21#wechat_redirect)

[技术分享 | 另类的 XSS 攻击之新型 XSS 载体](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484841&idx=1&sn=b26dabac5e770bbd7b1331fda1a55fbd&chksm=c07b41ebf70cc8fda9501464c3401eb9920424354f1d47a15c4ca06f45876fcc76727296129d&scene=21#wechat_redirect)

[安全工具 | xray windows 1.9x 版通杀补丁](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247483680&idx=1&sn=533ec7a01f23b787140c4ed5d8b3d096&chksm=c07b4562f70ccc74dd692b604e7913a5d403e9e4dee2e7836e101b9023d1c36c959e21f506a2&scene=21#wechat_redirect)

[安全工具 | 新型目录碰撞工具 DirCollision](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247483860&idx=1&sn=feeeb8a332cbd808378b529c7a4461cb&chksm=c07b4596f70ccc80f5b1a477e43c2068745c9c2add75e7864b213db59b878f6e7b1dd33fd20f&scene=21#wechat_redirect)

[技术分享 | web 登录框密码加密的突破小秘密](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484638&idx=1&sn=432a65116ced1190672f7691f14c4d87&chksm=c07b409cf70cc98aacdfc49dae64bb1b5768a2346b915f7b4e75e1dcdb32d1b0d56066641180&scene=21#wechat_redirect)  

[权限维持 | Windows 快捷方式权限维持与后门](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485200&idx=1&sn=f8b01f78def1a3504833965f2283fcd2&chksm=c07b4352f70cca4435c25e2f1423e0c6c3589f5cd2fc5883ad25cb9b4da7e584e4bd45930f4f&scene=21#wechat_redirect)

[技术分享 | ChatGPT 在红蓝队中的利用姿势 (二)](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485015&idx=1&sn=c9489f4dd9e5bbba2d127584b394dbde&chksm=c07b4215f70ccb037f0b9f77eb2844734496ba25b3dff6af885bb8086c1f2bfee1ef4af3afcb&scene=21#wechat_redirect)

[实用工具 | ChatGPT 大师 V1.0 免注册中文复刻版](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485120&idx=1&sn=71bdb30ccc08c1a90e3a3c5596199294&chksm=c07b4282f70ccb9481f5bce72199305e8b50a9b4894bec4c491f846274d6cf5ba02f64734abb&scene=21#wechat_redirect)

[技术分享 | spring-security 三种情况下的认证绕过](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485128&idx=1&sn=00ec04aefba51abcc5ff787499079722&chksm=c07b428af70ccb9c8375268d00d5fa307ce10943f050bb501566937f0398a1bbbcbc207510c8&scene=21#wechat_redirect)  

[技术分享 | 另类的 SSRF 漏洞的挖掘与利用，绝对另类哦！](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484749&idx=1&sn=b6e183851754e7dfbfe4c2cc829cfa63&chksm=c07b410ff70cc819841b0694e143543d9dc0e4c9ab1b186c53e0ee307898a74008e2fb11ddad&scene=21#wechat_redirect)

[文档干货 | 密码测评相关概念及国标文档和行标文档分享](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247483976&idx=1&sn=f50c2b4183bf61c6b4298a28ecc6e8d7&chksm=c07b460af70ccf1cb82b212b1c25c4dcc50ed384141e3b3b46034440b15739b1caad77d7b28e&scene=21#wechat_redirect)

[实用工具 | ChatGPT Tools，无需登录网址即可直接使用](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485055&idx=1&sn=84e8e30c086c478638d0bf1695e6d71c&chksm=c07b423df70ccb2b63fef9d51cd7906f8002688a6a2631ce17064a8eb880714ec1932cca9f3f&scene=21#wechat_redirect)

[权限提升 | Linux 本地提权 sudo(CVE-2021-3156) 漏洞复现](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485201&idx=1&sn=8144629d1685f4d6519b8a7bacdbd4b9&chksm=c07b4353f70cca45f13ea4a03a0636738904c4f57139767a4df016ae20f6f4ed975e8ef6feac&scene=21#wechat_redirect)

[技术分享 | 如何利用 HTTP 头部注入漏洞赚取 12500 美元的赏金](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484888&idx=1&sn=6f13af6bdccc6083418ea37c8f3fb3f4&chksm=c07b419af70cc88c432e687979ac95ac9061c545a2221ec2f22d4574618dc7ac8c0a419f6fa0&scene=21#wechat_redirect)

[技术分享 | Windows 文件 / 文件夹隐藏技巧，无需借助三方软件](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485035&idx=1&sn=b0a75ee79d31949d7d1665e846fb35c9&chksm=c07b4229f70ccb3f5c5828bebf8152dde198481c413c5dc7a8a98a88406ae45e92d12a2aaaf0&scene=21#wechat_redirect)

[技术分享 | 利用子域接管漏洞赚取 2000 美金，子域接管漏洞讲解！](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247485141&idx=1&sn=56fc9882f11d11ae475a6957c75d4dc2&chksm=c07b4297f70ccb81210552f43294630210381c03b8434abb10c8f7c3d91c82ef1d03bba4ebd5&scene=21#wechat_redirect)  

[漏洞分析 | (CVE-2021-4206)QEMU QXL 整数溢出导致堆溢出漏洞](http://mp.weixin.qq.com/s?__biz=Mzg5Njg5ODM0OQ==&mid=2247484793&idx=1&sn=1e812cd70aac173e002b2d739c3c9f6c&chksm=c07b413bf70cc82d1ec68780d7c08de6baeaad84b81a2d52fa28a1d186556275e53361f3394e&scene=21#wechat_redirect)

<table><tbody><tr><td width="558" valign="top"><h1 data-selectable-paragraph="" id="sr-toc-6"><strong>免责声明：</strong>文章中涉及的程序 (方法) 可能带有攻击性，仅供安全研究与教学之用，读者将其信息做其他用途，由读者承担全部法律及连带责任，文章作者和本公众号不承担任何法律及连带责任，望周知！！！</h1></td></tr></tbody></table>

点赞是鼓励 在看是认同 分享是传递知识

**看完点个** **“在看”** **![](https://mmbiz.qpic.cn/mmbiz_gif/8gt9uOic7ib7Puxs35EZDJOvFZ9Mq3IictsibD3HNIwVics6uoEbOkGAsBB3sKlwxYUT6BiaibwZ0NRMWHM7u6jMNROVA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1) 分享给更多人![](https://mmbiz.qpic.cn/mmbiz_gif/WvOwYJPuJLcBglNp6W9DN3Hibico0cg75E2jukNE8PiamQzSPjdRPbPicnFHjGRW3VUZajianYDCaFiaicoTCQibgex5wg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**