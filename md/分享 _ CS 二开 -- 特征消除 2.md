<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/nqM5OLTwmAEPpyNezhKokA)

cobaltstrike4.5 特征消除 2

修改了内置 stage 的配置，实现硬性特征消除

修改部分 payload，实现基本免杀

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmjw8VHpUOjXicjRicBlQjfqf9ibUye6RZPcR72nuibDWgMdt89Bp5ubaclFQIaibaV9xWEIZib2SeWKPNTA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

修改 checksum8 判等参数

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmjw8VHpUOjXicjRicBlQjfqf9uemo7QXq5aJ07hFClS20er6ibNkjFNsGNamjpulVcwVYCRWWZII5hGQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)  

```
public static long checksum8(String text) {
if (text.length() < 4) {
return 0L;
}
text = text.replace("/", "");
long sum = 0L;
for (int x = 0; x < text.length(); ++x) {
sum += text.charAt(x);
}
return sum ;
}

```

修改随机生成算法  

写入方法, 传值

```
   public static void main(String []args) {
        String key = "0797809e694f99998172aec328c672f26eea6a664.cs";
        long flag = checksum8(key);
        System.out.println(flag);
    \}\}

```

```
public static boolean isStager(String uri) {
   return checksum8(uri) == ****;

```

修改传值

修改 common/CommonUtils 的

```
public static String MSFURI(final int n) {
final String[] array = toArray("a, b, c, d, e, f, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9");
StringBuffer sb;
do {
sb = new StringBuffer(n + 1);
sb.append("/");
for (int i = 0; i < n; ++i) {
sb.append(pick(array));
}
} while (checksum8(sb.toString()) != ****);
return

```

```
public static String MSFURI_X64() {
final String[] array = toArray("a, b, c, d, e, f, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9");
String string;
do {
string = "/" + pick(array) + pick(array) + pick(array) + pick(array);
} while (checksum8(string) != ****);

```

修改 return 的结果和判等结果

简单免杀

修改

/aggressor/dialogs/PayloadGeneratorDialog.java

encoders/Transforms.java

自定义加载器

```
#include <windows.h>
#include <stdio.h>
unsigned char buf[] ="";
void main(){   
   ***
}

```

重新打包跑就行了

关于 beacon 的部分不方便多说，就没写到这里

后续看看要不要公开吧

文章来源：冰棱安全团队

如有侵权，请联系删除

**推荐阅读**

[实战 | 记一次奇妙的文件上传 getshell](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495718&idx=1&sn=e25bcb693e5a50988f4a7ccd4552c2e2&chksm=c04d7718f73afe0e282c778af8587446ff48cd88422701126b0b21fa7f5027c3cde89e0c3d6d&scene=21#wechat_redirect)  

[「 超详细 | 分享 」手把手教你如何进行内网渗透](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495694&idx=1&sn=502c812024302566881bad63e01e98cb&chksm=c04d7730f73afe267fd4ef57fb3c74416b20db0ba8e6b03f0c1fd7785348860ccafc15404f24&scene=21#wechat_redirect)  

[神兵利器 | siusiu - 渗透工具管理套件](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495385&idx=1&sn=4d2d8456c27e058a30b147cb7ed51ab1&chksm=c04d69e7f73ae0f11b382cddddb4a07828524a53c0c2987d572967371470a48ad82ae96e7eb1&scene=21#wechat_redirect)  

[一款功能全面的 XSS 扫描器](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495361&idx=1&sn=26077792908952c6279deeb2a19ebe37&chksm=c04d69fff73ae0e9f2e03dd8e347f35d660a7fd3d51b0f5e45c8c64afc90c0ee34c4251f9c80&scene=21#wechat_redirect)  

[实战 | 一次利用哥斯拉马绕过宝塔 waf](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495331&idx=1&sn=94b63a0ec82de62191f0911a39b63b7a&chksm=c04d699df73ae08b946e4cf53ceea1bc7591dad0ce18a7ccffed33aa52adccb18b4b1aa78f4c&scene=21#wechat_redirect)  

[BurpCrypto: 万能网站密码爆破测试工具](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495253&idx=1&sn=d4c46484a44892ef7235342d2763e6be&chksm=c04d696bf73ae07d0c16cff3317f6eb847df2251a9f2332bbe7de56cb92da53b206cd4100210&scene=21#wechat_redirect)  

[快速筛选真实 IP 并整理为 C 段 -- 棱眼](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495199&idx=1&sn=74c00ba76f4f6726107e2820daf7817a&chksm=c04d6921f73ae037efe92e051ac3978068d29e76b09cf5b0b501452693984f96baa9436457e4&scene=21#wechat_redirect)  

[自动探测端口顺便爆破工具 t14m4t](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495141&idx=1&sn=084e8231c0495e91d1bd841e3f43b61c&chksm=c04d6adbf73ae3cdbb0a4cc754f78228772d6899b94d0ea6bb735b4b5ca03c51e7715b43d0af&scene=21#wechat_redirect)  

[渗透工具｜无状态子域名爆破工具（1 秒扫 160 万个子域）](http://mp.weixin.qq.com/s?__biz=Mzg5OTY2NjUxMw==&mid=2247495099&idx=1&sn=385764328aff5ec49acddab380721af0&chksm=c04d6a85f73ae393ffab22021839f5baec3802d495c34fb364cbdd9b7cb0cf642851e9527ba7&scene=21#wechat_redirect)

**查看更多精彩内容，还请关注****橘猫学安全：**

**每日坚持学习与分享，觉得文章对你有帮助可在底部给点个 “****再看”**