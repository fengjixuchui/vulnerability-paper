> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/vKXLmfs4DHhy6WvpVnwnrw)

mvn 命令打包 IDEA 图形化打包 maven 项目 IDEA 调试 yso 项目参考链接

mvn 命令打包
--------

项目地址：https://github.com/frohoff/ysoserial

```
git clone https://github.com/frohoff/ysoserial.git

```

适用 maven 在命令行下打包：

```
mvn clean package -DskipTests

```

开始下载相关的 maven 库依赖，并且在 target 目录下构建成 jar 包。

出现如下提示即为打包成功：

```
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 54.956 s
[INFO] Finished at: 2021-09-18T19:09:37+08:00
[INFO] ------------------------------------------------------------------------

```

IDEA 图形化打包 maven 项目
-------------------

用 IDEA 打开 ysoserial 项目目录。

先点击`skip test`这个按钮，打包的时候就会跳过测试模块，再点击运行即可打包成功。

![](https://mmbiz.qpic.cn/mmbiz_png/ibq2PfPib58XVgibfKdr5KZkrFRdPKNib4ESkw0RwarucfgEfuWKrxOXBDOu2mcPEMnRQgQHxF1Q1ibN8Q4UDu2lyjQ/640?wx_fmt=png)

实际就等于以下这条命令：

```
mvn clean package -DskipTests

```

IDEA 调试 yso 项目
--------------

学习 java 反序列化必然要弄清楚各个反序列化链的生成原理，而调试 yso 项目可以很方便分析具体的反序列化链的生成过程。

IDEA 导入 yso 项目，下载好相关 maven 依赖后，整个项目就能运行了。

首先定位整个项目的入口，`maven-assembly-plugin`是一个用来打包项目的插件，可以把依赖、类文件等都打包在一起。这里的 mainClass 的值是 ysoserial.GeneratePayload ，这个就是主类，也就是入口函数：

可以在`pom.xml`文件中看到：

![](https://mmbiz.qpic.cn/mmbiz_png/ibq2PfPib58XVgibfKdr5KZkrFRdPKNib4ESKJ0ibU3PCXnehbVjBV5SuQZEWWNaRI1GvAcCk1JodFwAic9GkiaKVTcpQ/640?wx_fmt=png)

我们需要配置相关的启动选项（`Run/Debug Configurations`），可以直接点击`GeneratePayload.main()`函数旁边的绿色运行按钮：

![](https://mmbiz.qpic.cn/mmbiz_png/ibq2PfPib58XVgibfKdr5KZkrFRdPKNib4EStljUDZFm2FMLID3Q4GMlblk0SugULG2jK5kFsJuTNjW8ic9TGJE74sQ/640?wx_fmt=png)

就可以生成一个叫`GeneratePayload`的运行配置，运行生成具体的反序列化 payload 还需要其他参数，这里我以 cc2 为例，命令为`whoami`

![](https://mmbiz.qpic.cn/mmbiz_png/ibq2PfPib58XVgibfKdr5KZkrFRdPKNib4ESDia3cK7X9fh7Y6FY28YtibGVZwAwG2JDbCoIGgLcJE5ygSOoYBNfEXoQ/640?wx_fmt=png)

点击运行，就会输出相关 payload：

![](https://mmbiz.qpic.cn/mmbiz_png/ibq2PfPib58XVgibfKdr5KZkrFRdPKNib4EStotHqyEkNWWIic4I2SRWKzsauyTeXzhXJaV8KdTxou4NMbpv67vpicrQ/640?wx_fmt=png)

在`CommonsCollections2.getObject()`函数里面下断点，点击调试按钮，就能进行调试了。

调试任何 Java 的项目其实都大同小异，找主类，然后设置运行的参数，点击 debug 的按钮，调试就开始了。

参考链接
----

ysoserial 笔记

java 使用 idea 调试 ysoserial