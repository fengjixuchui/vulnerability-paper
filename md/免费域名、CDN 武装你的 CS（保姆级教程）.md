<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/TARe1HyRltoIKSJ0-1gaIQ)

‍  

首先申请域名、cdn

免费域名网站：https://my.freenom.com/

免费 cdn 网站：https://dash.cloudflare.com/

一、先申请一个免费的域名，我这里搜索的是 loaclhost.cf ，此时要先把你的代理切换成美国。

![](https://mmbiz.qpic.cn/mmbiz_png/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViau3gRv6v1Jkwtianqiavb4yfCUPyK88tlzFjD9Bz7oASg0SyVELSeLwQQ/640?wx_fmt=png)

点击完成之后，会进入到购物车，然后选择需要申请使用的时间。（12 个月免费，1 年就要收费搞不懂）

![](https://mmbiz.qpic.cn/mmbiz_png/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaQIhUNmxvMTZqGfmm4nepUzhPmNQgdibIfkQESjYqfJZu6AciaFQG5MlQ/640?wx_fmt=png)

然后会让你登录注册，选择 google 账号登录（也可以用 facebook 登录）。

![](https://mmbiz.qpic.cn/mmbiz_png/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJVia5rqAwrQujMhHIYqv8YKrKnTY4hia6B5jnBThllfu7YmYnuZVQ1XSMGA/640?wx_fmt=png)

登录之后需要去购物车记住你当前外网的 IP，这个很重要。

![](https://mmbiz.qpic.cn/mmbiz_png/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaGXk1ictQ6J3dBUIrxXrKBKsM0xdtPP8p7FARIniaOwc4td8Ticjp3Tfwg/640?wx_fmt=png)

然后查询这个 IP 位置

![](https://mmbiz.qpic.cn/mmbiz_png/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaa4CwUraVykfBPAInGVLEiaOQ3rPZATPUriaAicaJ7xSRxe1zpx83GDfJQ/640?wx_fmt=png)

cip.cc 使用平台查询你得 IP 位置

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJVia0pOweXYyF2sNLSnOkHicdHY2eqNtrxv9DRrsrh4tDriaowppuzLeoibMw/640?wx_fmt=jpeg)

去修改你个人信息，个人信息可以随便填写，只要手机号、地址不要瞎填写就好了；地址填写你刚刚查询自己代理 IP 位置，不然之后的域名会申请失败。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaQvoEt0XkTD7M5m55ynibBib80vrP9VVMTSBwjricOEUj1tZ8Y8x57Em0A/640?wx_fmt=jpeg)

填写好自己的地址（代理 IP 的地址），后需要重新搜索域名，从头来一遍，加入到自己的购物车。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViawwGLVxEyqSoccn8L9pxjf2Zol2FzqJB0JhYhicia1916TqEFd2QNGCxA/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaic80Ia1ibzJD9alre2kQNB2kfTsicHVF4uaNDV1bGYPZibjwf1Fhibm6Zhg/640?wx_fmt=jpeg)

注：如果出现这个告警说明，注册失败，是因为你的个人信息地址与 IP 定位地址不一致，修改成 IP 定位地址就好了（需要重新将域名加到购物城重新提交一次）

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaTNdOJK9Nndraibqkl9t1nOTYwxiaVZyRSAEbSACXoqMa9ul7ylXiaOPcA/640?wx_fmt=jpeg)

购买成功之后，选择 Services 找到 My Domains。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJVialksr89mseJKECbt0PUw9QT2hJgAQ9DKCy9ARb949RDALxFDziaY0aOA/640?wx_fmt=jpeg)

此时域名就申请完毕了。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJVia7frCG0TKdkbOmCXOorEk6wZQyvzj4nf56ujGM005R84kEzgHiaUYK8Q/640?wx_fmt=jpeg)

二、接下来去申请 CND。

登录到 https://dash.cloudflare.com/sign-up 注册一个账号，注册账号很简单，此处省略，登录之后提示需要你填写自己的站点，把你申请的域名填进去。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaOric6tf25VMDFBmWA4ibXicw0lHvPQpryDHxaicoISQdQJ0n5zlqhVv5lQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViakkibDyfryVkiafZh67qlkOCAgicylP03vWicUTb49r7NmG4NoCzP3y4UKg/640?wx_fmt=jpeg)

然后会生成两个 cdn 服务器名称。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaxBO4yFr51Ys3kDE5tJ6j6ORsicpB3UVNeeTkxltWr3xJThiaRmSIfBkA/640?wx_fmt=jpeg)

回到 freenom 的 My Domains 选择申请的域名设置。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaupdNrL9GzG0EFA18Ia3hw0RLz2KBATehjGJlYVQFCWehN7rju0icCqg/640?wx_fmt=jpeg)

选择 Managerment Tools ——> Nmaeserver

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJVia4EsrrAqZXZ00kfBTPTRvsUX6ibMPhFribZlLXj0gu8YA4tPEbdXMDdxw/640?wx_fmt=jpeg)

将刚才 Couldflare 给的 cdn 服务器名称 填写进去，保存退出。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViazwK3O8ar8yianOMcBXE3N16leuN0Niaduuc6w53cfrtpHfSeDgTsNMEw/640?wx_fmt=jpeg)

回到 Couldflare 选择 DNS 管理自己的域名，前缀可以随便写，我写的是 www，绑定自己的 vps 真实 IP。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaSNxLPmqhajtJ5xtRTeEKnKZgvowSRibdqw9Kvc7iaHA0scMNlVyexAiag/640?wx_fmt=jpeg)

准备 C2-Profile ，下载地址：https://github.com/threatexpress/malleable-c2

下载之后需要修改一些地方，根据我的截图直接对应修改。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaxa1iaibt0m45fo05guZicU4bdeCNbSfGqDIeWJUs2xjiaGQMjjKXSsphtg/640?wx_fmt=jpeg)

选择自己的 cs 版本，我这里用的 4.2，编辑对应的文件，然后编辑文档（这里的 password 都是 123456）。

修改 http-certiticete：  

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViayr4BgzejMOSdUQC8XJekC3ib88pqT2k4FaRd4D72THC4Eks5icHwQSVQ/640?wx_fmt=jpeg)

修改 http-stager：  

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaMAeDF8hceHhJx85D1NGLLFtDRyqYiaxhKmuibglaSwclSoVt7IQOToNg/640?wx_fmt=jpeg)

修改 client：

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaaPIEUA0lApRMJPSicXLtGEbLUSic6nDB7ExL1wAzNgibj2iboiaEIeEic7sQ/640?wx_fmt=jpeg)

修改 http-get：

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJVialGiaOsQgEoBRldCxQsqPTFdicORUjttKXxDw63a3C5dIcbTh32beo2BQ/640?wx_fmt=jpeg)

修改 http-post：  

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaJhmEcTKHtSibMMEdtE3pfRG5EcACZCXwnu3ibMFuZtxt7HTJHYgcKmmQ/640?wx_fmt=jpeg)

修改文件后保存，上传到自己的 c2 服务器。

之后进行证书设置，创建自己的证书。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViar1PKfjicuSZfVx5cM29X4NDZTDRrOssjp3xSQXZBjaiaiar1B2TMQDfXg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaSXSibM5MA7TpkdIBbG5xNfbib1k8zZ9Q1c6Sh1hm0N5cFI9SUAhvyOHw/640?wx_fmt=jpeg)

将证书私钥、公钥保存为两个文件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaIcRq7zJN8nqqbibRLwsmv1icKuqJzvOcrIBcdjfn2JKOm6QeRPIRKAwQ/640?wx_fmt=jpeg)

将证书上传服务器上，然后生成自己的 store 文件

```
openssl pkcs12 -export -in server.pem -inkey server.key -out www.xxx.ga.p12 -name www.xxx.ga -passout pass:123456
keytool -importkeystore -deststorepass 123456 -destkeypass 123456 -destkeystore www.xxx.ga.store -srckeystore www.xxx.ga.p12 -srcstoretype PKCS12 -srcstorepass 123456 -alias www.xxx.ga
```

然后使用 c2 自带的 c2lint 对 profile （刚刚修改的文件）进行检查

```
chmod +x c2lint
./c2lint jquery-c2.4.2.profile
```

这个样子就是没有什么的问题的

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaXGkjfjzFPkdQ6PUTs8Cueia2aEMABByPfaxDwAeEUKFQBBg76B2zTQQ/640?wx_fmt=jpeg)

编辑 teamserver 文件，最后的 cobaltstrike.store 改为刚刚生成的 www.xxx.ga.store（也就是通过证书生成的文件）

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaRGQenbhcYOXmq8kfhZbJ3fodjclXib1a99AMc3ZJoORg6CP25cWeYrw/640?wx_fmt=jpeg)

不要着急启动，先把加密方式修改为完全。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaGH4rBcvGJjOQEEmqDsnovGNicmIBpYWSBeXZ3keclowuFot3h9UJPwA/640?wx_fmt=jpeg)

创建规则 www.domain.xx/*js，因为此处的 c2 profile 使用的 jQuery 会生成缓存，导致 cs 无法上线，需要绕过 js 缓存。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViaeYF0DFy5rIxFL5BbtnLYfv4M8J7pah1wDiaTg7UX4aOd1aqaR52sBow/640?wx_fmt=jpeg)

现在启动自己的 C2 试一试

```
./teamserver your_ip your_pass jquery-c2.4.3.profile
```

设置监听器。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViasYWpBSxiaib55ZA8ibIPo4C8YTZgFAicYGyZ6FS2X77FLd9bmFdYV0HXicA/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViac8KRTokibC5aoMbyCWFjMZchwAZBcwtgAoV6tBKgfb97FVict7ibicrUcA/640?wx_fmt=jpeg)

选择生成的 exe 文件 使用 https 的。

![](https://mmbiz.qpic.cn/mmbiz_jpg/pZ0Zg2kzkm1iaPoVzQL4h3l0qfdCNPJViahEGwpNIK9so0xEfA4yS3hE1lY4QFUp5KpLc4qKU9b88lQDoCxlh4cw/640?wx_fmt=jpeg)

执行后成功上线，上线 Linux 后续再更新。