> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/bURbhwCcxwrmXAMDaszESg)

**过** WAF（针对云 WAF）
------------------

### 寻找真实 IP（源站）绕过

如果流量都没有经过 WAF，WAF 当然无法拦截攻击请求。当前多数云 WAF 架构，例如百度云加速、阿里云盾等，通过**更改 DNS 解析，把流量引入 WAF 集群**，流量经过检测后转发请求到源站。如图，dict.com 接入接入 WAF 后，dict.com 的 DNS 解析结果指向 WAF 集群，用户的请求将发送给 WAF 集群，WAF 集群经过检测认为非攻击请求再转发给源站。

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXI5M9icG0FDuLz3A9S5InKm8Ss3sPWj8xRMxh5KbicKpURE2Hb22SPuMA/640?wx_fmt=png)

image-20211101163158685

绕过云 WAF 寻找真实 IP 与绕过 CDN 寻找真实 IP 的方法类似，可以查看这篇文章：

https://plumeria.ltd/post/efd52af7.html#CDN%E7%9A%84%E7%BB%95%E8%BF%87

### 利用同网段绕过

一些在云服务商的站点，同时使用云服务商提供的 WAF 服务。当流量不是通过 DNS 解析引流到 WAF，流量必须经过 WAF 的检测，这是不能通过发行源站进行绕过。可以考虑在云服务商买一台 VPS，通过 VPS 攻击目标站点，因为流量是局域网，可能不经过 WAF 检测，实现绕过。能不能成功，关键在于云服务商的网络配置。

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEX8mh7dejmClkxiaD7U5icWbuu0wk0z1EULCAsFx5JfOS1S0tIYQibCicJbg/640?wx_fmt=png)

### 利用边界漏洞绕过

如果未能发现源站 IP，可以尝试寻找子站的 SSRF 漏洞。如果子站访问目标站不经过 WAF 集群，可以利用 SSRF 漏洞来绕过 WAF。

资源限制角度绕过 WAF
------------

### 超大数据包绕过

这是众所周知、而又难以解决的问题。如果 HTTP 请求 POST BODY 太大，检测所有的内容，WAF 集群消耗太大的 CPU、内存资源。因此许多 WAF 只检测前面的几 K 字节、1M、或 2M。对于攻击者而然，只需要在 POST BODY 前面添加许多无用数据，把攻击 payload 放在最后即可绕过 WAF 检测。

协议层面绕过 WAF
----------

即使流量都确保经过 WAF，如果 WAF 的防御策略根本就没有检测 payload，那么也就能绕过 WAF。协议层面绕过 WAF，利用 WAF 解析协议的问题，使得 payload 被认为不是请求的 HTTP 请求的内容。

### 协议未覆盖绕过

在 http 头里的 Content-Type 提交表单支持四种协议：

•application/x-www-form-urlencoded - 编码模式 •multipart/form-data - 文件上传模式 •text/plain - 文本模式 •application/json -json 模式

文件头的属性是传输前对提交的数据进行编码发送到服务器。其中 multipart/form-data 表示该数据被编码为一条消息, 页上的每个控件对应消息中的一个部分。所以，当 waf 没有规则匹配该协议传输的数据时可被绕过。

### pipeline 绕过

http 协议是由 tcp 协议封装而来，当浏览器发起一个 http 请求时，浏览器先和服务器建立起连接 tcp 连接，然后发送 http 数据包（即我们用 burpsuite 截获的数据），其中包含了一个 Connection 字段，一般值为 close，apache 等容器根据这个字段决定是保持该 tcp 连接或是断开。当发送的内容太大，超过一个 http 包容量，需要分多次发送时，值会变成 keep-alive，即本次发起的 http 请求所建立的 tcp 连接不断开，直到所发送内容结束 Connection 为 close 为止。

![](https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXOo6ZweJyAFV1Mr5tMXnRqQIjJngZHNbY4OeNoKuuajOslrmLOLqPSg/640?wx_fmt=jpeg)

img

发送两个请求，但绕过失败，被云锁拦截，此种方法现在基本失效。

![](https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEX6FVmicg5I0IgwfOkNyhEKn9qog0ejWgWic2fd32x9CRamf1P4LQ9Bz1w/640?wx_fmt=jpeg)img

### 分块传输绕过

分块传输编码（Chunked transfer encoding）是只在 HTTP 协议 1.1 版本（HTTP/1.1）中提供的一种数据传送机制。以往 HTTP 的应答中数据是整个一起发送的，并在应答头里 Content-Length 字段标识了数据的长度，以便客户端知道应答消息的结束。

**分块编码具体方法**

在头部加入 Transfer-Encoding:chunked 之后，就代表这个报文采用了分块编码。这时，报文中的实体需要改为用一系列分块来传输。

每个分块包含十六进制的长度值和数据，长度值独占一行，长度不包括它结尾的 CRLF(\r\n)，也不包括分块数据结尾的 CRLF。

最后一个分块长度值必须为 0，对应的分块数据没有内容，表示实体结束。

例：

```
- 位置①
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用数学运算符以及数据类型：news_id=1.0，news_id=1e0，news_id=1-1
- 位置②
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可以利用加号+替换空格：union+select
- 位置③
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用数学运算符：+、-、~、.    （注：其中-、~、.号必须是select查询的第一个字段的数据类型为数字型才能使用）
  - 可以利用小括号()替换空格：select(1),2,db_name()
- 位置④
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用其他字符：%80~%FF（需要IIS服务器支持）
- 位置⑤
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用其他字符：%80~%FF（需要IIS服务器支持）
  - 可以利用点号.替换空格：from.users
  - 可以利用中括号[]替换空格：from[users]
```

也可以使用 github 上的插件实现分块传输

**chunked-coding-converter**：https://github.com/c0ny1/chunked-coding-converter

![](https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEX97br7409DBG2ibCSWJrMF95V4Xdn4fSW47Bq9SciaYia7fIBBAqcgMTLA/640?wx_fmt=gif)

img

### 另类字符集编码绕过

Content-Type 头中使用 charset 定义字符集的应用场景不只有在 responses 中，request 中同样可以使用。

常见的服务器与可见编码如下所示：

<table><thead><tr><td>服务器信息</td><td>可用编码</td><td>说明</td></tr></thead><tbody><tr><td>Nginx, uWSGI-Django-Python3</td><td>IBM037, IBM500, cp875, IBM1026, IBM273</td><td>对参数名和参数值进行编码，服务器会对参数名和参数值均进行 url 解码，需要对等号和 &amp; and 进行编码 (不进行 url 编码)</td></tr><tr><td>Nginx, uWSGI-Django-Python2</td><td>IBM037, IBM500, cp875, IBM1026, utf-16, utf-32, utf-32BE, IBM424</td><td>对参数名和参数值进行便慢慢 服务器会对参数名和参数值均进行 url 解码 等号和 &amp; 符号不应该以任何方式编码。</td></tr><tr><td>Apache-TOMCAT8-JVM1.8-JSP</td><td>IBM037, IBM500, IBM870, cp875, IBM1026, IBM01140, IBM01141, IBM01142, IBM01143, IBM01144, IBM01145, IBM01146, IBM01147, IBM01148, IBM01149, utf-16, utf-32, utf-32BE, IBM273, IBM277, IBM278, IBM280, IBM284, IBM285, IBM290, IBM297, IBM420, IBM424, IBM-Thai, IBM871, cp1025</td><td>参数名按原始格式 (可以像往常一样使用 url 编码)Body 不论是否经过 url 编码均可等号和 &amp; 符号不应该以任何方式编码</td></tr><tr><td>Apache-TOMCAT7-JVM1.6-JSP</td><td>IBM037, IBM500, IBM870, cp875, IBM1026, IBM01140, IBM01141, IBM01142, IBM01143, IBM01144, IBM01145, IBM01146, IBM01147, IBM01148, IBM01149, utf-16, utf-32, utf-32BE, IBM273, IBM277, IBM278, IBM280, IBM284, IBM285, IBM297, IBM420, IBM424, IBM-Thai, IBM871, cp1025</td><td>参数名按原始格式 (可以像往常一样使用 url 编码) Body 不论是否经过 url 编码均可 等号和 &amp; 符号不应该以任何方式编码</td></tr><tr><td>IIS6, 7.5, 8, 10 -ASPX (v4.x)</td><td>IBM037, IBM500, IBM870, cp875, IBM1026, IBM01047, IBM01140, IBM01141, IBM01142, IBM01143, IBM01144, IBM01145, IBM01146, IBM01147, IBM01148, IBM01149, utf-16, unicodeFFFE, utf-32, utf-32BE, IBM273, IBM277, IBM278, IBM280, IBM284, IBM285, IBM290, IBM297, IBM420,IBM423, IBM424, x-EBCDIC-KoreanExtended, IBM-Thai, IBM871, IBM880, IBM905, IBM00924, cp1025</td><td>参数名按原始格式 (可以像往常一样使用 url 编码) Body 不论是否经过 url 编码均可 等号和 &amp; 符号不应该以任何方式编码</td></tr></tbody></table>

规则缺陷 / 特性角度绕过 WAF
-----------------

### 空白符替换绕过

#### MySQL 特性

> select id,contents,time from news where news_id=1①union②select③1,2,username④from⑤admin

• 位置①• 可以利用其它控制字符替换空格：%09,%0a,%0b,%0c,%0d,%20,%a0• 可以利用注释符号替换空格：/**/、%23est%0d%0a、 --+a%0d%0a• 可以利用数学运算以及数据类型：news_id=1.0，news_id=1E0，news_id=\N• 位置②• 可以利用其它控制字符替换空格：%09,%0a,%0b,%0c,%0d,%20,%a0• 可以利用注释符号替换空格：/**/、%23test%0d%0a、 --+a%0d%0a• 可以利用括号：union(select 1,2)• 位置③• 可以利用其它控制字符替换空格：%09,%0a,%0b,%0c,%0d,%20,%a0• 可以利用注释符号替换空格：/**/、%23test%0d%0a、 --+a%0d%0a• 可以利用其它符号：+ 、- 、 ~ 、!、@• 位置④• 可以利用其它控制字符替换空格：%09,%0a,%0b,%0c,%0d,%20,%a0• 可以利用注释符号替换空格：/**/、%23test%0d%0a、 --+a%0d%0a• 大括号 {}：union select {``1},{x 2}• 可利用数学运算以及数据类型：

> union select usename,2.0from admin union select username,8e0from admin union select username,\Nfrom admin

• 位置⑤• 可以利用其它控制字符替换空格：%09,%0a,%0b,%0c,%0d,%20,%a0• 可以利用注释符号替换空格：/**/、%23test%0d%0a、 --+a%0d%0a• 反引号 `：union select 1,table_name,3 from`information_schema`.`tables`limit 0,1%23• 内联注释：union select 1,table_name,3 from /*!50001information_schema.tables*/ limit 0,1%23• 大括号 {}：union select 1,table_name,3 from{x information_schema.tables}limit 0,1%23• 小括号 ()：union select 1,table_name,3 from(information_schema.tables)limit 0,1%23

#### SQLServer 特性

> select id,contents,time from news where news_id=1①union②select③1,2,db_name()④from⑤admin

```
- 位置①
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用数学运算符以及数据类型：news_id=1.0，news_id=1e0，news_id=1-1
- 位置②
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可以利用加号+替换空格：union+select
- 位置③
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用数学运算符：+、-、~、.    （注：其中-、~、.号必须是select查询的第一个字段的数据类型为数字型才能使用）
  - 可以利用小括号()替换空格：select(1),2,db_name()
- 位置④
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用其他字符：%80~%FF（需要IIS服务器支持）
- 位置⑤
  - 可以利用其它控制字符替换空格：%01~%0F、%11~%1F
  - 可以利用注释符号：/**/、--+a%0d%0a
  - 可利用其他字符：%80~%FF（需要IIS服务器支持）
  - 可以利用点号.替换空格：from.users
  - 可以利用中括号[]替换空格：from[users]
```

#### Access 特性

> select id,contents,time from news where news_id=1①union②select③1,2,username④from⑤admin

• 位置①• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d、%16• 位置②• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 位置③• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 可使用其他字符：+、-、.、=

#### Oracle 特性

> select id,contents,time from news where news_id=1①union②select③1,2,username④from⑤admin

• 位置①• 可利用其他控制字符替换空格：%00、%09、%0a、%0b、%0c、%0d• 可以利用其它控制字符替换空格：%1f、%1d• 可使用其他字符：.• 位置②• 可利用其他控制字符替换空格：%00、%09、%0a、%0b、%0c、%0d• 位置③• 可利用其他控制字符替换空格：%00、%09、%0a、%0b、%0c、%0d• 可使用其他字符：-、+、%ad• 位置④• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 位置⑤• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 可插入字符：%30%ff、%24、%7b%22%7b%76

#### PostgreSQL 特性

> select id,contents,time from news where news_id=1①union②select③1,2,username④from⑤admin

• 位置①• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 可使用其他字符：.、!• 位置②• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 位置③• 可利用其他控制字符替换空格：%09、%0a、%0c、 %0d• 可使用其他字符：.、~、@、-、+• 位置④• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 位置⑤• 可利用其他控制字符替换空格：%09、%0a、%0c、%0d• 可插入字符：%30~%ff、%24

### 函数分隔符绕过

对基于正则表达式的 WAF，我们猜测安全工程师写 WAF 规则时，可能不知道函数名与左括号之间可以存在特殊字符，或者遗漏可以存在特殊字符。例如匹配函数”concat()” 的规则写法，“concat(” 或者”concat\s*(”，就没有考虑到一些特殊字符。相应的绕过方法，在特殊位置引入特殊的分隔符，逐个测试。这些特殊分隔符发现也是通过 Fuzz 出来的。

### 等价关键字绕过

有些函数或命令因其关键字被检测出来而无法使用但是在很多情况下可以使用与之等价或类似的代码替代其使用。

以下举例了 mysql 中的等价关键字：

```
hex()、bin() ==> ascii()

sleep() ==>benchmark()

concat_ws()==>group_concat()

mid()、substr() ==> substring()

updatexml、extractvalue() ==> polygon()

@@user ==> user()

@@datadir ==> datadir()

and ==> &&

or ==> ||

not ==> !

xor ==> |

= ==> like

!= ==> <>

limit 0,1 ==> limit 1 offset 0

union select ==> union select * from (select 1)a join (select 2)b

’‘ ==> ""

'admin' ==> 0x61646D696E

select * from users where id = 1 order 4 ==> select * from users where id = 1 into @a,@b,@c,@d
```

### 添加库名绕过

以下两条查询语句，执行的结果是一致的，但是有些 waf 的拦截规则 并不会拦 截 [库名].[表名] 这种模式。

### ALL 或者 DISTINCT 绕过

去掉重复值

```
select 1,2 from users where user_id=1 union DISTINCT select 1,2 

select 1,2 from users where user_id=1 union select DISTINCT 1,2 
```

显示全部

```
select 1,2 from users where user_id=1 union all 

select 1,2 select 1,2 from users where user_id=1 union select all 1,
```

### 大小写绕过

常用于 waf 的正则对大小写不敏感的情况，一般都是题目自己故意这样设计。

```
select * from users where id=1 UNION SELECT 1,2,3,4; 

select * from users where id=1 UniON SelECT 1,2,3,4
```

### 双关键字绕过

在某一些简单的 waf 中，将关键字 select 等只使用 replace() 函数置换为空，这时候可以使用双写关键字绕过。例如 select 变成 seleselectct，在经过 waf 的处理之后又变成 select，达到绕过的要求。

### 双重 / 多重 URL 编码绕过

双重 url 编码，即对于浏览器发送的数据进行了两次 urlencode 操作，如 s 做一次 url 编码是 %73, 再进行一次编码是 %25%37%33。一般情况下数据经过 WAF 设备的时候只会做一次 url 解码，这样解码之后的数据一般不会匹配到规则，达到了 bypass 的效果。

### Unicode 编码绕过

IIS 服务器支持对于 unicode 的解析，例如我们对于 select 中的字符进行 unicode 编码，可以得到如下的 s%u006c%u0006ect，这种字符在 IIS 接收到之后会被转换为 select，但是对于 WAF 层，可能接收到的内容还是 s%u006c%u0006ect，这样就会形成 bypass 的可能。

<table><thead><tr><td><strong>字符</strong></td><td><strong>Unicode 编码</strong></td></tr></thead><tbody><tr><td>a</td><td>%u0000 %u0041 %u0061 %u00aa %u00e2</td></tr><tr><td>单引号</td><td>%u0027 %u02b9 %u02bc %u02c8 %u2032 %uff07 %c0%27 %c0%a7 %e0%80%a7</td></tr><tr><td>空白</td><td>%u0020 %uff00 %c0%20 %c0%a0 %e0%80%a0</td></tr><tr><td>左括号 (</td><td>%u0028 %uff08 %c0%28 %c0%a8 %e0%80%a8</td></tr><tr><td>右括号)</td><td>%u0029 %uff09 %c0%29 %c0%a9 %e0%80%a9</td></tr></tbody></table>

### Emoji 表情字符绕过

emoji 是一串 unicode 字集组成，一个 emoji 图标可以占 2、4、7 个字节。且 mysql 支持 emoji 存储。

部分 Emoji 可以插入到 %23 与 %0A 之间实现绕过。

### json 提交与 xml 提交绕过

有些程序是 json 提交参数，程序也是 json 接收再拼接到 SQL 执行 json 格式通 常不会被拦截。所以可以绕过 waf。

```
POST /06/vul/sqli/sqli_id.php HTTP/1.1
Host: 192.168.0.115
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:88.0) Gecko/20100101 Firefox/88.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type:application/json
Content-Length: 38
Origin: http://192.168.0.115
Connection: close
Referer: http://192.168.0.115/06/vul/sqli/sqli_id.php
Cookie: PHPSESSID=e6sa76lft65q3fd25bilbc49v3; security_level=0
Upgrade-Insecure-Requests: 1

{'id':1 union select 1,2,3,'submit':1}
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXS9gvpluuAwYaw84erf2ZYUzFaId4VoorRE0lC2swOhXtDr71Xmht9g/640?wx_fmt=png)

image-20211101231132608

同样 text/xml 也不会被拦截

### **特殊的百分号**

在 **ASP/ASPX+IIS** 的环境中存在一个特性，就是特殊符号 %，在该环境下当们我输入 s%elect 的时候，在 WAF 层可能解析出来的结果就是 s%elect，但是在 iis+asp 的环境的时候，解析出来的结果为 select。

### HTTP 参数污染

HPP 是 HTTP Parameter Pollution 的缩写，意为 HTTP 参数污染。

在 ASPX 中，有一个比较特殊的 HPP 特性，当 GET/POST/COOKIE 同时提交的参数 id，服务端接收参数 id 的顺序 GET,POST,COOKIE，中间通过逗号链接，于是就有了这个 idea。

UNION、SELECT、FROM 三个关键字分别放在 GET/POST/COOKIE 的位置，通过 ASPX 的这个特性连起来，堪称完美的一个姿势，压根不好防。

但姿势利用太过于局限：使用 Request.Params["id"] 来获取参数, G-P-C 获取到参数拼接起来，仅仅作为 Bypass 分享一种思路而已。

下表中列举了一些主流环境下的 HPP 情况：

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEX6EUwbOy1FYxU50FP37nrRbOaeq54EyEZSffvTl5QypO0YpicKqsTFlg/640?wx_fmt=png)

image-20211101212812215

### GET 方法传输 POST 数据绕过

大家的常识是 GET 参数通过 URL 传递，POST 放在 Request body 中。

但是在某些中间件（如 IIS）中的 GET 请求同样可以传输 POST 数据。

### 畸形 method 绕过

某些 WAF 在处理数据的时候严格按照 GET、POST 等标准 HTTP 方法来获取数据，或者采用正则匹配的方式来处理数据，可能因为 WAF 和 WEB 服务解析的前后不对等绕过 WAF。

**存在环境：Apache 2.X**

某些 apache 版本在做 GET 请求的时候，无论 method 为何值均会取出 GET 的内容。

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXvdLHiaicrquGI79v61kRlWssuLudV9zSicL5SZ65K6ibPFOV3n201XvW5Q/640?wx_fmt=png)

image-20211101212939505

### 畸形的 boundary 绕过

PHP 在解析 multipart data 的时候有自己的特性，对于 boundary 的识别，只取了逗号前面的内容，例如我们设置的 boundary 为 ----aaaa,123456，php 解析的时候只识别了 ----aaaa，后面的内容均没有识别。然而 WAF 在做解析的时候，有可能获取的是整个字符串，此时可能就会出现绕过。

**存在环境：PHP**

### 参数数量限制绕过

WAF 在实际环境中为防止拒绝服务式攻击 (denial of service attacks)，默认最多解析前 100 个请求参数 (包括同名的)，更多的参数将直接忽略。

**存在环境：Nginx+Lua WAF**

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXeAU6Uh5PHJgCLnZ5cSMGl3RPIBXM8Z2DqSxwtzfzDDESasVeUYOmHw/640?wx_fmt=png)

image-20211101215241527

### 变换请求方式绕过

假如 php 里使用 $_REQUEST 获取参数，那么 php 获取参数的默认优先级是：

`$_COOKIE` > `$_POST` > `$_GET`。此时 WAF 层只过滤 get/post，但没有过滤 cookie，于是导致了绕过。

**存在环境：PHP**

### 信任白名单绕过

有些 WAF 会自带一些文件白名单，对于白名单 waf 不会拦截任何操作，所以可 以利用这个特点，可以试试白名单绕过。

白名单通常有目录：

```
/admin

/phpmyadmin

/admin.php
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXNWA32yrpEchzdKPgIKUG75ymOQBsttooWYHd8JfAlztBrg5LGHBiarA/640?wx_fmt=png)

image-20211101220538726

### 静态文件绕过

除了白名单信任文件和目录外，还有一部分 waf 并不会对静态文件进行拦截。例如 图片文件 jpg 、png 、gif 或者 css 、js 会对这些静态文件的操作不会 进行检测从而绕过 waf 拦截。

```
/1.jpg&name=vince+&submit=1

/1.jpg=/1.jpg&name=vince+&submit=1

/1.css=/1.css&name=vince+&submit=1
```

![](https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibM8iahChKskMzib8fJ0y0SEXWB90SNYAiazLM9vV2WocMhV1OEZiaicRgBLZIP9VyrF91NS2ZprbxwdtQ/640?wx_fmt=png)

image-20211101230701225

### PostgreSQL 字符串特性绕过

由于 postgres 会将双引号中的内容认为是一个表名 / 字段名，同时在双引号引起的字符串中使用 U& 前缀转义是合法的，所以当过滤了 information_schema 等关键名称时，可以将其用双引号引用并在其前面 加入 U & 转义前缀，同时将其中某个字符替换为对应的 Unicode 表现形式来绕过 WAF。

例如：以下语句同样会返回所有的 Schema

```
select U&"tabl\0065_sch\0065ma" from U&"inform\0061tion_sch\0065ma".U&"t\0061bles" where 
U&"tabl\0065_sch\0065ma" not in (U&'pg_cat\0061log',U&'inform\0061tion_sch\0065ma') group by 1;
```

```
【往期推荐】


【内网渗透】内网信息收集命令汇总


【内网渗透】域内信息收集命令汇总

【超详细 | Python】CS免杀-Shellcode Loader原理(python)

【超详细 | Python】CS免杀-分离+混淆免杀思路


【超详细 | 钟馗之眼】ZoomEye-python命令行的使用


【超详细 | 附EXP】Weblogic CVE-2021-2394 RCE漏洞复现

【超详细】CVE-2020-14882 | Weblogic未授权命令执行漏洞复现

【超详细 | 附PoC】CVE-2021-2109 | Weblogic Server远程代码执行漏洞复现

【漏洞分析 | 附EXP】CVE-2021-21985 VMware vCenter Server 远程代码执行漏洞

【CNVD-2021-30167 | 附PoC】用友NC BeanShell远程代码执行漏洞复现


【奇淫巧技】如何成为一个合格的“FOFA”工程师

【超详细】Microsoft Exchange 远程代码执行漏洞复现【CVE-2020-17144】

【超详细】Fastjson1.2.24反序列化漏洞复现

  记一次HW实战笔记 | 艰难的提权爬坑

【漏洞速递+检测脚本 | CVE-2021-49104】泛微E-Office任意文件上传漏洞


免杀基础教学（上卷）


免杀基础教学（下卷）


走过路过的大佬们留个关注再走呗

往期文章有彩蛋哦
```

![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTECbvcv6VpkwD7BV8iaiaWcXbahhsa7k8bo1PKkLXXGlsyC6CbAmE3hhSBW5dG65xYuMmR7PQWoLSFA/640?wx_fmt=png)  

一如既往的学习，一如既往的整理，一如即往的分享![](https://mmbiz.qpic.cn/mmbiz_png/7D2JPvxqDTGYu9nrfsXsv7ZrsqXibnKn0ibNvXPNxyic6GHpgKgUC5LWm1tPhibApO9DMwcNSSZfJn83twR7CSnbow/640?wx_fmt=png)  

“如侵权请私聊公众号删文”

公众号