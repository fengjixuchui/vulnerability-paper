> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/9KGmIa2ESf0JMmselSbm3g)

![](https://mmbiz.qpic.cn/mmbiz_jpg/zbTIZGJWWSNw1gicBic6GWyD4Cic84SpCuc2hjKYHSNAwLfmSOlqJtsXFnNvxiaXSO2MCLo17vgEphBoueicJn9Aweg/640?wx_fmt=jpeg)  

一位苦于信息安全的萌新小白帽

本实验仅用于信息防御教学，切勿用于它用途

公众号：XG 小刚

偏移量

前几天听了公司大佬的免杀分析啊，很牛逼  

其中有一种混淆 shellcode 的方式比较有趣，就是使用偏移量来混淆，今就偷摸来分享分享

大佬思路

大佬是用的 C++，在 win 找一个所有版本都存在的文件，读取该文件二进制，  

，在这之前先生成一个列表，这个列表帮助我们使用偏移量来遍历该文件，从而找出所有的字符构造出 shellcode

我的思路

我的思路比较简单，直接自己生成个随机字符，该字符包含 0-f 即可  

```
string = '0123456789abcdef'
str_list = list(string)
random.shuffle(str_list)
string2 = ''.join(str_list)
```

然后遍历 shellcode，找到在随机字符的位置，生成一个列表即可  

```
a = open(sys.argv[1],'rb')
b = a.read().encode('hex')
list = []
for i in b:
    b = string2.find(i)
    list.append(b)
```

源码

公众号回复：**偏移量混淆**  

使用脚本，打开 shellcode.bin 文件，混淆后生成 Offset_shellcode.py 文件。

![](https://mmbiz.qpic.cn/mmbiz_gif/zbTIZGJWWSNw1gicBic6GWyD4Cic84SpCucVibM20IXdeLjt1tasZh9TF5msYMJLlTsQw1S3MuMQAcCLliaClWPMkUA/640?wx_fmt=gif)

然后直接套加载器用就行了