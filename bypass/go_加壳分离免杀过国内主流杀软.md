<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/jXStUsavx4xW3yqi45w5oQ)

  

点击上方蓝字关注我们

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/486RHs1WbcgGib6o96dHbvGUGGwPicd8wusUGH1cXR29tM4bO0lNzialzkQhvU6m5ZUdaKibmcF2OQayjMe9Bia6iaXQ/640?wx_fmt=png)

✎ 阅读须知

  

乌鸦安全的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。

乌鸦安全拥有对此文章的修改、删除和解释权限，如转载或传播此文章，需保证文章的完整性，未经授权，不得用于其他。

该稿件作者获赠《Web 渗透攻防实战》图书一本。

  

**01 插件安装**

本篇免杀为 Cobalt Strike 安装插件后 bypass 国内杀软。

插件下载地址：

```
https://github.com/fengziHK/bypass_go
```

1.1 Cobalt Strike 导入插件

如下图直接导入：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8KnHXIrtN4nBHqTGQiaDtr6vicibjoHFDI3UDA6In3lW4MAVXso7dTLz8A/640?wx_fmt=png)

你会发现攻击那里多出一个 bypass 的模块

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8SJjiaqHMgib4rtMpjcSQ4Rwg6SdeCBliaicibrHbcR3W3kFL5icErTOjO47w/640?wx_fmt=png)

  

**02 免杀火绒**

Cobalt Strike 生成一个 64 位的 payload

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN85OwiaqE06LPNb5LhicgzSxV5qTUURmLN5icSnzShYqKlScbOKzkWtWDXg/640?wx_fmt=png)

生成的 shellcode 文件

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8EVZ8c5nW2OTY40ibkbOZdwnzdJdS73OPqJfiaaDrVkP1BBUBT2ibfH0Eg/640?wx_fmt=png)

打开你刚才生成是 shellcode 文件 你会发现出现以下内容

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8FLz6pu30JCLAUWMGMj1mIMEke6JJzicD9T0xeWPMOq6w4n6OU4xwQRg/640?wx_fmt=png)

在你下载的 Bypass_Go-main 目录执行 cmd 操作命令

2.2 生成 code.txt

process_shellcode.exe + shellcode.txt 里的 payload

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8a31NOChCe5nAuusvU0MAYaAxFvG9wlaYAnmRgzWia6MyRPH9aicMiahtw/640?wx_fmt=png)

完成上面的步骤之后接着 生成 (k1 k2).txt

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8StrzIIdYnYpf2fT2PoJAYWFbYUXLC4la5vdiaibB0SJYnVrY4fhHRUgA/640?wx_fmt=png)

将你生成的 3 个 txt 放到 kali 当中，并用 python 搭建一个微服务

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8cFQC67xB3KCL8yXmsYXPKCYGe5prQ0OGt4AOPnkciatd9S7g2bH6SJg/640?wx_fmt=png)

修改 shellcode_loader.go 的配置信息，变成远程加载 shellcode

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8z1nnEexJNSwXe75BPyDibbVcFhC05Ul4JcxJDBKRPeWb3j8nsHzp8yw/640?wx_fmt=png)

cmd 里面运行以下命令进行编译（需要有 go 的环境变量否则报错）

```
go build -ldflags "-H windowsgui" shellcode_loader.go
```

编译完成后会生成一个 exe 文件 （火绒之前是报毒的，但是升级病毒库之后又不报了）

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN89ViaibB8wez7wd2IRufm3viaiam7VeRWqPewoXK9PKCRqDXiaDsRbBPMibZA/640?wx_fmt=png)

火绒下上线 (这里只是在火绒的主机上线 静态和动态都过了)

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8bicMowzEBHhZKS9D40LGztZicfYZ1LOibEtHD6BJEnHA5RzHvWUNsjx1A/640?wx_fmt=png)

**03  加壳免杀 360**

以上方法生成的 exe 文件，360 直接报毒

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8TXaTNsojcGCSrdibeUP6Rao6iaMEARrhd4dCTYicXcD94DOho6PUXn7ibA/640?wx_fmt=png)

那么如何过 360 呢？ 

这里采用了加壳的方式过 360 和火绒！

一开始我的思路是编码混淆，发现不行之后使用加壳，upx 确实可以过火绒，但是过不了 360，按照往常的经验来分析：upx 应该是被 360 拉黑了。

这里也试过掩日 + upx，但是火绒会直接查杀。

于是我想到了另外一个加壳软件 safe

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8iagwBFq8V4yq4pLH71RGA4A31dHkC9e0gG8D0ftk8jqMCE9xPpwcGicg/640?wx_fmt=png)

用法很简单将你的 exe 拖入之后就可以了 （这里选择默认加壳模式就行了，当然如果懂汇编的师傅可以尝试一下其它的选项）

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8MYruKEjo1CQQrMD5ep73RGccDiaQYJEM0gTlZSQVXVlVibODBcuRGr3A/640?wx_fmt=png)

加壳后查杀，360 不杀，到此位置该方法可过 360 + 火绒，但目前无法过红伞和卡巴（已测试）

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8e21uSUBGdaqZHHfMmWRicmcjvHEWSwbHXncUicbsstUJkUjicVJBGUrEA/640?wx_fmt=png)

动态执行可上线

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1Bicpt70ZKp6EdFdof18MKN8ag3nYPDlAdy3Bic354LPFPTJcVaeXFtNGf4K26bicfkP0lYSG66AKeIQ/640?wx_fmt=png)

**04  总结**

通过 go 编译后加壳可过国内主流杀软，但是缺点也很明显：bypass 之后的文件有点大 。

在加壳的时候，最先测试的是掩日，后来是 upx，但是这些都被 360 或是火绒查杀，最后测试到了 safe 的时候，发现免杀成功。

免杀上线之后，配合梼杌进行提权，效果也是不错的。

![](https://mmbiz.qpic.cn/mmbiz_png/7PuqRWWU6zPRMxSeBfjvKhbuTlWQcqk8L2ib8dROI0fFTknJfEctspUxmbxZwkvG9214pibCEmGWsuEDvDad20tA/640?wx_fmt=png)  

新书推荐

![](https://mmbiz.qpic.cn/mmbiz_png/US10Gcd0tQGCeAxCpwiafHPCQ59GvHz6giandwhxYRRbpy9Fg4r24n3DUppDIuN9AdtiaAYaIEm15OGhIfuv6Mzkg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/TN05MmJLxMrNiboff6rhmPUYUNXdWTXZfiaHXPuUGqmPZtqhI6NtGicPMIu6ohOCReWY2C4YZY4AIchDMyal6KWQw/640?wx_fmt=gif)

    过去网络安全距离我们很远，只要没有被攻击便可以忽略，而现在如果存在安全漏洞且一不小心被成功攻击，就可能导致很多公司财务等重要数据被勒索病毒感染，造成巨大经济损失！近几年来，国家展开了护网行动，加上各种机构经常组织 CTF 比赛等，网络安全越来越火，人才缺口也越来越大。“会渗透，是懂安全的基础；会漏扫，是懂渗透的基础；去实战，是检验能力的标准” 此书可以给网络安全领域的专业人士或想入门的人士答疑解惑，是您必不可少的一本专业图书!  

本书从网络攻防实战的角度，对 Web 漏洞扫描利用及防御进行全面系统的研究，由浅入深地介绍了在渗透过程中如何对 Web 漏洞进行扫描、利用分析及防御，以及在漏洞扫描及利用过程中需要了解和掌握的基础技术。

全书共分 10 章，包括漏洞扫描必备基础知识、域名信息收集、端口扫描、指纹信息收集与目录扫描、Web 漏洞扫描、Web 常见漏洞分析与利用、密码扫描及暴力破解、手工代码审计利用与漏洞挖掘、自动化的漏洞挖掘和利用、Web 漏洞扫描安全防御，基本涵盖了 Web 漏洞攻防技术体系的全部内容。书中还以一些典型漏洞进行扫描利用及实战，通过漏洞扫描利用来还原攻击过程，从而可以针对性地进行防御。

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1Ar5g2WODbmaxTd6ibMYtwZic1LzLS237GhaxAibBnqGmGrdX179RxtibyB5EvFicExia0WUON3sd2tOJxA/640?wx_fmt=jpeg)

  

点击上方链接，更多优惠等你哦~

tips：加我 wx，拉你入群，一起学习

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1ACBHDE9o8KA6icOCZVKdLBJOca699BJK50FDxBNnhRZrS1hyXb2K4AkLTYfJwticmyHQxv3X6vZHfQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_png/CibE0jlnugbX5SLGI9312kOrkH7gXIN5NPic75bQ8WbAFMEqvZiaQ0WSk4W9eYUfJJRzlMgibjic8mIGicMvjialoDgmQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1ACBHDE9o8KA6icOCZVKdLBJkslQQ2B5nDuKBlpbKHHtME5RBrJsYucDbPWpyglY02yicRq93PTWn7w/640?wx_fmt=jpeg)

扫取二维码获取

更多精彩

乌鸦安全

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Bt3mgRlo88wGCQuAJ2kv0pzM18jFmpv4CJEBMNAicGSSvDlWSN6DG5JJ0Q8EI6oEuaZS0QNyAojYw/640?wx_fmt=gif)