<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/MHxomRzX8Y40YXuCUpp_Yg)

  点击蓝字关注我哦

**前言**  

2021 年了，现在渗透的越来越难了，刚打的 shell，过一会就没了，现在的流量设备，安全设备一个比一个流弊，payload 一过去就面临着封禁，为了对抗设备，一些大佬们总结出很多绕过这种基于签名的 * WAF 或 IDS* 的手法，为什么叫基于签名的？因为这种设备也是检查数据包中一些特征字符，比如什么 and 1=1 什么的，但是肯定不会这么简单的，除了几个黑名单的固定的特征字符，很多都是那种通过正则去匹配特征字符的，这也是造成绕过可能性的原因。

  

**常规手法**

**1. 直接通过真实 ip 访问**

这是一种对待云 waf 最有效的办法，只要找到做 cdn 的之前的真实 ip，那么直接通过 ip 访问，则会使云 waf 完全失效，web 应用服务器失去云保护。

**1.1 怎么找到真实 ip？** 

手法挺多的，我比较常用的，就是直接把网站的 titile 给取下来放到一些搜索引擎搜索，比如在 fofa 中搜索网站 titile，一般都能找到，钟馗之眼也不错，当然手法很多，找比较实用的就行。

**1.2 通过 ip 去访问一些网站，可能提示 web 页面找不到？** 

究其原因是，有些网站在路由上直接使用的域名为硬路由，这时候需要修改 host 解析文件，把相关域名和真实 ip 给对应上填上，再用域名去访问。

linux host 文件路径

```
/etc/hosts
```

windows host 文件路径

```
C:\WINDOWS\system32\drivers\etc
```

**2. 切换协议**

通过切换 http 到 https，或者 https 切换到 http，如果 web 站点没有进行强制 https 访问，那么 http 也能访问到其站点，如果 waf 错误配置，也能起到一点效果（方法比较特殊），还可以通过增加 www，或者删除 www 前坠有时也管用。  

**3. 通过 IPv6 访问**

有许多入侵检测系统也只监控 IPv4 流量，没有对 IPv6 进行监控。

访问格式：http://[ipv6 地址]:80/index.html

ipv6 为：2001:470:c:1818::2

访问地址：http://[2001:470:c:1818::2]:80/index.html

**4. 对 http 包头进行修改**

方法之一就是添加以下标头： 

*   X-forwarded-for
    
*   X-remote-IP
    
*   X-originating-IP
    
*   x-remote-addr
    
*   x-client-ip
    

例如：

X-Originating-IP: 127.0.0.1

在一些做了访客流量负载的 web 架构很常见，他并不是把 web 服务器映射出去，而是把外面的访问流量通过一台流量转发机器转发到内网 web 应用服务器，这种形式的话，在转发进来的数据包中就会出现 X-forwarded-for 等字段，标示着是哪个 ip 访问的 web 服务。

如果包存在：

*   Content-Type: text/html
    

那么可以尝试做以下修改：

*   Content-Type:           #直接删除类型值
    
*   Content-Type: text/htmlzzzzzzzzz   #错误的类型值
    
*   Content-Type: application/octet-stream #其他类型值
    

有时候将 MIME 类型设置为 multipart/form 数据然后对请求进行错误处理也有奇效。  

*   Content-Type: multipart/form-data ; boundary=0000
    
*   Content-Type: mUltiPart/ForM-dATa; boundary=0000
    
*   Content-Type: multipart/form-datax; boundary=0000
    
*   Content-Type: multipart/form-data, boundary=0000
    
*   Content-Type: multipart/form-data boundary=0000
    
*   Content-Type: multipart/whatever; boundary=0000
    
*   Content-Type: multipart/; boundary=0000
    

对 HTTP 方法进行更改：

把 get 改成 post ，post 改成 get，或者直接改成 put

有时候错误方法也能成功访问

请求可以通过 “GETS” 而不是 “GET” 发送，并且在许多情况下仍会按预期运行。  

特别是在 PHP 中，根据配置，cookie 值可以被视为参数

```
/cmd/a.php

cookie: cmd1=;cat /etc/passwd
```

还有的是就是把 http 协议 1.1 改成 1.0 ，因为大部分服务器也支持 1.0 版本。

**5 对参数操作**

参数名称可以通过多种方式进行操作，具体服务器上运行的服务器端语言，还有取决于服务器的特性，这里讲一下 php 和 asp 的绕过。

1. 通过硬编码值造成绕过

PHP 中的 **+** 符号可用于实现此目的，而 ASP 中的 **%** 符号将实现类似的结果

在 ASP 中，可以将无效的 URL 编码添加到参数名称中（请注意，编码必须无效才能正常工作）

例子：

```
/cmd/a.php?%value=payload
/cmd/a.php?\%\}9value=payload
```

在 PHP 中，加号可以达到同样的效果：

```
/cmd/a.php?+value=payload
```

2. 多个参数（HTTP 参数污染）

在 php 中，如果遇到多个参数，那么是从右到左来取参数值

```
/cmd/a.php?value=1111111111111111111111111111&value=payload
```

又比如

```
/cmd/a.php?value=payload&value=payload
```

又比如

```
/cmd/a.php?page=cat /etc/passswd&page=
```

又比如

```
/cmd/a.php? page=cat&page=/etc/passswd&page=/passwd
```

在保证结果正确的情况下，想怎么玩就怎么玩

3. 利用服务器特性

比如 windows 的特性可以在文件名之后加_等符号，linux 加‘

**6. 通过控制字符**

这些控制字符包括

*   %0d **(CR)**
    
*   %0a **(LF)**
    
*   %0d%0a **(CRLF)**
    
*   %09
    
*   %0B
    
*   %00
    

例子：

```
http://example.com/file.txt
```

改成：  

```
http://example.com/file%00.txt
```

对于有一些 waf 很实用。

**7. 通过变换路径来 bypass**

一些 waf 或者 web 应用通过 web 路由进行封禁，体现为访问某个特定的 url 路径为 403 等状态。

但是通过 url 路径的特性，能进行绕过：

```
/path//vuln.php 
/////////////////路径//////////////// vuln.php?value=PAYLOAD #在php中
/path/./vuln.php?value=PAYLOAD
/path/blah/../vuln.php?value=PAYLOAD 
/path/blah/blah/blah/../../../vuln.php?value=PAYLOAD 
/PaTh/VULN.PHP?VaLuE=PAYLOAD #windows大小写不分
```

通过中间件的特性，在 Apache Tomcat 中：

```
/path;/vuln.php?value=PAYLOAD
/path/;lol=lol/vuln.php?value=PAYLOAD
```

PATH_INFO（通过 Apache 设置的环境变量）

```
/vuln/vuln.php/lolol?value=PAYLOAD 
/path/vuln.php;lol=lol?value=PAYLOAD
```

等。。。。。。

姿势列举不完的，灵活组合才是最强姿势。

**8. 分块传输**

注意：

1. 只有 HTTP/1.1 支持分块传输

2.POST 包都支持分块，不局限仅仅于反序列化和上传包

3.Transfer-Encoding: chunked 大小写不敏感

```
github：
https://github.com/c0ny1/chunked-coding-converter/releases/tag/0.4.0
```

**8.1 通过 burp chrunk 插件分块编码传输**

![](https://mmbiz.qpic.cn/mmbiz_png/96Koibz2dODtBT3wib3ZeMSSDgNJMZHBZRaLPc74mNl4RocVEmJHPOKuSwBuXZErOu6KO8uGQMIRw0KXenoQZvLQ/640?wx_fmt=png)

分包后  

![](https://mmbiz.qpic.cn/mmbiz_png/96Koibz2dODtBT3wib3ZeMSSDgNJMZHBZR8LRQegIeicb8jf70njQRQSr9HamDRRdqDiahewc1E50ueuNUHic3h1PcA/640?wx_fmt=png)

此方法主要是把一些关键字给拆开，当然你也可以通过手动编码进行调整，编码过程中长度需包括空格的长度，最后用 0 表示编码结束。

**8.2 延时分块**

```
详情参考
https://gv7.me/articles/2021/java-deserialized-data-bypasses-waf-through-sleep-chunked/
```

**9. 垃圾数据**

遇到什么 waf，都是大包绕，绕不过，那就是包不够大，继续填充！！

并不是随意填充垃圾数据，而是填一些不影响结果的数据，比如遇到 php 站

```
post参数为username=admin'
```

那么填充垃圾数据可为：

```
username=11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&username=admin'
```

填充到 waf 不再拦截为止。  

还有通过语言的注释语句填充，例如如果是 xml 上传，则可以使用 xml 中的注释语法

```
<!-- 1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad1asdadad -->
```

把这样的语法放在 payload 前面，填充到 bypass waf 为止

如果是反序列化包，可以参考这篇文章：

```
https://gv7.me/articles/2021/java-deserialize-data-bypass-waf-by-adding-a-lot-of-dirty-data/
```

![](https://mmbiz.qpic.cn/mmbiz_png/96Koibz2dODsGoxEE3kouByPbyxDTzYIgX0gMz5ic70ZMzTSNL2TudeJpEAtmtAdGg9J53w4RUKGc34zEyiboMGWw/640?wx_fmt=png)

END

![](https://mmbiz.qpic.cn/mmbiz_png/96Koibz2dODsGoxEE3kouByPbyxDTzYIgX0gMz5ic70ZMzTSNL2TudeJpEAtmtAdGg9J53w4RUKGc34zEyiboMGWw/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_gif/96Koibz2dODtIZ5VYusLbEoY8iaTjibTWg6AKjAQiahf2fctN4PSdYm2O1Hibr56ia39iaJcxBoe04t4nlYyOmRvCr56Q/640?wx_fmt=gif)

**看完记得点赞，关注哟，爱您！**

**请严格遵守网络安全法相关条例！此分享主要用于学习，切勿走上违法犯罪的不归路，一切后果自付！**

**在看你就赞赞我！**

![](https://mmbiz.qpic.cn/mmbiz_gif/96Koibz2dODtaCxgwMT2m4uYpJ3ibeMgbThXaInFkmyjOOcBoNCXGun5icNbT4mjCjcREA3nMN7G8icS0IKM3ebuLA/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_gif/96Koibz2dODtaCxgwMT2m4uYpJ3ibeMgbTnHS31hY5p9FJS6gMfNZcSH2TibPUmiam6ajGW3l43pb0ySLc1FibHmicibw/640?wx_fmt=gif)

转载是一种动力 分享是一种美德