<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/UOs9_m3_X2Zrb4iDMs1LrQ)

**从零基础学渗透，领取配套视频**

**#统统可白嫖#**

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSHyfzIicIMsib97kZfZEART3awLIBLCUTufSibfC1DXZotKfSvNs2Zr0MSUr7dEWIwsQiay1jwn5WXaOA/640?wx_fmt=png)

扫码找小助理白嫖渗透资料![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSEEQwsVFyfJD70E9HmDELbPwumVMkXxnmgmwHklA5JxIWJlzcPao47a9cibAmp1zeZ5Hf8yEWZSFBg/640?wx_fmt=png)

**学习大佬的思路技巧**  

作者： Icepaper  

原文地址：https://xz.aliyun.com/t/10278

#### waf 拦截

本在打某市 Hvv 第一天就找到一个文件上传的点，经过测试，可以直接任意文件上传，没有什么道理。

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPT8JCPVUKyic9eehVm5PQIfpYqG5qnKsBqxib3ujicEv36BhBaPcVhDXurw/640?wx_fmt=png)

直接尝试上传 Php 文件，被 waf 拦截了

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTialhmG1GibJx86MBjCWOLwANBbsY2TTbHVhiaNGvq1dicUplbY7Zo9CTYg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTQib2TeXteEyfXpHkNCZI5kuf376qT8ORVQfSuTjgSdgOoYDtaCDmk5A/640?wx_fmt=png)

不知道这是哪家的 waf

尝试了一系列的绕过，发现利用换行 + chunk 可以过后缀

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTVRxBy5pHmOd2Zm0iaNaNpxbPpuHr8duaUMlTbJXLPJhDMPxV8cDCRgw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTooYzksS0doFMWLR8yUgQFpPAkR26a62l2vdt6twzvmyQ92icXbYIP4w/640?wx_fmt=png)

  
之后就要过内容检测的 waf，但是在这里死活过不去  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTjjYOTiaHOJicgwuS2AB9pUvxpmibVqGpNyAs5f7XXrHlWE5thnhFXBsew/640?wx_fmt=png)

Webshell 内容 + chunk 编码过后缀 会提示 502  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTpTzMznvbYMkP5FRuWmlLGUoYRHJ8xAIiadSMXm9AQib77ZGF2IWzacdA/640?wx_fmt=png)

之后尝试上传 txt，想先看看能不能先绕过内容检测，发现这个 waf 检测不能同时存在 <? 和 ()

  
如 <?phpinfo(); 这种语句，就会被拦截。

因为他同时出现了 <? 和 ()  
如果你的内容检测没有同时出现 () 和<? 时，就可以过内容检测, 不知道市面上有没有这种类型的 webshell, 我找了一圈好像都有。  

#### host 碰撞绕过

该站点为某个单位的类似官网的站点，然后网站有超链接，该超链接定向跳转到某些 ip  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTavgNcoCOn6rtKJNBYkz0LZ2PibG2WVCq5TEiap8P4p2MVeswvXicVLCQg/640?wx_fmt=png)

因为这种单位很喜欢将自己的服务器部署在 C 段的分散的 IP 上

于是猜测，这个类似官网网站的站点也很有可能就搭建在这个超链接的 C 段上

我们不妨 host 碰撞一下

如果找到了真实 IP 的话，那么久可能绕过云 waf  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTTlEZgbScce3CzXaqz8EZmKmXEmTofF8MfEIey41vbCMC1eAkavlYTQ/640?wx_fmt=png)

于是直接用 host 碰撞的 py 脚本去碰撞一下该 C 段 IP，发现居然成功了。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTj58IW6ia2Dr5zj43CiaI0tUe9sicdLh0O60OA84kFqeLTlJS5icOQPOWqA/640?wx_fmt=png)

直接修改 Target 为碰撞出来的真实 IP，之后就不用 chunk + 后缀换行也能过后缀 waf 拦截了（需要换行，不用 chunk）。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTxQF9Fj3xCUtPzVUFyOf7p8GqwShicJ5ibxN6ssN5VYnYbZ9qXzavsF2Q/640?wx_fmt=png)

但是这里内容检测还是过不了，但是不会显示云 waf 地址或者 502 了，猜测肯定是过了 cdn， 但是不知道是什么拦截住了（可能为本地的硬件防火墙）  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPT3e6luz22kTicwUB3P4LicavO07G3utDzSR3jbciahsoRFciaGWJeD62X5Q/640?wx_fmt=png)

#### content-Encoding 绕过  

于是翻了翻笔记，找到以前屡试不爽的上传 Tips ————添加 Accept-Encoding: deflate

  
发现这种方法已经过时了，换成 Accept-Encoding: gzip 发现还是过不了这个拦截

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTZMsXDib9KHAribI2NNG4tBvK6QT2icSSiaAGsHGYAzFPuvx6dFabkCoNRw/640?wx_fmt=png)

在 http 协议中，可以对内容（也就是 body 部分）进行编码， 可以采用 gzip 这样的编码。从而达到压缩的目的。

也可以使用其他的编码把内容搅乱或加密，以此来防止未授权的第三方看到文档的内容。  

Accept-Encoding——浏览器发给服务器, 声明浏览器（客户端）支持的编码类型。

  
  
当服务端接收到请求，并且从 header 里拿到编码标识时，就可以选择其中一种方式来进行编码压缩，然后返给客户端。

发现还有一个 header 字段 Content-Encoding 这个字段大概意思是：决定文件接收方将以什么形式、什么编码读取这个文件，指定服务器响应的 HTTP 内容类型。

一般来说：

```
Accept-Encoding设置在请求头当中，会告诉服务器，我可以接受哪种编码压缩。
    Content-Encoding设置在响应头中，会告诉客户端，我用的是哪种编码压缩。但是也可以放在Header头上
```

看说了这么多我们也不懂啊，我们大概可以理解它的本质，这两个 header 头都会影响服务器对于数据内容的传输格式类型（压缩算法）。

  
大家也可以看看下这个文章

  
https://www.cnblogs.com/xuzhudong/p/8486761.html

尝试了一下，发现 content-Encoding 居然可以绕过

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTancCCrgmQYj1tQEfypj9Arvzmm8R3G8zLgkAUyJiabtax8Bd5HlmfNA/640?wx_fmt=png)

如果没找到真实 IP，这样也是过不了的。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTYrjztewH1zogF8db30uCXicZXLCzftHpaWlwiaQC3QyNzlSqbX1g50Ag/640?wx_fmt=png)

之后就可以直接上传了。

但是后来发现该服务器的 disable_function 贼难绕，这是后话了。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTjmGkmbich2HwqF1cuQFprQFIMNmYKW4VkicgxUpHepvnrPNU5jSTYseQ/640?wx_fmt=png)

  
总 结：  

```
1、通 过 host 碰 撞 找 到 真 实 IP 绕 过 云 waf(fofa 这 种 是 搜 不 到 真 实 IP 的)
2、Content-Encoding=deflate 绕过本地防火墙内容检测
```

**gzip 也是能绕的**  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSETPru974yUneBn0AMTuwPTAcdzEVeFocNbG4iaQ8wGySTicmx0mR9jGkXt7cIiasTTb6ey2ZIyeUy4A/640?wx_fmt=png)

声明：本公众号所分享内容仅用于网安爱好者之间的技术讨论，禁止用于违法途径，**所有渗透都需获取授权**！否则需自行承担，本公众号及原作者不承担相应的后果.

@

**欢迎加我个人微信：zkaq99、**实时分享安全动态

* * *

**防丢失**

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSHgvVpick2qWW2vFsCx8rQbPH81BDEjjmcTWx9fqnqFGibDKvcGM2H7L313cBAGMoZ5yLEXkkVia4cAw/640?wx_fmt=jpeg)

[

Burpsuite 在各场景下的抓包方法 (整理)

2021-08-11

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGxyQDNlLJqgCtl0uVbspVnw7mIx6WzWt0EyBfIZ4TEg0xoVhnq0aQ1C3LAwTjqkkBBQVuGCVmbbQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247530928&idx=1&sn=46ce72097822348cd6d17e2941e60db6&chksm=ebea309ddc9db98bece713fa8eec5b2c9f47cdfb5921c976319c555d627dcd3ec2dc1dee58b6&scene=21#wechat_redirect)

[

【精选】SRC 快速入门 + 上分小秘籍 + 实战指南

2021-07-26

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSG4hnDrcfyBr4yp6gXLibsXuBFUwfZlEFxK6tMHyUPcQlkWKhoafcKcoh8X6nw6O359kfhkHDYoLmg/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247528604&idx=1&sn=5ab3a5b3eaf0c56fcdeabccadfdc6bde&chksm=ebea39b1dc9db0a71fa71d233709afdfd2e2e0483ded28cca42044eded300f1c7025bde1b37a&scene=21#wechat_redirect)

[

干货｜列了几种均能过安全狗的方法！

2021-07-01

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSG24NfnFAyvceedkicO9fPkUwQ9X1L8owPwAichgQibfKV9RPxFibr8ia1JmdjjyFSGlUu97qfecE9iczCQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247524943&idx=1&sn=98644144a3c10bb068ec0f310dcc4958&chksm=ebea2b62dc9da2749321fce7ab28788ced08a2b496e0a45b06a5887b5aa457e48f7a66110301&scene=21#wechat_redirect)

[

巧用 FOFA 挖到你的第一个漏洞

2021-06-08

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSEJumG6X6C1M75AVwnphgU4wO2tIdSFib6hV6m4GLica2XGIEP1ujeNm1WVia1S6wFOV4RBB13FoxXIw/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247521952&idx=1&sn=55ab0613e5a7ba79b78849b4d91451f6&chksm=ebeadf8ddc9d569bcc64e99414dcbe6878a0b2c9f5c057b30c4bbe465ba76fcaa64e66caa0c2&scene=21#wechat_redirect)

[

那些年的 Hvv 日记

2021-04-17

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSFRZS6XmvwR7KNeLGxuk6C4NDAawNMNvfHW7iacLEa7nYTUTCDQrfQcvRdfShEKtv7W9DWSufrYKlQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247515246&idx=1&sn=b1a73a93f8ce9a5d51ce3bed4ada1e56&chksm=ebeaf543dc9d7c557c36881cccaaffad5312938ad0450dc1e4050de583523c2a27ba5ab3a469&scene=21#wechat_redirect)

[

一名大学生的黑客成长史到入狱的自述

2020-12-22

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGzeY0rLibT3cqh51icktS1tKjpxm4A8ib17UC35kYoXLiak8X7Ugtu2rW2BRth3X5vKickew16jMibak2A/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247502926&idx=1&sn=8750295399cdcc5e71918c30bb1a974f&chksm=ebea8563dc9d0c75cdf709d2d16fdbdf82abee64516f7a44347f40056969d1b4bc3a1eb2ab2e&scene=21#wechat_redirect)

[技术揭秘：如何分析菜刀是否包含后门？](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247496122&idx=1&sn=3f85b9e357f9cf3ea2497de34c523221&chksm=ebeab897dc9d3181e026ac971b5d17d4d5490298a4e0d8d00e39020892791f9cb171f621d444&scene=21#wechat_redirect)

[2020-10-23](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247496122&idx=1&sn=3f85b9e357f9cf3ea2497de34c523221&chksm=ebeab897dc9d3181e026ac971b5d17d4d5490298a4e0d8d00e39020892791f9cb171f621d444&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSHhV4muTBk1V7CXJP0nAxEI1TIjU4mUV6z1jdoE73UtlCpTK64xKXquNXD8bHLGU8VZCjAFbxCcpw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247496122&idx=1&sn=3f85b9e357f9cf3ea2497de34c523221&chksm=ebeab897dc9d3181e026ac971b5d17d4d5490298a4e0d8d00e39020892791f9cb171f621d444&scene=21#wechat_redirect)

**看到这里了，点个 “赞”、“再看” 吧、**