<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/pFxd5p7DcJIbepWefOHmSQ)

参考原作者视频

```
https://www.bilibili.com/video/BV1Mq4y1v7WC?spm_id_from=333.999.0.0
```

  

前言:

Powershell在渗透当中或多或少都会使用，但杀软对于powershell看管的很严格

  

  

测试环境：物理机+最新版的360

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/rFvFNYa3ibHauw1LW2og9QMWtJcWsWibDOKM5JOZF2tTAxCln4QRdp7rsc1wqmicNsKfDRPYZeXjk5ic2VwCcgAib7Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

首先我们假设已经拿到了webshell或者上线到CS，能够执行命令，执行PowerShell代码，如下所示

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

发现被360给拦截了 ，也就是正常的输出命令也被拦截，能说明跟代码没有任何的一个关系，就是禁止你调用PowerShell这个进程

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

绕过方法:

微软提供的一个dll

```
C:\Windows\Microsoft.NET\assembly\GAC_MSIL\System.Management.Automation\v4.0_3.0.0.0__31bf3856ad364e35
```

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

  

部分代码:

```
`byte[] psshell = Convert.FromBase64String(ps);``string decodedString = Encoding.UTF8.GetString(psshell);``Runspace rs = RunspaceFactory.CreateRunspace();``rs.Open()；`
```

  

  

把上线命令进行base64编码

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

成功上线

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

结果:360全程没有任何拦截

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

绕过并创建计划任务  

  

用PowerShell创建计划任务

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

发现被拦截

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

把powershell进行base64编码

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

执行我们的powershell代码  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

结果: 成功写入进去

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)