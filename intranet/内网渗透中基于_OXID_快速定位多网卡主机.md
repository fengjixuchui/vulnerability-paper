<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/aEtBM8Bi9YBCBKay-K-VUg)

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/GiclhPbvFYkCXrGfXGVnNdC4XE5PDSODs3iabibU0J4ot0JTo3ombzCN005khpVMb4ezVg9cywOTPgkHwhrocGgAg/640?wx_fmt=gif)

**1、背景**  

    在红队行动中，通过前期打点拿到一台边界主机或者 DMZ 区主机的权限后，攻击者需要尽可能完整地定位内部网络体系架构，如果仅仅只是通过扫描或者分析本地网络路由以及跳点等，所能获得的信息微乎其微。如何如何更快速的定位多网卡主机实现跨边界渗透是内网渗透中最重要的一环。

    在本文中将实现无需任何身份验证的情况下，通过 135 端口在 Windows 操作系统机器上实现网络接口的远程枚举。

**2、OXID 解析器交互分析**

    OXID 解析器是在支持 COM + 的每台计算机上运行的服务。它执行两项重要职责：

存储与远程对象连接所需的 RPC 字符串绑定，并将其提供给本地客户端。

将 ping 消息发送到本地计算机具有客户端的远程对象，并接收在本地计算机上运行的对象的 ping 消息。

**3、抓包分析**  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/GiclhPbvFYkDGhQzrd1DK8ibg4zaH5QcetwjCRaEntgLV0465bVy51JyXJX5ic2njqZUrl2cCIsWSOQFEGW5S6oHg/640?wx_fmt=png)

经过 TCP 三次握手以及 dcerpc 协议，第五个数据包返回了目标机器的 Windows 网络配置信息、主机名

![](https://mmbiz.qpic.cn/sz_mmbiz_png/GiclhPbvFYkDGhQzrd1DK8ibg4zaH5QcetVhVucbibUy2esKLoicTS4fCPjy1uLnQaIeLBJA7NcbgBibTm7NSiaxpgXA/640?wx_fmt=png)

```
"\x05\x00\x02\x03\x10\x00\x00\x00\xec\x00\x00\x00\x01\x00\x00\x00" \
"\xd4\x00\x00\x00\x00\x00\x00\x00\x05\x00\x07\x00\x00\x00\x02\x00" \
"\x5d\x00\x00\x00\x5d\x00\x47\x00\x07\x00\x44\x00\x45\x00\x53\x00" \
"\x4b\x00\x54\x00\x4f\x00\x50\x00\x2d\x00\x41\x00\x44\x00\x47\x00" \
"\x33\x00\x33\x00\x31\x00\x32\x00\x00\x00\x07\x00\x31\x00\x39\x00" \
"\x32\x00\x2e\x00\x31\x00\x36\x00\x38\x00\x2e\x00\x38\x00\x30\x00" \
"\x2e\x00\x31\x00\x00\x00\x07\x00\x31\x00\x39\x00\x32\x00\x2e\x00" \
"\x31\x00\x36\x00\x38\x00\x2e\x00\x32\x00\x30\x00\x31\x00\x2e\x00" \
"\x31\x00\x00\x00\x07\x00\x31\x00\x30\x00\x2e\x00\x32\x00\x30\x00" \
"\x2e\x00\x35\x00\x36\x00\x2e\x00\x38\x00\x33\x00\x00\x00\x07\x00" \
"\x31\x00\x3a\x00\x3a\x00\x32\x00\x35\x00\x36\x00\x3a\x00\x66\x00" \
"\x64\x00\x00\x00\x00\x00\x09\x00\xff\xff\x00\x00\x1e\x00\xff\xff" \
"\x00\x00\x10\x00\xff\xff\x00\x00\x0a\x00\xff\xff\x00\x00\x16\x00" \
"\xff\xff\x00\x00\x1f\x00\xff\xff\x00\x00\x0e\x00\xff\xff\x00\x00" \
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/GiclhPbvFYkDGhQzrd1DK8ibg4zaH5QcetAsCOfLiakoWkKtxE5toVoauk7RZF8tiav0BYjK9d0dHO0L4e0rJLATSg/640?wx_fmt=png)

登录该主机查看该信息是否正确

信息一致。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/GiclhPbvFYkDGhQzrd1DK8ibg4zaH5QcethC0og3IBrkOnlvZEtWSgLkiaUqcadVYomaj10f4W0qzYj9yf3Py9DXQ/640?wx_fmt=png)

**4、利用脚本**  

https://github.com/Rvn0xsy/OXID-Find/

**参考**

[1] 分布式组件对象模型 (DCOM) 远程协议

https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-DCOM/%5bMS-DCOM%5d-171201.pdf

[2] Impacket

https://github.com/SecureAuthCorp/impacket