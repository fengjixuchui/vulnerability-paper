<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/kJsyXXpMM3KVqZRUA6sGJw)

前言

首发在知识星球,没想到有这么多表哥来交流。

  

1

最近遇到海康多一点，但是无法直接进后台。

发现很多js会存在泄漏key和secret

可以直接访问到摄像头。

不止一次遇到。

  

  

1

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/MzKvKJKNPPfx0FXibr61KMx5ZHfJtWDaxStnDKKpqjuFia0fjHu6NP1GzYNsxG24yibcAlVfWBqXKkmoodVibUnCAg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

js发现

![图片](https://mmbiz.qpic.cn/mmbiz_png/aukmFcvZ9rXV8YRH9BRtg6YwuMJtjWXmAtibU0egYvVevOCoEcjl5zJjbjjPAMaIGR1CYmIKe4XTeQS56DcsLRA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/eycUesMAvEaf49NVG3GOdGWKvgMVibNymv72yQHZGaIEncgEx8RbictXxTpUyJpCHCCKrBd8NA2H2bicItyq4zcag/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

进行js多次查看发现存在jsconfig的调用。

  

  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmT2IPRNVJzSuibhZdL9aXISIEIKtxMplfDm6icd9iaPbCUia2FJd40ktRoXySKicYLjTWIaHDiaibh6j7YA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmT2IPRNVJzSuibhZdL9aXISFQKGhd89Oictx5ZzG1GeH9kxKHW4hCiaYlKH28cSUhyC83bW1xNRrmfw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

又比如burp中某一个js请求包。

  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmT2IPRNVJzSuibhZdL9aXISmecn8GGAoWzETDmW8YrYFsuc32kXC7l4IRNxm8z7gnj7U0Pk5sDdoQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

上述都泄漏了appkey和Secret,

有的叫法可能也是User或者Passwd大同小异

appkey就是user 由一个8位数数构成:23412412

Secret就是passwd，由21位的密钥构成:QfQPss5GOac9Bjxkfuv3

  

和阿里云/企业微信的Token——Secret泄漏一样,都可以进行api调用。

这里可以直接访问到所有摄像头  

2

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

利用过程

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

官方提供api接口文档

  

```
https://open.hikvision.com/docs/docId?productId=5c67f1e2f05948198c909700&version=%2Ff95e951cefc54578b523d1738f65f0a1&curNodeId=16741aecc05944a6b0cd1341d68e4546
```

  

1./api/resource/v2/encodeDevice/search接口,获取权限的编码设备列表

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

2./api/resource/v1/cameras 获取cameraIndexCode  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

3./api/video/v1/manualCapture 带cameraIndexCode去获取摄像头的Picurl

  

```
`{``"cameraIndexCode":id号,` `"pageNo": 1,` `"pageSize": 1000``}`
```

  

3.会获取如下图的picUrl,直接访问就是摄像头的画面

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

3

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

另一种方法

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

利用rtsp协议去访问

  

利用/api/video/v2/cameras/previewURLs 接口 。获取获取rtsp协议摄像

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

这里借助借助VLC media player 播放去访问rtsp协议摄像头

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)