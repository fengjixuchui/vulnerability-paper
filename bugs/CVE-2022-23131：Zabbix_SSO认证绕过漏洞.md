<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/aZ2mhFaT3fO6QrULwZ3WKQ)

  

**上方蓝色字体关注我们，一起学安全！**

**作者：****lalalashenla****@Timeline Sec  
**

**本文字数：462**

**阅读时长：2～3min**

**声明：仅供学习参考使用，请勿用作违法用途，否则后果自负**

**0x01 简介**  

  
  

zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。  
  

**0x02 漏洞概述**  

  
  

在启用 SAML SSO 身份验证（非默认）的情况下，恶意行为者可以修改会话数据，因为存储在会话中的用户登录未经过验证。未经身份验证的恶意攻击者可能会利用此问题来提升权限并获得对 Zabbix 前端的管理员访问权限。  
  

**0x03 影响版本**  

  
  

Zabbix 5.4.0 – 5.4.8  
Zabbix 6.0.0alpha1  
  

**0x04 环境搭建**  

  
  

自行搭建靶场  

在Authentication处  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjVnZygOiaLvAKDPgBw7gtyGXRfAKhyhJFmcVJo9VaeqqMicK5AzvhgxPWGJnBIysJpqsGqrbD8PXCw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  
SAML settings处开启SAML认证

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjVnZygOiaLvAKDPgBw7gtyGQ6kFF42iaTVGW9wnBhLibAbME7keo121nkzJAL2jrpNicWiccqtiaPgeYNw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

开启后登陆页面出现Sign in with Single sign-on（SAML）选项  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjVnZygOiaLvAKDPgBw7gtyG0nibyRhQ3TiannwhXQ35pGWLP2RiaNyxmXicdp73ZJLWnapHH3GCupwjvg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x05 漏洞复现**  

  
  

对下方SAML登录链接进行抓包

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjePfiakVWTPTWId9VaUCn7BoweFNKSib8KszOdNAh5qtic2icTk3F29oRAtUK3exu0EClpnCatRNv1Xw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

将zbx_session解码

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjePfiakVWTPTWId9VaUCn7BLDuXkOjEiafgtLMZZY8u3pmLYiaHUCe73ibhNibibVblOkaoVxDRymwparA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjePfiakVWTPTWId9VaUCn7BXOuqFzOa8u4LC4oRB1hviaEdjFZwTsHmy0R5ZWAsjlhbqS27s9ibuWEw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

将解码出来的与" {“saml_data”:{“username_attribute”:“xxxusername”} "拼接在一起，即：

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjePfiakVWTPTWId9VaUCn7BPbibp3GU73VmMwew4YDiaW6llqPIxTm7oauztgI15cKUiceEOEm8o6R8Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

替换抓包中的zbx_session：

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsjePfiakVWTPTWId9VaUCn7BKCvWmjQ0qFnGgCdhwyaLjNIVEBuR5LYSRGK4DbuIXLYwu90dduvouw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

替换后即可成功登陆

  

**0x06 修复方式**  

  
  
  

1、禁用SAML身份验证  

2、目前厂商已发布升级补丁，补丁获取链接：  

https://support.zabbix.com/browse/ZBX-20350  

  

**参考链接：**

https://blog.csdn.net/weixin_44309905/article/details/123014461  

http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202201-1030  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/VfLUYJEMVsiaASAShFz46a4AgLIIYWJQKpGAnMJxQ4dugNhW5W8ia0SwhReTlse0vygkJ209LibhNVd93fGib77pNQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/VfLUYJEMVshAoU3O2dkDTzN0sqCMBceq8o0lxjLtkWHanicxqtoZPFuchn87MgA603GrkicrIhB2IKxjmQicb6KTQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

**阅读原文看更多复现文章**

Timeline Sec 团队  

安全路上，与你并肩前行