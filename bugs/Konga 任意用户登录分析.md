> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/8guU2hT3wE2puEztdGqZQg)

公众号

介绍

首先呢，先了解下 Konga 是什么东东 (有点多余，知道有漏洞就行了!)

了解 konga 之前呢，先了解下 Kong：

**Kong 是一款基于 OpenResty（Nginx + Lua 模块）编写的高可用、易扩展的，由 Mashape 公司开源的 API Gateway 项目。**

Kong 是基于 NGINX 和 Apache Cassandra 或 PostgreSQL 构建的，能提供易于使用的 RESTful API 来操作和配置 API 管理系统，所以它可以水平扩展多个 Kong 服务器，通过前置的负载均衡配置把请求均匀地分发到各个 Server，来应对大批量的网络请求。

那么它的功能呢，有以下这么几点 (百度抄来的):

*   高级路由、负载平衡、健康检查——所有这些都可以通过管理 API 或声明性配置进行配置。
    
*   使用 JWT、基本身份验证、ACL 等方法对 API 进行身份验证和授权。
    
*   代理、SSL/TLS 终止以及对 L4 或 L7 流量的连接支持。
    
*   用于实施流量控制、req/res 转换、日志记录、监控和包括插件开发人员中心的插件。
    
*   复杂的部署模型，如声明式无数据库部署和混合部署（控制平面 / 数据平面分离），没有任何供应商锁定。
    
*   本机入口控制器支持服务 Kubernetes。
    

了解完 Kong，**我们再来说 Konga，简易来说，其实就是图形化的用来管理 Kong 的一个系统。**

漏洞描述

那么上面功能介绍也说了，它调用 api 呢是使用 jwt 做的身份验证，一般没有点安全意识的去 docker 装个 Konga 谁还去专门去改下 jwt 的默认密钥呢！

是不！

图下：通过图可看到默认 key 为：oursecret

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdM28U9hUAtDCiacAmT1BN0ic7KEUtJGPhOOr7xjHfN4ogNWYoVMVhtAXSA/640?wx_fmt=png)

**那么我们再去看看他是通过那些参数去进行的 jwt 加密：**

从图下可看到：它是通过 UID 进行 jwt 加密返回的。

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMoVqHpXfjIyb6SBO5ibMqMPhPJibcbpBYhpK4HuXs7G15icCuticYEY1upA/640?wx_fmt=png)

漏洞复现

那么我们就可以去漏洞利用一下了：

首先呢，访问 jwt 的官网:  
https://jwt.io/#debugger-io

然后通过如图的方式生成一个 jwt-token，从箭头处可看到一处放 uid，一处放 Konga 的默认 key。

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMxurQvicqnW8T4HbwvBz5wxmicoB8Weic0SIjQV2jdCwvPwtlA0klVUPtA/640?wx_fmt=png)

通过左边生成的 token 就可以以管理员身份访问后台任意接口了。

我们还是找个倒霉鬼实验一番把：

首先呢我们访问的这个接口是需要身份验证的。

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMgmF0AgY8DNiaRBzgELhcUdb89BBLJOzucGZ9dQibUNy2JVUqkE8TLx0g/640?wx_fmt=png)

然后的我们把刚才 jwt 网站生成的 token 加到请求头中：

可以看到，是成功获取到数据的。

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMNgysib2JQicEbpHLOtLCp5BhnOdeuWfiagyNXiaOmq3ZV98nGyPY6vAaHQ/640?wx_fmt=png)

我们也可以试试用户管理的接口：

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMJ8sjA1icicTiajVpKmxjnrYh8pamOPPWATIicjz3u7Q0dBKCZiaExkLQooQ/640?wx_fmt=png)

好了，到这里就分析结束了。

这里多嘴说一句：

**Konga 的默认密码为 3 个 admin，我有理由相信 100 个你们中，有 99 个字典里不会有这个密码！**

反正我是没有。

![图片](https://mmbiz.qpic.cn/mmbiz_gif/0Z0LqMyVGaQp4egQCAlAUl2EwqtzhtdcaHyLcHhgYQGyrZUkVorovOdXmk7dMWWu4xJKEicTWCDWS8vU6hpYWUg/640?wx_fmt=gif)

【火线 zone 社区周激励】

2021.11.22 ～ 2021.11.28 公告

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMUxSOA0ibdBj1r4u1G97H90Jiams8gK1GSGFp1VEmHEFxALicdic9mRprAw/640?wx_fmt=png)

【相关精选文章】

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaRz0QEOD2W734vZWicBibEvO5hjW2uWmgLwd873dIERyIRQf11MxCAekPicnSwY8TiaI9F0Utxic6XhJ8g/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247489985&idx=1&sn=fc326c022037e6921ea4c2c187d00fb6&chksm=eaaa91e1dddd18f757f723640ccb11e9288f3f21128b1fd76f4ba65dffab58216e0c66db3d83&scene=21#wechat_redirect)

  

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMPcp3oyUvxmoUGyKdOAs0iaSFwxLWxPryP8Eysovz1wibUkcWwQg4ictAQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247490058&idx=1&sn=8d68144588fefe513720e4ca19cfadfd&chksm=eaaa922adddd1b3c0e8d143653356b96acfb6014eb07cf4ec89b7798335ef39d61b20eda4e5b&scene=21#wechat_redirect)

![图片](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMjcibW4dZBeAO97fTHNySjKA0lqfiaWXfVUVfHiawIhzlFKoia4kD9g1geA/640?wx_fmt=png)

火线 Zone 是 [火线安全平台] 运营的封闭式实战安全攻防社区，研究讨论实战攻防技术，平台向顶尖的白帽子提供安全测试的云端基础设施，目前火线的高级白帽子数量已经近万人，欢迎具备分享和探索精神的白帽子加入火线 Zone 社区，共建一个有技术氛围的优质社区！

如需转载火线 Zone 公众号内的文章请联系火线小助手：hxanquan（微信）

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/0Z0LqMyVGaQL1vIzYc2ictDEOukBEibCdMFJwn8KgPsRib537Q7ZRd4ZVKVmqy4MZTDqPnC423TMb77FCv1LKVbaQ/640?wx_fmt=jpeg)

//  火线 Zone //

微信号 : huoxian_zone

![图片](https://mmbiz.qpic.cn/mmbiz_gif/CkzQxaHZX9KdW919vwagVwhCeicQPXuMGibHcf2WqiaFyvfy5p1oIk1C5SOdtTyLlQmOtEia7FMKicknJzGTmYLWb2Q/640?wx_fmt=gif)

点击阅读原文，加入社区，共建一个有技术氛围的优质社区！