<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/YELZB900vbbnrkeDgBToDg)

**0x00 前言**
-----------

**fofa : body="Bitrix Virtual Appliance"** **影响: 3k**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5cbbsZPyGbqwFjVFLYe2LBj5riawanvZDhH9hYEOQVoP8T5JicuDa2swBXQ3wwEDdbsQ5O1h2NERdCg/640?wx_fmt=png)

**Bitrix 是俄罗斯的一套 cms 系统，在 <=7.5.0 版本时存在安装时任意文件上传漏洞.**

**0x01 复现**
-----------

**首先点开左下角的链接 => Восстановить копию**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5cbbsZPyGbqwFjVFLYe2LBjkG5BCVcR9ekdjmM0icLUCp9xDbzxEgqxxGs3UMPhLQDyagUKJqdBnWA/640?wx_fmt=png)

  
点继续.  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5cbbsZPyGbqwFjVFLYe2LBjiagdFsJibYQibqujLLTd19cus4ZHWV5HDibN1TXujozibdQ9wUNZicjVysFA/640?wx_fmt=png)

  
选择第三个选项并上传 Webshell 文件  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5cbbsZPyGbqwFjVFLYe2LBjWY9UZHUhr5GkmCUiaJsgOFFxoDfKx2ojYl4RW0XHY084onGr1Pf5lwA/640?wx_fmt=png)

  
当出现红色字体时说明存在漏洞，shell 已经成功上传在根目录.  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5cbbsZPyGbqwFjVFLYe2LBjUmTjqibevicIKeiannzfqFGr7TaM8tibcWibPbiaSaE33WVLopJzt8aiaGj2g/640?wx_fmt=png)

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5cbbsZPyGbqwFjVFLYe2LBjhgZtYK0jrt4ibwzRrhoxWuHdCjGPqJN1W2BCdgEJKxiaUNUiatRwVWFPw/640?wx_fmt=png)

**实际上就是 move_uploaded_file** **直接能传****.**

```
  elseif ($source == 'upload')
  {
    if (!count($_FILES['archive']['tmp_name']))
    {
      $ar = array(
        'TITLE' => getMsg('ERR_EXTRACT'),
        'TEXT' => getMsg('ERR_UPLOAD'),
        'BOTTOM' => '<a href="/restore.php?Step=1&lang='.LANG.'">'.getMsg('BUT_TEXT_BACK').'</a>'
      );
      html($ar);
      die();
    }
    foreach ($_FILES['archive']['tmp_name'] as $k => $v)
    {
      if (!$v)
      {
        continue;
      }
      $arc_name = $_FILES['archive']['name'][$k];
      if (!@move_uploaded_file($v, $_SERVER['DOCUMENT_ROOT'].'/'.$arc_name))
      {
        $ar = array(
          'TITLE' => getMsg('ERR_EXTRACT'),
          'TEXT' => getMsg('ERR_UPLOAD'),
          'BOTTOM' => '<a href="/restore.php?Step=1&lang='.LANG.'">'.getMsg('BUT_TEXT_BACK').'</a>'
        );
        html($ar);
        die();
      }
    }
    $text =
    '<input type=hidden name=Step value=2>'.
    '<input type=hidden >';
    showMsg(getMsg('LOADER_SUBTITLE1'), $text);
    ?><script>reloadPage(2, 1);</script><?
    die();
  }

``` 

**免责声明：****文章中涉及的程序 (方法) 可能带有攻击性，仅供安全研究与教学之用，读者将其信息做其他用途，由读者承担全部法律及连带责任，文章作者和本公众号不承担任何法律及连带责任，望周知！！！**
======================================================================================================