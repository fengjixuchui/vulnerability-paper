> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/RzhF4_Zz00RTB1iQFquqoA)

  

  

网安引领时代，弥天点亮未来 

  

  

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x00故事是这样的**  

  

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hBe9qrC6cvGgqyvucUIlZoKuo47g1O9icB0sYmNQQicFUcnLQtHtDNNwsfUQ1U7zyl1fz35eGNq2pCA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

程序版本:

**EyouCMS-V1.5.9-UTF8-SP1**

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hBe9qrC6cvGgqyvucUIlZoKZIUDp9yqUVcdPVK3JormOM1IoEF6YQ0tccfKvDyiavEp9fibbDQhwaEg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hBe9qrC6cvGgqyvucUIlZoKyPLADeQ5EHCVRQ3fib2RmbYxlhwrSeW7rx3O4iaf9xm4QmhdsWUiapE2Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

漏洞复现：

**1.选使用一个账号429588851@qq.com找回密码，点击发送。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**2.这个时候429588851@qq.com会收到验证码8589。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**3.然后填写验证码8589,同时把账号修改成另一个账号q601333824@vip.qq.com。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**4.这样就跳转到密码重置页面了，就可以重置对方的密码了。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**5.测试登录，成功重置了q601333824@vip.qq.com邮箱对应账号的密码了。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

漏洞分析：

**1.漏洞文件:\user\controller\Users.php 代码行数1368行。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**2.验证码查询条件如下:**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**3.查询条件code(验证码)和lang(语言类型)，缺少email参数,从而验证码没有和发送邮箱进行绑定,导致可以使用数据库中存在的任意验证码去重置前台用户密码。**

修复方案:

**1.只要查询条件加上'email' => array('eq', $post['email'])就能修复,因为这样可以让邮箱和验证码进行绑定操作。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**2.欢迎大家关注弥天安全实验室公众号。**

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==) 

  

知识分享完了

喜欢别忘了关注我们哦~

  

学海浩茫，

予以风动，

必降弥天之润！

  

 弥  天

安全实验室  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)