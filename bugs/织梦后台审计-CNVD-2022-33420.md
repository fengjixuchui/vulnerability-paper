<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/6MdW6pEnVpWqKr9u_UO_9Q)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/FlVldQMtUg1yYoic9jIrbicqTk7cqGBKzAXfMiahvPwO9njbqI7W11RMFCU0YED3ibSUBRiahp2BHbMrl2Mf5XATypw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

漏洞介绍  

![图片](https://mmbiz.qpic.cn/mmbiz_png/4tFX0yPcrrjicx2V9rWgT008ubiaJJG1bNibQZKe6zribxia56R9jBsYX45SpZvTdhwE3phw4zyLyD46JJzaLic3c9dw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/tYCsq548t3ic3XajhCuu3HEnT5ptCn2rxSawia4LLyVb2M4AdbibuNKCnuBGicJicGMxibMhsXOvvAXH9shpabicQGUVw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/KCA6lb3uZgZSrchcNOUK1gYjovEibfAp3WNHIFYQtX6nFTd1dR8tqPaDOgXZiadQFL5jFxNJWaflEQDTicl48XSdg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/N6icJLL4icia5ct1a3ibjL1cEAoNGTeArxnTAavb6OQZDRdkyiarDsMP4kvECRlYStSWsjfNgK4JX1UEIBrB7FsQ7nQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/z1wOHsa77HsOPM20iboFjaic3sh0U4PluLd2NibuPZ3FF585wY49zARBgg9FLichc9zNjRuzPmwzfzglUQicibEETTBg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

织梦后台可以直接上传文件，或者上传zip文件，但是随着织梦的更新，后台文件上传也加了过滤，导致黑客无法直接上传恶意文件

![图片](https://mmbiz.qpic.cn/mmbiz_png/GqvNxxBRfVobteeL0U8jg3AXAcnbPCe7ydeKl40ibWmXaIgFTLhdRRHliaG4jbXYBEtcWvMMpw9C8Z5ib8Y1pDDJA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HKo9WD2Zr4zI2QOu4tL4CwSmUJWgrjpGa06V3VkPaZ4AFw0dDlzehSkZcxrFeOyt3VOqgJsltibMyiadibw9aeUUQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibrDpQPJOmGPIpDPAhdx29SJeia448dgxiaCcic1DWyJ4PpTjicRZZX0BneVG5kXuHnc8ksMDvEdfmqicD0SRD8V4Clw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/QABjQccnicQqXUKYAic0n1ficpN4zRNj8PSMPrBkMbwq9ZzRZap5iazjZafWY0nNPvssFMM5Ur4AmFznjUdl54VNQQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/N6icJLL4icia5ct1a3ibjL1cEAoNGTeArxnTAavb6OQZDRdkyiarDsMP4kvECRlYStSWsjfNgK4JX1UEIBrB7FsQ7nQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

一经上传，就会被拦截

![图片](https://mmbiz.qpic.cn/mmbiz_png/GqvNxxBRfVobteeL0U8jg3AXAcnbPCe7ydeKl40ibWmXaIgFTLhdRRHliaG4jbXYBEtcWvMMpw9C8Z5ib8Y1pDDJA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HKo9WD2Zr4zI2QOu4tL4CwSmUJWgrjpGa06V3VkPaZ4AFw0dDlzehSkZcxrFeOyt3VOqgJsltibMyiadibw9aeUUQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/ibrDpQPJOmGPIpDPAhdx29SJeia448dgxiaCcic1DWyJ4PpTjicRZZX0BneVG5kXuHnc8ksMDvEdfmqicD0SRD8V4Clw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/QABjQccnicQqXUKYAic0n1ficpN4zRNj8PS5GqUO7olh9I4w505ibBV6fFAbkAzKAC3d7u5ibfJfqelNGrxQThw8qAw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

开始审计，看看，开发都过滤哪些函数，首先是【/dede/article_string_mix.php】

过滤函数在29行

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

    - 这里就放两个文件的过滤函数

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

    这里我们可以清晰的看到，开发都过滤了哪些危险函数

回到上一个页面，看看开发的逻辑

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

    黑名单在手，天下我有，查看哪些恶意函数，不在这个黑名单内，【preg_replace】这个函数不在黑名单内，这个函数是正则匹配函数，但是加了【/e】修饰符的话，就会执行php代码

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

    点击保存，查看木马是否成功执行

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

    - 这个危险函数，可以绕过织梦的所有上传文件的检测，这里我就不一遍一遍的试了

  

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

XSS漏洞

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

   - 织梦目前挖掘到了三处3xss，一处可以打到前台【可以配合木马钓鱼】，两处可以获取cookie，一处只能简单的弹窗【这个并没有什么用】

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

    - 第二处：网站栏目管理 -> 增加子类 -> 输入xss即可，这里可以打到cookie

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

    - 第三处：后台添加友情链接可以打到前台xss

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

    - 还有一个没啥用的逻辑漏洞，这里我就不掩饰，只是简单的说一下，你可以在别人评论的地方后面，无限的刷赞，或者踩，只需要点赞，抓包，扔给跑包模式，跑就可以了

  

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

*-*此漏洞已提交CNVD*-*

  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

**免责声明**  

由于传播、利用本公众号NGC660安全实验室所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号NGC600安全实验室及作者不为此承担任何责任，一旦造成后果请自行承担！如有侵权烦请告知，我们会立即删除并致歉。谢谢！