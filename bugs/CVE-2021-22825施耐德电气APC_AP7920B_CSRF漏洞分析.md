<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/jzV1ezL_36excExFR2X0JA)

**![图片](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
------------------------------------------------------------------------------------------------------------------------------------------------------------------------

施耐德电气/APC AP7920B是一种机架式配电单元（PDU）设备，用于能源、交通和水/废水系统等物理基础设施。如果攻击者获得对PDU的特权访问，可以使设备重启，这将会危及正常运行时间，或者带来难以预估的影响。

Part1

漏洞状态

<table interlaced="enabled" style="visibility: visible;"><tbody style="visibility: visible;"><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">漏洞细节<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">漏洞POC<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">漏洞EXP<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">在野利用<br style="visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">有<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">无</td><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">无</td><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">无</td></tr></tbody></table>

Part2

漏洞描述

<table interlaced="enabled" style="visibility: visible;"><tbody style="visibility: visible;"><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞名称<br style="visibility: visible;"></td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">施耐德电气/APC AP7920B将敏感信息暴露给未经授权的攻击者漏洞</p></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">CVE编号</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">CVE-2021-22825</p></td></tr><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞类型</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">CSRF</p></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞等级</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;">6.5中危（Medium）</td></tr><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">公开状态</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;">公开<br style="visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="145" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞描述</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">当特权账户单击破坏安全令牌的恶意 URL 时，攻击者可以使用提升的特权访问系统。</p></td></tr><tr class="ue-table-interlace-color-single" style="word-break: break-all; visibility: visible;"><td valign="middle" align="center" colspan="1" rowspan="1" style="word-break: break-all; visibility: visible;">时间线<br style="visibility: visible;"></td><td valign="middle" align="left" colspan="1" rowspan="1" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">2021年1月6日 &nbsp;CVE分配</p>2021年12月21日公告发布</td></tr></tbody></table>

受影响版本：

带有NMC2的AP7xxxx和AP8xxx：v6.9.6和更早版本

带有NMC3的AP7xxx和AP8xxx：v1.1.0.3和更早版本

带有NMC3的APDU9xxx：v1.0.0.28和更早版本

Part3

漏洞分析

AP7920B PDU通过两个并发秘密处理用户会话，在HTTP cookie标头和HTTP请求的URL内传输以跟踪用户会话的cookie和令牌示例：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

AP7920B允许配置“插座（outlet）”用户，该用户可以访问与设备用户相同的菜单（对设备相关屏幕具有读写访问权限），但更改配置、控制设备、删除数据或使用文件传输选项的能力有限。当插座用户登录设备时，将只能查看或控制已分配给插座用户的插座。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBvRuGe4Mk5sujGtRC9AYiaF3q7VTglGP4AcNiaF63BRicO6l11KSdAS8TA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

Outlet Configuration页面允许用户配置一个外部链接，单击该链接会打开一个新的浏览器窗口。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBd6mMCRn8GY2FpKzCJwpc3KpwF89tooKyj6wujkicjuGiaz9Euta2DOlA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

AP7920B配置页面中的外部链接未使用'rel=”noreferrer”'强化属性或已定义的引荐来源网址策略进行设置，也没有应用程序定义的引用策略。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBXMHUZA8CQHK5BbVd9sl5dfR3jWMlftAgb8ChI7TcHX9eiaKqGBrEy9w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBoyuakA3omm1LQLOlDJ5zFLYt6EA6JozAkMzprnJ3eICT0IU6iaW6tRw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

除非浏览器专门应用了缓解措施（例如，默认情况下使用“strict-origin-when-cross-origin”策略而不是旧的“no-referrer-when-downgrade”策略），否则可能会出现安全问题。用户可以单击应用程序中定义的链接，完整的HTTP Referer标头（包括用户会话令牌）可能会发送到链接的外部域。

用于配置关闭第二个出口的跨域请求示例。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBiaTiagkUucN868J1yyDAy4SHsqwd1xt5obrJq8hz387CFKIMibsKQ26xA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

有权访问插座1的插座用户能够在插座配置页面中插入一个链接，使他们能够获得与插座2交互所需的权限。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEB0tFxPlwrxPPRVPCKmfgJfn7iau90urJOODgkpibkic3wzmicWRZSOHUyEw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

插座用户可以创建一个任意的“后门”用户，该用户具有从合法管理员单击恶意链接获得的管理权限。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBby9ic55LNNAZsqtseEl4AffP9ToKdgDZWGhaiaHdLcNicSrunFVB0kHwg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

插座用户可以创建一个任意的“后门”用户，该用户具有从合法管理员单击恶意链接获得的管理权限。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBby9ic55LNNAZsqtseEl4AffP9ToKdgDZWGhaiaHdLcNicSrunFVB0kHwg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

Part4

总结

施耐德AP7920B Web应用程序没有设置反CSRF对策的外部链接和操作。外部URL缺乏强化属性，令牌在URL中传输，除了令牌之外，没有其他针对CSRF攻击的保护措施。为了破坏设备，盗用了用户权限的攻击者只需配置一个页面链接，如果更高权限的受害者用户访问该页面，就可以对应用程序采取行动。例如，使用与受害者相同的权限向AP7920B发送跨域GET/POST请求。受害者甚至不会知道成功的利用/攻击已经发生。

Part5

缓解建议

带有NMC2的AP7xxxx和AP8xxx更新固件v7.0.6版本；带有NMC3的AP7xxx、AP8xxx、APDU9xxx更新固件v1.2.0.2版本。

将‘rel="noreferrer"’所有HTTP链接中的属性添加到Web应用程序的外部资源。

在服务器响应中添加一个限制性的Referrer-Policy HTTP标头（例如，“same-origin”)。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![图片](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmYrt8sZBqiah8aNInQspzccnPAAhd0OKLQ5Ziad4ovQEohiamyrpYjQcwVAWROpYWmMXia1YRKPiczFSQw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEB8LsicibRtlxNc8V6zx2Wb0ociaIezrpwtF65pu5rYtprCykib6x0kHpXVg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247523481&idx=1&sn=1d836d96f86de835eeffc327220e71a1&chksm=fd7676ceca01ffd82315c7f56b1f495412e93031656af4469e419021952b0acfce170e7df819&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBzB29BB9JyicMMcdib6xG6WBCpzrMuMUIUUtbDgIlTdMiaT4ArHyChK1oA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247523389&idx=1&sn=9483c28192fab53815058017d2d10743&chksm=fd76766aca01ff7c59f9d77865db59ee37a8f6e9322afadb1357114a244f4d4bc1157d8a2def&scene=21#wechat_redirect)

[![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYrJ9hp9YkeOAscHjHC0JEBQ0GbQW4zlCxAkoWKicPdEYxlPpylwsYTcj6Tp4zqump4ibSj4gBj94eg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247521870&idx=1&sn=b30e33591a225a5e16b9d97761d201ec&chksm=fd767c19ca01f50ff5f26240eec16aa12aa82de7f7dda6e4e304fb751dc60c3f6149457a03fe&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247520961&idx=1&sn=4f8d14a9a9230b7cd3c57606e47345bc&chksm=fd767896ca01f18072cb9088cfbf800fce413bc9ba246204922236c35938cbe99fbc46e98ed9&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的探索和实践，创新应用网络空间行为学及工业网络行为验证，构建了工业大数据深度分析、威胁情报共享、威胁感知和协同响应等核心能力优势，为电力、石油石化、煤炭、烟草、轨道交通、智能制造等关键信息基础设施行业提供安全产品、服务和综合解决方案，工业网络安全态势感知平台已部署4000余家电厂。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**点击“在看”鼓励一下吧**

**![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)**