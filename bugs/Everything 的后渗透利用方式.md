<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/UFbNOVOvo7b9cM0pvJ6dbQ)

**【信息收集 - 工具】Everything 内网渗透使用**
================================

1.4:https://www.voidtools.com/zh-cn/downloads/  

1.5:https://www.voidtools.com/forum/viewtopic.php?f=12&t=9787#download

es.exe everything 命令行控制程序

https://www.voidtools.com/zh-cn/downloads/

**HTTP 服务器利用**
==============

前提条件：**管理员 且 BypassUAC**

下载便携版，打开

设置中取消显示托盘图标

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHoojlS4DGuvDA1iaicsp5PtmWen2Aia6CuAvUWfTOXbmjAMUl9ynCTKEOA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHKubdCAXlbu7R3ZqSjLbsV4N0NyPazibK6zC6Pz7tYsbawbmjRyqLA9Q/640?wx_fmt=png) ![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHym27J1IvCVoZZPpAOm8ZyofROPfMIY0Kk7nDISbZe0SyibhR2iaby64g/640?wx_fmt=png)

选择应用，保存，得到配置文件

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHibniceN3ccyUk7nQP5AggjKwicJlwSJF8BCUUphCKONFxADGxvIkC2Ohg/640?wx_fmt=png)

将便携版与配置文件上传到目标

然后安装 Client 服务

```
everything.exe -install-client-service
```

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljH6Qo6ajXrp4XBiaEugNXxuvehbkjicoLyejFNnH1kplibvJhzQEL5aLMWg/640?wx_fmt=png)

这样就在目标机器上开启了 http 服务，可以搜索、下载

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHQLWicQ1JAtTuNNvmzdelKUjQNiaeG7AeTibVIWKvNiaHibwkf6picmgXMFJA/640?wx_fmt=png)

```
shell powershell "wget 'http://127.0.0.1:25005/?search=ceshi&offset=1'| Select -ExpandProperty Content"
```

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHmHgKOBjFVMQrT7or61D8MarGoz4kqXxiaw37refxatlINibHQccJwl4g/640?wx_fmt=png)

卸载服务：

```
everything.exe -uninstall-client-service
```

优点: 搜索方便、http 服务

缺点:

1. 需要把端口转出来，或者自己写个工具请求本地 http 服务去搜索，使用 powershell 的 wget 或者 curl 之类的也行。

2. 因为安装了自启动服务，所以部分杀软或者管理软件会提示开机自启动。

使用 ES 命令行控制
===========

PS：**一定要使用 1.5 版本**

条件：管理员权限 + bypass UAC

上传 everything1.5 版本，上传配置文件，这里就不需要 http 服务了，只需要隐藏图标即可，上传 es.exe。

后台启动：

```
shell everything64.exe -startup
```

搜索：

```
shell es -instance 1.5a -sort size -n 10 ceshi
```

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHD4PQUdkUXcmXj0sbe3txTsZXjTGiaPR7nXGxBg612nZ7vsyImw0VCpw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHv6QxvptuXpuE6f91YACPtuw2nG8ekibK5oA1TxJkkYJNpe9EyVpQN6w/640?wx_fmt=png)

图标也是隐藏的：

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljH61drFNjdCvvTcP8xqXqh3ibGpsI5AFHoibCqSClT3MbHR3Fu0OFolx6Q/640?wx_fmt=png)

高级语法
====

内容搜索
----

内容搜索比较费时间，最好只限定某目录、可限定格式

```
shell es -instance 1.5a -sort size -n 10 content:hhhhhh -parent-path C:\Users\aa\Desktop *.txt > re.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHqyLdyLVdTFNT6M8XUia3KaSBZKwaOJyFU6EaXFyqPsl1l0M7vUwwMibQ/640?wx_fmt=png)

横向搜索共享
------

使用 everything1.5

在 everything1.5 配置文件中存在 folders 参数，该参数可添加 UNC 路径

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHD1f9m7BkBEMHwgklYU8DhcBIugdpqqd2Z0avxCwKRtK16fNRvUI1Hw/640?wx_fmt=png)

使用该参数可添加内网的共享地址，然后 everything 会在启动时自动索引已经添加的内网共享。

对映到 UI 中修改的配置：

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHVDWjjCcaWOibUWXd6WDJYQFrArU2FXkK8s8GrQFCqq9TtVVnb72YpVQ/640?wx_fmt=png)

添加排除文件提高效率：

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHqjLicunWm5hkoCCTNmV5JSmqbO3cXicRnfa8yPibDhIyJP62mVvrRENzw/640?wx_fmt=png)

将配置文件、everything64.exe、es.exe 上传到目标服务器

使用 es 的命令退出当前的 everything 实例（如果之前有运行的话）：

```
shell es -instance 1.5a -exit
```

重新后台启动 everything

```
shell everything64.exe -startup
```

注意：因为 everything 会自动进行 SMB 认证，所以需要注意一下 token。

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHMv10McgqAvIa3Zq3GD47svG7KibFuFOul1F2j92lcZhoN98LVgzKXoQ/640?wx_fmt=png)

```
shell es -instance 1.5a -sort size -n 10 \\
```

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHa0WgibJFLZoJO1TXPSILsmhiceX9MtibrBnvSVkYVhcBNvukWxoyAT1Jg/640?wx_fmt=png)

指定某台机器上：

```
shell es -instance 1.5a -sort size -n 10 -parent-path \\192.168.110.138\ ceshi
```

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHDdibicTZic2jGdYaCUPe1tVQ62hyKbkYyR9Xfpur9Knwzeluqte46cDnA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHqMg5z1R5GSaV98xNZyj930iaTJdrraaYcsFibfkib3JdWwBXprIte49gw/640?wx_fmt=png)  

总结：

Everything 比较适合机器多的情况下根据关机字检索重要文件，但如果添加的目标文件夹太多，建立索引的时间也会变长。

机器比较少还是一个一个翻比较实在

![](https://mmbiz.qpic.cn/mmbiz_png/e8xpb63541hazlm3c2Oib0ZRQ7gticibljHkYouibm4ODWk5JH93Dqkv7Njo7ibS09XxgzrH3IBDssvlUwNWztkFuyw/640?wx_fmt=png)

扫描二维码关注我们

![](https://mmbiz.qpic.cn/mmbiz_jpg/PrTu58FA79bwwicW0Lg5LyzhwsucDdaP0hr0FHcjJAFUFsXjCHqia5BbgavliabU5SlZ6icq5jNN3VoDoGgRQTJFRw/640?wx_fmt=jpeg)