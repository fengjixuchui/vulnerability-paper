<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.povilaika.com](https://www.povilaika.com/apache-2-4-50-exploit/)

> Apache HTTPd 版本 2.4.50 中的一个漏洞，CVE-2021-42013 为我们提供了一个机会......

该漏洞也会影响 Apache 版本 2.4.49。但是，对于任一版本，必须满足某些条件才能成功利用：

1.  1.   将原始 Apache 配置（要求全部拒绝）覆盖为许可配置
    2.  启用 CGI 脚本执行
2.  当然，您将需要一个正常运行的 Apache 2.4.50 漏洞利用程序。

复制
--

[我们可以使用jas9reet 提供的 Docker 镜像](https://hub.docker.com/r/jas9reet/cve-2021-42013-lab)轻松重现易受攻击的主机：

![](https://www.povilaika.com/wp-content/uploads/2022/05/docker_image_for_apache_exploit.png)

通过遵循容器描述中的设置说明，我们可以立即设置我们的实验室。要获取容器的 IP 地址，我们可以使用以下命令：  
`$ docker inspect -f '\{\{range.NetworkSettings.Networks\}\}\{\{.IPAddress\}\}\{\{end\}\}'  
`

可以在 GitHub 存储库[CVE-2021-42013](https://github.com/viliuspovilaika/cve-2021-42013)中找到用 C 编写的漏洞利用。

下载源码并编译：

![](https://www.povilaika.com/wp-content/uploads/2022/05/downloading_apache_exploit.png)

或者，[您可以下载预构建版本](https://www.povilaika.com/download/1369/)。

我们现在可以针对我们之前设置的 Docker 容器运行此漏洞利用：

![](https://www.povilaika.com/wp-content/uploads/2022/05/apache_2450_exploit.png)

正如我们所看到的，漏洞利用的执行很容易，并且我们已经收到了我们在有效负载参数中请求的_passwd文件。_

把它提升一个档次
--------

为了进一步研究这个漏洞并估计易受攻击的系统的数量，我们需要找到运行 Apache 2.4.50 的主机。对于这个任务，我们可以使用[Shodan](https://www.shodan.io/)或[Censys](https://censys.io/)等服务。另一种更传统的方法是使用端口扫描软件，例如_nmap_或_masscan_：

![](https://www.povilaika.com/wp-content/uploads/2022/05/scanning_the_internet.png)

然后可以使用_cat_、_tr_和_cut_实用程序格式化结果：

![](https://www.povilaika.com/wp-content/uploads/2022/05/formatting_masscan_output.png)

最后，将新的主机文件加载到_nmap_中以进行横幅抓取：

![](https://www.povilaika.com/wp-content/uploads/2022/05/nmap_banner_grabbing.png)

经过一段时间的等待，_nmap_终于检查了提供的 ~280k 主机文件，并将结果保存在一个文本文件中。在手动检查结果中的随机样本后，我们编译的 Apache 2.4.50 漏洞利用确实获得了一些成功：

![](https://www.povilaika.com/wp-content/uploads/2022/05/apache_2.4.50_exploit.png)

然而，很少有主机运行这个特定版本的 Apache HTTPd，更容易受到攻击。

根据 Censys 的数据，大约有 1500 台主机运行 Apache 2.4.50，大约六分之一的主机易受攻击，截至 2022 年 5 月，我们只有数百个可利用的系统。