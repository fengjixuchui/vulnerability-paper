<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/5zd985kzJeat4w1fMZ8nUA)

**![图片](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Part1

漏洞状态

<table interlaced="enabled" style="visibility: visible;"><tbody style="visibility: visible;"><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">漏洞细节<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">漏洞POC<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">漏洞EXP<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; background-color: rgb(170, 170, 170); visibility: visible;">在野利用<br style="visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">有<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">有<br style="visibility: visible;"></td><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">无</td><td width="123" valign="top" align="center" style="word-break: break-all; visibility: visible;">无</td></tr></tbody></table>

Part2

漏洞描述

<table interlaced="enabled" style="visibility: visible;"><tbody style="visibility: visible;"><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞名称<br style="visibility: visible;"></td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">Schneider Electric Modbus Serial Driver共享内存滥用导致的本地提权漏洞</p></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">CVE编号</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">CVE-2020-7523</p></td></tr><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞类型</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">本地提权</p></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞等级</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;">7.8 高危(HIGH)</td></tr><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td width="145.66666666666666" valign="middle" align="center" style="word-break: break-all; visibility: visible;">公开状态</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;">公开<br style="visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="visibility: visible;"><td width="145" valign="middle" align="center" style="word-break: break-all; visibility: visible;">漏洞描述</td><td width="389" valign="top" style="line-height: 1.5em; word-break: break-all; visibility: visible;"><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">Schneider Electric Modbus Serial Driver 滥用共享内存导致的本地提权漏洞</p><p style="line-height: 1.5em; word-break: break-all; visibility: visible;">因为ModbusDrvSys 程序创建了一块共享内存，里面默认储存串口名。方便多进程之间交互操作，漏洞原因在于这块共享内存没有安全权限，任何进程可以打开，读写，导致的可以替换串口名，从而导致任意文件读写的本地提权漏洞。</p></td></tr><tr class="ue-table-interlace-color-single" style="word-break: break-all; visibility: visible;"><td valign="middle" align="center" colspan="1" rowspan="1" style="word-break: break-all; visibility: visible;">时间线<br style="visibility: visible;"></td><td valign="top" align="left" colspan="1" rowspan="1" style="word-break: break-all; visibility: visible;"><p style="word-break: break-all; visibility: visible;">2020-08-31 CVE编号收录</p>2020-10-13 施耐德发布更新补丁文档</td></tr></tbody></table>

受影响版本：

modbus_driver_suite <= 14.15.0.0

modbus_serial_driver x86 <= 2.20_ie_30

modbus_serial_driver x64 <=3.20_ie_30

Part3

漏洞复现环境

**系统环境：**

Win7 X64 sp1

**软件：**

SchneiderModbusDriverSuite.exe

Part4

漏洞复现

安装软件：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

成功之后查看进程

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpuf2pU44yGvRIp3qfWzD2Muic6QJJEkibia7kEabXdPmY6azIJeNMptcnA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

查看是否存在 ModbusDrvSys.exe 进程  

**系统路径：**

C:\Windows\System32\ModbusDrvSys.exe

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpdPdA7YeITzO58utuBvjOMvTjNZM2cnL7oEc7nbTmZBdevKkDibV66mw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

**软件版本：**

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpK7DJvpj1qth6VXBIteezvW5SfZnIukaOErCytMsHsp1gugohZuRfCg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

使用管理员账号在C盘创建test.exe

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

填充16进制数据

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)  

查看属性

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpibzUhgnktFuLibkia8FibqAibnTTVbpMILTvEWGNmlUlT5bJiceuFCsFYEfw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

普通用户没有写权限

切换账号

使用ImHex 工具打开 C:\test.exe

会提示 只读模式，没有权限修改文件,并且看到文件内容 0x00-0x0F

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpkDhd3oUKHLOHRcPibnGZFgGpcYPOmoia4PFePIMW0v8W50slmdzdWZ1Q/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

运行测试程序

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpFhRaxM41aqsNuIqlVUicXvESHRib6ib9rnicXBKNVDYELPGTZAFZvC4KdQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

再用Imhex 打开 C:\test.exe 查看结果

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpkdicqBB4MJJT21kOyTy44OIlhdBicgGyqTg8A0hvAcQIMqP58CunLfKA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

没有写权限的文件已经被修改。

Part5

漏洞细节分析  

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpZYPDK7qJw72zTmtfKhaM2mz7oY50yuALTCv31zIPpzk4xPWRPODIEQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

查看共享内存权限。默认无权限，就是任何本地程序都能打开，读写。

X64 dbg 加载程序，进行分析。

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpXpwzYdeLRq6wHqOaKqYzobyMLr74rOJnCibwsue7l1Q32cv4ibjIFs3Q/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

这里接收发送数据。

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzp0Yf2VhSNxEicNJdR6JDLvsjf9CpCDfyohyfM4EFtBAPPq1B2ek6g2aQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

先取出发送数据的长度，这里是我们构造数据的真实长度。  

然后高低字节序翻转一下，

最后比较，0x411 也就是数据最大长度不能超过 0x411 十进制 1041

如果超过这个长度

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzpb6Yk5DjtAEOtp0BZ97J7UBHcv13LtEeTYafSoWZUeyHaGRx1Jiaa7CA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

直接跳转到关闭网络连接位置。  

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmZB6AM8SUPRiaJDmnwLnLOzp2QFPfyn1RHAj8WIibWdu8TVr4EpQ2z3GqnibrujaqAXtNeyU5WIY8NIA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

然后 判断 rax+0x44c位置也就是打开文件句柄计数，减一。如果减一之后等于0直接关闭文件。

如果长度在0x411以内

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

进行下一次数据接收。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

这里判断是否有文件打开，如果有直接写入数据，如果没有，就根据共享内存里面储存的路径打开文件。

Part6

总结

ModbusDrvSys.exe创建了一块共享内存，保存串口名。由于共享内存没有设置权限，任意程序都可以修改里面的串口名。因此本地程序可以通过修改串口名，然后发送特定数据包给本地27700端口，即可把发送的数据写入任意文件。

Part7

缓解建议

安装主机安全卫士设置应用程序白名单。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247520961&idx=1&sn=4f8d14a9a9230b7cd3c57606e47345bc&chksm=fd767896ca01f18072cb9088cfbf800fce413bc9ba246204922236c35938cbe99fbc46e98ed9&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247520328&idx=1&sn=66df47e4b17cd9a8d45390d277e2fa6c&chksm=fd767a1fca01f309fa78fda6dd33cf609c65d3d071c6f7ecef7999bd17140c56fb7ef3dc3f25&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247519669&idx=1&sn=8772942ca9d18261fa9f0b3f5260f27e&chksm=fd7667e2ca01eef4d629b81b1a3170cf36611ba2a2983243f3025d5bfb5dbcba015ff6481065&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247518684&idx=1&sn=7c550b44dafea92ebe10cb34551b5a5c&chksm=fd76638bca01ea9dd27d10694484200f65f9e95194758f4d4a06fe69888f0dda5b9f38ce0345&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的探索和实践，创新应用网络空间行为学及工业网络行为验证，构建了工业大数据深度分析、威胁情报共享、威胁感知和协同响应等核心能力优势，为电力、石油石化、煤炭、烟草、轨道交通、智能制造等关键信息基础设施行业提供安全产品、服务和综合解决方案，工业网络安全态势感知平台已部署4000余家电厂。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**点击“在看”鼓励一下吧**

**![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)**