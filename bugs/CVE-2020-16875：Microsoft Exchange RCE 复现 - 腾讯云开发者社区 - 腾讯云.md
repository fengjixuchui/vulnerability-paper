> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [cloud.tencent.com](https://cloud.tencent.com/developer/article/1704777)

> Microsoft Exchange Server 是个消息与协作系统。Exchange server 可以被用来构架应用于企业、学校的邮件系统或免费邮件系统。它...

**上方蓝色字体关注我们，一起学安全！**

**作者：zhang0b@Timeline Sec**

**本文字数：727**

**阅读时长：2~3min**

**声明：请勿用作违法用途，否则后果自负**

**0x01 简介**

Microsoft Exchange Server 是个消息与协作系统。Exchange server 可以被用来构架应用于企业、学校的邮件系统或免费邮件系统。它还是一个协作平台。你可以在此基础上开发工作流，知识管理系统，Web 系统或者是其他消息系统。

**0x02 漏洞概述**

由于对 cmdlet 参数的验证不正确，Microsoft Exchange [服务器](https://cloud.tencent.com/product/cvm?from=20065&from_column=20065)中存在一个远程执行代码漏洞。成功利用此漏洞的攻击者可以在系统用户的上下文中运行任意代码。利用此漏洞需要拥有以某个 Exchange 角色进行[身份验证](https://cloud.tencent.com/product/mfas?from=20065&from_column=20065)的用户权限。

**0x03 影响版本**

Exchange Server 2016 CU17

Exchange Server 2016 CU16（已测）

Exchange Server 2019 CU5

Exchange Server 2019 CU6

**0x04 环境搭建**

为

先放一个链接

```
https://docs.microsoft.com/zh-cn/Exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019

```

该链接包含 exchange 的安装包地址以及安装所需组件的地址以及安装全过程。

![](https://ask.qcloudimg.com/http-save/yehe-5605816/4v9zoqr8xz.png)

**0x05 漏洞复现**

（1）首先判断 exchange 版本

在 outlook 界面查看源代码，通过查看 link 标签中的数字与链接

```
https://docs.microsoft.com/zh-cn/Exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019

```

中的内部版本号进行对比即可判断版本。由于官方文档中所列出的为各个主要发行版本，因此可能会出现 link 标签中的数值出现在两个版本中间的情况。

![](https://ask.qcloudimg.com/http-save/yehe-5605816/3ogkb9fsgg.png)

![](https://ask.qcloudimg.com/http-save/yehe-5605816/g42pds0nqh.png)

安装完成后可能会出现访问 / owa 或者 / ecp 目录为空白的现象，可能是由于服务没有开启，将 exchange 相关服务全部开启即可。

（2）复现

POC 下载地址：

```
https://srcincite.io/pocs/cve-2020-16875.py.txt

```

先简单更改下 poc，在 g**et_x**ml 函数下面输入想要执行的命令，然后运行。

![](https://ask.qcloudimg.com/http-save/yehe-5605816/lhy0tezvb4.png)

```
python3 poc.py <target_ip> <user:pass> <cmd>

```

成功执行命令，生成 2.txt 文件

![](https://ask.qcloudimg.com/http-save/yehe-5605816/qdgy8zpnq7.png)

**0x06 修复方式**

寻找符合操作系统版本的漏洞补丁，并进行补丁下载安装。

https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2020-16875

https://srcincite.io/pocs/cve-2020-16875.py.txt

![](https://ask.qcloudimg.com/http-save/yehe-5605816/idkqdmd3e1.png)

**阅读原文看更多复现文章**

Timeline Sec 团队

安全路上，与你并肩前行