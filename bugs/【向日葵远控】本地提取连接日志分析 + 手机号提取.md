<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s?__biz=MzUyMTE0MDQ0OA==&mid=2247491981&idx=1&sn=4a08715c89a09d8d81f35e11589700e5&chksm=f9dd0002ceaa891412abdae40389ae0db1012826e6b3c9d3112025d9b9b6a745bf3a2b51e4d1&scene=21&sessionid=1661677556&key=78fb1eae9cadd3bd1d9703cfa20e23377c8acdb52b3bbe2f25e174e2c6e17dfcbd34f5d74c3be70403da50283995d1306f3c291c30f25fd99f9cbddf6b8d489bed0b14fcb125fc5052366438f5358bcc86b192e24e06961c210a1292703e02dddfa057d5f59114f6749ff503ca827bef60c95476b68964e306997465b1fb9b76&ascene=15&uin=MzgxODQ4MjMz&devicetype=Windows%20Server%202016%20x64&version=63070517&lang=zh_CN&session_us=gh_611ed74b5ea9&exportkey=A8lZkPHBCYIvx/IMgTVhHh0=&acctmode=0&pass_ticket=J64lXBInTmcsrqDnG5TtLjVhXlP1GgaQTdI65VKrQJ1aWV2RO/i2dgsiHvavnALP&wx_header=0&fontgear=2#wechat_redirect)

0x00 前言
=======

本文详细的对此类远控软件目录信息特征的获取方法做了探究，希望可以帮助到有相关侦察 & 比赛需求的师傅，同时本文很有可能存在纰漏，有疑问的师傅可以加我微信：**liyi19960723** 进行讨论，本文仅作学习使用，切莫用作非法

0x01 非默认路径如何找到文件夹
=================

桌面存在图标
------

【右键】——【打开文件所在位置】——【打开`log`文件夹】![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DlqpVPibXCBfliccJRjb7Mj7ibL9rTSQjuNXAkgXeh7Lq5gJcz2AX3iaicGw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DszPaibWfcLovbRcphBvthXs4OhsuU3oLaHT5F4QI0aIgfkiaoXy9k95A/640?wx_fmt=png)

桌面不存在图标
-------

【任务栏搜索向日葵】——【打开文件位置】——【打开`log`文件夹】

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DwRTb2PjcZ89jgEY3jdGKyEl3u7ibZTyHlSaHGqiausXAYXut1ATv0w3g/640?wx_fmt=png)

0x02 如何找到日志中的 IP 信息
===================

环境介绍
----

远程控制一般是通过远控软件进行的，类似的还有 Todesk、TeamViewer、Splashtop、QQ 等，遇到此类问题，首先就需要找到操作日志，并且读懂日志，这里以向日葵为例，向日葵的日志一般保存在日葵安装目录下`C:\Program Files\Oray\SunLogin\SunloginClient\log`路径中名为`sunlogin_service.时间-数字.log`的日志文件

我先来讲一下我的测试环境，两台 Windows10 主机，一台物理机一台虚拟机（腾讯云），软件均为`V12.6.0.49095` 官网最新版，注意！我测试用的都是完整版，简约版只有被控功能，但日志无区别，实验过程中**仅进行了正常连接通讯，没有传递文件等**，腾讯云机器做被控机，物理机做主控机

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DcC7IC3IQayuFBIpYF6ficxCBIag9BkRYE3wI4ticVCPQKXUGMb0o0NQQ/640?wx_fmt=png)

探究方法
----

这里我用的还是 QQ \ 微信 \ 钉钉等语音功能获取真实 IP 相同的实验方法，即**通过 IP 反推取证特征**

### 一. 根据已知信息，找到正确的目录文件

想获取到有效的文件首先是找到对的路径，这里我们通过较短时间的测试拿到了三条目录，但是真正包含有效信息的只有`sunlogin_service.时间-数字.log` 结构的文件，即第二条

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2D76YvcAhpcF3v1mpjB6rSH6iaUI8rDe7u3fMk5ibPb1YSyMJzDqv5Ms8A/640?wx_fmt=png)

### 二. 确定有效时间

时间以【创建时间】判断最为准确，一般文件浏览 编辑都会对【修改日期】产生影响，所以【右键】——【属性】，即可查询【创建时间】

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DawK6jJEpEhKmdL29ic4HvoqZNvMKEWQuRLgZ6BE9ZibrFB2L6ZfSfGIw/640?wx_fmt=png)

### 三. 通过 IP 反推特征点

我的腾讯云主机 IP 是 `81.7x.xx.x` ，物理机 IP 是 `111.xx.2xx.xxx` 打开 `sunlogin_service.时间-数字.log` ，搜索我这里用的是 Vscode，使用 notepad++ 或直接使用 TXT 打开都是一样的

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DtMD0HZ0QuIjmWUs9RlRf1pqw6dFa0thG2icCqjYGZa2vtK6mvFHibpkw/640?wx_fmt=png)

这里我在**主控机目录**通过**被控机真实 IP** 搜索出了 8 项相关的目录（在真实环境中会更多），其中部分项也包含主控机真实 IP

```
[29528] 2022-08-28 12:23:55.938 - Info  - [P2PHelper] receive peer local ip 10.x.xx.x:15xxx, public ip 81.7x.xx.x:15xxx[29528] 2022-08-28 12:23:55.938 - Info  - [P2PStream] EstablishP2P local ip 111.xx.2xx.xxx:20xxx/192.168.0.103:160xx ==> peer ip 81.7x.xx.x:15xxx/10.x.xx.x:15xxx[29528] 2022-08-28 12:23:55.938 - Info  - [udpwrapper] attempt to prepare P2P connection via: 60.1xx.xxx.xx:41xx, (local)192.168.0.103:16xxx|(public)111.xx.2xx.xxx:20xxx ==> (local)10.x.xx.x:15xxx|(public)81.xx.xx.x:15xxx[29528] 2022-08-28 12:23:55.938 - Info  - [udpwrapper] P2PHolePunch 81.7x.xx.x:15xxx[6668] 2022-08-28 12:23:56.537 - Info  - [udpwrapper] receive p2p hello message from 81.7x.xx.x:15xxx, stop hole punch thread @1417[6668] 2022-08-28 12:23:56.568 - Info  - [udp] OnConnectRes with 81.7x.xx.x:15xxx, mode 2, peer straight send no[29528] 2022-08-28 12:23:56.569 - Info  - [P2PStream] connected (by udp) 0.0.0.0:160xx <--> 81.7x.xx.x:15xxx
```

由此我们可知在**主控机目录**中，`[P2PHelper]`  `[P2PStream]`  `[udpwrapper]`  `[udp]` 中是包含真实 IP 信息的，因此我们在真实环境中可搜索上述四项来获取主控端和被控端的真实 IP 和端口，知道了这些特征点，我们用**相同时间段的被控机目录**做验证

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2D7kmmuJZQzq9icJBYr80uvlbPul4ickLg7uKu7qjygnf3jdU5p7ZGjlNg/640?wx_fmt=png)![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2Dib5AyyPR3dw2bAWZ92l2XIdXgc7msggtJ3GFCA0ib0qcztibjuoPD8KLQ/640?wx_fmt=png)

我们可以看到在搜索`[udpwrapper]` 和`[udp]` 时，分别都搜索到了**主控机真实 IP**，那么这里就存在一个问题，`[P2PHelper]` 和 `[P2PStream]` 在**被控机目录**中并不适用

那么还需要探究被控机的特征点，还是用相同的方法，在**被控机目录**通过**主控机真实 IP** 搜索出了 5 项相关的目录（在真实环境中会更多）

```
[5668] 2022-08-28 12:23:56.448 - Info  - [P2PAccepter] [60.xx.xxx.xx:41xx] receive P2P request (public 111.xx.2xx.xxx:20xxx local 192.168.0.1031xxxx), delay r:32/c:40[5668] 2022-08-28 12:23:56.448 - Info  - [udpwrapper] P2PHolePunch 111.xx.2xx.xxx:20xxx[3452] 2022-08-28 12:23:57.111 - Info  - [udp] support straight send in peer : no 111.xx.2xx.xxx:20xxx CConnection::OnConnectRequest[3452] 2022-08-28 12:23:57.149 - Info  - [udp] OnConnectAck with 111.xx.2xx.xxx:20xxx, mode 2, peer straight send no[5668] 2022-08-28 12:23:58.025 - Info  - [service][UdpAcceptor] new acceptor 111.xx.2xx.xxx:20xxx-->0.0.0.0:15xxx
```

由这些目录我们获取了两个新的特征点 `[P2PAccepter]` 和 `[service]` ，至此所有的特点便找齐了

探究结果
----

来总结一下，`[P2PHelper]` `[P2PStream]` 只对主控机有效，`[P2PAccepter]` `[service]` 只对被控机有效，`[udpwrapper]` `[udp]` 对双端都有效，关系如下图所示

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2D38w5reLsQjt05gcSjjmUAoibFq2FJ1ibV1iah610KLqxI9LjpRBnG8TiaA/640?wx_fmt=png)

在实战中，运用此特征点还可以分析在这次通讯中此主机所承担的 “角色”

0x03 手机号提取
==========

打开向日葵远程控制软件界面，点击左侧【升级】，即可跳转到官网获取全部手机号

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DFCOqic2t5yDoiaNGJErHRWe4q771MhibyGLO4JNpK3jsnKyjbB7PAx6PA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DtGtSPxyOaPnhKCHrHS5nzcA7CWaiaw3aib9gz7UluicNDq4WHX01pfLnQ/640?wx_fmt=png)

但同时这种方法是具有局限性的，无法对【微信登录】用户进行提取，如无法解除客户端也可以在日志文件中搜索 `account` ，同样可以获取到除【微信登录】外的客户端手机号信息（我没有成功，放一张别人的图）

![](https://mmbiz.qpic.cn/sz_mmbiz_png/wQuKRAE0ouNsH3JqlMJO1a5nR5BKNN2DT0kps0UxJoo5XmOrXzvo7uNxIR6zG5cBWrel3m683RqWiazGhSlcqxQ/640?wx_fmt=png)

0x04 参考资料
=========

1.  **固话 GOIP 取证解疑与向日葵日志分析 —— 明不可欺**
    
2.  **向日葵官网 —— https://sunlogin.oray.com/**