<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/qjUetsbrouREnwcUCuG2KQ)

扫码领资料

获网安教程

免费 & 进群

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSFJNibV2baHRo8G34MZhFD1sjTz4LHLiaKG9208VTU6pdTIEpC9jlW6UVfhIb9rHorCvvMsdiaya4T6Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/b96CibCt70iaaJcib7FH02wTKvoHALAMw4fchVnBLMw4kTQ7B9oUy0RGfiacu34QEZgDpfia0sVmWrHcDZCV1Na5wDQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

Gophish 钓鱼的 SAO 操作

#### 1 介绍

Gophish 是一个功能强大的开源网络钓鱼框架。

#### 2 安装

Github 地址

> https://github.com/gophish/gophish/releases/tag/v0.11.0

windows 下和 linux 下均可以搭建

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyB95qhLJIFBlw2GFGzExz3UxcpA56CmxwiczRyBHEJKw8S8sNDK2vqRw/640?wx_fmt=jpeg)

这边我选择在 Linux 环境下搭建该框架

搭建环境：kali 虚拟机 网卡状态桥接

> root@kali:/home/kali/Desktop/gophish# wget https://github.com/gophish/gophish/releases/download/v0.11.0/gophish-v0.11.0-linux-64bit.zip

然后解压压缩包

> root@kali:/home/kali/Desktop/gophish# unzip gophish-v0.11.0-linux-64bit.zip

修改配置文件 config.json

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Hty6cHBllvBMHib5hgiba2Eu3yTgKMia0HLKa4feUJYibHIqv4gLjcQ6gyfOA/640?wx_fmt=jpeg)

启动 gophish

> root@kali:/home/kali/Desktop/gophish# ./gophish

注意

在这里启动的时候可能会失败，使用 sudo 的权限依旧会提示”sudo: ./gophish: command not found“等其它异常，这个时候需要给”gophish“文件夹权限

> root@kali:/home/kali/Desktop/gophish# chmod -R 777 gophish

之后再重新启动

根据环境 ip 地址访问后台

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtySZMnzQsD8KdESiahWeUefSMiaicz0APlSSxGHKicelfNZGE3Wf5AYiaDdKw/640?wx_fmt=jpeg)

注意

在 V0.11.0 版本中添加了密码策略，在之前的版本中账号密码为 admin/gophish，在该新版本中添加了密码策略，密码为随机生成！！！然后登录重置密码即可！！！

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtydVjPBvIMG8hnhviadkk8Mv6ANNnMPicdDUQImTBpL8Hn7Fh1ESmylRFQ/640?wx_fmt=jpeg)

后台主页面

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Hty1Zf2noQhfz5bI2B4LaDnRg3h4BQnTpTf4CP7PfKmso2flibIJF7dNpA/640?wx_fmt=jpeg)

#### 3 平台功能

```
Dashboard 仪表板，查看整体测试情况
Campaigns 每次攻击前需要配置一次
Users & Groups 用户和用户组（添加需要进行钓鱼的邮箱和相关基础信息）
Email Templates 电子邮件模板
Landing Pages 需要伪造的钓鱼页面
Sending Profiles 钓鱼邮箱发送配置
导航栏后面的功能为用户设置、用户管理。主要配置以及功能为上面的内容


```

#### 4 搭建邮件服务器

搭建环境：ubuntu16.04 虚拟机网卡状态为桥接

参考链接：https://blog.csdn.net/sd4015700/article/details/21454729

*   安装 postfix
    

> root@wrs-virtual-machine:/home/wrs# apt-get install postfix

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyicuibPvk6OeldEg7Usuuhy6IprCcNk6McPZWZuI2doQibPdThah2QVFmg/640?wx_fmt=jpeg)

在安装的过程中，会提示输入选择类型和域名。分别填写 "only localhost" 和 "localhost"

*   安装 mailx 软件包
    

> root@wrs-virtual-machine:/home/wrs# apt-get install mailutils

mailx 软件包是一个命令行的邮件属性程序，mail 命令包含在 mailx 软件包里面

*   测试默认设置
    
*   添加测试用户 (ceshi)
    

```
root@wrs-virtual-machine:/home/wrs# useradd -m -s /bin/bash ceshi
root@wrs-virtual-machine:/home/wrs# passwd ceshi


```

*   测试添加的用户 测试 25 端口是否打开
    

```
root@wrs-virtual-machine:/home/wrs# telnet localhost 25


```

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyJrVLuYEYm5MdwQpuUUaSRJ6myALZESa2n7Ja0xKXHicyE4PEzKUcXmw/640?wx_fmt=jpeg)

```
root@wrs-virtual-machine:/home/wrs# telnet localhost 25
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 wrs-virtual-machine ESMTP Postfix (Ubuntu)
ehlo localhost                     //输入
250-wrs-virtual-machine
250-PIPELINING
250-SIZE 10240000
250-VRFY
250-ETRN
250-STARTTLS
250-ENHANCEDSTATUSCODES
250-8BITMIME
250 DSN
mail from:root@localhost     //邮件来源
250 2.1.0 Ok
rcpt to:ceshi@localhost       //发送目的人
250 2.1.5 Ok
data                                  //开始传输数据
354 End data with <CR><LF>.<CR><LF>
Subject: this is test            //标题
test                                  //内容
.
250 2.0.0 Ok: queued as 5B67EE00B7
quit                                 //退出邮件发送
221 2.0.0 Bye


```

切换用户查看是否有邮件

```
root@wrs-virtual-machine:/home/wrs# su ceshi
ceshi@wrs-virtual-machine:/home/wrs$ mail


```

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Htyv8Kftrx62yPRMaTFkNuLdxls9YEWVjlMbg6ffgW7mL1yNBqZwT5Cibg/640?wx_fmt=jpeg)

此时的邮件存放在 / var/mail/ceshi 文件中。

当这个邮件被打开之后，Postfix 就会以 mbox 的风格处理邮件，将邮件都保存到 / home/ceshi/mbox 这一个文件中。

#### 5 搭建开源邮件服务器 EwoMail

官网直接下载开源的项目。

> https://gitee.com/laowu5/EwoMail

EwoMail

EwoMail 是基于 Linux 的开源邮件服务器软件，集成了众多优秀稳定的组件，是一个快速部署、简单高效、多语言、安全稳定的邮件解决方案，帮助你提升运维效率，降低 IT 成本，兼容主流的邮件客户端，同时支持电脑和手机邮件客户端。

官方安装文档

> http://doc.ewomail.com/docs/ewomail/install

注意

系统默认会禁止 exe 后缀文件附件的收发，需要根据文档修改配置文件

> http://doc.ewomail.com/docs/ewomail/exe

#### 0x06 功能详解

##### Sending Profiles（钓鱼邮箱发送配置）

Sending Profiles 的主要作用是将用来发送钓鱼邮件的邮箱配置到 Gophish。点击 “New Profile” 新建一个策略，依次来填写各个字段

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtynhLtIRnsuXOPpT3MWYsiboPGX4BDwu5x7wvBwANgaf8Na7BCqic4K0ew/640?wx_fmt=jpeg)

```
Name：新建的发件策略进行命名，不会影响到钓鱼的实施，建议以发件邮箱为名字，例如使用qq邮箱来发送钓鱼邮件，则Name字段可以写 xxxxxx@qq.com 。
Interface Type：Interface Type 是接口类型，默认为 SMTP类型 且不可修改，因此需要发件邮箱开启SMTP服务。

From：From：发件人，即钓鱼邮件所显示的发件人。（在实际使用中，一般需要进行近似域名伪造）

Host：Host 是SMTP服务器的地址，格式是 smtp.example.com:25。

Username：Username 是SMTP服务认证的用户名，如果是qq邮箱，Username则是自己的qq邮箱号 xxxx@qq.com。

Password：Password 是SMTP服务认证的密码，例如qq邮箱，需要在登录qq邮箱后，依次点击 “设置”—>“账户”—>“开启SMPT服务”—>“生成授权码”来获取SMTP服务授权码，Password的值则填写我们收到的授权码。

Email Headers（选填）：Email Headers 是自定义邮件头字段，例如邮件头的 X-Mailer 字段，若不修改此字段的值，通过gophish发出的邮件，其邮件头的X-Mailer的值默认为gophish。

设置好以上字段，可以点击 “Send Test Email” 来给自己发送一个测试邮件，以检测SMTP服务器是否认证通过。如成功收到测试邮件，说明SMTP服务器是否认证通过。


```

##### Email Templates（钓鱼邮件模板）

完成了邮箱配置之后，就可以使用 gophish 发送邮件了。所以，接下来需要去 “Email Templates” 中编写钓鱼邮件的内容。点击 “New Template” 新建钓鱼邮件模板，依次介绍填写各个字段

```
Name：对当前新建的钓鱼邮件模板进行命名，可以简单命名

Import Email：Gophish为编辑邮件内容提供了两种方式，第一种就是 “Import Email”。用户可以先在自己的邮箱系统中设计好钓鱼邮件，然后发送给自己或其他伙伴，收到设计好的邮件后，打开并选择“导出为eml文件”或者“显示邮件原文”，然后将内容复制到gophish的“Import Email”中，即可将设计好的钓鱼邮件的导入。

Subject：邮件主题。

内容编辑框：内容编辑框是编写邮件内容的第二种模式，内容编辑框提供了 Text和 HTML两种模式来编写邮件内容，使用方式与正常的编辑器无异。其中HTML模式下的“预览”功能比较常用到，在编辑好内容后，点击预览，就可以清晰看到邮件呈现的具体内容以及格式。

Add Tracking Image：Add Tracking Image 是在钓鱼邮件末添加一个“跟踪图像”，用来跟踪受害用户是否打开了收到的钓鱼邮件。默认情况下是勾选的

Add Files：Add Files 是在发送的邮件中“添加附件”，一是可以添加相关文件提高邮件真实性，二是可以配合免杀木马诱导受害用户下载并打开。


```

注意在点击 “Import” 之前需要勾选上“Change Links to Point to Landing Page”，该功能实现了当创建钓鱼事件后，会将邮件中的超链接自动转变为钓鱼网站的 URL。

注意如果不勾选就无法跟踪到受害用户是否打开了钓鱼邮件。

##### Landing pages（登录页）

```
Name:登录页命名，（搜索了一些文档似乎这个功能确实没有太大的用处）

Import site:设置选择钓鱼页，自动生成html文件，当然可以自己手动写html文档


```

##### Campaigns (活动)

```
Name:命名的活动名称，根据自己喜好设置

Email template:选择邮件模板，需要先设置好“Email template”才可在这里进行设置

Landing page：设置登录页

Launch Date：发送时间，也可以选择时间段内发送

Sending Profile:选择上面设置的钓鱼邮箱名称。

Groups:选择目标组或者目标用户


```

#### 7 发送钓鱼邮件测试

利用 qq 邮箱去发送一个邮件，这里先来做一个测试。

1. 测试邮件是否可以发送

首先打开 qq 邮箱的邮件服务

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Htyx43UomveQrLUa7ic6y5efb3Cyk9gcIhYW88RMBP79wbA2TuVKcFQsVQ/640?wx_fmt=jpeg)

开一个即可，为了方便，这里没有使用搭建好的邮件服务器。

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyqSX6mtuvkTViaC3NHVffHNIkRO5oiaUT5VC37gRUd4w6XpVdpE2BEnGw/640?wx_fmt=jpeg)

注意

这里有帮助，根据帮助去配置即可，需要注意的一点就是下面的这个密码是开通邮件服务之后给出的密码，不是自己邮箱密码。

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtylIZZ7SDqgHtJL6xP4nSfjJno09V7VFDvTokMGtAORdm11AVl7mXcfQ/640?wx_fmt=jpeg)

接下来准备工作已经完成，测试一下时候成功，尝试发送测试邮件看到成功发送，看看收件箱的内容。

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Hty5kNTmib4gGDQNWloeHyl3kwJLc6lXXFBx6GiaZgF236Qs2B3DK7MHibaA/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Hty0FiaefBu7LB87ea7XOuCX5nGK6RKeicN4kRQlib3c2hSic3uLt1g7ZSGPw/640?wx_fmt=jpeg)

邮件成功发送，但是有一点的问题的就是邮件 haeader，在发送钓鱼邮件的时候要去修改。

2. 创建钓鱼模板

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyXrfhcMSh5ziajq8xW1bm6TAhnGAkbicMJZghIlqgzSVcP5dPldsd69sA/640?wx_fmt=jpeg)

3. 配置登录页

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyVIuxUvX64fK0uIGnj33wgzs7pkN7VVJ7pqtTxXhibjX5VvTXMDoPicDA/640?wx_fmt=jpeg)

4 . 配置钓鱼用户以及组

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyNU0OUrJNr0Rwq6FdoWibFjawDYOvplaJCaDB2FDOY0Bgn1vNDXPBxnw/640?wx_fmt=jpeg)

为了方便记录，这里我选择了两个临时邮箱作为演示接收邮箱

```
cmolyt02483@chacuo.net
t8qa5_zdo4@tempmail.cn


```

*   0x05 创建活动
    

选择 “New Campaign” 创建

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtynKvI87toX3FmrOg2MNlzd9LIVbWZ5C8qB2g8dsNMMQeZ0zJPcfBcjg/640?wx_fmt=jpeg)

成功启动，邮件即发送出去

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyvLE97qibhMuCJd5PMw7IAertwtbfEiawZOA8mBgVfhuEERXibwqyXlwdA/640?wx_fmt=jpeg)

然后查看面板，详细内容

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyW4wvX7gDweVMIdd6GfNibQ6f7GK0AOwE9d3DHA5zSUianjiavYuZ1JhJw/640?wx_fmt=jpeg)

这里我 copy 了 “活动”，那么总共发送了四个邮件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtyyNAhCcg8q9E0h5G42p54PW9Kxrk5DgoY5pdVu7fAeHAA6e1drIjVbg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42HtytDWnybyYlpsHq2ODSCcLVtuhicQ1noGw6UzdSib19tC2AsDo5vwVcI7g/640?wx_fmt=jpeg)

两个邮箱均发送成功。

#### 0x08 Over

发送钓鱼邮件，上线，选择发送的邮件选择使用可执行文件，接下来的就是利用免杀木马钓鱼了！！！！，本来想着写一写，有点累了，就结束了叭

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGEaLTPHVJgmQUFEJD42Htyx4VzSC4174UkduBA08S2NAGUp0nCq3hpaWxpmqcHxFicSAKeGwHG7eg/640?wx_fmt=jpeg)

欢迎大佬评论！！！

```
作者：sec-in【 Am1azi3ng 】
转载自：https://www.sec-in.com/article/1171

```

声明：⽂中所涉及的技术、思路和⼯具仅供以安全为⽬的的学习交流使⽤，任何⼈不得将其⽤于⾮法⽤途以及盈利等⽬的，否则后果⾃⾏承担。**所有渗透都需获取授权**！

@

**学习更多渗透技能！体验靶场实战练习**

```
（hack视频资料及工具）


```

（部分展示）

往期推荐

【精选】SRC 快速入门 + 上分小秘籍 + 实战指南

爬取免费代理，拥有自己的代理池

漏洞挖掘｜密码找回中的套路

渗透测试岗位面试题 (重点：渗透思路)

漏洞挖掘 | 通用型漏洞挖掘思路技巧

干货｜列了几种均能过安全狗的方法！

一名大学生的黑客成长史到入狱的自述

攻防演练｜红队手段之将蓝队逼到关站！

巧用 FOFA 挖到你的第一个漏洞

**看到这里了，点个 “赞”、“再看” 吧**