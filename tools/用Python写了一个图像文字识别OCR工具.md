<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/pl7NXqZPYD8P7dTFQ3LgiA)

> **来自公众号：快学Python**

人生苦短，快学Python！

在之前的文章里，我们多次尝试用Python实现文本OCR识别！

点击蓝字查看历史文章👉[OCR识别的花样使用](https://mp.weixin.qq.com/s?__biz=MzI2MDY2NzQwMQ==&mid=2247490907&idx=2&sn=30dc1894b8314c89ab7d510fa49154dc&chksm=ea677c3ddd10f52b139fb403c6a91d62d39cfcc16896d27a29d5d92de8d7419b02a75d5037ac&token=421314186&lang=zh_CN&scene=21#wechat_redirect)、[5行Python实现验证码识别](https://mp.weixin.qq.com/s?__biz=MzI2MDY2NzQwMQ==&mid=2247492627&idx=1&sn=014a6ca8037a6891add03fa5c8833a80&chksm=ea648575dd130c63cba9df8ee687fe91a53144ad3e55dbaa1c06c06aea16986d20e9261629cc&token=421314186&lang=zh_CN&scene=21#wechat_redirect)、[3行Python代码识别图片文字](https://mp.weixin.qq.com/s?__biz=MzI2MDY2NzQwMQ==&mid=2247494675&idx=1&sn=39d8d21ba38ff7074f3ed1d683b0763c&chksm=ea648d75dd130463fa17f06f63e4a3c7462e3619f741e883249af8f18144a3de52a4de9ab21a&token=421314186&lang=zh_CN&scene=21#wechat_redirect)。

不过今天我们要搞一个升级版：直接写一个**图像文字识别OCR工具**！

引言
--

最近在技术交流群里聊到一个关于图像文字识别的需求，在工作、生活中常常会用到，比如**票据、漫画、扫描件、照片的文本提取**。

博主基于 PyQt + labelme + PaddleOCR 写了一个桌面端的OCR工具，用于快速实现图片中**文本区域自动检测+文本自动识别**。

识别效果如下图所示：

![图片](https://mmbiz.qpic.cn/mmbiz_gif/P33BNFicia1AkYS8amPicgxTekyKazdupQd9ib5CsGtMhaICJCvPWQq4wFJcaBypS7icmnhsLfib4nsnL2CzMHmGjaCg/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)▲OCR工具识别效果

所有框选区域为OCR算法自动检测，右侧列表有每个框对应的文字内容；点击右侧“识别结果”中的文本记录，然后点击“复制到剪贴板”即可复制该文本内容。

功能列表
----

*   文本区域检测+文字识别
    
*   文本区域可视化
    
*   文字内容列表
    
*   图像、文件夹加载
    
*   图像滚轮缩放查看
    
*   绘制区域、编辑区域
    
*   复制所选文本识别结果
    

OCR部分
-----

图像文字检测+文字识别算法，主要借助 `paddleocr` 实现。

创建或者选择一个虚拟环境，安装需要用到的第三方库。

```
conda create -n ocr  
conda activate ocr  

```

### 安装框架

如果你没有NVIDIA GPU，或GPU不支持CUDA，可以安装CPU版本：

```
# CPU版本  
pip install paddlepaddle==2.1.0 -i https://mirror.baidu.com/pypi/simple 
```

如果你的GPU安装过CUDA9或CUDA10，cuDNN 7.6+，可以选择下面这个GPU版本：

```
# GPU版本  
python3 -m pip install paddlepaddle-gpu==2.1.0 -i https://mirror.baidu.com/pypi/simple  

```

### 安装 PaddleOCR

安装paddleocr：

```
pip install "paddleocr>=2.0.1" # 推荐使用2.0.1+版本  

```

版面分析，需要安装 Layout-Parser：

```
pip3 install -U https://paddleocr.bj.bcebos.com/whl/layoutparser-0.0.0-py3-none-any.whl  

```

### 测试安装是否成功

安装完成后，测试一张图片`--image_dir ./imgs/11.jpg`，采用中英文检测+方向分类器+识别全流程：

```
paddleocr --image_dir ./imgs/11.jpg --use_angle_cls true --use_gpu false  

```

输出一个list：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

### 在python中调用

```
from paddleocr import PaddleOCR, draw_ocr  
  
# Paddleocr目前支持的多语言语种可以通过修改lang参数进行切换  
# 例如`ch`, `en`, `fr`, `german`, `korean`, `japan`  
ocr = PaddleOCR(use_angle_cls=True, lang="ch")  # need to run only once to download and load model into memory  
img_path = './imgs/11.jpg'  
result = ocr.ocr(img_path, cls=True)  
for line in result:  
    print(line)  

```

输出结果是一个list，每个item包含了文本框，文字和识别置信度：

> [[[24.0, 36.0], [304.0, 34.0], [304.0, 72.0], [24.0, 74.0]], ['纯臻营养护发素', 0.964739]] [[[24.0, 80.0], [172.0, 80.0], [172.0, 104.0], [24.0, 104.0]], ['产品信息/参数', 0.98069626]] [[[24.0, 109.0], [333.0, 109.0], [333.0, 136.0], [24.0, 136.0]], ['（45元/每公斤，100公斤起订）', 0.9676722]] ......

界面部分
----

界面部分基于pyqt5实现，其中pyqt GUI程序开发入门和环境配置，详见一篇博客(具体见文末)。

主要步骤：

### 界面布局设计

在QtDesigner中拖拽控件，完成程序界面布局，并保存`*.ui`文件。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

### 利用 pyuic 自动生成界面代码

在 pycharm 的项目文件结构中找到`*.ui`文件，右键——External Tools——pyuic，会在ui文件同级目录下自动生成界面 ui 的 Python 代码。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

### 编写界面业务类

业务类 MainWindow 实现程序逻辑和算法功能，与前面第2步生成的ui实现解耦，避免每次修改ui文件会影响业务代码。ui界面上的控件可以通过`self._ui.xxxObjectName` 访问。

```
class MainWindow(QMainWindow):  
 FIT_WINDOW, FIT_WIDTH, MANUAL_ZOOM = 0, 1, 2  
  
 def __init__(self):  
  super().__init__()  # 调用父类构造函数，创建QWidget窗体  
  self._ui = Ui_MainWindow()  # 创建ui对象  
  self._ui.setupUi(self)  # 构造ui  
  self.setWindowTitle(__appname__)  
  
  # 加载默认配置  
  config = get_config()  
  self._config = config      
    
  # 单选按钮组  
        self.checkBtnGroup = QButtonGroup(self)  
        self.checkBtnGroup.addButton(self._ui.checkBox_ocr)  
        self.checkBtnGroup.addButton(self._ui.checkBox_det)  
        self.checkBtnGroup.addButton(self._ui.checkBox_recog)  
        self.checkBtnGroup.addButton(self._ui.checkBox_layoutparser)  
        self.checkBtnGroup.setExclusive(True) 
```

### 实现界面业务逻辑

对主界面上的按钮、列表、绘图控件进行**信号槽连接**。自定义的槽函数不用专门声明，如果是自定义的信号，需要在类__init__()前加上 `yourSignal= pyqtSignal(args)`。

这里以按钮响应函数、列表响应函数为例。按钮点击的信号是 `clicked`，listWidget列表切换选择的信号是 `itemSelectionChanged` 。

```
# 按钮响应函数  
self._ui.btnOpenImg.clicked.connect(self.openFile)  
self._ui.btnOpenDir.clicked.connect(self.openDirDialog)  
self._ui.btnNext.clicked.connect(self.openNextImg)  
self._ui.btnPrev.clicked.connect(self.openPrevImg)  
self._ui.btnStartProcess.clicked.connect(self.startProcess)  
self._ui.btnCopyAll.clicked.connect(self.copyToClipboard)  
self._ui.btnSaveAll.clicked.connect(self.saveToFile)  
self._ui.listWidgetResults.itemSelectionChanged.connect(self.onItemResultClicked)  

```

### 5. 运行看看效果

运行 `python main.py` 即可启动GUI程序。

打开图片→选择语言模型ch（中文）→选择文本检测+识别→点击开始，检测完的文本区域会自动画框，并在右侧识别结果——文本Tab页的列表中显示。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

所有检测出文本的区域列表，在识别结果——区域Tab页：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

软件代码
----

由于时间有限，软件细节功能还需进一步完善。代码已开源到 gitee 上，欢迎感兴趣的朋友提pull request，共同修改完善。

代码开源地址：_https://gitee.com/signal926/ocr-gui-demo_

参考链接
----

画框、区域列表：_https://github.com/wkentaro/labelme_

icons：_https://github.com/google/material-design-icons_

_https://gitee.com/paddlepaddle/PaddleOCR/blob/release/2.3/doc/doc_ch/quickstart.md_

_https://blog.csdn.net/Bit_Coders/article/details/119304488_

--- EOF ---  

  

**推荐↓↓↓**

 ![](http://mmbiz.qpic.cn/mmbiz_png/n9vSKDrwqn1jYjDr12k70sWjrXt1RNyibPOiawH02FLgUQ02JJtYpWCMXpftrbDgHxnTTEM9pZcB6ic8RpWOKlPug/0?wx_fmt=png) ** 数据分析专栏 ** 分享数据分析相关技术文章、教程、工具，包括但不限制于R、Python、Spark、MySQL、Excel等在数据分析、数据挖掘、数据抓取、数据可视化等方面的技术文章分享。 0篇原创内容   公众号