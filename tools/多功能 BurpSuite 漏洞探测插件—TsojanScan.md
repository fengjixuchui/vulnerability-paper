> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2uTxakCAfApDNMQyx0y8dg)

TsojanScan
==========

一个集成的 BurpSuite 漏洞探测插件

First
-----

 本着市面上各大漏洞探测插件的功能比较单一，因此与 TsojanSecTeam 成员决定在已有框架的基础上修改并增加常用的漏洞探测 POC，它会以最少的数据包请求来准确检测各漏洞存在与否，你只需要这一个足矣。

### **Usage**

#### **1、加载插件**

 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4WJ9XcnTibpLm1yZ2wwJvrkeQ2ZjYaQMy30DQSmH70ibeUfX0RkpNdRDg/640?wx_fmt=png)**

#### **2、功能介绍**

#### **（1）面板** 

#### **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4gL6ghXjVIZQslvMUMKeDNIptjxWKibHPj2ZWCLjQ13k0Ga0wu4GSEHQ/640?wx_fmt=png)**

自定义黑名单，插件不扫描黑名单的 url 列表，进行 Reg 匹配优先级第一。 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4Y7csicryr8YdibxCV5icWricTHFXGreibj6JV5n9plFXa2MDykWoYAib6wjw/640?wx_fmt=png)** 

#### **（2）主动探测** 

####  **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4KWJf68eMaibll0vRYUUX8cDpvEj2JtlkNqriaYBnsFZZ5wic9HG9sL6gA/640?wx_fmt=png)** 

**比如探测非根目录 /，目录下面需要加 /** 

 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4qLobDF9EC0Z193N3tG7XSLx15VHaZib1pk6ExCXH9njHYyw1LElEBEg/640?wx_fmt=png)** 

#### 3、fastjson >=1.2.80 探测

#### （1）本地环境 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4zFjWzjF4pT3CDFKyScSbhClY4owjoyzvvjZUnyRNbkXrg28X3VPiaTg/640?wx_fmt=png)** 

#### 2）预查询 DNSlog 接口

#### **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4jkaW7KaicgHeWw5d4QQqB9ncicStbMkqFUxXiaCEoibydxA4ODyrzMjbSw/640?wx_fmt=png)**

 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4zAEPOWtqYYxopgUJsUnhJVgM5StnUPlKT4O4J2DJeoN8jO3hmfr7Qg/640?wx_fmt=png)** 

#### （3）扫描

**![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4mopJHbVg2uOCKv8gia1IRlicsSKibF5nA1icv9MvWwN4XP6fKTHGUKIYug/640?wx_fmt=png)**

#### （4）判断准确版本

1.2.80 版本探测如果收到了两个 dns 请求，则证明使用了 1.2.83 版本，如果收到了一个 dns 请求，则证明使用了 1.2.80 版本。 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4t2vtgguoNDia3vzEfnqJtftUYzhgr5HTqFxz6G6ibMZSBQaJibzS2jauQ/640?wx_fmt=png)              ![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4LyrGdnfNBzCQ2A1VVJ2yOkKrgANtxsRTa6Kibs5ghtZLRnMddnIA7Gg/640?wx_fmt=png)** 

#### 4、DNSLog 查询漏报

#### **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4AmIdcj5FD9AYTEWpQvY7dic29soqiaq23IyZ1Ccb5NzY9u5yg103xXEw/640?wx_fmt=png)**

 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4ticygVhQMRTASdzCE8iaGZc6VjyLZsv2cJ3pgNkrcQjfkyn2mpOQVVkQ/640?wx_fmt=png)** 

 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4kTNDArNIwgRnLGqDrxJdr31DSLYxHsmYbp9jeCgCSwtiaDOrDKUuxzQ/640?wx_fmt=png)** 

 **![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4ZRyRBZicZFKCdiaAWic3icBXWxN3NP2uM0kBaOPBYOJmAIXcl8rHo2KiadA/640?wx_fmt=png)** 

**注意⚠️：扫描结束后才会在 BurpSuite 的 Target、Dashboard 模块显示高危漏洞，进程扫描中无法进行同步，但可以在插件中查看（涉及到 DoPassive 方法问题）。**

**![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgxtzzb1SmVBu0BX8sYhpKa4N44MWuiaHHszzGsh9HRkCEQvH4rdLFXRicMTq9SdFO2cg4lZJNeINwYg/640?wx_fmt=png)**

### Update

#### 更新说明 - v1.4.1

1.  修复 dnslog 平台，更换 api 接口。
    
2.  版本号未修改，下次更新上传。
    

#### 更新说明 - v1.4

1.  增加 laravel 漏洞扫描、增加 laravel 主动扫描。
    
2.  Issue 首字母大写（强迫症福音）。
    
3.  增加自定义每个请求之间延时的功能。
    
4.  增加 SQL 注入扫描、增加 SQL 注入主动扫描（MySQL 报错，时间盲注 SQL 全系列）。
    
5.  修复 Text4shell 某些头部不扫描的问题。
    
6.  修复主动扫描时已存在的漏洞不会重复添加的问题。
    
7.  修复 dnslog 平台，更换 api 接口为 dnslog.rest。
    

#### 更新说明 - v1.3

1.  增加 thinkphp 多语言 rce 漏洞扫描。
    
2.  优化 thinkphp 多语言 rce 探测数据包，减少发包数量。
    

#### 更新说明 - v1.2

1.  增加 Fastjson 参数扫描，并增加 Fastjson 主动扫描。
    
2.  修改引入的 fastjson 库版本为 1.2.83，防止被反制。
    
3.  删除自己添加的 bp api，改为 maven 库导入模式。
    
4.  增加 axis 服务接口扫描。
    

#### 更新说明 - v1.1

1.  增加 Domain 黑名单设置，可手动添加域名让插件对该域名进行判断是否为黑名单，从而不对其进行漏洞探测，来减少多余的探测进程影响渗透过程。。
    
2.  黑名单模式添加方式：google.com 或者 google，127.0.0.1 或者 127.0.0.1:8080；之前的扫描进程不会中断，下一个域名或者 ip 开始进行判断。
    
3.  Reset 表示恢复默认黑名单状态，也就是当前初始化状态。
    
4.  apply 表示当你启用 BlackList 功能时，需要 apply 加载。
    

#### 更新说明 - v1.0

1.  增加 druid 未授权扫描。
    
2.  修复 log4j 只扫描 已有头部与容易出现问题头部取交集 的问题。
    
3.  修复 SpringBoot Env、swagger、druid 在同一文件中导致的发现 druid 则不再探测其他漏洞的问题。
    
4.  修改 dnslog 请求次数，改为仅在插件开启时请求一次，方便查询 dnslog 结果。
    
5.  不扫描 dnslog 平台（某个家伙 Yyy 连 dnslog 都自己扫了）。
    
6.  增加了 spring cloud gateway 扫描，但没加漏洞检测。
    
7.  修复了 spring cloud SPEL 漏洞不报的问题，增加 / functionRouter 接口扫描。
    
8.  修复只取 host 不取 port 导致同一域名不同端口会跳过扫描的问题。
    
9.  修复 fastjson 扫描无法通过 dnslog 获取结果的问题。
    
10.  修复匹配 URL 后缀时使用包含的方式，改为以 xx 后缀结尾。
    
11.  修改 log4j 和 text4shell 为不扫描. asp/.php/.aspx 等后缀。
    
12.  增加 ThinkPHP 主动自定义目录扫描
    
     ○ 比如：想扫描 / Think5 / 目录的话，Repeater 请使用 GET /Think5/ HTTP/1.1；  
    
    ○ 缺点：如果想主动扫描根目录或 public 目录的话，Repeater 请使用根目录 GET / HTTP/1.1。
    
13.  修改结果窗口的请求和响应分割线，将其保持在中间的位置。
    
14.  增加 Weblogic 主动扫描（这个也有类似 ThinkPHP 的自定义目录扫描）。
    

#### 更新说明 - v0.1

1.  修改 dnslog 部分，将 ceye 删除，创建了 testmail.buzz（已修复）。
    
2.  增加 Text4shell 漏洞探测。
    
3.  增加 springboot 信息泄露扫描记录，防止扫描重复路径。
    
4.  增加配置窗口，替代 config.json 文件。
    

### ToDo

<table cellpadding="0" cellspacing="0" height="380"><colgroup><col width="72"><col width="622"></colgroup><tbody><tr height="20"><td height="15" width="12" x:str="">√</td><td width="519" x:str="">增加 swagger-resource 的扫描与匹配规则。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">修复路径中包含. js 即跳过扫描的问题。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 druid 的扫描配置。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 springboot 扫描绕过部分（后跟. json 后缀、增加 / 绕过方式）。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 log4j 扫描的头部字段。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 spring 漏洞扫描（core 没加）。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 log4j 的 404 路径扫描，未测试，没找到测试环境。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 fastjson 扫描规则。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 ThinkPHP Scan。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">修改 sql 注入扫描&nbsp;-&nbsp;后续慢慢来，工程量太大。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 weblogic 检测 poc。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">删除 Level Make 功能。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">修改 scannedURL，改为每个 POC 都有自己的 scannedURL 并单独检测。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">增加 fastjson 检测（参数中的）。</td></tr><tr height="20"><td height="15" x:str="" width="12"><br></td><td width="519" x:str="">增加 shiro 扫描 key - 比较占用时间，决定不加。</td></tr><tr height="20"><td height="15" x:str="" width="12"><br></td><td width="519" x:str="">增加 log4j、Text4shell、fastjson 的延迟检测 - 决定不加，手动探测吧。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">修改 bp 的 interface，改为 2022 的 interface，目前 issue 无法同步到 dashboard 那里。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">设置 ThinkPHP 扫描每个目标仅扫一次。</td></tr><tr height="20"><td height="15" x:str="" width="12">√</td><td width="519" x:str="">设置 weblogic 扫描每个目标仅扫描一次。</td></tr></tbody></table>

### Thanks

部分代码参考来源：

https://github.com/pmiaowu/BurpShiroPassiveScan

https://github.com/pmiaowu/BurpFastJsonScan

https://github.com/l1ubai/GyScan

https://github.com/whwlsfb/Log4j2Scan

### END

欢迎各位师傅提 Issue。。。