<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/jIba2RLaAmxmJsYrrDnunA)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhavmkTAluVkiaSCs1FlxrSHQBrGSYQGWvc9PAYHDvGVq3nEjtueJBbsw/640?wx_fmt=jpeg)  

**巡风**是一款适用于企业内网的**漏洞快速应急、巡航扫描**系统，通过搜索功能可清晰的了解内部网络资产分布情况，并且可指定漏洞插件对搜索结果进行快速漏洞检测并输出结果报表。**巡风**是YSRC/同程安全应急响应中心出品的开源作品

本软件只做初步探测，无攻击性行为。请使用者遵守《中华人民共和国网络安全法》，勿将巡风用于非授权的测试

其主体分为两部分：**网络资产识别引擎，漏洞检测引擎**。

*   1、网络资产识别引擎会通过用户配置的IP范围定期自动的进行端口探测（支持调用MASSCAN），并进行指纹识别，识别内容包括：服务类型、组件容器、脚本语言、CMS。
    
*   2、漏洞检测引擎会根据用户指定的任务规则进行定期或者一次性的漏洞检测，其支持2种插件类型、标示符与脚本，均可通过web控制台进行添加。
    

项目地址
----

https://github.com/ysrc/xunfeng

安装指南
----

https://github.com/ysrc/xunfeng/blob/master/docs/install/Linux.md

下面介绍CentOS7下安装部署巡风的具体步骤
=======================

1、安装操作系统依赖
----------

```
yum install gcc libffi-devel python-devel openssl-devel libpcap-devel  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhEzRB26L490nvLVkZQNQXOg3Ry89S0m28Q9qr4HwyuiaAKaK29EHjVLg/640?wx_fmt=jpeg)

(图片可放大查看)

2、上传巡风安装包
---------

```
tar -zxvf /root/xunfeng-0.1.1.tar.gz -C /opt  
cd /opt  
mv xunfeng-0.1.1/ xunfeng  
  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhIVCFEWxu7JC7vHmRffNtIvQLYCc6jcLoe5DerWO1NKFf4I7W6xAXZA/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhjiaJWJm8BwtxiaxLIQ604ricA0qcppt3eibia1uI1UMhGiaJQbasMSYM89kA/640?wx_fmt=jpeg)

(图片可放大查看)

3、python 依赖库
------------

```
建议使用pip进行管理  
wget https://sec.ly.com/mirror/get-pip.py --no-check-certificate  
python get-pip.py  
更新到pip最新版本:  
pip install -U pip  
使用pip安装 python 依赖库, 这里使用了豆瓣的 pypi 源。  
cd /opt/xunfeng  
pip install -r requirements.txt -i https://pypi.doubanio.com/simple/  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuhw3RTSldkqDTUzBwJpnIEMyibKmQD8pAqMQdJHoXsODShicz6uKPOUxgA/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhzNtYgt1oIrzk51s0pGsobzHtyThDuAdHU689hyKtfg1L1S8zxxSTAg/640?wx_fmt=jpeg)

(图片可放大查看)

Tips:

```
若出现pyparsing报错用下面命令解决  
pip install -I pyparsing==2.2.0  
  
再次执行  
pip install -r requirements.txt -i https://pypi.doubanio.com/simple/
```

4、安装mongodb
-----------

```
cat > /etc/yum.repos.d/mongodb.repo << \EOF  
[mongodb-org]  
name=MongoDB Repository  
baseurl=http://mirrors.cloud.tencent.com/mongodb/yum/el$releasever/  
gpgcheck=0  
enabled=1  
EOF
```

```
yum install -y mongodb-org  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhqnmgB04GWdlwqicg8JiaZttmG0L1PiajeNUfguNu1IncibtOuum22nC9KA/640?wx_fmt=jpeg)

(图片可放大查看)

5、创建数据库及数据库账户，并导入数据  

----------------------

启动数据库

```
service mongod restart  
netstat -antlp | grep 27017  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhY0iaLe9kxXef2aVBsW3NjjI17wEZM5Y6rGvWdJYLvEzqRDdlUzxuEHA/640?wx_fmt=jpeg)

(图片可放大查看)

创建数据库账户及密码

```
mongo  
use xunfeng  
db.createUser({user:'scan',pwd:'password2021',roles:[{role:'dbOwner',db:'xunfeng'}]})  
exit  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhPWard0aE9Fh6ZnkgnkcTpzSiazmzIC9RljUhTiaKqNmHhz9jFlvic1s3w/640?wx_fmt=jpeg)

(图片可放大查看)

导入数据  

```
cd /opt/xunfeng/db  
mongorestore -h 127.0.0.1 --port 27017 -d xunfeng .
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuh9h4YW2ZRYxDC7FLklNRSRvicUNvkjliaE8VuH856Qz1E7OCicRcFicflWQ/640?wx_fmt=jpeg)

(图片可放大查看)

可以使用navicat测试数据库是否可以正常连接 

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhI4Euf1JxNhDMYQhlKiaurw0fXxvZl9QpvpWm1pM3ehELMibnPmlvU3jw/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhAgzeLrheMsKtNiaXibRHjKxJUSk78O9k5ibslUTT29IGbCgic6t3rIl71g/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuhzxib2ASgWbAbYhmacF7ou6n0JRLicfDD6bZibJZ4MftsiaickPecLO3WhyQ/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhAlthQOdd9H4NSpTFRugo30eVLdib5cs9844GF4P0zc9kS0X0Sj9dbag/640?wx_fmt=jpeg)

(图片可放大查看)

接下来停止数据库服务

```
service mongod stop  

```

6、修改Config.py和Run.sh中端口与密码
--------------------------

cat Config.py

```
  
class Config(object):  
    ACCOUNT = 'admin'  
    PASSWORD = 'xunfen321'  
  
  
class ProductionConfig(Config):  
    DB = '127.0.0.1'  
    PORT = 27017  
    DBUSERNAME = 'scan'  
    DBPASSWORD = 'password2021'  
    DBNAME = 'xunfeng'  

```

cat Run.sh

```
  
#!/bin/bash  
CURRENT_PATH=`dirname $0`  
cd $CURRENT_PATH  
  
XUNFENG_LOG=/var/log/xunfeng  
XUNFENG_DB=/var/lib/mongo  
  
[ ! -d $XUNFENG_LOG ] && mkdir -p ${XUNFENG_LOG}  
[ ! -d $XUNFENG_DB ] && mkdir -p ${XUNFENG_DB}  
  
nohup mongod --port 27017 --dbpath=${XUNFENG_DB} --auth  > ${XUNFENG_LOG}/db.log &  
nohup python ./Run.py > ${XUNFENG_LOG}/web.log &  
nohup python ./aider/Aider.py > ${XUNFENG_LOG}/aider.log &  
nohup python ./nascan/NAScan.py > ${XUNFENG_LOG}/scan.log &  
nohup python ./vulscan/VulScan.py > ${XUNFENG_LOG}/vul.log &  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhqOrrRPPukyrhQxyrooBhyGSE6vmibWiaFY9q5czX6ibgyiaIPnSWCW7vKA/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhwibQ50kXRAP5TkU1V4D6LVZMSbuT8OA8iaJSBWtekbu1ar25XxmszJRQ/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhpTVth8UzNvic3bqYgjjTrvBtuibUO2Vgr0tE1iaWYUPqbtczfUia4rFsfA/640?wx_fmt=jpeg)

(图片可放大查看)

Run.sh中修改XUNFENG_DB=/var/lib/mongodb为实际路径/var/lib/mongo 

yum安装的mongodb数据库路径为：/var/lib/mongo

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuh7BQvqJGBlhIMHBDN7ia8m96Ovicup2akHSVG8wnuicKib7emsdkpQA5icHw/640?wx_fmt=jpeg)

(图片可放大查看)

7、运行巡风
------

```
sh Run.sh 
```

查看日志是否有报错

```
tail -f /var/log/xunfeng/web.log  

```

防火墙放通web端口

```
firewall-cmd --zone=public --add-port=80/tcp --permanent  
firewall-cmd --reload  

```

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhpGu5o4oPXuricibWUujNnsr3mQby5icicZANOW29lMsJefkibEMSjdDvUAg/640?wx_fmt=jpeg)

(图片可放大查看)

8、使用巡风
------

http://IP

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhWicZGYvIHk6erjT8PxiaBagIwVaxSy6FXLQqNUHwzBytEhJnLuu8bWyw/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhiaN4jhAeVeK6W8MI11M7KmJ99nfyt5UdsIcthXicqN9jeib5HicuF6z4sQ/640?wx_fmt=jpeg)

(图片可放大查看)

*   1）设置网络资产探测列表
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhIm2sXXiaCpfVyR2bRicHPqFEicnHmkHgxL8hQqu2FicOB7QnNZM6XfBjxg/640?wx_fmt=jpeg)

(图片可放大查看)

*   2）启用MASSCAN，并设置实际masscan的路径及自定义弱口令字典
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhqZfLwc2ibf5Fl14NynuUNibIlGu6rVW2N6GvoaT5InYFswgC7vWia7wmg/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuhxe4zGxxxqHXkPHtn1MCIsNgN0cqJ5BN2bBDwkHfZib9jHPu8J9rNsBQ/640?wx_fmt=jpeg)

(图片可放大查看)

*   3）查询IP，下发POC漏洞扫描任务
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhHSfic6uIAeAUgx4MSZQ0XJ1YNn13t6dVXPnTXTn4Jdw3glqmh1eiaKug/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhFKu9K2ia8IGDibRoI5E35dho2Sj38Qlbttf4LuSXgZ8kiaqo19fjxJnFg/640?wx_fmt=jpeg)

(图片可放大查看)

*   4）下载扫描结果
    

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1ChuhS0aQqiaAGSeB7GzRzecVHTkSF6mJg0DQjq18OtSUBsoLibFs9JrfhVkg/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuh1MFeMj3cibFzv7u9KFdzN1f3IqoE3599NNgoI8PQoEmhR4YquR0w6CQ/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_jpg/n8kWxMqYcWUHT9wiabWoWw1tfYjO1Chuhrzib4QsofPwsxfibicBiaJp28vibWTouKorXX99MuvoL0BXmM8ufrfibCcrQ/640?wx_fmt=jpeg)

(图片可放大查看)

![](https://mmbiz.qpic.cn/mmbiz_png/3heAguJrdPwwb5AxgeyO4QBNh18Fn6zdHoLUI5icibB4ibJKHvDsZTm7oBibUMPBk2ccibiawFdUyRsxdwsHjdAVjYuw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/3heAguJrdPzCWice1Y8p1bdRNj1ia9mnqXmk7sSHiasP3r4pRyV3v3WxCT1UIFqKmD1F4g64cjHbgPhmkj6vbK1FA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/3heAguJrdPzLicKwibCOrj4LSdPHyjzIeCec4cT7TKYicpltRA9sjls9gnl2G8aQ2xxbEMDPklOXS9Qq1PiaWicxcjA/640?wx_fmt=png)