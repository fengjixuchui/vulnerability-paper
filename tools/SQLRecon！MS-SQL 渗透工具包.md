<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/iGQoTuLp8UHAurJI205pYA)

<table><tbody><tr><td width="557" valign="top" height="62"><p><strong>声明：</strong>该公众号分享的安全工具和项目均来源于网络，仅供安全研究与学习之用，如用于其他用途，由使用者承担全部法律及连带责任，与工具作者和本公众号无关。</p></td></tr></tbody></table>

现在只对常读和星标的公众号才展示大图推送，建议大家把 Hack 分享吧 “设为星标”，否则可能看不到了！

**工具介绍**

SQLRecon 是一款使用 C# 开发的 MS-SQL 渗透工具包，专为攻击性侦察和后期渗透而设计；有关每种技术的详细使用示例可参阅 wiki 。

类似工具还有：SharpSQLTools、PySQLTools，大家可以自己去看下，根据实际场景使用。

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6ufFNzOLta5CicheE3DyJjNc3mnXeswsZEcCFZibjBAfbSjsxR6Z7Gbnj4xCkSIuwtHwPBdyhqPNU9icg/640?wx_fmt=png)

**工具参数**

**枚举**  

SQLRecon 支持 MSSQL SPN 的 Active Directory 枚举，类似于 PowerUpSQL 的 Get-SQLInstanceDomain.

```
枚举类型 (-e)：
-e domain - 使用当前用户令牌为MSSQL SPN枚举AD
   [+] -d domain.local | (可选) Domain FQDN

```

**强制参数**
--------

强制参数包括身份验证类型（Windows、本地或 Azure）、连接参数和模块。  

```
身份验证类型 (-a)：
-a Windows - Windows身份验证，这使用当前用户令牌
-a Local - 本地身份验证，这需要本地数据库用户的凭据
-a Azure - Azure AD域用户名和密码身份验证，这需要域用户的凭据
如果身份验证类型是Windows，那么您将需要提供以下参数：
-s SERVERNAME - SQL服务器主机名/IP
-d DATABASE - SQL服务器数据库名称，默认为“master”
-r PORT - 默认端口1433
-m MODULE - 您要使用的模块
如果身份验证类型是Local，那么您将需要提供以下参数：
-s SERVERNAME - SQL服务器主机名/IP
-d DATABASE - SQL服务器数据库名称，默认为“master”
-u USERNAME - 本地SQL用户的用户名
-p PASSWORD - 本地SQL用户的密码
-r PORT - 默认端口1433
-m MODULE - 您要使用的模块
如果身份验证类型是Azure，则您需要提供以下参数：
-s SERVERNAME - SQL服务器主机名/IP
-d DATABASE - SQL服务器数据库名称，默认为“master”
-r DOMAIN.COM - 域的FQDN
-u USERNAME - 域用户的用户名
-p PASSWORD - 域用户的密码
-m MODULE - 您要使用的模块

```

← 左右滑动查看更多 →

**注：**有时 SQL Server 可能不会使用标准 TCP 端口，如：MSSQL 故障转移集群。如果身份验证类型是 Windows 或 Local ，您可以选择通过 -r 参数来设置非标准连接端口。默认情况下 SQLRecon 将通过 1433 端口连接到数据库。

**标准模块**
--------

标准模块用于与单个 MS SQL 服务器进行交互。

```
标准模块(-m)：
info - 打印有关SQL服务的信息
query -o QUERY - 执行任意SQL查询
whoami - 查看您登录的用户、映射的用户以及存在的角色
users- 查看哪些用户帐户和组可以针对数据库进行身份验证
databases - 显示SQL服务器上存在的所有数据库
tables -o DATABASE - 显示您指定的数据库中的所有表
search -o KEYWORD - 在您连接的数据库的表中搜索列名
smb -o SHARE - 捕获NetNTLMv2哈希
↓命令执行（需要系统管理员角色或类似角色）
enablexp - 启用xp_cmdshell
disablexp - 禁用xp_cmdshell
xpcmd -o COMMAND - 使用xp_cmdshell执行任意系统命令
enableole - 启用OLE自动化程序
disableole - 禁用OLE自动化程序
olecmd -o COMMAND - 使用OLE自动化程序执行任意系统命令
enableclr - 启用自定义CLR程序集
disableclr - 禁用自定义CLR程序集
clr -o DLLPATH -f FUNCTION - 在自定义存储过程中加载并执行.NET程序集
agentstatus - 检查SQL代理是否正在运行并获取作业
agentcmd -o COMMAND - 执行任意系统命令

```

← 左右滑动查看更多 →

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6ufFNzOLta5CicheE3DyJjNc3XzSanoRWjJh2K2JAaa8YryHUxwkMKe4SM4WBgtVT4rBn7Fy97RVngQ/640?wx_fmt=png)

**模拟模块**
--------

模拟模块用于在模拟 SQL 用户的上下文中与单个 MS SQL 服务器进行交互。

```
模拟模块(-m)：
impersonate - 枚举任何可以被模拟的用户帐户
iwhoami -i IMPERSONATEUSER - 查看您登录的用户、映射的用户以及存在的角色
iusers -i IMPERSONATEUSER - 查看哪些用户帐户和组可以针对数据库进行身份验证
iquery -i IMPERSONATEUSER -o QUERY - 作为模拟用户执行任意SQL查询
↓命令执行（需要系统管理员角色或类似角色）
ienablexp -i IMPERSONATEUSER - 启用xp_cmdshell
idisablexp -i IMPERSONATEUSER - 禁用xp_cmdshell
ixpcmd -i IMPERSONATEUSER -o COMMAND - 使用xp_cmdshell执行任意系统命令
ienableole -i IMPERSONATEUSER - 启用OLE自动化程序
idisableole -i IMPERSONATEUSER - 禁用OLE自动化过程
iolecmd -i IMPERSONATEUSER -o COMMAND - 使用OLE自动化程序执行任意系统命令
ienableclr - 启用自定义CLR程序集
idisableclr - 禁用自定义CLR程序集
iclr -o DLLPATH -f FUNCTION - 在自定义存储过程中加载并执行.NET程序集
iagentstatus -i IMPERSONATEUSER - 检查SQL代理是否正在运行并获取作业
iagentcmd -i IMPERSONATEUSER -o COMMAND - 执行任意系统命令

```

← 左右滑动查看更多 →

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6ufFNzOLta5CicheE3DyJjNc3JtCnoP36wbVjO5YYxgOibg3TpyJgxy2gqn9ZkQg0hribzcDCtAbnFKTw/640?wx_fmt=png)

**链接的 SQL Server 模块**
---------------------

当您能够通过已建立的连接与链接的 SQL 服务器进行交互时，链接的 SQL Server 模块是有效的。  

```
链接的SQLServer模块(-m)：
links - 枚举任何链接的SQL服务器
lquery -l LINKEDSERVERNAME -o QUERY - 在链接的SQL服务器上执行任意SQL查询
lwhoami -l LINKEDSERVERNAME - 查看您在链接的SQL服务器上登录的用户
lusers -l LINKEDSERVERNAME - 查看哪些用户帐户和组可以针对链接的SQL服务器上的数据库进行身份验证
ldatabases -l LINKEDSERVERNAME - 显示链接的SQL服务器上存在的所有数据库
ltables -l LINKEDSERVERNAME -o DATABASE-显示链接的SQL服务器上提供的数据库中的所有表
lsmb -l LINKEDSERVERNAME -o SHARE - 从链接的SQL服务器捕获NetNTLMv2哈希
↓命令执行（需要系统管理员角色或类似角色）
lenablerpc -l LINKEDSERVERNAME - 在链接的SQL服务器上启用RPC和RPC out
ldisablerpc -l LINKEDSERVERNAME - 在链接的SQL服务器上禁用RPC和RPC out
lenablexp -l LINKEDSERVERNAME - 在链接的SQL服务器上启用xp_cmdshell
ldisablexp -l LINKEDSERVERNAME - 在链接的SQL服务器上禁用xp_cmdshell
lxpcmd -l LINKEDSERVERNAME -o COMMAND - 在链接的SQL服务器上使用xp_cmdshell执行任意系统命令
lenableole -l LINKEDSERVERNAME - 在链接的SQL服务器上启用OLE自动化过程
ldisableole -l LINKEDSERVERNAME - 在链接的SQL服务器上禁用OLE自动化过程
lolecmd -l LINKEDSERVERNAME -o COMMAND - 在链接的SQL服务器上使用OLE自动化过程执行任意系统命令
lenableclr -l LINKEDSERVERNAME - 在链接的SQL服务器上启用自定义CLR程序集
ldisableclr -l LINKEDSERVERNAME - 在链接的SQL服务器上禁用自定义CLR程序集
lclr -o DLLPATH -f FUNCTION - 在链接的SQL服务器上的自定义存储过程中加载并执行.NET程序集
lagentstatus -l LINKEDSERVERNAME - 检查SQL代理是否正在运行并在链接的SQL服务器上获取作业
lagentcmd -l LINKEDSERVERNAME -o COMMAND - 在链接的SQL服务器上执行任意系统命令

```

← 左右滑动查看更多 →

**下载地址**

**点击下方名片进入公众号**

**回复关键字【****23****0601****】获取**下载链接****

**信 安 考 证**

  

  

需要考以下各类安全证书的可以联系我，价格优惠、组团更便宜，还送【潇湘信安】知识星球 **1** 年！

<table><tbody><tr><td width="557" valign="top"><p>CISP、PTE、PTS、DSG、IRE、IRS、NISP、PMP、CCSK、CISSP、ISO27001...</p></td></tr></tbody></table>

![](https://mmbiz.qpic.cn/mmbiz_jpg/XOPdGZ2MYOeH17P4KeKnWkbLrWiaWOb0F1PCq8qME7Y67R45o7kW1iabxmbbd4yldq5cA3HsQZo2Q6lB3rYUVSUA/640?wx_fmt=jpeg)

往期推荐工具

[渗透测试常用的数据库综合利用工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484579&idx=1&sn=2f2054508220223100066edf3064b37b&chksm=9036e21ba7416b0d7afecc97d3338d954023a51a5622939782273f264207363e4ea8ba9d18de&scene=21#wechat_redirect)

[RequestTemplate 红队内网渗透工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484512&idx=1&sn=90d24f2727ba99c870d7112c406bf208&chksm=9036e2d8a7416bce7e190896de3c7cbd428d385d5563717bce46b0c7f51f33ea18d3e0f1af1e&scene=21#wechat_redirect)

[Railgun - 一款 GUI 界面的渗透工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484499&idx=1&sn=edeae57e8306db1bfdcb72e0b0b655d2&chksm=9036e2eba7416bfdbe6a495b60a89d1a677fc745aa512036072224fc1537d8931276e55f7c90&scene=21#wechat_redirect)

[GoBypass - Golang 免杀生成工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484019&idx=1&sn=05133dd5cb31474078eb4ab019f164f3&chksm=9036e4cba7416ddd92c8f9147bb2d283ddedcdfb4d46ed5987d192863008be9bc655025e0697&scene=21#wechat_redirect)

[ByPassBehinder 冰蝎 WebShell 免杀工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484096&idx=1&sn=487a1f9daf0090071913aeceeb266d53&chksm=9036e478a7416d6ebced132fe4a03bb1d2584d7fb3eb433612151648743322ff900ae849d572&scene=21#wechat_redirect)

[SweetBabyScan 内网资产探测漏扫工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484070&idx=1&sn=eb4cd4f6aac6e0a0ef26a75e4bc2bc7a&chksm=9036e41ea7416d088f70e8593099f750c81b079de1b4b14219276b352a2e83a3eb1d5829c94b&scene=21#wechat_redirect)

[掩日 - 适用于红队的综合免杀工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247483997&idx=1&sn=1a87fc6bfec2a48dd3dfa5bc2852e8e8&chksm=9036e4e5a7416df3ff7f5b4cf55b4c8c57cde271128de0b9fcdf381a19afb207223deb88fb61&scene=21#wechat_redirect)

[AuxTools 浮鱼渗透辅助工具箱 V1](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247483907&idx=1&sn=4e7cf5de0472f6685edb64a598e6aff8&chksm=9036e4bba7416dad5aa253462a84d0c47fdb4e89914c70bd5a3fbbd8b4ef05572a4e7e702faa&scene=21#wechat_redirect).0

[POCbomber 红队快速打点漏洞检测工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247483790&idx=1&sn=35e3a0fa64cff8d72313fa41ddcbfc3c&chksm=9036e736a7416e20dcd23cfede5c887bfecf5e489234eeb67040bcbbc6326cb42373d226a186&scene=21#wechat_redirect)