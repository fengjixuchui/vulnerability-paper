> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/TbJZRqb2mEraNWCWhBt9XA)

<table width="676"><tbody><tr><td valign="top" width="557" height="62"><section><strong>声明：</strong>该公众号大部分文章来自作者日常学习笔记，也有少部分文章是经过原作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系昊辰。</section><section>请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。</section></td></tr></tbody></table>

### python 小工具学习连载

### -web 目录碰撞 -

应用场景
----

我们都知道，现在存在大量开源的 cms 被我们使用，甚至于在各种企业网络中都变得常见。而所有的系统在安装、配置以及不定管理方面都有着自己的缺陷，CMS 也不例外。由于我们可以从网上下载任何开源的 web 应用程序，并在本地搭建，那么我们可以根据这个来创建一个能够获取远程目标所有文件都扫描器。这样就能深度挖掘被. htacess 文件保护的残留安装文件和目录以及其他内容。相比于常见的御剑、dirsearch 来说，我们通过利用本地 cms 源码来对网站进行扫描，大大提高了命中率，就像针对不同的病毒打不同的疫苗一样，在测试中我使用 dirsearch 对自己的网站进行扫描，结果只有 10 个左右，但是使用本次编写的 web 目录碰撞工具，成功扫描到了 140 + 个敏感文件，其中不乏数据库的配置文件等。

工具效果
----

利用本地源码目录对自己的网站目录进行碰撞。

使用方法：python3 web 目录碰撞. py target_url 本地 cms 路径

![](https://mmbiz.qpic.cn/mmbiz_png/xG8Nt1c2ib4SELS2nWgFZ5j0rheRDFLxDygibUian26fK81z1wGYqiaxojnbh9X8goiamD5WVDtIf3XicRtjN1khk6SA/640?wx_fmt=png)Snipaste_2021-12-25_18-12-23

dirsearch 扫描结果

![](https://mmbiz.qpic.cn/mmbiz_png/xG8Nt1c2ib4SELS2nWgFZ5j0rheRDFLxDRXSG1xsBeKTU38Uia58EPRg8CsPw2icGR3HzR1vNgktIPV0eibOhOtd7Q/640?wx_fmt=png)image-20211225181523010

实现原理
----

因为我们的工具实现原理是我们扫描本地的 cms 源码文件，通过这些源码文件中的目录去对网站的目录进行碰撞，所以我们肯定需要一个 cms 的源码。这里我将源码下载放在了 download 下的 build 文件中。

首先呢，我们需要输入目标的网址以及本地源码的路径，然后根据源码的路径，使用 os.chdir 函数将工作目录切换到该路径下。然后通过 os.walk 函数去遍历该路径下的所有文件，并以队列的方式进行存储。并且在发现一些我们不需要的文件时，会自动将它省略。

```
target = sys.argv[1]directory = sys.argv[2]filters = [".jpg",".gif",".png",".css"]# 切换工作路径os.chdir(directory)# 创建一个队列web_paths = queue.Queue()for r,d,f in os.walk("."):    for files in f:        remote_path = "{}/{}".format(r,files)        if remote_path.startswith("."):            remote_path = remote_path[1:]        if os.path.splitext(files)[1] not in filters:            web_paths.put(remote_path)
```

现在我们就获得了该 cms 的所有文件的路径，然后我们将其与我们的 url 拼接起来，使用 requests 模块去进行访问，通过网页状态码来判断该页面是否可以访问到。

```
def test_remote():    while not web_paths.empty():        path = web_paths.get()        url = "{}{}".format(target,path)        #print(url)        headers = {            'User-Agent':'Mozilla/5.0 (Windows NT 10.0; WOW64)'        }                try:            response = requests.get(url,headers=headers)            if response.status_code == 200:                print("[{}] => {}".format(response.status_code,url))                result.append(url)            else:                print("[-] {} 状态吗为:{}".format(url,response.status_code))        except:            print("[-] {} {}".format(url,"连接失败"))            pass
```

因为一个网站的文件往往很多，所以这里还采用了多线程的方式进行扫描，并且在最后扫描结束时，将扫描的结果全部放入我们的 result.txt 文件中。

```
for i in range(threads):    t = threading.Thread(target=test_remote)    t.start()while True:    if threading.active_count() == 1:        os.chdir(now_work)        f = open('result.txt','w')        for i in result:            f.write(i+'\n')        f.close()        break
```

#### 关注公众号回复 "web 目录碰撞" 获取该工具

公众号

![](https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png)

**推荐阅读**

[**python 小工具学习连载 - ssh 隧道**](http://mp.weixin.qq.com/s?__biz=MzkyODI3MTgwNQ==&mid=2247484181&idx=1&sn=cfe146d6a2345115756e2a4dd42ced35&chksm=c21a1fc7f56d96d11f09fe26ef81eaf6a0256ee8871a02610793b33cae126622d0aa77527a81&scene=21#wechat_redirect)  

[**python 小工具学习连载 - ssh 反向连接**](http://mp.weixin.qq.com/s?__biz=MzkyODI3MTgwNQ==&mid=2247484106&idx=1&sn=51849f47c035d09068ccf4d0bf0df086&chksm=c21a1e18f56d970ecbd67563a8ca8859c77ab1cf4cddeffa95343c72edc52ee151c0c6a5e6b8&scene=21#wechat_redirect)  

[**python 小工具学习连载 - 反向 shell**](http://mp.weixin.qq.com/s?__biz=MzkyODI3MTgwNQ==&mid=2247483897&idx=1&sn=92987b90c09401036f96dbb4dc06c9f5&chksm=c21a1d2bf56d943d3f1121a2d76eee36137ee5bd95cf333471069830c4a25193829837f0f92e&scene=21#wechat_redirect)  

[**python 小工具学习连载 - 取代瑞士军刀**](http://mp.weixin.qq.com/s?__biz=MzkyODI3MTgwNQ==&mid=2247483852&idx=1&sn=9f37721a78ee497e850b47118be28621&chksm=c21a1d1ef56d9408adbb282474a7c77b4ed98e3dd19490b172eff1bbb67c12624a9da8269fc3&scene=21#wechat_redirect)