<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/PrCBSLisqWmd3XbPJ6bTOQ)

shiro反序列化漏洞综合利用 v2.2
====================

下载地址  

https://github.com/j1anFen/shiro_attack

填坑,修bug。基于javafx,利用shiro反序列化漏洞进行回显命令执行以及注入各类内存马

1.  自定义关键字
    
2.  添加代理功能(设置->代理)
    
3.  检出默认key (SimplePrincipalCollection) cbc/gcm
    
4.  Tomcat/Springboot 回显命令执行
    
5.  集成CommonsCollectionsK1/K2/NoCC
    
6.  通过POST请求中defineClass字节码实现注入内存马
    
7.  resources目录下shiro_keys.txt可扩展key
    

内存马
---

注入类型：冰蝎,哥斯拉,蚁剑[JSP 自定义返回包格式],neoreGeorg,reGeorg（均为默认配置,当前最新版本）

1.  提示：**注入Servlet内存马路径避免访问出错尽量选择静态资源目录。**, Filter无需考虑
    
2.  某些spring环境以jar包启动写shell麻烦
    
3.  渗透中找目录很烦,经常出现各种写shell浪费时间问题
    
4.  无落地文件舒服
    
5.  主要参考哥斯拉以及As-Exploits兼容实现
    

TODO
----

1.  解决serialVersionUID匹配cc/cb多种jar包
    
2.  ...
    

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

shiro综合利用工具

下载地址

https://github.com/safe6Sec/ShiroExp

### 0x01 说明

简单说一下，这个工具里面很多payload比如SimplePrincipalCollection进行检测、tomcat通用回显、cc链、内存马注入等等都是各位大佬花时间研究出来的成果。小弟只是学习漏洞原理之后习惯性的输出一个轮子。  
这个工具前前后后差不多搞了二十天左右才弄出来。本来打算上周末发出来，由于本人太菜鸡在内存马上卡了几天。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

 ![](http://mmbiz.qpic.cn/mmbiz_png/7XAvvlbibo1RFgAFeqib8ULThEGibyJ2xJy3UtvgN7jO2UiaUIQnfg4CIClelEogiav0N50lzKTJZlvLhOEFgQU65AA/0?wx_fmt=png) ** 阿乐你好 ** 安全相关信息推送 4篇原创内容   公众号