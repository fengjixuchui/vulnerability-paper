> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/-HUp8zKuHjrX2GwVNRcytg)

DNSLog-Platform-Golang
======================

相信 DNSLog 平台已经是安全从业者的标配。而公开的 DNSLOG 平台域名早已进入流量监控设备的规则库。同时也有隐私问题值得关注。于是撸了（凑了）一个一键搭建 Dnslog 平台的 golang 版本。可以使用其一键搭建自己的 Dnslog 平台。由于是作者的第一个 golang 程序，难免会有一些小问题。不过 他真的是一键！

部署
--

1.  选择你喜欢的方式下载本目录下的 main.go 文件
    
    不多说。
    
2.  决定是否开放公网访问？
    
    倒数第几行中的`http.ListenAndServe("localhost:8000", nil)` ，这样写的话只能通过 localhost 进行访问，墙裂建议不要修改，而后通过中间件反向代理后对外开放，方便做访问控制、日志管理等。如果想直接对外开放的话可以修改为:`http.ListenAndServe(":8000", nil)`
    
3.  域名准备
    
    做好 NS 指向即可。不会检查请看后文
    
4.  尝试运行
    
    先`go get github.com/miekg/dns` 获取需要的库。`go run main.go yourdomain` 可先在 shell 前台运行，看功能是否正常使用与检查数据存放目录是否成功创建。如果没问题的话 直接 `nohup go run main.go yourdomain &`
    
    （第一次运行需要到 github 拖 miekg/dns 库，所以需要你的服务器能上 github）
    

使用
--

直接 web 访问进行使用。或者使用 api 接口。只有两个 URI，

1.  /new_gen
    
    生成随机的八位字符，组合到 domain 中并返回。当然也可以本地生成，没做限制，无所谓。
    
2.  / 八位字符
    
    第一步生成的八位字符可以直接访问，可以获取到相关的 DNS 解析记录。返回为 null 或者正常数据的 JSON 形式。
    

PS：当然，你也可以通过 go build 打包成可执行文件进行跨平台或者离线运行。这都依赖于 go 的特性。

可定义的配置项
-------

1.  临时数据存放目录
    
    ```
    localdir, _ := os.Getwd()
    tmplogdir = localdir + "/dnslog/" //DNS日志存放目录,可自行更改。
    ```
    
2.  html 页面
    
    HelloHandler 方法中的 res 变量
    
3.  子域名长度
    
    数据接口判断了访问路径是否为 9, 是才会尝试读取文件中储存的记录。
    
    ```
    if len(r.URL.Path) == 9 {
    		w.Header().Set("Content-Type", "application/json")
    		res = GetDnslog(r.URL.Path)
    ```
    
    new_gen 接口返回的随机 key 长度为 8
    
    ```
    key := randSeq(8)
    ```
    
    写入文件时判断了子域名长度是否为 8
    
    ```
    if len(idkey) == 8 {
    ```
    

检查 NS 指向是否成功？
-------------

可以通过 linux 下命令行工具`host -t ns sub.youdomain.com`来确认 NS 服务器。也可以通过在线工具：https://myssl.com/dns_check.html （选择 NS 类型）

其他
--

感谢高学长给予的大力帮助：https://github.com/netchiso

往期推荐

[

干货 | log4j2 漏洞靶场、在线检测、burp 检测插件（附下载地址）



](http://mp.weixin.qq.com/s?__biz=MzIwMzIyMjYzNA==&mid=2247496952&idx=1&sn=ed2eef8f4bb7967b456636a38388c014&chksm=96d00ffda1a786eb6517c7a6c2ae998bbdf25ccec31e2ceb13000d452d668bb8fa207bed467a&scene=21#wechat_redirect)

[

实战 | 通过恶意 pdf 执行 xss 漏洞



](http://mp.weixin.qq.com/s?__biz=MzIwMzIyMjYzNA==&mid=2247496942&idx=1&sn=5a79d328041dc0f5a57524d5b2cc7a6f&chksm=96d00feba1a786fd834be303d63d53ca116abdac8bb361e6c6bd196a0418ed19ed30b76006ca&scene=21#wechat_redirect)

[

HVV 必备 | 二十八种未授权访问漏洞合集



](http://mp.weixin.qq.com/s?__biz=MzIwMzIyMjYzNA==&mid=2247496897&idx=1&sn=2cc83eba7c8081d08712cf7e5abd848d&chksm=96d00fc4a1a786d22f6baeedcec5c78058c59821cfa1a4ceee869c7cc024adc1755068c76756&scene=21#wechat_redirect)

[

实战 | 一次 springboot 未授权到云主机接管



](http://mp.weixin.qq.com/s?__biz=MzIwMzIyMjYzNA==&mid=2247496868&idx=1&sn=e771df248cbaaab2b3bfaab015a6d603&chksm=96d00fa1a1a786b71fc7a27b18d6e6f87cbfaf14703a348257b48f1491a1b0751a2ab55868f0&scene=21#wechat_redirect)

[

工具 | 从任意主机的 SSL 证书中抓取域名



](http://mp.weixin.qq.com/s?__biz=MzIwMzIyMjYzNA==&mid=2247496868&idx=2&sn=583b986d2435ddce2ff94e7b404a4f49&chksm=96d00fa1a1a786b7b53a1af8bc569b52b20abe2f284eb2c59d7158713bd4d3a1baf4f7f6e0a1&scene=21#wechat_redirect)

[深扒丨内网横向移动的九种方式](http://mp.weixin.qq.com/s?__biz=MzIwMzIyMjYzNA==&mid=2247496858&idx=2&sn=39fb1bdb8726b6e56c8d90fe13a52682&chksm=96d00f9fa1a786890b072d667773886a28a1b71b9c63fccf615eee3b33ebfcaf900c51abda1c&scene=21#wechat_redirect)

公众号