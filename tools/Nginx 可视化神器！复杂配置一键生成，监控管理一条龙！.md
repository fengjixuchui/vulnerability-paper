<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Df3LRdj_ABEhkJHgG44SPg)

> **来自公众号：Java 知音**

#### 功能说明

nginxWebUI 是一款图形化管理 nginx 配置的工具，可以使用网页来快速配置 nginx 的各项功能，包括 http 协议转发、tcp 协议转发、反向代理、负载均衡、静态 html 服务器、ssl 证书自动申请、续签、配置等。配置好后可一建生成 nginx.conf 文件，同时可控制 nginx 使用此文件进行启动与重载，完成对 nginx 的图形化控制闭环。

nginxWebUI 也可管理多个 nginx 服务器集群， 随时一键切换到对应服务器上进行 nginx 配置，也可以一键将某台服务器配置同步到其他服务器，方便集群管理。

nginx 本身功能复杂， nginxWebUI 并不能涵盖 nginx 所有功能，但能覆盖 nginx 日常 90% 的功能使用配置，平台没有涵盖到的 nginx 配置项，可以使用自定义参数模板，在 conf 文件中生成配置独特的参数。

部署此项目后，配置 nginx 再也不用上网各种搜索配置代码，再也不用手动申请和配置 ssl 证书，只需要在本项目中进行增删改查就可方便的配置和启动 nginx。

#### 技术说明

本项目是基于 solon 的 web 系统，数据库使用 h2，因此服务器上不需要安装任何数据库。

本系统通过 Let's encrypt 申请证书，使用 acme.sh 脚本进行自动化申请和续签，开启续签的证书将在每天凌晨 2 点进行续签， 只有超过 60 天的证书才会进行续签，只支持在 linux 下签发证书。

添加 tcp/ip 转发配置支持时，一些低版本的 nginx 可能需要重新编译，通过添加–with-stream 参数指定安装 stream 模块才能使用，但在 ubuntu 18.04 下，官方软件库中的 nginx 已经带有 stream 模块，不需要重新编译。本系统如果配置了 tcp 转发项的话，会自动引入`ngx_stream_module.so`的配置项，如果没有开启则不引入，最大限度优化 ngnix 配置文件。

#### jar 安装说明

以 Ubuntu 操作系统为例：

> **注意：本项目需要在 root 用户下运行系统命令，极容易被黑客利用，请一定修改密码为复杂密码**

1.  **安装 java 运行环境和 nginx**
    

Ubuntu:

```
apt update
apt install openjdk-11-jdk
apt install nginx


```

Centos:

```
yum install java-11-openjdk
yum install nginx


```

Windows:

```
下载JDK安装包 https://www.oracle.com/java/technologies/downloads/
下载nginx http://nginx.org/en/download.html
配置JAVA运行环境 
JAVA_HOME : JDK安装目录
Path : JDK安装目录\bin
重启电脑


```

2.  **下载最新版发行包 jar**
    

```
Linux: mkdir /home/nginxWebUI/ 
       wget -O /home/nginxWebUI/nginxWebUI.jar http://file.nginxwebui.cn/nginxWebUI-3.4.4.jar
Windows: 直接使用浏览器下载 http://file.nginxwebui.cn/nginxWebUI-3.4.4.jar 到 D:/home/nginxWebUI/nginxWebUI.jar


```

有新版本只需要修改路径中的版本即可

3.  **启动程序**
    

```
Linux: nohup java -jar -Dfile.encoding=UTF-8 /home/nginxWebUI/nginxWebUI.jar --server.port=8080 --project.home=/home/nginxWebUI/ > /dev/null &
Windows: java -jar -Dfile.encoding=UTF-8 D:/home/nginxWebUI/nginxWebUI.jar --server.port=8080 --project.home=D:/home/nginxWebUI/


```

参数说明 (都是非必填)

*   `--server.port` 占用端口, 默认以 8080 端口启动
    
*   `--project.home` 项目配置文件目录，存放数据库文件，证书文件，日志等, 默认为 / home/nginxWebUI/
    
*   `--spring.database.type=mysql` 使用其他数据库，不填为使用本地 h2 数据库，可选 mysql
    
*   `--spring.datasource.url=jdbc:mysql://ip:port/nginxwebui` 数据库 url
    
*   `--spring.datasource.username=root`  数据库用户
    
*   `--spring.datasource.password=pass`  数据库密码
    

> 注意 Linux 命令最后加一个 & 号，表示项目后台运行

#### docker 安装说明

本项目制作了 docker 镜像，支持 `x86_64/arm64/arm v7` 平台，同时包含 nginx 和 nginxWebUI 在内，一体化管理与运行 nginx。

1.  **安装 docker 容器环境**
    

Ubuntu:

```
apt install docker.io


```

Centos:

```
yum install docker


```

2.  **拉取镜像:**
    

```
docker pull cym1102/nginxwebui:latest


```

3.  **启动容器:**
    

```
docker run -itd \
  -v /home/nginxWebUI:/home/nginxWebUI \
  -e BOOT_OPTIONS="--server.port=8080" \
  --privileged=true \
  --net=host \
  cym1102/nginxwebui:latest


```

注意:

1.  启动容器时请使用`--net=host`参数，直接映射本机端口，因为内部 nginx 可能使用任意一个端口，所以必须映射本机所有端口。
    
2.  容器需要映射路径`/home/nginxWebUI:/home/nginxWebUI`，此路径下存放项目所有数据文件，包括数据、nginx 配置文件、日志、证书等，升级镜像时此目录可保证项目数据不丢失，请注意备份。
    
3.  `-e BOOT_OPTIONS` 参数可填充 java 启动参数，可以靠此项参数修改端口号。`--server.port` 占用端口，不填默认以 8080 端口启动。
    
4.  日志默认存放在`/home/nginxWebUI/log/nginxWebUI.log`
    

另: 使用 docker-compose 时配置文件如下：

```
version: "3.2"
services:
  nginxWebUi-server:
    image: cym1102/nginxwebui:latest
    volumes:
      - type: bind
        source: "/home/nginxWebUI"
        target: "/home/nginxWebUI"
    environment:
      BOOT_OPTIONS: "--server.port=8080"
    privileged: true
    network_mode: "host"


```

#### 编译说明

使用 maven 编译打包

```
mvn clean package


```

使用 docker 构建镜像

```
docker build -t nginxwebui:latest .


```

#### 添加开机启动

1.  **编辑 service 配置**
    

```
vim /etc/systemd/system/nginxwebui.service


```

```
[Unit]
Description=NginxWebUI
After=syslog.target
After=network.target
 
[Service]
Type=simple
User=root
Group=root
WorkingDirectory=/home/nginxWebUI
ExecStart=/usr/bin/java -jar /home/nginxWebUI/nginxWebUI.jar
Restart=always
 
[Install]
WantedBy=multi-user.target


```

之后执行

```
systemctl daemon-reload
systemctl enable nginxwebui.service
systemctl start nginxwebui.service


```

#### 使用说明

打开 `http://xxx.xxx.xxx.xxx:8080` 进入主页

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3iaM9RAckuMglOz5mjo9lbib0Y7S9OWZrqfI0n6K4xy6Bn8CSiaCY6aNIQ/640?wx_fmt=jpeg)

登录页面，第一次打开会要求初始化管理员账号

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe30HGT7ZnBMej0cB8wfsGMakFmvuic9ZkXWuIaMLYudYicZNSiaqsJsoibqA/640?wx_fmt=jpeg)

进入系统后，可在管理员管理里面添加修改管理员账号

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3NMqwBiba0FMSPbX9BY9XFhJB46D03ZBVic34lUZA1eacYjd3cFDEVbIw/640?wx_fmt=jpeg)

在 http 参数配置中可以配置 nginx 的 http 项目，进行 http 转发，默认会给出几个常用配置，其他需要的配置可自由增删改查。可以勾选开启日志跟踪，生成日志文件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3hzHkXGKkRLxUuWnLIic4NvtDbRx6ib9icg0bWxGoabsPGiaB3Z1bFeicddw/640?wx_fmt=jpeg)

在 TCP 参数配置中可以配置 nginx 的 stream 项目参数，大多数情况下可不配。

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3Aia7Lg2t28YRibPMibHHeQEzmbvBZIfWOE02fbogA8G9WjsgAAdzVrS3w/640?wx_fmt=jpeg)

在反向代理中可配置 nginx 的反向代理即 server 项功能，可开启 ssl 功能，可以直接从网页上上传 pem 文件和 key 文件，或者使用系统内申请的证书，可以直接开启 http 转跳 https 功能，也可开启 http2 协议。

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3fqZz1jrvZD228SOh69XyQaicYEqESFPiaibdg76KX37jet36YFg0EXmzQ/640?wx_fmt=jpeg)

在负载均衡中可配置 nginx 的负载均衡即 upstream 项功能，在反向代理管理中可选择代理目标为配置好的负载均衡

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3Yp5TNE5GKNH785R6pxkOCaFIibIAHQEqFoEIQCpBOB0QvEwtgpt51LQ/640?wx_fmt=jpeg)

在 html 静态文件上传中可直接上传 html 压缩包到指定路径，上传后可直接在反向代理中使用，省去在 Linux 中上传 html 文件的步骤

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3Dr2KpzExCTuZC679fqhB43xb0bQoUibLYurNwFDSIBHQPiabOymgoMAw/640?wx_fmt=jpeg)

在证书管理中可添加证书，并进行签发和续签，开启定时续签后，系统会自动续签即将过期的证书。

> 注意：证书的签发是用的 acme.sh 的 dns 模式，需要配合阿里云的 aliKey 和 aliSecret 来使用。请先申请好 aliKey 和 aliSecret

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3X9t9l1ibnpaDMNia0ntI6rbteetO2ZSpQiaaOyTraxeVfznGNDK9FmwGw/640?wx_fmt=jpeg)

备份文件管理，这里可以看到 nginx.cnf 的备份历史版本，nginx 出现错误时可以选择回滚到某一个历史版本

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe37F2NhbHz06XSv8MyjchqB3e7LSNBIhPd3Dsubb3vPjfYCicJ2CHTsHQ/640?wx_fmt=jpeg)

最终生成 conf 文件，可在此进行进一步手动修改，确认修改无误后，可覆盖本机 conf 文件，并进行效验和重启，可以选择生成单一 nginx.conf 文件还是按域名将各个配置文件分开放在 conf.d 下

![](https://mmbiz.qpic.cn/mmbiz_jpg/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3KOCfYIkU8JcgBLoaLF9IfgKLhicZ9XiaiaBSibKJP8dIhpOIz3SicZq7yhA/640?wx_fmt=jpeg)

远程服务器管理，如果有多台 nginx 服务器，可以都部署上 nginxWebUI，然后登录其中一台，在远程管理中添加其他服务器的 ip 和用户名密码，就可以在一台机器上管理所有的 nginx 服务器了。

提供一键同步功能，可以将某一台服务器的数据配置和证书文件同步到其他服务器中

#### 接口开发

本系统提供 http 接口调用，打开 `http://xxx.xxx.xxx.xxx:8080/doc.html` 即可查看 smart-doc 接口页面。

接口调用需要在 http 请求 header 中添加 token，其中 token 的获取需要先在管理员管理中，打开用户的接口调用权限，然后通过用户名密码调用获取 token 接口，才能得到 token

![](https://mmbiz.qpic.cn/mmbiz_png/eQPyBffYbufr9J95P1BWjsHHv6MicJoe3eEFc3I2L8VUr2iaab2AJpElibnc8NqJsfWS7ILxF7JwE1thN573F3lTg/640?wx_fmt=png)

#### 找回密码

如果忘记了登录密码或没有保存两步验证，可按如下教程找回密码和关闭两步验证

1.  **停止 nginxWebUI**
    

```
pkill java


```

2.  **使用找回密码参数运行 nginxWebUI.jar**
    

```
java -jar nginxWebUI.jar --project.home=/home/nginxWebUI/ --project.findPass=true


```

*   `--project.home` 为项目文件所在目录
    
*   `--project.findPass` 为是否打印用户名密码
    

运行成功后即可打印出全部用户名密码并关闭两步验证

**开源地址：**  

*   _https://github.com/cym1102/nginxWebUI_
    

---END---

**推荐↓↓↓**