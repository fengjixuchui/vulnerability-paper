<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DN7_q2uKMEGlMn4s1osycw)

> 原文作者：Joke 丶殇 
> 
> 原文地址：https://www.freebuf.com/sectool/304988.html

前言  

-----

最近因为项目测试的原因需要做蓝牙的 Man-in-the-Middle（中间人攻击），有人推荐了一款工具 Btlejuice，但在实际搭建环境的时候发现总会出现问题，所有分享成功搭建的过程顺便也留个记录

前期准备
----

1. 两个蓝牙 dongle，按需求准备 4.0 或 5.0 的 dongle（蓝牙适配器），我这边因为项目的原因要用 5.0 的，但是 4.0 的在搭建的时候问题不会很多。

2. 两台 Linux 主机，可以使用虚拟机进行搭建，建议新建 ubuntu 系统，我这边是 kali+ubuntu。

搭建过程
----

### 1.node.js 安装

如果系统预装 node.js 要先清除掉，再输入以下命令进行安装 node.js 的环境：

curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash

再使用 nvm 安装 node.js，目前在我安装过的版本中 v8 是不就契合 btlejuice，所以我们现在安装的版本是 8.9.0

nvm install 8.9.0

### 2. 安装依赖及 btlejuice

安装蓝牙的相关开发环境，有可能系统会自带，不过还是要确认一次

sudo apt install bluetooth bluez libbluetooth-dev libudev-dev build-essential

安装 btlejuice

npm install -g btlejuice --unsafe-perm

选项 - g 是全局安装，由于 btlejuice 好像很久没有人维护，所以直接安装会报发现漏洞导致无法安装，所以要加选项 --unsafe-perm

检查是否正确安装可以尝试本地进行代理并连接代理

开启代理

btlejuice-proxy

![](https://mmbiz.qpic.cn/mmbiz_jpg/8H1dCzib3UibufmBJQWQXXGDB3qokRLC1WEQ6oNQ9Qp710rp13hEAeLRFbpIQEsVQcu83lAG82xcJO8m2n3TT6zQ/640?wx_fmt=jpeg)

连接代理并开启网页 UI，注意默认是 8080 但是执行命令的时候是显示 8000 这个应该是命令行回显的时候写错了。

btlejuice -u [ip] -w //ip 是指开启代理服务的主机的 ip，-w 是开启 UI，如果是本地的话直接 - w 就可以了

![](https://mmbiz.qpic.cn/mmbiz_jpg/8H1dCzib3UibufmBJQWQXXGDB3qokRLC1WLXorVGyEFDIhWO0qmaGCibBE2ibRnOFALL6XmEdx4AwkFzejkePobyWw/640?wx_fmt=jpeg)

访问 http://localhost:8080

![](https://mmbiz.qpic.cn/mmbiz_jpg/8H1dCzib3UibufmBJQWQXXGDB3qokRLC1WMPtaUqDz9e2a1DW9ldZCLoJWMgtSwaOxk8fZiavicHh6bydebzNwK0zA/640?wx_fmt=jpeg)

### 3. 搭建整套环境

两个主机都要安装 btlejuice

VM1: 作为代理的主机

插入蓝牙 dongle 并确认状态

hciconfig

![](https://mmbiz.qpic.cn/mmbiz_jpg/8H1dCzib3UibufmBJQWQXXGDB3qokRLC1WzpKOluXWqSCDJUmHXGRTBew9ts2L3EuBibeODCwbFrvqhoez3ybedtQ/640?wx_fmt=jpeg)

如果显示的是 DOWN，使用命令将其运行起来

hciconfig hci0 up

要注意如果 BD Address 显示的全是 0，那要确认一下你购买的这个 dongle 是不是支持 Linux 系统的，如果支持再确认一下有没有安装驱动，建议购买 dongle 时要进行确认。

然后开启蓝牙服务

service bluetooth start

开启 btlejuice 代理

btlejuice-proxy

VM2: 作为 btlejuice 的客户端去连接代理 VM1

同样的和 VM1 确认 dongle 的状态，但不同的是，VM2 要关闭蓝牙服务

service bluetooth stop

使用 btlejuice 客户端并开启网页 UI

btlejuice -u [ip] -w //ip 是 V1 代理机的 IP

打开浏览器访问 http://localhost:8080，点击下图按钮对附近的蓝牙设备进行搜索

![](https://mmbiz.qpic.cn/mmbiz_jpg/8H1dCzib3UibufmBJQWQXXGDB3qokRLC1W42XXjGrlsA4iaVXWNHicv6HRGWb89jibZeFkqhqQ5K2NXKDtiaxVKbwQlw/640?wx_fmt=jpeg)

双击选择你想要攻击的设备后，再用其他蓝牙设备进行正常配对，但是目前我还没有成功过。由于 Btlejuice 这个工具有点老且没有人在继续维护了，而且好像限制也比较大，目前我查到使用这个工具成功的案例好像只有一个智能灯泡的。

参考来源：

技术分享 | 如何使用 BtleJuice 黑入 BLE 智能电灯泡：https://www.freebuf.com/articles/wireless/180716.html

Btlejuice：https://github.com/DigitalSecurity/btlejuice

好书推荐

![](https://mmbiz.qpic.cn/mmbiz_png/8H1dCzib3UibvomMpTQ7udqN3RoYl9gWl8ywjia2FPHJE1NZvG2a8crDLoXKma99AzvhEYWYjFsqBW2zBfYPhv8eg/640?wx_fmt=png)

> 本书从网络攻防实战的角度，对 Web 漏洞扫描利用及防御进行全面系统的研究，由浅入深地介绍了在渗透过程中如何对 Web 漏洞进行扫描、利用分析及防御，以及在漏洞扫描及利用过程中需要了解和掌握的基础技术。全书共分 10 章，包括漏洞扫描必备基础知识、域名信息收集、端口扫描、指纹信息收集与目录扫描、Web 漏洞扫描、Web 常见漏洞分析与利用、密码扫描及暴力破解、手工代码审计利用与漏洞挖掘、自动化的漏洞挖掘和利用、Web 漏洞扫描安全防御，基本涵盖了 Web 漏洞攻防技术体系的全部内容。书中还以一些典型漏洞进行扫描利用及实战，通过漏洞扫描利用来还原攻击过程，从而可以针对性地进行防御。

禁止非法，后果自负  

欢迎关注公众号：web 安全工具库

欢迎关注视频号：之乎者也吧

![](https://mmbiz.qpic.cn/mmbiz_png/8H1dCzib3UibuuYLiaUKicNQoEA59skhiaf9pVptPzM7HfPoIBqicD8BJa2EeZmq6ibfGHUIlYMMpN0ukox9G446tS5Yw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/8H1dCzib3UibuuYLiaUKicNQoEA59skhiaf9p2H8roX2HLELxFjTRCFsd3C4lCicVZOrcxcz8ranXyXua79MZvJSKEhA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/8H1dCzib3UibufmBJQWQXXGDB3qokRLC1WicfpNxKZiaZueodTudL9iajicib14FW9JXJg60PkPj3XE5paewiaedJKmd5A/640?wx_fmt=jpeg)