<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/QuFf8P_ANCFgQRI1QTkuMA)

![](https://mmbiz.qpic.cn/mmbiz_png/Ar7BeyBAjVLic0ia4vSFIKa3mGPglabHsr3w9saZKOUiaicF3nkIIVicIiaX0kMGSG7qG5iaHNHbAoXbIvLmAxf35xaxg/640?wx_fmt=png)

点击上方蓝字关注我们

10x01 简述

最近想学习下代码审计，但是奈何语言底子太差，还没办法捉到手搓代码的地步，只能靠一些辅助工具来协助审计。

因为是想学以下 java 的审计，从 github 上找工具时发现了 codeql。

他是 github 发布的开源白盒审计工具，可以审计多种语言，因为是开源的原因其中有很多大佬们提交的扫描规则，同时也能用 ql 语言写出要用的规则。

安装 codeql
---------

```
Codeql 可执行文件：https://github.com/github/codeql-cli-binaries/releases
规则：https://github.com/github/codeql
go规则：https://github.com/github/codeql-go
```

这里吐槽一下，百度上有些大佬写了 但是没有完全写完，整的云里雾里的。

1. 将上述文件下载 2. 将这些文件解压后放入到 codeql_home (自己创建就好)3. 本地生成数据库 `ps:适合编译类语言如c,java等`

```
codeql database create 数据库名 --language=python --source-root=源码路径
```

在线生成数据库
-------

```
ps:适合不需要打包的如python等    
此方法只是为了生成数据库，和上述第三步一样，区别只是在线生成和本地生成。

url：https://lgtm.com/dashboard
```

1. 输入链接, 点击 follow 生成![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxY09JzhNMHbicicQnzSk1NuUxoNUiaUwDGr9KTMxrJPr1qsc6oEqPG3ibdg/640?wx_fmt=png) 2. 生成完成后点击下方进入下载到本地

![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajx2iah54nvribaJwpu16ibeTbicg7FMbo8E9tCLZzT1RDvYepOxaMsSH6jBA/640?wx_fmt=png)  
![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajx0hae2UibCfUt9gHVXf02MYVm9obQUPR2ae8PPBflP2rfYXY60mrqY7g/640?wx_fmt=png)3. 解压数据![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxDxIIyJhJicnuOAzyorqAQg2I35c7VDcd5APZdkxmWjU1BcibjrDXDzuA/640?wx_fmt=png)

使用现有规则扫描
--------

```
例子为扫描python的，如果是需要编译的，需要指定编译命令 如java等。
```

codeql database analyze 数据库名 codeql-cl/python --format=csv --output=analysis/python-results.csv 其中`codeql-cl/`为安装 codeql 那一步下载的规则

与 VScode 配合使用
-------------

1. 下载 codeql 插件

![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxwC4x0wr7IKVFfvry28A4Aml9ESvFykgJFhe30uPddTwxic3gAvxa9Ww/640?wx_fmt=png)  
2. 安装后配置文件![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajx3rMcBQPPTvSpfJXUOVSefxskfrXDyRa0cLSic8TeE4eA1Wibm0DS2ayw/640?wx_fmt=png) 3. 将 codeql 可执行文件的绝对路径写入![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxQQU3KrHrm5JrsysSA7np9Y2S4Q2iaCGk9uNiccKEJ8fia49Qmo62PH87w/640?wx_fmt=png) 4. 创建工作区

> 1.vscode 打开规则文件夹 2. 点击文件 ---> 将工作区另存

![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxEVXesQVV9mayns0PDPfH5mico8YwicKrSx3kGtWQI22UblKHyRZONNgw/640?wx_fmt=png)  
5. 保存好（其实都行这样是为了方便）6. 打开工作区 7. 选择要使用的扫描 CodeQL RUN Query![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxYmjLfH9x2rQdBB15IGLVPiaQCr76EOC1gqqEFYRHPsHC79cQOCbMAbQ/640?wx_fmt=png)8. 选择扫描的数据库 9. 查看扫描![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxR0m2K8r1TO1S0O1FAvrIEkDhhwsoh9xziaT3dH36LPbqeuTnH8Kvib4w/640?wx_fmt=png) 10. 结果查看位置![](https://mmbiz.qpic.cn/mmbiz_png/auiclCmzibWgzV7e63u3xzvISTWA7qViajxvB72WdRnicxic7o5dZPEhPRKZhkgsWwLRWsZuRotTTZKmuWHwX1lQwZw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_gif/6aVaON9Kibf7jNIAOgqwdCv2J77riaDsoMDSpLqoaUiao8aD9r3FwP0gFU2Psuqv6SgVAPhib8hibvO8CaEM8wu1Arw/640?wx_fmt=gif)