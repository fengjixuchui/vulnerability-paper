> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/pLpJNCzl7jMor7vlM0Q0Ww)

运行模块
====

操作路径
----

`运行模块` 

需要 Session 模块 / 无需 Session 模块
-----------------------------

*   当在存在 Session 的行点击运行模块时, 显示所有可用的模块, 包括需要 Sesison 和无需 Session 的模块.
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHoYlHIMXiaplz1e5yOX5ibgny5zVZJPjNcYYtN3tGhML2zKwiaybrSgzHg/640?wx_fmt=png)

*   如果点击不存在 Session 的行, 则默认只显示不需要 Session 的模块
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHXlOdFWicNicHHwcTlO7J7wRReYG1yAgPX1IYWuzkSbmUz7JrMyVMqaJA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfH8VmoJk3r6H1ryzk3fBnHxpAia1giaslbgeN6jkhqm9q5KGOVu3oBuSEg/640?wx_fmt=png)

过滤 / 查找 / 标注模块
--------------

*   Viper 的根据 ATT&TK 对模块进行分类, 可以通过选择栏进行过滤选择
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHtDzXOqhUFHAAmOTztxx04JwEtZ4GlNpC51YEvKv8v6aFTOo54e03fA/640?wx_fmt=png)

*   支持根据关键字搜索模块, 搜索功能会根据名称 / TTPs / 简介进行匹配
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHTnp8QjibzbwqJFUawtI9YnqWvb7dWe5Shb7SQ17jwxGzbybomPlwicRg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHVb9FkKHKceljjoO0xgcgnH2Ae42HFeMKVdob590XkKYRFv7RFa4nBQ/640?wx_fmt=png)

参数 / 说明
-------

*   左侧点击选择模块后, 右侧默认显示模块所需参数. 鼠标移到参数上方时自动显示参数说明.
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfH91FribhXric8zXe8EHXgRoD9iboz4lx7B2JHTy2BptCuhukTFcicwlBgSQ/640?wx_fmt=png)

*   右侧还可以切换到说明选项卡, 展示模块的更多信息
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHvtVTTPS1aNRKcbvicn2brPHqddIIicXKxe2jiaicXNyuBIBpibibMFicCIB7g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfH3uAXfCCnLxE4icsTb6vOKzpK1JyFahNEwXJSnWe4TWhKRPnoycHe1Ag/640?wx_fmt=png)

适用权限是指模块可以在哪些权限下运行, 如上图 1 表示模块可以在 普通用户权限, 管理员权限. SYSTEM 权限下都可以运行, 图二表示模块只能在管理员及 SYSTEM 权限下运行.

运行 / 结果输出
---------

*   输入参数后点击运行即可运行模块
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfH74WVnTsknpIQ8YfGNiavEv4rwvpqBA8icWYEVVUW7YAsVMHKAn8foHzw/640?wx_fmt=png)

*   运行后切换到 `实时输出` 可以看到模块运行状态
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfH6D8vzvVtORbAHw6anMUnn3FBpZfU0n7BTvfTCUOexswye4F8gbUwLQ/640?wx_fmt=png)

右侧通知列表会显示 **模块进入后台** **模块运行时输出的日志** **模块运行结束后提示** 

左侧展示模块的运行结果, 包括 **运行结束时间** **主机 IP** **模块名称** **模块参数** **模块结果输出** 等

*   如果模块运行时间较长, 可以在任务列表页面查看后台有哪些模块在运行
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHSnq6O8PahYEyVhibicd01TfBjUE5BGyIyrSyAK80JsK05JrYetxiafksw/640?wx_fmt=png)

*   点击删除按钮会手动终止模块后台运行
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHueMvAe4icWIBTTZK322pHdwJ6bVKK5Z8jNNKPCSLSY92NpVlLsJE0gg/640?wx_fmt=png)

**不出网主机利用出网主机上线**  

====================

熟悉内网渗透的同学一定遇到过这种场景, 话不多说, 直奔主题.

这里我们假设`主机A(192.168.146.1)`是出网主机,`主机B(192.168.146.12)`是不出网主机.

出网主机可以访问不出网主机的某个端口
------------------

此场景一般使用`内网路由`和`bind_tcp`类型监听实现`主机B`上线.

*   `主机A`正常上线
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHLucyeVKAr46qHMaATl2W6icd7Bh0EW8icwnSAicvyjicLxM3qDHibQtaESA/640?wx_fmt=png)

*   添加一个到 192.168.146.0/24 网段的路由![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHv3tg5ISP8q22XVeoA5tDUklYV2XfWj6zA77240MmVTpdYtP1icN8gNA/640?wx_fmt=png)
    
*   生成一个 bind_tcp 的载荷, 在`主机B`上执行 (实战中通过 exp 执行)![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHtZzHG8GCtNafd4Hwh8G3ibGIl0GtB7lfTM19cqFPYEjcCzjJRNvG7GQ/640?wx_fmt=png)
    

     ![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHmLxCtq09axwcHtsn4jPRrCPHTLKMxAOpyhSyftf1ngfAlglh2UGtMg/640?wx_fmt=png)

*   运行一个指向`主机B`的监听
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHpDp6gJMxz0M8qkXRpe9PicSkLn0XTNJlmUeYdaZV0jVWwvCxokib8Hsw/640?wx_fmt=png)

*   `主机B`上线
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfH5z9ChabS3xziayruBcpTRGAW26dp4XbwOea21iaWbdFEycpLfDib0QGEA/640?wx_fmt=png)

可以看到主机 B 的 Session 连接信息是通过`主机A(192.168.146.1)`

不出网主机可以访问出网主机的某个端口
------------------

此场景使用`反向端口转发`及`reverse_tcp`类型监听载荷实现

*   `主机A`正常上线
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHLucyeVKAr46qHMaATl2W6icd7Bh0EW8icwnSAicvyjicLxM3qDHibQtaESA/640?wx_fmt=png)

*   添加一个 reverse_tcp_rc4 类型监听, 记住这里使用的 9000 端口
    

不要使用 reverse_https 类型

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHSicqLibRnYogcyXbApR6XtMzhShA7SN3NBDJWk5CGS3cAQDvM3mKTQDA/640?wx_fmt=png)

*   添加一个反向端口转发, 记住这里使用的 9000 端口和 12345 端口
    

该操作需要已经过 UAC 的管理员权限

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHZvpAic6IvWpsnhicnpnFFyFBwmfm0dNdFgbanXPiaNuT7Jgv36icRssnqQ/640?wx_fmt=png)

*   生成一个 reverse_tcp_rc4 类型的载荷, 并在`主机B`上执行
    

**这里一定注意以下几个参数**

**LHOST 填写出网主机的内网 IP 地址 (192.168.146.1)**

**LPORT 填写上一步端口转发中 远程端口 (监听) 的地址 (12345)**

**RC4 密码一定要与之前建立监听时 RC4 密码相同**

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHzHsODBB38bfwlsGdjdCwHqsNeFAQNYOib4tOogXF3LibvKIfUb4vAvwg/640?wx_fmt=png)

*   `主机B`上线
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkIaM7icmAlK9pn8ibf5uhPJfHibOMRQ9VUQic4G8O6weqhCZ6kRvb1kQ2YpjoXY8d9PIvGVg9OKDiaOpbg/640?wx_fmt=png)

因为是使用了反向端口转发, 所以 Session 连接信息是 127.0.0.1 环路地址