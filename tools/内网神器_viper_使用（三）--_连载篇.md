<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Xm7T7HzifGa05Du81HXOcg)

昨天的文章我教大家如何上线，那么上线就算是到此为止了，更多上线方式，大家自己去研究，今天教大家上线之后的操作。  

主机和 Session
-----------

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KUe8tyYqhzia5YJlpf896K2OiaFsOUfFsIF8ByDstia7XK52cviccySJiaKg/640?wx_fmt=png)

控制台中显示权限及主机的重要信息, 从左到右分别介绍各个图标的含义.

*   点击执行模块按钮会显示所有可用的模块
    

平台会根据当前目标是否有 session 权限来自动过滤适用的模块

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KmG2o4NichyCEfY8FibfIBwEMbuSyaAP8ojwXCpGFxcHE5px6We86q39g/640?wx_fmt=png)

*   彩色长方形标签表示 session 最后的心跳时间
    

心跳时间超过 1 分钟后图标会变成红色, 此时 VIPER 后台认为该 session 很可能已经失效, 但是对于 tcp 类型的 payload, 在长时间不操作时可能处于休眠状态导致心跳超过 1 分钟, 对 session 重新操作即可唤醒 session

*   带有编号的紫色标签是 sid, 用于标注 session.
    
*   IP 的长方形标签表示 session 在互联网测的连接端口,
    

此 ip 地址一般为企业出口路由器的公网 IP

此时鼠标移动到该标签上方会显示 session 完整网络连接信息及 GeoIP(地理位置信息)

*   x64 及 x86 标签表示 session 的 arch,x64 及 x86 颜色不同
    

arch 表示 session 进程的 arch, 并不表示操作系统的 arch, 操作系统的 arch 可以在主机信息里面查看

*   带图标的长方形标签标识 session 是 windows 系统还是 linux 系统及系统版本
    
*   长方形标签展示主机名, 当前用户等信息.
    

其中白色的表示该 session 是普通用户权限, 金色表示 session 是管理员权限 (已过 uac), 便于直观判断

*   黄色的 IP 地址表示主机在内网中的 IP
    

内网可以理解为在 NAT 后面的网络

*   正方形图标表示主机的图标标签, 可以通过点击图标自行修改, 鼠标移动到图标上时会显示主机的备注信息
    

*   点击权限中的任意标签会弹出针对对权限的所有可用操作
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KqvgzVImC3pgqzAicKlibPu7jbiagoADTgV8BRZpk0RXY2lVFOdicrKf68Q/640?wx_fmt=png)

*   点击主机中的任意标签中可以操作 / 查看 / 修改 / 更新以主机 IP 为 ID 的信息集
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KTZibCOePSlgFOrpgdGl5xBoJcgxsL6p3CWUS6iavGTpJk96naD57ibTdg/640?wx_fmt=png)

信息收集 (初始教程)
===========

在获取一个 Session 之后, 我们在内网就已经有了一个立足点, 可以进行后续信息收集 / 横向移动等操作了.

Session 克隆
----------

*   操作 Session 过程中可能会由于杀毒软件或网络的原因导致 Session 掉线, 在实战会生成多个 Session, 然后再进行进一步操作, 以免丢失权限.
    
*   VIPER 中可以使用 **Session 克隆** 快速的复制多个 Session.
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3K6hZYjV81D8A8qqIga866Caq86RBMcTQOtj6a6T0FicszBHsV5MABv9A/640?wx_fmt=png)

还可以将常用的模块加星, 模块会在下次打开时置顶

*   这样我们就有多个 Session 了, 可以大胆的进行后续操作而不用担心权限丢失.
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KrY1ia75KIQFvlzsvvStmIjuz0eZLDkfkc2r6BFqicWRckHqr2xhFV64A/640?wx_fmt=png)

权限信息
----

*   通过**权限操作 - 权限信息** 查看 Session 的详细信息, 以便于决定后续提权 / 扫描 / 信息收集的方向.
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3Kibo5RZlibH8QibmFzOLMsIcRIdZTjbfZ0uZyhovrZjs8YJFUQfiapD5BkA/640?wx_fmt=png)

文件管理
----

*   使用**权限操作** - **文件管理**快捷打开文件浏览器
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KhJicYLswxaIb6gFTMehjEDLp2kUp80BicAwjZ661vjib52e0MgtibyAMRA/640?wx_fmt=png)

*   可以在文件浏览器中对文件进行可视化操作, 就像操作本地文件一样进行浏览 / 上传 / 下载 / 删除 / 执行.
    
*   下载的文件可以在**文件列表**中查看
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KL8RAmVypPd7OH1FmTYu3IrD8aWSj2xyA2zH5NhTZxwD29x2BK1CInw/640?wx_fmt=png)

命令终端
----

*   可以使用**权限操作 - 命令终端**打开 session 命令行
    
*   在下方输入框输入命令, 点击下方快捷键快速执行指定命令. 点击 help 查看帮助.
    

shell + 命令 执行系统命令, 如: shell whoami

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KLcKic1oMsRDp1DSErEiacZrgN8ibeMAlShfalpl49GXWdYc9D7K3aiaaBQ/640?wx_fmt=png)

主机信息
----

*   主机信息中展示已控主机的详细信息, 包括 systeminfo, 网络连接, 进程列表等
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3K93yHgPC1TIoKwQNJSlTutKVFFIpEystSX4YwjPQQP0SDJMalMOoPRA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KqxsfQNiaffVFV0kWl2N0UvE945h8TdHRG6LxkI1UsIIDnYkYYNq318A/640?wx_fmt=png)

*   点击重新请求按钮会发送请求到已控主机的 Session 中进行信息收集操作, 结果缓存到数据库中.
    
*   点击读取缓存按钮会读取数据库最新缓存的信息
    

主机信息会展示可能和渗透相关的进程信息, 比如 lsass 进程, 杀毒软件进程等

添加备注
----

*   在多人协作或者渗透大型内网过程中, 我们需要对主机进行一些备注以方便记录
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KZsMfeg2IMDS7IhLWGTjhUs7IyPqA0odEVjj58I7tsdFyicXmET8ySCA/640?wx_fmt=png)

内网代理
====

Viper 的内网代理功能基于 MSF 的 socks4a/socks5 代理模块集成而来. Viper 将内网路由, 端口转发, 内网代理集中控制, 方便使用.

路由路径
----

*   `内网代理` `路由路径` 中可以查看所有主机的路由信息
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3Ktsj2W8j1cb0qgTuJjG8QcVovujhaBoTLibrKGU4Yl21Xib8Lnny9pt2w/640?wx_fmt=png)

*   如果不存在对应路由, 则用网络直连表示
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KMQ8LHGZNACDxoGlFVQmlYerGzkSDLzDxL1TFdFYe1Kiap3LSFE03hicA/640?wx_fmt=png)

路由列表
----

*   查看所有 Session 中的路由
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3Kt1JzrK6jvCibETibjh2jwUF0laibjBQOooyiakuuemYTh4PDN8Bu4Jw8QQ/640?wx_fmt=png)

端口转发
----

*   查看所有 Session 的端口转发配置
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KNh7kFrKF1GOUpQfTYahrvAbPTrLzF8ic5lFm8lvx4uFrsdbxgXAtYgA/640?wx_fmt=png)

内网代理
----

*   内网代理可以添加 socks4a,socks5 两种代理
    

socks5 代理不支持 udp

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3K5cT71Ce96vNRoJFCL8GVFBJU7H0HQ7r2XBZch1NHFjI7PL9A5fgIiag/640?wx_fmt=png)

*   代理使用的路由基于 `内网路由` , 使用代理前确认配置了正确的路由.
    

![](https://mmbiz.qpic.cn/mmbiz_png/0JWssWBbxkJ86xT3Exg3jiaHtE1zLjo3KXuEsNWlDfA4fviaSYI64D1uruys3Khhyfo4yHDvUhQQ30nYv3Vyhkmw/640?wx_fmt=png)