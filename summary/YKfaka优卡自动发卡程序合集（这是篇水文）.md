<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/KP7qaWGtaUW0kxvupq7mwQ)

**注：韩进不会排版将就看吧，上期活动奖励已寄出，现在应该基本都签收了吧，毕竟发货四五天。（实在抱歉昨天点错扫码删了，补发）**

  

源码下载地址：https://www.songma.com/product/view188448.html

大部分都是基于宝塔安装目前常见版本：5.7.2（市面上含有少量的5.7.1及5.7.0）

演示地址：本地（由于源码加密，其实并非代码审计出来的）

  

**0x01 简介  
**

    ykfaka是一套发卡网站程序的源码，然后，我也是在不知道是啥了。就理解为发卡平台源码就完事了。

  

**0x02 漏洞**

    期初我在前台也没有发现什么明显的问题并且，没有源码的情况下。后来问题的出现均出于进入后台的那一刻，我们先看下界面。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ewDiceIFyTno63WjIH9nsMS96scibSuAnM3nRicRtDH0NnRcQiaGxUxMWLKABXlXSnLk0ibWPDquGicA5YWTy6H9SWnA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

很简单哈，在我们注册账号之前，只有购买的位置，注册后以后太交互功能也 有限，我们看下后台界面。

![图片](https://mmbiz.qpic.cn/mmbiz_png/ewDiceIFyTno63WjIH9nsMS96scibSuAnMG9p2vYqaibDnsFibGZG2mA7cpwML0S48ibWJxe5gyJWjm4icPb1LrZWP8A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

然后，我实在不知道咋写了，直接给漏洞位置吧：

**0x001:前台订单购买处**

在立即购买时，添加x-forwarded-for 头，值为XSS代码

![图片](https://mmbiz.qpic.cn/mmbiz_png/ewDiceIFyTno63WjIH9nsMS96scibSuAnM1dSwiaN3oxkU39VwweWY8j5YAhfQ7nuQg50YY9WWIFmic0FrMaoasmtg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/ewDiceIFyTno63WjIH9nsMS96scibSuAnMbMcWRlibfOf9CyfibX44atB6upNDUOBTHlPacpoxFFgiacO8DeV3xuLOA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

无论是否购买成功在后台均会生成订单记录，订单记录无时效性。

我们xss的触发位置于：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**第二弹：充值处XSS**

使用同样的方式，添加X-forwarded-for 头进行xss  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

**第三弹：系统日志XSS（这个位置很鸡肋）**

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

登录用户名被记录在日志中，可以直接使用<script>alert(/xss/)</script> 此类XSS payload进行登录。

  

**第四弹：后台全局CSRF**

此弹无截图，自己体会，不过很坑的一点是，80%的功能都需要操作密码。

  

**第五弹：操作密码绕过**

后台百分之80的功能需要验证操作密码，但是如果操作密码为整个功能点进入的验证密码的话可绕过，如：

http://XXX/Adm/All_Export.html?id=all&status=2（取功能接口地址）

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

Adm/All_Export.html?id=all&status=2  任意目标网站登录后台后直接访问即可。

  

**第六弹：getshell**

后台getshell没啥好看的 散会散会。

  

后台设有httponly，cookie是获取不到了，其他操作还是可以做一做的。  

如果有哪个大佬会sg解密的话可以联系我下，我直接给你源码。万一哪个大佬不光日下了还解密了，感谢你吧解密后源码给我一份谢谢。

  

  

总结，功能点漏洞太多，可以组合利用，比如说自动充值。直接提卡啥的。