<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/L8qaLC_cCAjqjv69hpS-Jg)

一个每日分享渗透小技巧的公众号![图片](https://mmbiz.qpic.cn/mmbiz_png/O7dWXt4o5KPTQKiaXksbZia7PmHLPX2vnCWsznInTj3b9TFYtTDIYG6lDGJZYYSv72NsVWF24Kjlo4MT29tEOQSg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

大家好，这里是 **大余安全** 的第 **134** 篇文章，本公众号会每日分享攻防渗透技术给大家。

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/sGWlDp8sFCl67vCmcZr3JtQP0jB8suQiaKaKCVYPOezloiaicS8xMkAriaAQd3dTOPXicBTVStlX66kEffEWJOiczUTA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

靶机地址：https://www.hackthebox.eu/home/machines/profile/149

靶机难度：高级（5.0/10）

靶机发布日期：2018年12月12日

靶机描述：

Waldo is a medium difficulty machine, which highlights the risk of insufficient input validation, provides the challenge of rbash escape or bypassing, and showcases an interesting privilege escalation vector involving Linux Capabilities, all of which may be found in real environments.

  

请注意：对于所有这些计算机，我是通过平台授权允许情况进行渗透的。我将使用Kali Linux作为解决该HTB的攻击者机器。这里使用的技术仅用于学习教育目的，如果列出的技术用于其他任何目标，我概不负责。

![图片](https://mmbiz.qpic.cn/mmbiz_png/o62ddIpxjBd0kv6p3zb6uf1GiaCo9PiaF12hWQQSurxFPuVIDtsNTgUpjjvmib7GxKXNePVMAwJfzuib52MWoORPYg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

一、信息收集

![图片](https://mmbiz.qpic.cn/mmbiz_png/Clq0o4fE5u6X5A1maTmqcvtEibdrsDO41kZPibRCHsX3Koj69GFK2qOyPwdcrgcDkHklrdJzBCiaQPuMVe11oSYHA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/O7dWXt4o5KPqfnGAHMYFT92wzwe3KQFsnJLsaIwnrbhDTibdyCHZWPl0lxeqrp99cb9qXc8nhQBsic33pmNcGJ4Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

可以看到靶机的IP是10.10.10.87..

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

nmap发现仅开放了ssh和apache服务...

![图片](https://mmbiz.qpic.cn/mmbiz_png/O7dWXt4o5KPqfnGAHMYFT92wzwe3KQFsnFTnuWZeGEt1acYib3OOzmicHq90VxqQCdwiaTL88ibhzm9abYevTKpsWw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

访问发现页面具有删除，写入简单权限...

![图片](https://mmbiz.qpic.cn/mmbiz_png/O7dWXt4o5KPqfnGAHMYFT92wzwe3KQFsVdTR0yjI3rvIRmK5cEkhxW38ooCiaFIGX928TNJJUSUyXINX5CtM1Pw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

利用burpsuit拦截分析...

早fileRead.php页面下，具有查看功能....存在目录遍历漏洞

![图片](https://mmbiz.qpic.cn/mmbiz_png/O7dWXt4o5KPqfnGAHMYFT92wzwe3KQFsdAyuf8L9t3dKkibhNhicgicAcPXYEHQMuziaqHRHASNZdtH82V5rDPwicUA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

继续尝试测试....

![图片](https://mmbiz.qpic.cn/mmbiz_png/O7dWXt4o5KPqfnGAHMYFT92wzwe3KQFseH37Rop7YXfoMCs6vq7ctkhBibNu1bvzxeGHLmpIdWliagOiczxt1KBww/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

果然...读取到了目录信息...

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

进一步查看存在rsa信息...

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

但是进行读取后，无法读取，dirRead.php只有查看目录信息...无法查看文件内容

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

继续拦截查看，还存在fileRead.php页面...

该页面也存在目录遍历漏洞...

输出file内容..

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

尝试将path内容复制试试...读取到了key信息...

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

由于key具有/\n等符号，我利用curl进行了简化...获得了key

这里较简单，利用好burpsuit很快就能读取到信息...

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

通过ssh_key成功登陆获得user_flag信息....

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

由于nobody位于容器中...可以使用相同的key在nobody本地ssh登陆到monitor权限中...

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

发现只有几个功能命令使用....

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

由于限制太大，我直接上传Linenum枚举了信息....

我发现没有设置SUID位...就能在v0.1目录文件中能够读取日志信息...

继续查看了getcap...发现cap_dac_read_search+ei....这就解释清楚了，该cap_dac_read_search+ei功能用于Bypass file read permission checks and directory read and execute permission checks....所以文件具有此权限它可以读取任何内容...

进一步查看getcap，发现了tac...

查看了tac功能....

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

尝试读取root信息...成功获得了root_flag信息...

  

这台难度高的靶机，主要难点在目录遍历和内部信息枚举发现....

由于我们已经成功得到root权限查看user和root.txt，因此完成这台高级的靶机，希望你们喜欢这台机器，请继续关注大余后期会有更多具有挑战性的机器，一起练习学习。

  

如果你有其他的方法，欢迎留言。要是有写错了的地方，请你一定要告诉我。要是你觉得这篇博客写的还不错，欢迎分享给身边的人。

  

  

如果觉得这篇文章对你有帮助，可以转发到朋友圈，谢谢小伙伴~

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

随缘收徒中~~**随缘收徒中~~****随缘收徒中~~**

  

欢迎加入渗透学习交流群，想入群的小伙伴们加我微信，共同进步共同成长！

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)  

大余安全

一个全栈渗透小技巧的公众号

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)