> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2VsdZJAhNLqD8tglLGELqQ)

**![图片](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Schneider Electric EcoStruxure Control Expert（前称Unity Pro）是法国施耐德电气（Schneider Electric）公司的一套用于Schneider Electric逻辑控制器产品的编程软件。该软件的V14.1以下的版本存在一个不正确的授权漏洞-CVE-2020-28211，可导致项目的身份验证被绕过。

Part1

漏洞状态

<table interlaced="enabled" width="677" style="visibility: visible;"><tbody style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"><tr class="ue-table-interlace-color-single" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;background-color: rgb(252, 252, 252);visibility: visible;"><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;background-color: rgb(170, 170, 170);visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">漏洞细节<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;background-color: rgb(170, 170, 170);visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">漏洞POC<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;background-color: rgb(170, 170, 170);visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">漏洞EXP<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;background-color: rgb(170, 170, 170);visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">在野利用<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;background-color: rgb(247, 250, 255);visibility: visible;"><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">有<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">有<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">有</td><td width="123" valign="top" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">无</td></tr></tbody></table>

Part2

漏洞描述

EcoStruxure Control Expert上存在不正确的授权漏洞，当使用调试器或其他方法覆盖内存时，该漏洞可能导致绕过身份验证。

<table interlaced="enabled" width="677" style="visibility: visible;"><tbody style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"><tr class="ue-table-interlace-color-single" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;background-color: rgb(252, 252, 252);visibility: visible;"><td width="103" valign="middle" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">‍漏洞名称<br style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: content-box !important;overflow-wrap: break-word !important;visibility: visible;"></td><td valign="middle" align="left" style="margin: 0px;padding: 0px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;clear: both;min-height: 1em;color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: justify;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;caret-color: rgba(0, 0, 0, 0);line-height: 1.75em;text-indent: 2em;visibility: visible;overflow-wrap: break-word !important;box-sizing: border-box !important;" width="432.6666666666667"><p style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;visibility: visible;text-indent: 0em;line-height: 1.5em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp; 绕过PLC仿真器和项目认证过程漏洞</p></td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(247, 250, 255); box-sizing: content-box !important; overflow-wrap: break-word !important; visibility: visible;"><td width="103" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">CVE编号</td><td valign="top" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;" width="432.6666666666667">CVE-2020-28211</td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(252, 252, 252); box-sizing: content-box !important; overflow-wrap: break-word !important; visibility: visible;"><td width="103" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞类型</td><td valign="top" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;" width="432.6666666666667">绕过身份验证</td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(247, 250, 255); box-sizing: content-box !important; overflow-wrap: break-word !important; visibility: visible;"><td width="103" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞等级</td><td valign="top" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;" width="432.6666666666667">7.8 高危</td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; outline: 0px; max-width: 100%; background-color: rgb(247, 250, 255); box-sizing: content-box !important; overflow-wrap: break-word !important; visibility: visible;"><td width="103" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">公开状态</td><td valign="top" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;" width="432.6666666666667">公开<br style="margin: 0px; padding: 0px; outline: 0px; max-width: 100%; box-sizing: content-box !important; overflow-wrap: break-word !important; visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;background-color: rgb(247, 250, 255);visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;"><td width="103" valign="middle" align="center" style="margin: 0px;padding: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);max-width: 100%;background-color: rgb(247, 250, 255);visibility: visible;overflow-wrap: break-word !important;box-sizing: content-box !important;">时间线</td><td valign="top" style="margin: 0px; padding: 5px 10px; outline: 0px; word-break: break-all; hyphens: auto; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;" width="432.6666666666667"><section style="margin: 0px; padding: 0px; outline: 0px; max-width: 100%; clear: both; min-height: 1em; line-height: 1.5em; box-sizing: content-box !important; overflow-wrap: break-word !important; visibility: visible;">2020-11-05 - 分配 CVE</section><section style="line-height: 1.5em; visibility: visible;">2020-11-08 - 公开发布</section></td></tr><tr class="ue-table-interlace-color-single" style="visibility: visible;"><td valign="middle" colspan="1" rowspan="1" style="border-left-color: rgb(221, 221, 221); border-left-width: 1px; border-top-color: rgb(221, 221, 221); border-top-width: 1px; visibility: visible;" align="center">影响范围<br style="visibility: visible;"></td><td valign="top" colspan="1" rowspan="1" style="border-left-color: rgb(221, 221, 221); border-left-width: 1px; border-top-color: rgb(221, 221, 221); border-top-width: 1px; visibility: visible;" width="432.6666666666667"><p style="line-height: 1.5em; visibility: visible;">‍Schneider Electric EcoStruxure Control Expert&nbsp; version &lt;=&nbsp;v14.1<br style="visibility: visible;"></p></td></tr><tr class="ue-table-interlace-color-double" style="border-left-color: rgb(221, 221, 221);border-left-width: 1px;border-top-color: rgb(221, 221, 221);border-top-width: 1px;margin: 0px;padding: 0px;outline: 0px;max-width: 100%;visibility: visible;box-sizing: content-box !important;overflow-wrap: break-word !important;"><td valign="middle" colspan="1" rowspan="1" align="center" style="border-left-color: rgb(221, 221, 221);border-left-width: 1px;border-top-color: rgb(221, 221, 221);border-top-width: 1px;margin: 0px;padding: 0px;outline: 0px;max-width: 100%;visibility: visible;box-sizing: content-box !important;overflow-wrap: break-word !important;">复现环境<br></td><td valign="middle" colspan="1" rowspan="1" align="left"><section style="line-height: 1.5em;">Windows 10</section><section style="line-height: 1.5em;">Schneider Electric EcoStruxure Control Expert v14.1</section></td></tr></tbody></table>

Part3

漏洞复现

- 安装Schneider Electric EcoStruxure Control Expert v14.1

- 启动Control Expert 14.1

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

新建任意项目并添加密码(这里我们先暂时设置hellovuleye):

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

无需其他操作，直接保存项目到任意目录下:

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

项目生成两个文件 **.stu  **.ztx

其中stu是主要工程文件，双击打开就会提示输入密码。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

这里我们使用xdbg附加进程。然后在 关键函数位置下断点。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

输入任意错误密码我这里输入9个6 (666666666

)然后点击确定。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

断点断下，我们不做任何处理，直接运行。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

提示密码错误。

再次输入9个6->确定。

断点再次断下，我们进行内存覆盖，F9执行。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

项目被打开。

**复现成功！**

Part4

漏洞细节

此漏洞出现的原因是最终验证身份的关键点只是一个函数的返回值，很容易被绕过，如果使用一些加密方式来加密工程文件，首先验证密码，然后通过密码解密工程，这样就不容易被绕过。

Part5

修复缓解建议

1. 软件升级至最新版本。

2. 安装主机卫士，开启实时防护。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247527471&idx=1&sn=b47d0c0c2ca5a8cdadd5f29c9f2738c1&chksm=fd768678ca010f6e4c7fb5df798fceed8e3812ced7f01bb4e65535237e812d802e03c6653a92&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247527321&idx=1&sn=99adf54de611e2219c72dddad13543c5&chksm=fd7681ceca0108d8c2a6b89ee1a1d3444429093cc3a1eacb18c9e96d5c213c07e49903c2c985&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247527202&idx=1&sn=ea96acfd6496f6007b256ce2a57e8d07&chksm=fd768175ca010863e5e3433d97818fbb52a03531a59a8deb10cd070990a0f032cfd644b9091e&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247526917&idx=1&sn=cfabda4c5811b30453ea57f876fba6e1&chksm=fd768052ca010944cd7874202f1fbdb11f62b995ed642ae55ee78d61ed71ec7d7177df80bfc4&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持IT安全与OT安全融合发展，坚持产品体系的自主可控，全面赋能客户构建“业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强”的主动防御和纵深防御相结合的安全保障体系。截至2021年底，公司主要产品已应用于数千家“关基”企业，其中工业网络安全态势感知平台已部署4000余家客户，虚实结合工业网络靶场服务超过50家客户。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**点击“在看”鼓励一下吧**

**![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)**