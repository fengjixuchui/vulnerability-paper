<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/6gwi0cFwpT19DGwl2Yo6EA)

**![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

Schneider Electric EcoStruxure Control Expert（前称 Unity Pro）是法国施耐德电气（Schneider Electric）公司的一套用于 Schneider Electric 逻辑控制器产品的编程软件。

Part1

漏洞状态

<table interlaced="enabled" width="677"><tbody><tr><td width="123" valign="top" align="center">漏洞细节<br></td><td width="123" valign="top" align="center">漏洞 POC<br></td><td width="123" valign="top" align="center">漏洞 EXP<br></td><td width="123" valign="top" align="center">在野利用<br></td></tr><tr><td width="123" valign="top" align="center">有<br></td><td width="123" valign="top" align="center">有<br></td><td width="123" valign="top" align="center">有</td><td width="123" valign="top" align="center">无</td></tr></tbody></table>

Part2

漏洞描述

EcoStruxure Control Expert 上的 PLC 中没有完整性检查的代码下载，劫持组件 DLL 后向 PLC 注入代码可导致远程代码执行。

<table interlaced="disabled"><tbody><tr><td width="103" valign="middle" align="center">‍漏洞名称<br></td><td valign="middle" align="left" width="433"><p>&nbsp;&nbsp;施耐德 PLC 下游组件 Dll 注入导致的远程代码执行漏洞</p></td></tr><tr><td width="103" valign="middle" align="center">CVE 编号</td><td valign="top" width="433">CVE-2020-7475</td></tr><tr><td width="103" valign="middle" align="center">漏洞类型</td><td valign="top" width="433">远程代码执行</td></tr><tr><td width="103" valign="middle" align="center">漏洞等级<br></td><td valign="middle" width="433" align="left"><section>&nbsp;&nbsp;CVSS 评分为 9.8，高危!</section></td></tr><tr><td valign="middle" colspan="1" rowspan="1" align="center">公开状态</td><td valign="top" colspan="1" rowspan="1" width="433"><p>‍公开<br></p></td></tr><tr><td valign="middle" colspan="1" rowspan="1" align="center" height="39">时间线<br></td><td valign="middle" colspan="1" rowspan="1" align="left" width="433" height="39"><section>&nbsp; 2020-03-03 - 分配 CVE<br></section><section>&nbsp; 2020-03-23 - 公开发布<br></section></td></tr><tr><td valign="middle" colspan="1" rowspan="1" align="center">影响范围<br></td><td valign="middle" colspan="1" rowspan="1" align="left"><p>Schneider Electric EcoStruxure Control Expertversion &lt;=&nbsp; v14.1</p><section>Modicon M340 version &lt;= v3.20</section><section>Modicon M580 version &lt;= &nbsp;v3.10</section></td></tr></tbody></table>

**复现环境：**  

Windows 10

Schneider Electric EcoStruxure Control Expert v14.1

Part3

漏洞复现

- 安装 Schneider Electric EcoStruxure Control Expert v14.1

由于没有施耐德实体 PLC，这里使用 PLC 仿真器进行漏洞复现，基本原理一样。

启动 Control Expert 14.1 

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3MDE0M7HR9JGfBjZ0CsWDaVdc65CmQLUj3ibGDRrX0OHE4vAckPzq7gQ/640?wx_fmt=jpeg)

新建项目 (这里选择 BMX P34 2000 型号仿真器):

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3tzqVrcjCUdM07GrV10COR2X68PJT2cyLNb01RVyTicPemK1IKxAOmXg/640?wx_fmt=jpeg)

新建一个变量：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3QU5a0zKKa4Hl231LhRSOK7yfRdzqrMHxWyiaL1ia1ib9Gbe65gia3jGtxQ/640?wx_fmt=jpeg)

新建一个程序段：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3Dk7uX1Dtn4B2PqE7fiaXvpJw3oNQaDczZkr77iatZTDFETfObzqgndgg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3zElTzkzxUnhrjIDuKUAC6AJNWr2eIeL0EdXuDDib6POCWc4aA39ZYicg/640?wx_fmt=jpeg)

写入一段 ST 赋值代码：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d38AOcbgNvaj0PdC7QN7MqvAPeiaI5Vub6YeG4QjeAQFmQGTwoLUmJnTw/640?wx_fmt=jpeg)

使用 xdbg 附加 ControlExpert 并在编译函数处下断点:

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3ehqLGdYoGvmPJX7Ng2PnL18icJWQk11iaq6f3E23fED6h88K1exqVAmQ/640?wx_fmt=jpeg)

连接 PLC，然后将项目传输到 PLC：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3Ly3ek6T7bZ8jtxQyHGehjgYSz3A8xMqkRw5JacqUW0P48AibrWoU2Lw/640?wx_fmt=jpeg)

Xdbg 暂停在断点处，单步执行一次:

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3Z7LBibeF1hx1e0gOWjkbS92ZPmjNMusglZdR5rwtFicRtZvCNhJ8xj4g/640?wx_fmt=jpeg)

搜索特征码：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3CxCrOQ3MrsjbIQeDiaaQoj7UO6GPMfVzz9z2cWFe0juqAsyIGT8dctg/640?wx_fmt=jpeg)

双击过去反汇编查看：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3pSdhQWc9co5iawIMoh6sCXJrnA70eA5OuOzKY6nua3lZ9p2WIia0v5iaQ/640?wx_fmt=jpeg)

可以看到对应测试者写的 ST 代码的汇编代码。

这里替换字节码为测试者的测试代码后，让程序运行。

提示上载信息完好：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3rUsUnpkfEePyxafRYxMuL2eEHfJjmVXxIYciawC8ocB8icxkNQNm6c1A/640?wx_fmt=jpeg)

启动 PLC 仿真器：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3a6aVRm7A1SWSaftcwDzLTXMPSmlbBYMxFYcoOQPqNpvRMh5Xrrm5Sw/640?wx_fmt=jpeg)

弹出计算器，PLC 仿真器异常：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3lPAoQJa1Kqt75wnE48ugSBDKpkroctQ6CQwFeZSlkQ7sR70G8DgwzA/640?wx_fmt=jpeg)

复现成功！

Part4

漏洞细节

通过逆向手段，定位到编译 PLC 程序到 PLC 仿真器可执行的字节码的函数，再执行之后，修改原本编译好的字节码，程序会把测试字节码传输到 PLC 仿真器中，当操作 PLC 仿真器执行任务的时候，就会执行到测试代码。

Part5

修复缓解建议

1. 软件升级至最新版本 v15.2。

2. PLC 固件及时升级到最新版本。

3. 监控网络流量，查看是否有恶意代码的流量特征。

4. 安装主机卫士，设置 IP 白名单。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmYrt8sZBqiah8aNInQspzccnPAAhd0OKLQ5Ziad4ovQEohiamyrpYjQcwVAWROpYWmMXia1YRKPiczFSQw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d33JsgYTL2Mp87273icibkcmpwOichJodb1rTJCC5rsmiaaW43ZiaKcicu3Kkw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247530580&idx=1&sn=db53cff76d788242944297aba6aa4358&chksm=fd769203ca011b158379678a34c53eebeea8e3087da7c831cfe5d69f1595304075b3ec863e50&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3ibiaSh6Ixu3gzB0ZIUIwc4XosHzVPUG6IKPwDCF4WFW13CLvKDalG6PQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247527776&idx=1&sn=a1cbedd3cb549845ef588deae2e38327&chksm=fd768737ca010e2148a546908aa56dde8345ead295c5e5e35389282c15fe0bdb985af2467509&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3Q8t4gZ6niczNdZ0ZWMLlpXfJBVvGEc5fGSRrwqvmBLSwgd3XdqMSsGA/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247527579&idx=1&sn=d4527e919acedb5f5a512bf8e2770808&chksm=fd7686ccca010fda7afe784e6ff8a386c85a445418c79a8014459be0bb8653de0a5b78742939&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYOuiay5IEkMljwswoCTD1d3dYVEGAyeEwn6d824QcYR5FUicHIq4TdiazNTkffVic95cEWJ6Ko2WgNNQ/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247527471&idx=1&sn=b47d0c0c2ca5a8cdadd5f29c9f2738c1&chksm=fd768678ca010f6e4c7fb5df798fceed8e3812ced7f01bb4e65535237e812d802e03c6653a92&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持 IT 安全与 OT 安全融合发展，坚持产品体系的自主可控，全面赋能客户构建 “业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强” 的主动防御和纵深防御相结合的安全保障体系。截至 2021 年底，公司主要产品已应用于数千家 “关基” 企业，其中工业网络安全态势感知平台已部署 4000 余家客户，虚实结合工业网络靶场服务超过 50 家客户。

![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3Mma4ibTfp7sC3ibt8WmetoDfiaGHEb7VOiaemeFbuCTupYgus7NTKkibwKwpsEDfzqZdXh1skHff6A6VNgA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

**点击 “在看” 鼓励一下吧**

**![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZOFFgf4oTyfUTx7y0ZBV9yIg8qmaSwAvbjiba2KQn7VgmXYIriagc9H0hMu1u0UIZr98JYSmyG9tibg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)**