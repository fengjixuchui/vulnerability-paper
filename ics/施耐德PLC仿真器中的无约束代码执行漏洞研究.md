<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/sJdjrFJyiFd3MJ4YocHmzA)

**![图片](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Schneider Electric EcoStruxure Control Expert（前称Unity Pro）是法国施耐德电气（Schneider Electric）公司的一套用于Schneider Electric逻辑控制器产品的编程软件。CVE-2020-28213漏洞存在于其中的PLC仿真器，该仿真器是EcoStruxure Control Expert编程软件内置的一个有PLC仿真功能windows应用程序。

Part1

漏洞状态

<table interlaced="enabled" style="visibility: visible;"><tbody style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞细节<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞POC<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞EXP<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">在野利用<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">有<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">有<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">有</td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">无<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td></tr></tbody></table>

Part2

漏洞描述

EcoStruxure Control Expert上的 PLC 仿真器中存在没有完整性检查的代码下载漏洞，当通过 Modbus 发送特制请求时，该漏洞可能导致未经授权的命令执行。

<table interlaced="enabled" style="visibility: visible;"><tbody style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">‍漏洞名称<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">施耐德PLC仿真器中的无约束代码执行漏洞</td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">CVE编号</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">CVE-2020-28213</td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞类型</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">远程代码执行</td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞等级</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">8.8 高危</td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">影响范围</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><p style="visibility: visible;">Schneider Electric EcoStruxure Control Expert version &lt;=&nbsp; v14.1</p></td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(247, 250, 255); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">公开状态</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">公开<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; max-width: 100%; background-color: rgb(252, 252, 252); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">时间线</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><p style="margin: 0px; padding: 0px; clear: both; min-height: 1em; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">2020-11-05 -分配CVE</p><p style="margin: 0px;padding: 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: content-box !important;">2020-11-08&nbsp;-公开发布<br></p></td></tr></tbody></table>

复现环境：

Windows 10

Schneider Electric EcoStruxure Control Expert v14.1

Part3

漏洞复现

- 安装Schneider Electric EcoStruxure Control Expert v14.1

- 启动Control Expert 14.1

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmbibGuAaS7N1Eh7iclzB3vTB1hKKDav54qJzj3HQ9PW3YEJhc8uuKkUUaJQuG4pibZn15nuYJaGiaeV5g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

- 新建项目(这里选择 BMX P32 2000 型号仿真器)：

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmbibGuAaS7N1Eh7iclzB3vTB1oTgc26uhO5qckVS2PIxbHm1LQOPvAFPtn6VPp67N7JI8DgEz7PuQMQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

- 新建一个变量：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

新建一个程序段：  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 写入一段ST赋值代码：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 使用 xdbg附加 ControlExpert 并在编译函数处下断点:

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 连接PLC 然后将项目传输到PLC：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- Xdbg 暂停在断点处 单步执行一次：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 搜索特征码：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 双击过去反汇编查看：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

可以看到对应研究者写的ST代码的汇编代码。

这里替换字节码为研究者的测试代码后，让程序运行。

- 提示上传信息完好：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 启动PLC仿真器：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

- 弹出计算器，PLC仿真器异常：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**复现成功！**

Part4

漏洞细节

通过逆向手段，定位到编译PLC程序到PLC仿真器可执行的字节码的函数，再执行之后，修改原本编译好的字节码，程序会把测试字节码传输到PLC仿真器中，当操作PLC仿真器执行任务的时候，就会执行到测试代码。

Part5

修复缓解建议

1. 软件升级至v15.1版本。

2. 监控网络流量，查看是否有恶意代码的流量特征。

3. 安装主机卫士，设置IP白名单。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247526417&idx=1&sn=eb560bc466b7006cebdb3b6542adf075&chksm=fd768246ca010b50f8a84978eec9810ae0e29b3c0a70669d61762aee143b8c63082d9cd7214a&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247526247&idx=1&sn=56e4e4c514bbeca737eed2052e033b46&chksm=fd768d30ca010426087824ba934aed28d3d7dd0aef3e9eca8efd29e0db1bfa4ece024b35976e&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247525926&idx=1&sn=ca6ae457b4bd6218d309cb784d668114&chksm=fd768c71ca01056735d858ca144e9ab0b9e82df1633798dcdd9443bb020aee007356973b8e42&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247525738&idx=1&sn=d8c10875207674de6bd7d59b5b2a852e&chksm=fd768f3dca01062bf9c164a5825dc3638ebf42eee0dd2462892148eb54a5036a596a19255cda&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持IT安全与OT安全融合发展，坚持产品体系的自主可控，全面赋能客户构建“业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强”的主动防御和纵深防御相结合的安全保障体系。截至2021年底，公司主要产品已应用于数千家“关基”企业，其中工业网络安全态势感知平台已部署4000余家客户，虚实结合工业网络靶场服务超过50家客户。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**点击“在看”鼓励一下吧**

**![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)**