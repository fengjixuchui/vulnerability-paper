> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/y8bfp6R_2W2mNJdgtrZU8g)

**![图片](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Schneider Electric Interactive Graphical SCADA System（IGSS）是法国施耐德电气（Schneider Electric）公司的一套用于监控和控制工业过程的SCADA（数据采集与监控系统）系统。

Part1

漏洞状态

<table interlaced="enabled" style="visibility: visible;"><tbody style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; background-color: rgb(252, 252, 252); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞细节<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞POC<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">漏洞EXP<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; background-color: rgb(170, 170, 170); overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">在野利用<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; background-color: rgb(247, 250, 255); max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">有<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">有<br style="margin: 0px; padding: 0px; max-width: 100%; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;"></td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">无</td><td width="123" valign="top" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); max-width: 100%; word-break: break-all; overflow-wrap: break-word !important; box-sizing: content-box !important; visibility: visible;">无<br style="margin: 0px; padding: 0px; visibility: visible;"></td></tr></tbody></table>

Part2

漏洞描述

未经身份验证的远程攻击者可以通过多种途径强制 IGSSdataServer.exe 分配大量内存来存储攻击者控制的数据。攻击者可以提供少量数据来导致缓冲区过度读取情况，从而产生内存读取访问冲突，这是由 IGSSdataServer.exe 中实现的异常处理程序处理的。但是，异常处理程序不会释放攻击者分配的内存，攻击者可以反复向 IGSSdataServer.exe 发送特制消息以耗尽其内存，从而可能导致拒绝服务。

<table interlaced="enabled" style="visibility: visible;"><tbody style="margin: 0px; padding: 0px; visibility: visible;"><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; background-color: rgb(252, 252, 252); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">‍漏洞名称<br style="margin: 0px; padding: 0px; visibility: visible;"></td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; background-color: rgb(252, 252, 252); visibility: visible;">IGSS内存泄露导致的拒绝服务</td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; background-color: rgb(247, 250, 255); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">CVE编号</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; background-color: rgb(252, 252, 252); visibility: visible;">CVE-2022-24314</td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; background-color: rgb(252, 252, 252); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">漏洞类型</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; background-color: rgb(252, 252, 252); visibility: visible;">缓冲区错误</td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; background-color: rgb(247, 250, 255); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">漏洞等级</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">高危（7.5）</td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; background-color: rgb(252, 252, 252); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">受影响的产品</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; background-color: rgb(252, 252, 252); visibility: visible;">SchneiderElectricInteractive Graphical SCADA System (IGSS) Definition &lt;=15.0.0.22021</td></tr><tr class="ue-table-interlace-color-double" style="margin: 0px; padding: 0px; background-color: rgb(247, 250, 255); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">公开状态</td><td width="446" valign="top" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">公开<br style="margin: 0px; padding: 0px; visibility: visible;"></td></tr><tr class="ue-table-interlace-color-single" style="margin: 0px; padding: 0px; background-color: rgb(252, 252, 252); visibility: visible;"><td width="90" valign="middle" align="center" style="margin: 0px; padding: 5px 10px; border-width: 1px; border-style: solid; border-color: rgb(221, 221, 221); word-break: break-all; visibility: visible;">时间线</td><td width="446" valign="top" style="margin: 0px;padding: 5px 10px;border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);word-break: break-all;"><p style="margin: 0px;padding: 0px;clear: both;min-height: 1em;">发布时间:2022-02-09</p></td></tr></tbody></table>

Part3

漏洞复现

**1．实验环境**

渗透主机：kail

靶机环境：win10

软件版本：IGSS v15.0

**2．****涉及工具**

X64dbg

Python2

**3．漏洞复现**

1）在靶机中运行IGSS

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

点击开始，如下图所示：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

2）POC 验证:

python igss_dataserver_memleak.py -t 192.168.0.104 -p 12401 -v

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

3）查看结果，查看：

IGSS Master -> Runtime and Diagnostics -> 详细状态中的数据服务器内存使用情况，查看IGSSdataServer.exe服务器日志：FetchControl_RMS::appendRequest，内存不足。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

停止 POC 后，内存也未释放：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

Part4

漏洞分析

使用x64dbg 附加进程调试：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

分析此段代码大致流程为：

1）接受攻击者发送的数据判断是否分配内存：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

接收的数据和发送的数据一致：

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

2） 内存分配：

分配的大小结合POC 分析为：0x4000000

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

3）判断内存是否分配成功，成功则调用memcpy，触发异常：分配大量内存来存储攻击者控制的数据。攻击者可以提供少量数据来导致缓冲区过度读取情况，从而产生内存读取访问冲突。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

4） 分配失败则调用错误处理输出日志: 

FetchControl_RMS::appendRequest，内存不足。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

5）结合POC 分析：

攻击者可以反复连接IGSSdataServer.exe 发送特制消息，分配内存，断开socket连接后IGSSdataServer.exe 也未进行内存释放，导致耗尽其内存，从而可能导致拒绝服务。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

Part5

修复建议

更新到 IGSS 数据服务器版本 15.0.0.22021 或更高版本。

**SAFE**

**获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247526247&idx=1&sn=56e4e4c514bbeca737eed2052e033b46&chksm=fd768d30ca010426087824ba934aed28d3d7dd0aef3e9eca8efd29e0db1bfa4ece024b35976e&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247525926&idx=1&sn=ca6ae457b4bd6218d309cb784d668114&chksm=fd768c71ca01056735d858ca144e9ab0b9e82df1633798dcdd9443bb020aee007356973b8e42&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247525738&idx=1&sn=d8c10875207674de6bd7d59b5b2a852e&chksm=fd768f3dca01062bf9c164a5825dc3638ebf42eee0dd2462892148eb54a5036a596a19255cda&scene=21#wechat_redirect)

[![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247525507&idx=1&sn=405de25968bcd2b9567f9c189e5331cf&chksm=fd768ed4ca0107c2563415bb0af15b4bd6049fc4bd6a5d4e471f604921a1883d48ca650eb5d9&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持IT安全与OT安全融合发展，坚持产品体系的自主可控，全面赋能客户构建“业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强”的主动防御和纵深防御相结合的安全保障体系。截至2021年底，公司主要产品已应用于数千家“关基”企业，其中工业网络安全态势感知平台已部署4000余家客户，虚实结合工业网络靶场服务超过50家客户。

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

**点击“在看”鼓励一下吧**

**![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)**