<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Ai3CapHVnADggc-e2MZ66g)

**基础学渗透，领取配套视频**

**#统统可白嫖#**

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSHyfzIicIMsib97kZfZEART3awLIBLCUTufSibfC1DXZotKfSvNs2Zr0MSUr7dEWIwsQiay1jwn5WXaOA/640?wx_fmt=png)

扫码找小助理白嫖渗透资料![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSEEQwsVFyfJD70E9HmDELbPwumVMkXxnmgmwHklA5JxIWJlzcPao47a9cibAmp1zeZ5Hf8yEWZSFBg/640?wx_fmt=png)

**学习大佬的思路技巧**  

  

  

一、简介：

**作者：****搬运工 007** 

原文地址：https://www.freebuf.com/articles/system/234747.html  

-----------------------------------------------------------

**在本文中，我们将使用钓鱼技术来收集凭据。**

**我想说，好骚的操作![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBOL17xEWib5UK1CFv3UfEkM7aicgeI9evicnZgCTFOGWicbtLajCsSYNbQw/640?wx_fmt=png)**

**Metasploit 框架：phish_windows_credentials**
-------------------------------------------

现 Metasploit 带有内置的后期漏洞利用功能，可帮助我们完成任务。

由于它是后渗透的模块，因此只需要输入会话即可：

```
use post/windows/gather/phish_windows_credentials set session 1 exploit
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzB91KOLR6Yice2s4st0Q2Xovrwutl3XhuU18B6Bic7KSldO7LQxjHcp3Lw/640?wx_fmt=png)

该模块等待用户开始新的过程。

启动该过程后，将打开一个虚假的 Windows 安全对话框，要求用户提供凭据，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBMgAUJnfd9ezfuicDOxBZL7qiagc4fH854FrHYiazt5q2ib2EiaMgRvLdtOA/640?wx_fmt=png)

当用户输入其凭据时，它们将被捕获并显示，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBdOglOj2sfMDwrHupYNyyEibzjqByquHjmPC0gsETS51mKaaBEHHkllQ/640?wx_fmt=png)

**FakeLogonScreen**  

----------------------

FakeLogonScreen 工具由 Arris Huijgen 创建。

它是用 C＃开发的，因为它允许程序注入内存中。

我们将使用 Metasploit 远程执行此工具。

但是首先，让我们使用下面提供的链接下载该工具  

> 下载 FakeLogonScreen（https://github.com/bitsadmin/fakelogonscreen/releases）

我们只需从 meterpreter 会话中上传此工具，然后使用以下命令远程执行它：

```
upload /root/FakeLogonScreen.exe . shell FakeLogonScreen.exe
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBWKwt2njSJBW2uJ04ve80u0hHVswUl1qgfNspHmXo4OEh7NibFe9edQQ/640?wx_fmt=png)

执行后，它将模拟 Windows 锁定屏幕以从用户获取密码。

为此，此工具将显示与配置完全相同的锁定屏幕，以使用户不会感到可疑，如下图所示：

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBuX9rt1He8HogcicHkpcibSlItrNpqJlIkHicoC8XVMJ8lIUHGvKhu5EdQ/640?wx_fmt=png)

当用户输入凭据时，它将在本地或从域控制器验证凭据，然后将其显示在控制台上，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBEPHj9Gxq74ibUEicXW2JNdDf3PaZr79sxDU5CFFQlUHB5gHeDjBSYibPg/640?wx_fmt=png)

**SharpLocker**  

------------------

此工具与以前的工具非常相似。

它是由 Matt Pickford 开发的。

就像 FakeLogonScreen 一样，此工具也将显示伪造的锁定屏幕，供用户输入凭据，然后将击键的内容转储给攻击者。

> 下载 SharpLocker（https://github.com/Pickfordmatt/SharpLocker/releases/tag/v0.5）

我们将首先将该工具从攻击者机器上载到目标系统，然后执行它。

因此，当您有 meterpreter 会话时，只需键入：

```
upload /root/Downloads/SharpLocker.exe . shellSharpLocker.exe
```

我们将该工具下载到了桌面上，因此我们将遍历该位置然后执行它

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBa0YCRorias9iaMS1qULTRtqibW87XWia8A8HSe6ReolD6RufaMuDLh2D2Q/640?wx_fmt=png)

执行后，该工具将触发目标系统的锁定屏幕，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBQVEKtR9dahYddAficNN8YoLVjWObHpbYFpEibiaFeSI1m1G4CBI7Hicuvw/640?wx_fmt=png)

当用户输入密码时，它将捕获按键，直到显示整个密码为止，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBkVGKHlRp8C3xpVEwsOTT5L6xHjcHaplmIZGxlNDPh6ftph5BM83cYA/640?wx_fmt=png)

**PowerShell Empire**  

------------------------

PowerShell Empire 的此模块将在目标系统上提示一个对话框，要求像我们之前所做的那样获得凭据。我们可以通过以下命令使用此模块：

```
usemodule collection/prompt execute
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBx7D8JLibSnAh8QYCHNZO8SAUx2szLicf1ibibg3GMhrWeCKGdMbar17XuA/640?wx_fmt=png)

用户在对话框中输入凭据后，模块将在终端上显示该凭据，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBMlyZqFE43Xz4LCO6XKPlMce9VLKwKAJcHl58fvw1icCGLOictaFVHmqw/640?wx_fmt=png)

**collection/toasted**  

-------------------------

PowerShell Empire 的此模块触发重启通知，就像需要更新并重新启动安装时生成的那样。要使用此模块，以下命令：

```
usemodule collection/toasted execute
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBxCgPBcQqkD7aGbjZBeSNuOPniaLUJ7dsQbw0IWa7Vn4tA625Jm5ytxQ/640?wx_fmt=png)

模块执行后，将显示以下对话框：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzB2icF8posMialV8PBreo6luUG4RWJcyciaCgUv3hZZATJVG4w282gp65Rg/640?wx_fmt=png)

单击 “Postpone” 按钮后，它将要求提供凭据以验证推迟决策，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBicUrtthFISyIg9iaK7rSaRe5s2XzRVUpOPFrOBX97p5BZIQHSTKpsxPA/640?wx_fmt=png)

当用户输入凭据时，它将打印它们，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBxwmKQO8ps1SUiasy4qkVnqjePQEFZApwJdfXVxUj77Zb1ticfDwSux0Q/640?wx_fmt=png)

**Koadic**  

-------------

可以在 Koadic 中找到与 PowerShell Empire 中的模块类似的模块。使用 Koadic 进行会话后，请使用以下命令触发对话框：

```
use password_box execute
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBGRx07plibfBpTg1EiaH6zAUHT4Y9h9ndpBPB3z7rWK7QP27v2uu6nYOw/640?wx_fmt=png)

当用户在对话框中输入用户名和密码时，密码也将显示在终端中，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBCE1MV4TjYJC7RB9RZS1ww4htFI2VKUx40sU2vTRmMf7QngIMLelS4w/640?wx_fmt=png)

**PowerShell：Invoke-CredentialsPhish.ps1**  

---------------------------------------------

有一个可以在 PowerShell 上运行的脚本，该脚本会创建伪造的登录提示，供用户输入凭据。

> 下载 Invoke-CredentialsPhish.ps1（https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Invoke-CredentialsPhish.ps1）

要启动脚本，请键入：

```
Import-Module C:\Users\raj\Desktop\Invoke-CredentialsPhish.ps1 Invoke-CredentialsPhish
```

执行以上命令将弹出提示询问凭据的提示，如下图所示：

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBSSaZbwWRIxGk2ddvPUA4Wlvxnwia39qA8Q5p9pSxDbK7VV6L1DrK0Vg/640?wx_fmt=png)

因此，用户输入凭据后，它们将显示在屏幕上，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBdEexFGqf5aOpfIhiciblK0gnNsCZSr974FDOKyQjrU0Y3vibhVaxtiaClg/640?wx_fmt=png)

**PowerShell：Invoke-LoginPrompt.ps1**  

----------------------------------------

同样，Matt Nelson 还开发了另一个脚本。

该脚本将再次打开一个对话框，供用户输入密码。

> 下载 Invoke-LoginPrompt.ps1
> 
> （https://raw.githubusercontent.com/enigma0x3/Invoke-LoginPrompt/master/Invoke-LoginPrompt.ps1）

要启动脚本，请输入以下内容：

```
Import-Module C:\Users\raj\Desktop\Invoke-LoginPrompt.ps1 Invoke-LoginPrompt.ps1
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBhkILcT2P99Btiaa3icEYnk9yqUMWHzSsnIEFo6F1RJIPMrBImISjficKw/640?wx_fmt=png)

如您所见，对话框将出现在屏幕上，并且用户输入了凭据，然后它们将再次显示在终端上。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBfbdrJlQawq34iarsBrpYJJqUFntsIB4gDFq26MWWibYNVKHKyUKPIQ0w/640?wx_fmt=png)

**Lockphish**  

----------------

Lockphish 是另一个允许我们仿冒凭据的工具，您可以从此处下载该工具。

https://github.com/thelinuxchoice/lockphish.git

该工具会创建一个模板，该模板看起来像是将用户重定向到 YouTube 视频，该模板将托管在 PHP 服务器中，但是它将提示用户输入登录凭据，然后将其发送给攻击者。

使用以下命令启动该工具：

```
./lockphish.sh
```

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBicfTU0FBaOey87Ump9koGZt7ee77QqicqBesibn7spmr5VpoiaYfTNnh7g/640?wx_fmt=png)

如上图所示，它将使用 ngrok 生成链接，并将该链接发送到目标。

当目标访问链接时，它询问用户是否保存文件。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBEg9vVSF3XPotY2tzpjpq30ibXeI49zcrkCt9Q1SQEnfdYVZc9tfd85A/640?wx_fmt=png)

在用户输入凭据后，它将把用户重定向到 YouTube。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzByYDvstI3ibnDdx7WJHAB74GNqm8HEmGicfdg0VWpEicg9asJSpuTq4uZQ/640?wx_fmt=png)

然后，在执行下载的文件时，将触发锁定屏幕，并且将迫使用户输入凭据，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzB2VjefibkNdraIcvVnOQicia4eovybQyReQFZw9gmRb1w8c3LzqG257riaA/640?wx_fmt=png)

这样，我们将拥有我们的凭据，如下图所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSGeg9icUWQBdfmBCou9LYfzBDE8Ej8DDMw7SuhGRicenj7z2B1ibZQ9FzJ1tp0wIhsaEqJCwpKDvNapg/640?wx_fmt=png)

**结论**  

---------

这些是我们可以用来转储目标系统凭据的各种方法。

根据情况，应使用适当的方法来转储凭据。

PowerShell 方法最好用于验证凭据，因为在输入正确的凭据之前提示不会关闭。

Lockphish 方法无法像其他工具一样准确地创建锁定屏幕，并且它也不会验证凭据。

因此，每种方法和工具都有其优点和缺点。但是他们都还不错。

声明：本公众号所分享内容仅用于网安爱好者之间的技术讨论，禁止用于违法途径，**所有渗透都需获取授权**！否则需自行承担，本公众号及原作者不承担相应的后果.

@

**欢迎关注视频号：“****掌控安全课堂****”**

**分享点那些黑客你不知道的事，每周二也会开直播唠唠嗑！**

**解决大家在自学上存在的烦恼！**

 ![](http://wx.qlogo.cn/finderhead/Q3auHgzwzM5GasbBjHczHC7IgL2AAuVMBjlg8WPebhsOVribyZXibibTQ/0) **掌控安全课堂** ， 黑客敲代码的多种状态。。# 程序员 #编程# 黑客 视频号 ‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍‍

[

爬取免费代理，拥有自己的代理池

2021-10-22

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSHaWlec76UcVgaVkib8uTLrZ9yNSDKjklBxYP3oCBQMUxxcf35EBIf6dibNWuDxbTb2RYUyWjKupLXw/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247538507&idx=1&sn=012e95638679390d727ad9ac76f8093a&chksm=ebea1e66dc9d977076c87f955d303509c6a5dee9f498e18669ed25463d9403d7bd7fa2935277&scene=21#wechat_redirect)

[

Burpsuite 在各场景下的抓包方法 (整理)

2021-08-11

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGxyQDNlLJqgCtl0uVbspVnw7mIx6WzWt0EyBfIZ4TEg0xoVhnq0aQ1C3LAwTjqkkBBQVuGCVmbbQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247530928&idx=1&sn=46ce72097822348cd6d17e2941e60db6&chksm=ebea309ddc9db98bece713fa8eec5b2c9f47cdfb5921c976319c555d627dcd3ec2dc1dee58b6&scene=21#wechat_redirect)

[

【精选】SRC 快速入门 + 上分小秘籍 + 实战指南

2021-07-26

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSG4hnDrcfyBr4yp6gXLibsXuBFUwfZlEFxK6tMHyUPcQlkWKhoafcKcoh8X6nw6O359kfhkHDYoLmg/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247528604&idx=1&sn=5ab3a5b3eaf0c56fcdeabccadfdc6bde&chksm=ebea39b1dc9db0a71fa71d233709afdfd2e2e0483ded28cca42044eded300f1c7025bde1b37a&scene=21#wechat_redirect)

[

干货｜列了几种均能过安全狗的方法！

2021-07-01

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSG24NfnFAyvceedkicO9fPkUwQ9X1L8owPwAichgQibfKV9RPxFibr8ia1JmdjjyFSGlUu97qfecE9iczCQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247524943&idx=1&sn=98644144a3c10bb068ec0f310dcc4958&chksm=ebea2b62dc9da2749321fce7ab28788ced08a2b496e0a45b06a5887b5aa457e48f7a66110301&scene=21#wechat_redirect)

[

巧用 FOFA 挖到你的第一个漏洞

2021-06-08

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSEJumG6X6C1M75AVwnphgU4wO2tIdSFib6hV6m4GLica2XGIEP1ujeNm1WVia1S6wFOV4RBB13FoxXIw/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247521952&idx=1&sn=55ab0613e5a7ba79b78849b4d91451f6&chksm=ebeadf8ddc9d569bcc64e99414dcbe6878a0b2c9f5c057b30c4bbe465ba76fcaa64e66caa0c2&scene=21#wechat_redirect)

[

一名大学生的黑客成长史到入狱的自述

2020-12-22

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGzeY0rLibT3cqh51icktS1tKjpxm4A8ib17UC35kYoXLiak8X7Ugtu2rW2BRth3X5vKickew16jMibak2A/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247502926&idx=1&sn=8750295399cdcc5e71918c30bb1a974f&chksm=ebea8563dc9d0c75cdf709d2d16fdbdf82abee64516f7a44347f40056969d1b4bc3a1eb2ab2e&scene=21#wechat_redirect)

[

那些年的 Hvv 日记

2021-04-17

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSFRZS6XmvwR7KNeLGxuk6C4NDAawNMNvfHW7iacLEa7nYTUTCDQrfQcvRdfShEKtv7W9DWSufrYKlQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247515246&idx=1&sn=b1a73a93f8ce9a5d51ce3bed4ada1e56&chksm=ebeaf543dc9d7c557c36881cccaaffad5312938ad0450dc1e4050de583523c2a27ba5ab3a469&scene=21#wechat_redirect)

**看到这里了，点个 “赞”、“再看” 吧**