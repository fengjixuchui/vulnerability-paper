<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/D355g7dTycERba5Nhy8fug)

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrynhicSC9oWDibJEW3BUhEIWManZGCkeyNxMv9pQzctc5ZF2mlFAnYQegWvg559w1Gw4nJndYHQaJUg/640?wx_fmt=png)

**戟星安全实验室**

    忆享科技旗下高端的网络安全攻防服务团队. 安服内容包括渗透测试、代码审计、应急响应、漏洞研究、威胁情报、安全运维、攻防演练等

  

![](https://mmbiz.qpic.cn/mmbiz_png/b9vsTqmMg8w1eHrhL1E3WPdIVq0aIhciadAqvCP0hNKprCFU0n0Wl0vYz2lzq1cwOFSXyPNJicISSFD60ojmUlbw/640?&wx_fmt=png)

  

本文约 2512 字，阅读约需 7 分钟。

![](https://mmbiz.qpic.cn/mmbiz_png/40ZgxTCS1oX0o8VkyRJnCuPU9YaZ05Xryz81mg3Udos5sNZIjFDxMM8w22tNqia33EIRDynoS0CUEbyfDppkz5Q/640?&wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

三个模拟浏览器操作库

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

selenium

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

是最广泛使用的开源 Web UI（用户界面）自动化测试套件之一。它最初由杰森 · 哈金斯（Jason Huggins）于 2004 年开发，作为 Thought Works 的内部工具。Selenium 支持跨不同浏览器，平台和编程语言的自动化。

Selenium 通过使用特定于每种语言的驱动程序支持各种编程语言。Selenium 支持的语言包括 C#，Java，Perl，PHP，Python 和 Ruby

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

pyppeteer

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

Puppeteer 的 Python 版本的实现，在 puppeteer 之上稍微包装了下，Puppeteer 是 Google 基于 Node.js 开发的一个工具，主要是用来操纵 Chrome 浏览器的 API，通过 Javascript 代码来操纵 Chrome 浏览器的一些操作，用作网络爬虫完成数据爬取、Web 程序自动测试等任务，其 API 极其完善，功能非常强大

pyppeteer 的 web 自动化是基于 chromium 来实现的，仅支持 chromium 浏览器。同时它不是官方库，很久未维护了

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

对比

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

Pyppeteer 在安装配置的便利性和运行效率方面都要远胜 selenium，一些简单操作比 selenium 来的快

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

另一个 Playwright

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

微软开发，有维护，新出，模拟人工操作，可直接根据操作生成代码

playwright-python，是一款基于 python 的自动化测试工具，可以通过录制功能自动生成测试脚本；Playwright 是一个强大的 Python 库，仅用一个 API 即可自动执行 Chromium、Firefox、WebKit（Safari ）等主流浏览器自动化操作，并同时支持以无头模式、有头模式运行。

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

Selenium+Browsermobproxy 实现异步流量获取

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

browsermobproxy 是一个 java 开发的抓包工具，因此运行环境需要要 java

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5TVbRdRe0iaKabxHDnzZ3v7M6R2dKMEQ5NqesccaOAKsicrVFNKFtCVu8A/640?wx_fmt=png)

开启流量代理

```
# 开启Proxy服务
self._bmpserver = browsermobproxy.Server(self._BMP_path, options=self._BMP_options)
self._bmpserver.start()
# 开启对服务器信任选项 params={"trustAllServers": "true"}
self._bmpclient = self._bmpserver.create_proxy(params={"trustAllServers": "true"})
# 流量走代理监听
option.add_argument("--proxy-server={}".format(self._bmpclient.proxy))
```

导出流量，都是以字典结构保存的

```
# 设置捕获请求头和内容、二进制内容 options={'captureHeaders': True, 'captureContent': True, 'captureBinaryContent':True}
self._bmpclient.new_har(options={'captureHeaders': captureHeader, 'captureContent': captureContent})
self._chrome_driver.get(target)
self._chromeloads()

# 导出流量
result = self._bmpclient.har
for entry in result['log']['entries']:
    _url = entry['request']['url']
    print("请求地址：", _url)
```

使用属性来配置是否保留 http 的头和内容，都保留和 burp 一样，都不保留则只记录访问 url 信息

new_har(options={'captureHeaders': True, 'captureContent': True})

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5T1XYh9sE6hpIaeehZqpia4mKjKZ3uC1JhkXaWStO0c46O9v29JW4IB6g/640?wx_fmt=png)

browsermobproxy 会保存访问目标过程中产生的全部请求

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5THiaJ6uxqNdzYOsCdlFnFomT0Y4HBS2grazERJmA4jhkK2AT0iabXPorA/640?wx_fmt=png)

selenium 默认的网页加载模式是 “网页全部资源加载”，但是面对某宇盾时，会误认为防护脚本（某个 js 页面）是目标网页，需要设置延时大于 1 秒来绕过，可以用某 vnd 站来测试

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5TibqfFrzLgVdSHdcxNFl3XiakydaoASDwcpiakf9sEQc8RlICepGppNvkQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

selenium 的防反爬检测

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

stealth.min.js

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

主要以过 https://bot.sannysoft.com / 这个检测为目标

js 文件获取

https://cdn.jsdelivr.net/gh/requireCool/stealth.min.js/stealth.min.js

如果失效在 github 或 Google 搜索找一下

用法很简便，使用 execute_cdp_cmd 执行 js 脚本即可

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5T58hN7uVcFzS7YvOSswpJ84LG5BGPxJXhickVUSbr1PKO6Gia6SbibNmkg/640?wx_fmt=png)

伪造效果  

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5TgBJ5U5DPD2PZHYoyM3ib9rjncok9FbbAuJXvHpcGUP2l6DyZV5YERvw/640?wx_fmt=png)

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

selenium_stealth

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

py 的一个反反爬库

pip3 install selenium-stealth

同样使用简便，还可以直接自定义一些信息

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5TedfLP0ftso2yuBDggwpI7bjdYrjqEKFqCKpbUERCHAViaF1BaMZib3rQ/640?wx_fmt=png)

效果

![](https://mmbiz.qpic.cn/mmbiz_png/SE49V9dKJrxnvUawtpIBcDDIlqHpSl5TicibYoFMPVLXJPvM0FpqOI8CrgyPmkojAHfDRNLlIQgQI7CdRHtmDupQ/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

手动配置（不推荐）  

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

使用 execute_cdp_cmd 去挨个配置选项值，如下配置 webdriver 属性

```
# 设置webdriver
driver.execute_cdp_cmd("Page.addScriptToEvaluateOnNewDocument", {
    "source": """() => {
const newProto = navigator.__proto__
delete newProto.webdriver
navigator.__proto__ = newProto
"""
})
```

这种方式适用于一些专业的防反爬处理，性价比低，不推荐用

  

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?&wx_fmt=png)

往期回顾

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?&wx_fmt=png)

  

[【干货分享】Swaks+163 邮箱邮件伪造](http://mp.weixin.qq.com/s?__biz=MzkzMDMwNzk2Ng==&mid=2247504397&idx=1&sn=4ced20e52d30588629883ff7c3797bbc&chksm=c27ed81cf509510ac1d7fde9df5f904f8abd46f2a73ee8eea9034fa336e520c1793fb0b8fcc8&scene=21#wechat_redirect)  

[【奇技淫巧】教你零成本拥有高匿 C2](http://mp.weixin.qq.com/s?__biz=MzkzMDMwNzk2Ng==&mid=2247503963&idx=1&sn=e9d64d6d719ec2305d1b8e5574896c08&chksm=c27eda4af509535cd4ccb6c0f718e6a48705d68abbd540689d205f690875da6f06a319f3d57e&scene=21#wechat_redirect)  

[【干货分享】互联网资产搜集平台大全](http://mp.weixin.qq.com/s?__biz=MzkzMDMwNzk2Ng==&mid=2247503302&idx=1&sn=84ac69ebd11952eddaff567a6ac490a5&chksm=c27ec7d7f5094ec17541abb49bb8faf33a3c9aa0e26da416810ab571f3b894300805b311819c&scene=21#wechat_redirect)  

  

  

  

  

  

  

**声明**

    由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，戟星安全实验室及文章作者不为此承担任何责任。

    戟星安全实验室拥有对此文章的修改和解释权。如欲转载或传播此文章，必须保证此文章的完整性，包括版权声明等全部内容。未经戟星安全实验室允许，不得任意修改或者增减此文章内容，不得以任何方式将其用于商业目的。

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/voBb9QGGTa1VlLsnMnOwBwHInPLkOT9G4xFAL1XlgXqgauxolmmt45qfPicZPhgpIP1AThc6EO3eXNVURDkvwBw/640?&wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/b9vsTqmMg8w1eHrhL1E3WPdIVq0aIhciadAqvCP0hNKprCFU0n0Wl0vYz2lzq1cwOFSXyPNJicISSFD60ojmUlbw/640?&wx_fmt=png)

  

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/SE49V9dKJrynhicSC9oWDibJEW3BUhEIWMV4H85J4YckN52SrMs6g39J9hFmm1gicqv7aoxqzzueEib840W2oUlFXg/640?wx_fmt=jpeg)

戟星安全实验室

# 长按二维码 || 点击下方名片 关注我们 #

![图片](https://mmbiz.qpic.cn/mmbiz_png/40ZgxTCS1oX0o8VkyRJnCuPU9YaZ05Xryz81mg3Udos5sNZIjFDxMM8w22tNqia33EIRDynoS0CUEbyfDppkz5Q/640?&wx_fmt=png)