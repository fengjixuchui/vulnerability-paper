> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/ajKJPY4CZHMAUi27dodrng)

**前言:**

如果我们双击cmd程序那么他的父进程就是explorer.exe

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/rFvFNYa3ibHYxiarKXxBn46hzHOMv3rww1ia6IRHZUThwUsPfEB5WN1z7nPThDIHpsbiaZj7uORq8B2IqzbkMjbALQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

![图片](https://mmbiz.qpic.cn/mmbiz_png/rFvFNYa3ibHYxiarKXxBn46hzHOMv3rww1MU6JhK6KGlhJYF0yq4DVVEQUqAxIVk3FwgXIcKbqnyms9aQJklMicIg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

有时候运维人员会去看可疑的父进程，那么这个时候通过一些手法改变父进程名字  

  

**思路:**  

主要是利用操作系统API UpdateProcThreadAttribute的第三个参数PROC_THREAD_ATTRIBUTE_PARENT_PROCESS，当函数调用成功之后，当前调用函数的进程再创建进程的话，创建出来的子进程的父进程就会变成第4个进程句柄的进程

  

这个程序会打开一个cmd程序  

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

这里填我们欺骗的父进程  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)

  

  

如果我这里双击打开那么他的父进程就是explorer.exe，现在的父进程是winlogon.exe，欺骗成功

  

![图片](data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==)